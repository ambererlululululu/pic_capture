<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›ç­”å¯¹æ¯”</title>
    <style>
        /* ===== è®¾è®¡ä»¤ç‰Œç³»ç»Ÿ ===== */
        :root {
            /* é¢œè‰²ç³»ç»Ÿ */
            --bg: #ffffff;
            --surface: #ffffff;
            --text: #111827;
            --muted: #6b7280;
            --brand: #2563eb;
            --brand-hover: #1d4ed8;
            --border: #e5e7eb;
            --hover: #f3f4f6;
            --success: #10b981;
            --danger: #dc2626;
            --warning: #f59e0b;
            
            /* åœ†è§’ç³»ç»Ÿ */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            
            /* é˜´å½±ç³»ç»Ÿ */
            --elev-1: 0 1px 3px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
            --elev-2: 0 4px 20px rgba(0,0,0,.08);
            --elev-3: 0 8px 24px rgba(0,0,0,.12);
            --elev-dropdown: 0 8px 24px rgba(0,0,0,.15);
            
            /* é—´è·ç³»ç»Ÿ */
            --space-2: 8px;
            --space-4: 16px;
            --space-6: 24px;
            --space-8: 32px;
            --space-12: 48px;
            --space-16: 64px;
            
            /* å­—å·è¡Œé«˜ç³»ç»Ÿ */
            --fs-12: 12px;
            --fs-14: 14px;
            --fs-16: 16px;
            --fs-20: 20px;
            --fs-24: 24px;
            --lh-1_4: 1.4;
            --lh-1_6: 1.6;
            
            /* è¿‡æ¸¡åŠ¨ç”» */
            --transition: box-shadow .2s, transform .15s, border-color .2s, background .2s;
        }
        
        /* æš—è‰²ä¸»é¢˜æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --surface: #1e293b;
                --text: #f1f5f9;
                --muted: #94a3b8;
                --border: #334155;
                --hover: #334155;
            }
        }

        /* ===== åŸºç¡€é‡ç½®ä¸å…¨å±€æ ·å¼ ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: var(--lh-1_6);
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: auto;
            font-size: var(--fs-14);
        }

        .container {
            width: 100%;
            margin: 0;
            padding: var(--space-6);
            max-width: none;
        }

        /* ===== é¡¶éƒ¨Headerç»„ä»¶ ===== */
        .header {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            box-shadow: var(--elev-2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .header:hover {
            box-shadow: var(--elev-3);
        }

        .header h1 {
            font-size: var(--fs-24);
            font-weight: 600;
            color: var(--text);
            margin: 0;
        }

        .upload-section {
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-button {
            background: var(--brand);
            color: white;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            border: none;
            cursor: pointer;
            font-size: var(--fs-14);
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--elev-1);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .file-input-button:hover {
            background: var(--brand-hover);
            transform: translateY(-1px);
            box-shadow: var(--elev-2);
        }

        .file-input-button:focus-visible {
            outline: 2px solid var(--brand);
            outline-offset: 2px;
        }

        .file-name {
            color: var(--muted);
            font-size: var(--fs-14);
            margin-left: var(--space-2);
        }

        /* ===== æŸ¥è¯¢æ˜¾ç¤ºå¡ç‰‡ ===== */
        .query-display {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            margin-bottom: var(--space-6);
            border-left: 4px solid var(--brand);
            backdrop-filter: blur(10px);
            box-shadow: var(--elev-2);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .query-display:hover {
            box-shadow: var(--elev-3);
        }

        .query-display.sticky {
            position: sticky;
            top: var(--space-4);
            z-index: 100;
            box-shadow: var(--elev-3);
        }

        .query-text {
            font-size: var(--fs-20);
            font-weight: 600;
            line-height: var(--lh-1_6);
            color: var(--text);
            margin-bottom: var(--space-4);
        }

        .query-number {
            font-size: var(--fs-12);
            font-weight: 500;
            color: var(--muted);
            padding: var(--space-2) var(--space-4);
            background: var(--hover);
            border-radius: var(--radius-sm);
            display: inline-block;
            backdrop-filter: blur(5px);
            border: 1px solid var(--border);
            margin-left: var(--space-4);
        }

        .query-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
        }

        .nav-buttons {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }

        /* ===== æœç´¢ä¸‹æ‹‰æ¡† ===== */
        .search-results {
            position: fixed;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            box-shadow: var(--elev-dropdown);
            max-height: 320px;
            overflow-y: auto;
            z-index: 9999999;
            display: none;
            margin-top: 0px;
            width: 200px;
            backdrop-filter: blur(10px);
        }

        .search-result-item {
            padding: var(--space-2) var(--space-4);
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .search-result-item:hover {
            background: var(--hover);
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-number {
            font-weight: 600;
            color: var(--brand);
            margin-right: var(--space-2);
        }

        .search-result-content {
            color: var(--text);
            font-size: var(--fs-14);
            line-height: var(--lh-1_4);
        }

        .search-section {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: var(--space-2);
            position: relative;
        }

        .search-controls {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .search-type-select {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--fs-14);
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
        }

        .search-type-select:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-type-select:focus-visible {
            outline: 2px solid var(--brand);
            outline-offset: 2px;
        }

        .search-input {
            padding: var(--space-2) var(--space-4);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            font-size: var(--fs-14);
            width: 200px;
            transition: var(--transition);
            background: var(--surface);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-input:focus-visible {
            outline: 2px solid var(--brand);
            outline-offset: 2px;
        }

        .search-button {
            background: var(--brand);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--fs-14);
            font-weight: 500;
            transition: var(--transition);
            box-shadow: var(--elev-1);
        }

        .search-button:hover {
            background: var(--brand-hover);
            transform: translateY(-1px);
            box-shadow: var(--elev-2);
        }

        .search-button:focus-visible {
            outline: 2px solid var(--brand);
            outline-offset: 2px;
        }

        /* ===== å¯¼èˆªæŒ‰é’® ===== */
        .nav-button {
            background: var(--brand);
            color: white;
            border: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-size: var(--fs-14);
            font-weight: 500;
            transition: var(--transition);
            min-width: 80px;
            height: 36px;
            backdrop-filter: blur(10px);
            box-shadow: var(--elev-1);
        }

        .nav-button:hover:not(:disabled) {
            background: var(--brand-hover);
            transform: translateY(-1px);
            box-shadow: var(--elev-2);
        }

        .nav-button:focus-visible {
            outline: 2px solid var(--brand);
            outline-offset: 2px;
        }

        .nav-button:disabled {
            background: var(--muted);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .query-info {
            color: var(--muted);
            font-size: var(--fs-14);
            font-weight: 500;
            background: var(--hover);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-sm);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border);
        }

        /* ===== åˆ—é€‰æ‹©å¡ç‰‡ ===== */
        .column-selection {
            background: var(--surface);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
            box-shadow: var(--elev-2);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .column-selection:hover {
            box-shadow: var(--elev-3);
        }

        .column-selection.collapsed {
            padding: var(--space-3) var(--space-4);
        }

        .column-selection.expanded {
            padding: var(--space-6);
        }

        .column-selection h3 {
            font-size: var(--fs-20);
            font-weight: 600;
            margin-bottom: var(--space-4);
            color: var(--text);
        }

        .column-selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 0;
            border-radius: var(--radius-lg);
            transition: var(--transition);
            user-select: none;
        }

        .column-selection-header:hover {
            background: var(--hover);
            padding: var(--space-2);
            margin: calc(-1 * var(--space-2));
        }

        .column-selection-header h3 {
            margin: 0;
            font-size: var(--fs-18);
            font-weight: 600;
            color: var(--text);
        }

        .toggle-icon {
            font-size: var(--fs-16);
            color: var(--muted);
            transition: transform 0.2s ease;
        }

        .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .column-selection-content {
            padding: 0 var(--space-4) var(--space-4);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        .auto-mode-checkbox {
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--border);
        }

        .auto-mode-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--brand);
            outline: none;
            border: 1px solid var(--border);
        }

        .auto-mode-checkbox input[type="checkbox"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .auto-mode-checkbox label {
            margin-left: var(--space-2);
            font-size: var(--fs-14);
            font-weight: 500;
            color: var(--text);
            cursor: pointer;
        }

        .column-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-4);
            align-items: center;
        }

        .column-checkbox {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            transition: var(--transition);
        }

        .column-checkbox:hover {
            background: var(--hover);
        }

        .column-checkbox input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
            accent-color: var(--brand);
            outline: none;
            border: 1px solid var(--border);
        }

        .column-checkbox input[type="checkbox"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .column-checkbox input[type="checkbox"]:checked {
            background: var(--brand);
            border-color: var(--brand);
        }

        .column-checkbox label {
            cursor: pointer;
            font-size: var(--fs-14);
            color: var(--text);
            transition: var(--transition);
        }

        .column-checkbox label:hover {
            color: var(--brand);
        }

        /* ===== å¯¹æ¯”ç½‘æ ¼ ===== */
        .comparison-grid {
            display: grid;
            gap: var(--space-6);
            margin-bottom: var(--space-6);
            width: 100%;
            grid-auto-rows: 1fr;
            align-items: stretch;
        }

        .comparison-column {
            background: var(--surface);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            box-shadow: var(--elev-2);
            min-width: 0;
            overflow-wrap: break-word;
            flex: 1;
            width: 100%;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            cursor: grab;
            position: relative;
        }

        .comparison-column:hover {
            box-shadow: var(--elev-3);
        }

        .comparison-column.dragging {
            cursor: grabbing;
            opacity: 0.7;
            transform: rotate(2deg);
            z-index: 1000;
        }

        .comparison-column.drag-over {
            border: 2px dashed var(--brand);
            background: rgba(37, 99, 235, 0.05);
        }

        .drag-handle {
            position: absolute;
            top: var(--space-2);
            left: var(--space-2);
            width: 24px;
            height: 24px;
            background: var(--hover);
            border-radius: var(--radius-sm);
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
            font-size: 14px;
            color: var(--muted);
            border: 1px solid var(--border);
            user-select: none;
            right: auto;
            z-index: 1000;
        }

        .comparison-column:hover .drag-handle {
            opacity: 1;
        }

        .drag-handle:hover {
            background: var(--brand);
            color: white;
            border-color: var(--brand);
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* å­—æ•°å¾½æ ‡ */
        .char-count-badge {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            background: var(--brand);
            color: white;
            border: 1px solid var(--brand);
            font-size: var(--fs-12);
            font-weight: 500;
            line-height: 1;
            user-select: none;
            z-index: 1001;
            box-shadow: var(--elev-1);
        }

        .char-count-badge.char-count-badge--max {
            background: #ef4444; /* red-500 */
            border-color: #ef4444;
        }

        .column-header {
            font-size: var(--fs-20);
            font-weight: 600;
            color: var(--brand);
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-2);
            border-bottom: 2px solid var(--border);
            flex-shrink: 0;
        }

        .column-content {
            color: var(--text);
            line-height: var(--lh-1_6);
            flex: 1;
            overflow-y: auto;
        }

        /* ===== ç©ºçŠ¶æ€ ===== */
        .empty-state {
            text-align: center;
            padding: var(--space-16) var(--space-6);
            color: var(--muted);
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--elev-2);
            border: 1px solid var(--border);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-4);
            opacity: 0.6;
        }

        .empty-state-text {
            font-size: var(--fs-16);
            margin-bottom: var(--space-2);
            font-weight: 500;
        }

        .empty-state-subtext {
            font-size: var(--fs-14);
            color: var(--muted);
        }

        /* ===== å“åº”å¼è®¾è®¡ ===== */
        @media (max-width: 1440px) {
            .container {
                padding: var(--space-4);
            }
            
            .comparison-grid {
                gap: var(--space-4);
            }
        }

        @media (max-width: 1280px) {
            .header {
                flex-direction: column;
                gap: var(--space-4);
                text-align: center;
            }
            
            .query-nav {
                flex-direction: column;
                gap: var(--space-4);
            }
            
            .search-section {
                margin-left: 0;
                width: 100%;
            }
            
            .search-controls {
                flex-direction: column;
                width: 100%;
                gap: var(--space-2);
            }
            
            .search-type-select {
                width: 100%;
            }
            
            .search-input {
                width: 100%;
            }
        }

        @media (max-width: 1024px) {
            .column-checkboxes {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: var(--space-2);
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--space-2);
            }
            
            .header h1 {
                font-size: var(--fs-20);
            }
            
            .query-text {
                font-size: var(--fs-16);
            }
            
            .column-selection h3 {
                font-size: var(--fs-16);
            }
            
            .column-header {
                font-size: var(--fs-16);
            }
            
            .nav-buttons {
                flex-direction: column;
                width: 100%;
            }
            
            .nav-button {
                width: 100%;
            }
        }

        /* ===== å¯è®¿é—®æ€§å¢å¼º ===== */
        @media (prefers-reduced-motion: reduce) {
            * {
                transition: none !important;
                animation: none !important;
            }
        }

        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ */
        @media (prefers-contrast: high) {
            :root {
                --border: #000000;
                --text: #000000;
                --muted: #333333;
            }
        }

        /* ===== Markdownæ¸²æŸ“æ ·å¼ä¼˜åŒ– ===== */
        /* æ ‡é¢˜æ ·å¼ - ä½¿ç”¨è®¾è®¡ä»¤ç‰Œ */
        .markdown-h1{font-size:var(--fs-24);font-weight:600;color:var(--text);margin-top:var(--space-4);margin-bottom:var(--space-2);line-height:1.3}
        .markdown-h2{font-size:var(--fs-20);font-weight:600;color:var(--text);margin-top:var(--space-4);margin-bottom:var(--space-2);line-height:1.4}
        .markdown-h3{font-size:var(--fs-16);font-weight:600;color:var(--brand);margin-top:var(--space-4);margin-bottom:var(--space-2);line-height:1.4}
        .markdown-h4{font-size:var(--fs-16);font-weight:600;color:var(--text);margin:var(--space-4) 0 var(--space-2);line-height:1.4}
        .markdown-h5{font-size:var(--fs-14);font-weight:600;color:var(--text);margin:var(--space-4) 0 var(--space-2);line-height:1.4}
        .markdown-h6{font-size:var(--fs-12);font-weight:600;color:var(--muted);margin:var(--space-2) 0 var(--space-2);line-height:1.4}
        /* æ®µè½æ ·å¼ */
        .markdown-p{margin:0 0 var(--space-4);line-height:var(--lh-1_6);color:var(--text)}
        /* åˆ—è¡¨æ ·å¼ */
        .markdown-ul{margin:0 0 var(--space-4);list-style-type:disc;list-style-position:inside}
        .markdown-ol{margin:0 0 var(--space-4);list-style-type:decimal;list-style-position:inside}
        .markdown-li{margin-bottom:var(--space-2);line-height:var(--lh-1_4);color:var(--text)}
        .markdown-blockquote{border-left:4px solid var(--brand);background:var(--hover);padding:var(--space-4) var(--space-4);margin:var(--space-4) 0;border-radius:0 var(--radius-md) var(--radius-md) 0;color:var(--muted);font-style:italic}
        /* ä»£ç æ ·å¼ */
        .markdown-code{background:var(--hover);color:var(--danger);padding:var(--space-2) var(--space-2);border-radius:var(--radius-sm);font-family:ui-monospace,Menlo,monospace;font-size:0.9em}
        /* è¡¨æ ¼æ ·å¼ */
        .markdown-table-wrapper{overflow-x:auto;margin:var(--space-4) 0;-webkit-overflow-scrolling:touch}
        .markdown-table{border-collapse:collapse;width:100%;border:1px solid var(--border);min-width:500px}
        .markdown-table thead,.markdown-table-thead{background:var(--hover)}
        .markdown-table th,.markdown-table-th{background:var(--hover);border:1px solid var(--border);padding:var(--space-2) var(--space-4);text-align:left;font-weight:600;font-size:var(--fs-14);min-width:80px;white-space:nowrap;vertical-align:top}
        .markdown-table td,.markdown-table-td{border:1px solid var(--border);padding:var(--space-2) var(--space-4);font-size:var(--fs-14);min-width:100px;max-width:250px;vertical-align:top}
        .markdown-table tr,.markdown-table-tr{border-bottom:1px solid var(--border)}
        .markdown-hr{border:none;border-top:1px solid var(--border);margin:var(--space-6) 0}
        .markdown-link{color:var(--brand);text-decoration:none;border-bottom:1px solid transparent;transition:var(--transition)}
        .markdown-link:hover{color:var(--brand-hover);border-bottom-color:var(--brand)}
        .markdown-del{text-decoration:line-through;color:var(--muted)}
        .markdown-pre{background:var(--hover);border:1px solid var(--border);border-radius:var(--radius-sm);padding:var(--space-4);margin:var(--space-4) 0;overflow-x:auto;font-family:ui-monospace,Menlo,monospace;font-size:0.9em;line-height:var(--lh-1_6)}
        .markdown-code-block{background:transparent;padding:0;border:none;color:var(--text);white-space:pre-wrap}
        .markdown-img{max-width:100%;height:auto;border-radius:var(--radius-md);margin:var(--space-4) 0;display:block}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>å›ç­”å¯¹æ¯”</h1>
            <div class="upload-section">
                <div class="file-input-wrapper">
                    <input type="file" id="excelFile" class="file-input" accept=".xlsx,.xls" />
                    <button class="file-input-button">ä¸Šä¼ Excelæ–‡ä»¶</button>
                </div>
                <span id="fileName" class="file-name"></span>
            </div>
        </div>

        <!-- Query Display -->
        <div class="query-display" id="queryDisplay" style="display: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div class="query-text" id="queryText"></div>
                    <div class="query-number" id="queryNumber"></div>
                </div>
            </div>
            <div class="query-nav">
                <div class="nav-buttons">
                    <button class="nav-button" id="prevQuery" onclick="previousQuery()">ä¸Šä¸€ä¸ª</button>
                    <button class="nav-button" id="nextQuery" onclick="nextQuery()">ä¸‹ä¸€ä¸ª</button>
                    <div class="query-info" id="queryInfo"></div>
                </div>
                <div class="search-section">
                    <div class="search-controls">
                        <select id="searchType" class="search-type-select">
                            <option value="number">æœç´¢ç¼–å·</option>
                            <option value="content">æœç´¢å†…å®¹</option>
                        </select>
                        <div style="position: relative;">
                            <input type="text" id="searchInput" class="search-input" placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹..." />
                            <div class="search-results" id="searchResults"></div>
                        </div>
                    </div>
                    <button class="search-button" onclick="searchQuery()">æœç´¢</button>
                </div>
            </div>
        </div>

        <!-- Column Selection -->
        <div class="column-selection" id="columnSelection" style="display: none;">
            <div class="column-selection-header" onclick="toggleColumnSelection()">
                <h3>æ¨¡å‹åº”ç”¨é€‰æ‹©</h3>
                <span class="toggle-icon" id="toggleIcon">â–¼</span>
            </div>
            <div class="column-selection-content" id="columnSelectionContent" style="display: none;">
                <div class="auto-mode-checkbox">
                    <input type="checkbox" id="autoMode" checked onchange="toggleAutoMode()">
                    <label for="autoMode">ä»…å±•ç¤ºæœ‰å›å¤çš„æ¨¡å‹</label>
                </div>
                <div class="column-checkboxes" id="columnCheckboxes"></div>
            </div>
        </div>

        <!-- Comparison Grid -->
        <div class="comparison-grid" id="comparisonGrid"></div>

        <!-- Empty State -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">ğŸ“Š</div>
            <div class="empty-state-text">è¯·ä¸Šä¼ Excelæ–‡ä»¶å¼€å§‹å¯¹æ¯”</div>
            <div class="empty-state-subtext">æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let excelData = null;
        let currentQueryIndex = 0;
        let selectedColumns = [];
        let autoMode = true; // é»˜è®¤å¼€å¯è‡ªåŠ¨æ¨¡å¼

        // æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                loadExcelFile(file);
            }
        });

        // åŠ è½½Excelæ–‡ä»¶
        function loadExcelFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    excelData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    if (excelData.length > 0) {
                        setupColumnSelection();
                        showQueryDisplay();
                        updateQueryDisplay();
                    }
                } catch (error) {
                    alert('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    console.error('Excel parsing error:', error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // åˆ‡æ¢è‡ªåŠ¨æ¨¡å¼
        function toggleAutoMode() {
            const autoModeCheckbox = document.getElementById('autoMode');
            autoMode = autoModeCheckbox.checked;
            
            if (autoMode) {
                // å¼€å¯è‡ªåŠ¨æ¨¡å¼ï¼Œæ¸…ç©ºæ‰‹åŠ¨é€‰æ‹©çš„æ¨¡å‹
                clearManualSelection();
                updateComparisonGrid();
            } else {
                // å…³é—­è‡ªåŠ¨æ¨¡å¼ï¼Œä½¿ç”¨æ‰‹åŠ¨é€‰æ‹©çš„æ¨¡å‹
                updateColumnSelection();
            }
        }

        // æ¸…ç©ºæ‰‹åŠ¨é€‰æ‹©çš„æ¨¡å‹
        function clearManualSelection() {
            const checkboxes = document.querySelectorAll('#columnCheckboxes input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
        }

        // åˆ‡æ¢åˆ—é€‰æ‹©åŒºåŸŸçš„å±•å¼€/æŠ˜å 
        function toggleColumnSelection() {
            const content = document.getElementById('columnSelectionContent');
            const icon = document.getElementById('toggleIcon');
            const container = document.getElementById('columnSelection');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.classList.add('expanded');
                container.classList.remove('collapsed');
                container.classList.add('expanded');
            } else {
                content.style.display = 'none';
                icon.classList.remove('expanded');
                container.classList.remove('expanded');
                container.classList.add('collapsed');
            }
        }

        // è®¾ç½®åˆ—é€‰æ‹©
        function setupColumnSelection() {
            const checkboxesContainer = document.getElementById('columnCheckboxes');
            const columnSelection = document.getElementById('columnSelection');
            const content = document.getElementById('columnSelectionContent');
            
            // å›ºå®šæ˜¾ç¤º9ä¸ªæ¨¡å‹é€‰é¡¹ï¼Œä¸ä¾èµ–Excelæ•°æ®
            const modelOptions = [
                'Deepseek',
                'ChatGPT', 
                'ç‚¹ç‚¹',
                'Kimi',
                'è±†åŒ…',
                'Gemini',
                'é—®ä¸€é—®',
                'Grok',
                'å…ƒå®'
            ];
            
            checkboxesContainer.innerHTML = '';
            
            modelOptions.forEach((modelName, index) => {
                const checkboxDiv = document.createElement('div');
                checkboxDiv.className = 'column-checkbox';
                checkboxDiv.innerHTML = `
                    <input type="checkbox" id="model_${index}" value="${modelName}" onchange="updateColumnSelection()">
                    <label for="model_${index}">${modelName}</label>
                `;
                checkboxesContainer.appendChild(checkboxDiv);
            });
            
            // æ˜¾ç¤ºåˆ—é€‰æ‹©åŒºåŸŸï¼Œä½†å†…å®¹é»˜è®¤æŠ˜å 
            columnSelection.style.display = 'block';
            content.style.display = 'none';
            columnSelection.classList.add('collapsed');
        }

        // æ›´æ–°åˆ—é€‰æ‹©
        function updateColumnSelection() {
            const checkboxes = document.querySelectorAll('#columnCheckboxes input[type="checkbox"]:checked');
            selectedColumns = [];
            
            // å¦‚æœç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©äº†æ¨¡å‹ï¼Œè‡ªåŠ¨å…³é—­è‡ªåŠ¨æ¨¡å¼
            if (checkboxes.length > 0) {
                autoMode = false;
                document.getElementById('autoMode').checked = false;
            }
            
            if (excelData && excelData.length > 0) {
                const headers = excelData[0];
                
                Array.from(checkboxes).forEach(cb => {
                    const modelName = cb.value;
                    // åœ¨Excelè¡¨å¤´ä¸­æŸ¥æ‰¾å¯¹åº”çš„åˆ—ç´¢å¼•
                    const columnIndex = headers.findIndex(header => 
                        header && header.trim() === modelName
                    );
                    
                    if (columnIndex !== -1) {
                        selectedColumns.push({
                            index: columnIndex,
                            name: modelName
                        });
                    }
                });
            }
            
            updateComparisonGrid();
        }

        // æ˜¾ç¤ºæŸ¥è¯¢æ˜¾ç¤ºåŒºåŸŸ
        function showQueryDisplay() {
            document.getElementById('queryDisplay').style.display = 'block';
            document.getElementById('emptyState').style.display = 'none';
        }

        // æ›´æ–°æŸ¥è¯¢æ˜¾ç¤º
        function updateQueryDisplay() {
            if (!excelData || excelData.length <= 1) return;
            
            const currentRow = excelData[currentQueryIndex + 1]; // +1 å› ä¸ºç¬¬ä¸€è¡Œæ˜¯header
            const headers = excelData[0];
            
            // æŸ¥æ‰¾initial_questionåˆ—çš„ç´¢å¼•
            const initialQuestionIndex = headers.findIndex(header => 
                header && header.toLowerCase().includes('initial_question')
            );
            
            const queryColumn = initialQuestionIndex >= 0 ? currentRow[initialQuestionIndex] : currentRow[0];
            
            // è·å–ç¬¬äºŒåˆ—çš„ç¼–å·ï¼ˆç´¢å¼•1ï¼‰
            const queryNumber = currentRow[1] || 'æ— ç¼–å·';
            
            document.getElementById('queryText').textContent = queryColumn || 'æ— æŸ¥è¯¢å†…å®¹';
            document.getElementById('queryNumber').textContent = `ç¼–å·: ${queryNumber}`;
            document.getElementById('queryInfo').textContent = `ç¬¬ ${currentQueryIndex + 1} ä¸ªæŸ¥è¯¢ï¼Œå…± ${excelData.length - 1} ä¸ª`;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('prevQuery').disabled = currentQueryIndex === 0;
            document.getElementById('nextQuery').disabled = currentQueryIndex >= excelData.length - 2;
            
            updateComparisonGrid();
        }

        // ä¸Šä¸€ä¸ªæŸ¥è¯¢
        function previousQuery() {
            if (currentQueryIndex > 0) {
                currentQueryIndex--;
                updateQueryDisplay();
            }
        }

        // ä¸‹ä¸€ä¸ªæŸ¥è¯¢
        function nextQuery() {
            if (currentQueryIndex < excelData.length - 2) {
                currentQueryIndex++;
                updateQueryDisplay();
            }
        }

        // å®æ—¶æœç´¢å‡½æ•°
        function performSearch(searchTerm) {
            if (!excelData) return;

            const headers = excelData[0];
            const searchType = document.getElementById('searchType').value;
            
            // æŸ¥æ‰¾ç¼–å·åˆ—ï¼ˆç¬¬äºŒåˆ—ï¼‰å’Œå†…å®¹åˆ—ï¼ˆç¬¬ä¸‰åˆ—ï¼‰
            const numberColumnIndex = 1; // ç¬¬äºŒåˆ—
            const contentColumnIndex = 2; // ç¬¬ä¸‰åˆ—
            
            const searchResults = [];
            
            if (searchType === 'number') {
                // åªæœç´¢ç¼–å·ï¼ˆç¬¬äºŒåˆ—ï¼‰
                for (let i = 1; i < excelData.length; i++) {
                    const row = excelData[i];
                    const numberValue = row[numberColumnIndex];
                    
                    if (numberValue && numberValue.toString().toLowerCase().includes(searchTerm.toLowerCase())) {
                        searchResults.push({
                            index: i - 1,
                            type: 'ç¼–å·',
                            value: numberValue,
                            content: row[contentColumnIndex] || 'æ— å†…å®¹'
                        });
                    }
                }
            } else if (searchType === 'content') {
                // åªæœç´¢å†…å®¹ï¼ˆç¬¬ä¸‰åˆ—ï¼‰
                for (let i = 1; i < excelData.length; i++) {
                    const row = excelData[i];
                    const contentValue = row[contentColumnIndex];
                    
                    if (contentValue && contentValue.toString().toLowerCase().includes(searchTerm.toLowerCase())) {
                        searchResults.push({
                            index: i - 1,
                            type: 'å†…å®¹',
                            value: contentValue,
                            content: contentValue
                        });
                    }
                }
            }
            
            console.log('æœç´¢ç»“æœ:', searchResults);
            
            if (searchResults.length === 0) {
                hideSearchResults();
            } else if (searchResults.length === 1) {
                // åªæœ‰ä¸€ä¸ªç»“æœï¼Œç›´æ¥è·³è½¬
                currentQueryIndex = searchResults[0].index;
                updateQueryDisplay();
                hideSearchResults();
            } else {
                // å¤šä¸ªç»“æœï¼Œæ˜¾ç¤ºä¸‹æ‹‰é€‰æ‹©æ¡†
                showSearchResults(searchResults);
            }
        }

        // æœç´¢æŸ¥è¯¢
        function searchQuery() {
            console.log('æœç´¢å‡½æ•°è¢«è°ƒç”¨');
            const searchTerm = document.getElementById('searchInput').value.trim();
            console.log('æœç´¢è¯:', searchTerm);
            console.log('Excelæ•°æ®æ˜¯å¦å­˜åœ¨:', !!excelData);
            
            if (!searchTerm) {
                alert('è¯·è¾“å…¥æœç´¢å†…å®¹');
                return;
            }
            
            if (!excelData) {
                alert('è¯·å…ˆä¸Šä¼ Excelæ–‡ä»¶');
                return;
            }

            const headers = excelData[0];
            console.log('è¡¨å¤´:', headers);
            console.log('å‰3è¡Œæ•°æ®:', excelData.slice(0, 4));
            
            // æŸ¥æ‰¾ç¼–å·åˆ—ï¼ˆç¬¬äºŒåˆ—ï¼‰å’Œå†…å®¹åˆ—ï¼ˆç¬¬ä¸‰åˆ—ï¼‰
            const numberColumnIndex = 1; // ç¬¬äºŒåˆ—
            const contentColumnIndex = 2; // ç¬¬ä¸‰åˆ—
            
            console.log('æœç´¢ç¼–å·åˆ—ç´¢å¼•:', numberColumnIndex);
            console.log('æœç´¢å†…å®¹åˆ—ç´¢å¼•:', contentColumnIndex);
            console.log('æœç´¢è¯:', searchTerm);
            
            const searchResults = [];
            
            // æœç´¢ç¼–å·ï¼ˆç¬¬äºŒåˆ—ï¼‰
            for (let i = 1; i < excelData.length; i++) {
                const row = excelData[i];
                const numberValue = row[numberColumnIndex];
                
                console.log(`æ£€æŸ¥ç¬¬${i}è¡Œç¼–å·åˆ—:`, numberValue, 'æœç´¢è¯:', searchTerm);
                
                if (numberValue && numberValue.toString().toLowerCase().includes(searchTerm.toLowerCase())) {
                    console.log('åœ¨ç¼–å·åˆ—æ‰¾åˆ°åŒ¹é…:', numberValue, 'è¡Œç´¢å¼•:', i);
                    searchResults.push({
                        index: i - 1,
                        type: 'ç¼–å·',
                        value: numberValue,
                        content: row[contentColumnIndex] || 'æ— å†…å®¹'
                    });
                }
            }
            
            // æœç´¢å†…å®¹ï¼ˆç¬¬ä¸‰åˆ—ï¼‰
            for (let i = 1; i < excelData.length; i++) {
                const row = excelData[i];
                const contentValue = row[contentColumnIndex];
                
                if (contentValue && contentValue.toString().toLowerCase().includes(searchTerm.toLowerCase())) {
                    console.log('åœ¨å†…å®¹åˆ—æ‰¾åˆ°åŒ¹é…:', contentValue, 'è¡Œç´¢å¼•:', i);
                    // é¿å…é‡å¤æ·»åŠ ï¼ˆå¦‚æœç¼–å·åˆ—å·²ç»æ·»åŠ äº†ï¼‰
                    const existingResult = searchResults.find(result => result.index === i - 1);
                    if (!existingResult) {
                        searchResults.push({
                            index: i - 1,
                            type: 'å†…å®¹',
                            value: contentValue,
                            content: contentValue
                        });
                    }
                }
            }
            
            console.log('æœç´¢ç»“æœæ•°é‡:', searchResults.length);
            
            if (searchResults.length === 0) {
                console.log('æœªæ‰¾åˆ°åŒ¹é…çš„æŸ¥è¯¢');
                alert('æœªæ‰¾åˆ°åŒ¹é…çš„æŸ¥è¯¢');
                hideSearchResults();
            } else if (searchResults.length === 1) {
                // åªæœ‰ä¸€ä¸ªç»“æœï¼Œç›´æ¥è·³è½¬
                currentQueryIndex = searchResults[0].index;
                updateQueryDisplay();
                hideSearchResults();
            } else {
                // å¤šä¸ªç»“æœï¼Œæ˜¾ç¤ºä¸‹æ‹‰é€‰æ‹©æ¡†
                showSearchResults(searchResults);
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœä¸‹æ‹‰æ¡†
        function showSearchResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            const searchInput = document.getElementById('searchInput');
            
            // è·å–æœç´¢æ¡†çš„ä½ç½®
            const inputRect = searchInput.getBoundingClientRect();
            
            // å…³é”®ï¼šæŠŠä¸‹æ‹‰æŒ‚åˆ° bodyï¼Œé¿å…ç¥–å…ˆçš„ backdrop-filter/transform å½±å“
            if (resultsContainer.parentElement !== document.body) {
                document.body.appendChild(resultsContainer);
            }
            
            resultsContainer.innerHTML = '';
            
            results.forEach((result, idx) => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.onclick = () => selectSearchResult(result);
                
                // è·å–ç¼–å·å’Œqueryå†…å®¹
                const numberValue = excelData[result.index + 1][1]; // ç¬¬äºŒåˆ—ï¼ˆç¼–å·ï¼‰
                const queryContent = excelData[result.index + 1][2]; // ç¬¬ä¸‰åˆ—ï¼ˆqueryå†…å®¹ï¼‰
                
                resultItem.innerHTML = `
                    <div class="search-result-content">
                        <span style="color: var(--brand); font-weight: 500;">${numberValue}</span>
                        <span style="color: var(--text); margin-left: 8px;">${queryContent}</span>
                    </div>
                `;
                
                resultsContainer.appendChild(resultItem);
            });
            
            // è®¾ç½®ä¸‹æ‹‰æ¡†ä½ç½®
            resultsContainer.style.position = 'fixed';
            resultsContainer.style.top = (inputRect.bottom) + 'px'; // è´´åœ¨è¾“å…¥æ¡†ä¸‹ç¼˜
            resultsContainer.style.left = inputRect.left + 'px';
            resultsContainer.style.width = inputRect.width + 'px';
            resultsContainer.style.zIndex = '2147483647'; // æœ€é«˜å±‚çº§ä¿é™©
            resultsContainer.style.display = 'block';
        }

        // éšè—æœç´¢ç»“æœä¸‹æ‹‰æ¡†
        function hideSearchResults() {
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.style.display = 'none';
        }

        // é€‰æ‹©æœç´¢ç»“æœ
        function selectSearchResult(result) {
            currentQueryIndex = result.index;
            updateQueryDisplay();
            hideSearchResults();
        }

        // æ›´æ–°æœç´¢è¾“å…¥æ¡†placeholder
        function updateSearchPlaceholder() {
            const searchInput = document.getElementById('searchInput');
            const searchType = document.getElementById('searchType').value;
            
            if (searchType === 'number') {
                searchInput.placeholder = 'è¯·è¾“å…¥ç¼–å·...';
            } else if (searchType === 'content') {
                searchInput.placeholder = 'è¯·è¾“å…¥æŸ¥è¯¢å†…å®¹...';
            }
        }

        // æœç´¢æ¡†å®æ—¶æœç´¢å’Œç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰æ¡†
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const searchTypeSelect = document.getElementById('searchType');
            
            if (searchInput) {
                // å®æ—¶æœç´¢
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.trim();
                    if (searchTerm.length >= 2) { // è‡³å°‘2ä¸ªå­—ç¬¦æ‰å¼€å§‹æœç´¢
                        performSearch(searchTerm);
                    } else {
                        hideSearchResults();
                    }
                });
                
                // å›è½¦é”®æœç´¢
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchQuery();
                    }
                });
            }
            
            // æœç´¢ç±»å‹æ”¹å˜æ—¶æ›´æ–°placeholder
            if (searchTypeSelect) {
                searchTypeSelect.addEventListener('change', function() {
                    updateSearchPlaceholder();
                    // æ¸…ç©ºæœç´¢è¾“å…¥æ¡†
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.value = '';
                        hideSearchResults();
                    }
                });
                
                // åˆå§‹åŒ–placeholder
                updateSearchPlaceholder();
            }
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æœç´¢ç»“æœä¸‹æ‹‰æ¡†
            document.addEventListener('click', function(e) {
                const searchInputEl = document.getElementById('searchInput');
                const resultsEl = document.getElementById('searchResults');
                if (
                    searchInputEl && resultsEl &&
                    e.target !== searchInputEl &&
                    !searchInputEl.contains(e.target) &&
                    e.target !== resultsEl &&
                    !resultsEl.contains(e.target)
                ) {
                    hideSearchResults();
                }
            });
            
            // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ˜¾ç¤ºæ¡†æ¶
            setupColumnSelection();
            updateComparisonGrid();
            setupStickyQueryDisplay();
        });

        // è®¾ç½®æŸ¥è¯¢æ˜¾ç¤ºåŒºåŸŸçš„ç²˜æ€§å®šä½
        function setupStickyQueryDisplay() {
            const queryDisplay = document.getElementById('queryDisplay');
            if (!queryDisplay) return;

            // ç›‘å¬æ»šåŠ¨äº‹ä»¶
            window.addEventListener('scroll', function() {
                const queryDisplayRect = queryDisplay.getBoundingClientRect();
                const headerHeight = 80; // å‡è®¾headeré«˜åº¦çº¦ä¸º80px
                
                // å½“æŸ¥è¯¢æ˜¾ç¤ºåŒºåŸŸæ»šåŠ¨åˆ°è·ç¦»é¡¶éƒ¨ä¸€å®šè·ç¦»æ—¶ï¼Œæ·»åŠ stickyç±»
                if (queryDisplayRect.top <= headerHeight + 20) {
                    queryDisplay.classList.add('sticky');
                } else {
                    queryDisplay.classList.remove('sticky');
                }
            });
        }

        // æ›´æ–°å¯¹æ¯”ç½‘æ ¼
        function updateComparisonGrid() {
            const grid = document.getElementById('comparisonGrid');
            
            if (!excelData) {
                // æ²¡æœ‰Excelæ•°æ®æ—¶ï¼Œæ˜¾ç¤ºä¿çš®çš„æç¤º
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--muted);">
                        <div style="font-size: 64px; margin-bottom: 20px;">ğŸ”</div>
                        <div style="font-size: 18px; margin-bottom: 12px; font-weight: 500;">è¿˜æ²¡æœ‰é€‰æ‹©è¦å¯¹æ¯”çš„åˆ—å‘¢~</div>
                        <div style="font-size: 14px; margin-bottom: 8px;">ä¸Šä¼ Excelæ–‡ä»¶å¹¶é€‰æ‹©åˆ—åï¼Œå°±èƒ½çœ‹åˆ°ç²¾å½©çš„å¯¹æ¯”å•¦ï¼</div>
                        <div style="font-size: 12px; color: #9ca3af;">âœ¨ æœŸå¾…ä½ çš„æ•°æ®å“¦ âœ¨</div>
                    </div>
                `;
                grid.style.gridTemplateColumns = '1fr';
                return;
            }
            
            const currentRow = excelData[currentQueryIndex + 1];
            const headers = excelData[0];
            let columnsToShow = [];
            
            if (autoMode) {
                // è‡ªåŠ¨æ¨¡å¼ï¼šåªæ˜¾ç¤ºæœ‰å†…å®¹çš„æ¨¡å‹
                const modelNames = ['Deepseek', 'ChatGPT', 'ç‚¹ç‚¹', 'Kimi', 'è±†åŒ…', 'Gemini', 'é—®ä¸€é—®', 'Grok', 'å…ƒå®'];
                
                modelNames.forEach(modelName => {
                    const columnIndex = headers.findIndex(header => 
                        header && header.trim() === modelName
                    );
                    
                    if (columnIndex !== -1) {
                        const content = currentRow[columnIndex] || '';
                        // åªæœ‰å½“å†…å®¹ä¸ä¸ºç©ºæ—¶æ‰æ˜¾ç¤º
                        if (content.trim()) {
                            columnsToShow.push({
                                index: columnIndex,
                                name: modelName
                            });
                        }
                    }
                });
            } else {
                // æ‰‹åŠ¨æ¨¡å¼ï¼šæ˜¾ç¤ºç”¨æˆ·é€‰æ‹©çš„æ¨¡å‹
                columnsToShow = selectedColumns;
            }
            
            if (columnsToShow.length === 0) {
                // æ²¡æœ‰è¦æ˜¾ç¤ºçš„åˆ—æ—¶ï¼Œæ˜¾ç¤ºæç¤º
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--muted);">
                        <div style="font-size: 64px; margin-bottom: 20px;">ğŸ“</div>
                        <div style="font-size: 18px; margin-bottom: 12px; font-weight: 500;">å½“å‰æŸ¥è¯¢æ²¡æœ‰æ¨¡å‹å›å¤</div>
                        <div style="font-size: 14px; margin-bottom: 8px;">è¯•è¯•åˆ‡æ¢åˆ°å…¶ä»–æŸ¥è¯¢ï¼Œæˆ–è€…æ‰‹åŠ¨é€‰æ‹©æ¨¡å‹</div>
                        <div style="font-size: 12px; color: #9ca3af;">ğŸ’¡ æç¤ºï¼šå¯ä»¥å…³é—­ã€Œä»…å±•ç¤ºæœ‰å›å¤çš„æ¨¡å‹ã€æ¥æŸ¥çœ‹æ‰€æœ‰æ¨¡å‹</div>
                    </div>
                `;
                grid.style.gridTemplateColumns = '1fr';
                return;
            }
            
            grid.innerHTML = '';
            
            // è®¾ç½®ç½‘æ ¼åˆ—æ•° - å¹³é“ºæ’‘æ»¡æ•´é¡µï¼Œç¡®ä¿åˆ—å¹³å‡åˆ†é…
            grid.style.gridTemplateColumns = `repeat(${columnsToShow.length}, minmax(0, 1fr))`;
            grid.style.width = '100%';
            grid.style.display = 'grid';
            
            // ç”¨äºè®°å½•æœ€å¤§å­—æ•°
            const badges = [];
            const counts = [];

            columnsToShow.forEach((column, index) => {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'comparison-column';
                columnDiv.draggable = true;
                columnDiv.dataset.columnIndex = index;
                
                // æ·»åŠ æ‹–æ‹½æ‰‹æŸ„
                const dragHandle = document.createElement('div');
                dragHandle.className = 'drag-handle';
                dragHandle.innerHTML = 'â‹®â‹®';
                dragHandle.title = 'æ‹–æ‹½é‡æ–°æ’åº';
                dragHandle.setAttribute('draggable', 'false'); // é˜²æ­¢æ‰‹æŸ„æœ¬èº«è¢«æ‹–æ‹½
                
                // å­—æ•°å¾½æ ‡ï¼ˆæ¸²æŸ“åå­—æ•°ï¼‰
                const countBadge = document.createElement('div');
                countBadge.className = 'char-count-badge';
                countBadge.textContent = '0';
                countBadge.title = 'æ¸²æŸ“åçš„å­—æ•°';

                const headerDiv = document.createElement('div');
                headerDiv.className = 'column-header';
                headerDiv.textContent = column.name;
                
                const contentDiv = document.createElement('div');
                contentDiv.className = 'column-content';
                const content = currentRow[column.index] || '';
                contentDiv.innerHTML = renderMarkdown(content);

                // ç»Ÿè®¡æ¸²æŸ“åçš„å­—æ•°ï¼ˆçº¯æ–‡æœ¬é•¿åº¦ï¼‰
                const plainText = contentDiv.textContent || '';
                const charCount = plainText.trim().length;
                countBadge.textContent = charCount.toString();
                
                columnDiv.appendChild(countBadge);
                columnDiv.appendChild(dragHandle);
                columnDiv.appendChild(headerDiv);
                columnDiv.appendChild(contentDiv);
                grid.appendChild(columnDiv);

                // æ”¶é›†å¾½æ ‡ä¸è®¡æ•°ï¼Œç¨åç»Ÿä¸€æ ‡è®°æœ€å¤§å€¼
                badges.push(countBadge);
                counts.push(charCount);
            });
            
            // æ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
            setupDragAndDrop();

            // æ ‡è®°æœ€å¤§å€¼ä¸ºçº¢è‰²ï¼ˆå¹¶åˆ—ä¹Ÿé«˜äº®ï¼‰
            const maxChars = counts.length ? Math.max(...counts) : 0;
            badges.forEach(b => b.classList.remove('char-count-badge--max'));
            badges.forEach((badge, i) => {
                if (counts[i] === maxChars && maxChars > 0) {
                    badge.classList.add('char-count-badge--max');
                }
            });
        }

        // è®¾ç½®æ‹–æ‹½æ’åºåŠŸèƒ½
        function setupDragAndDrop() {
            const columns = document.querySelectorAll('.comparison-column');
            let draggedElement = null;
            
            columns.forEach(column => {
                // æ‹–æ‹½å¼€å§‹
                column.addEventListener('dragstart', function(e) {
                    draggedElement = this;
                    this.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', this.outerHTML);
                });
                
                // æ‹–æ‹½ç»“æŸ
                column.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    // ç§»é™¤æ‰€æœ‰æ‹–æ‹½æ‚¬åœæ•ˆæœ
                    document.querySelectorAll('.comparison-column').forEach(col => {
                        col.classList.remove('drag-over');
                    });
                    draggedElement = null;
                });
                
                // æ‹–æ‹½è¿›å…¥
                column.addEventListener('dragenter', function(e) {
                    e.preventDefault();
                    if (this !== draggedElement) {
                        this.classList.add('drag-over');
                    }
                });
                
                // æ‹–æ‹½ç¦»å¼€
                column.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });
                
                // æ‹–æ‹½æ‚¬åœ
                column.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                });
                
                // æ‹–æ‹½æ”¾ä¸‹
                column.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    
                    if (draggedElement && this !== draggedElement) {
                        // è·å–æ‹–æ‹½å…ƒç´ çš„ç´¢å¼•å’Œç›®æ ‡å…ƒç´ çš„ç´¢å¼•
                        const draggedIndex = parseInt(draggedElement.dataset.columnIndex);
                        const targetIndex = parseInt(this.dataset.columnIndex);
                        
                        // é‡æ–°æ’åº selectedColumns æ•°ç»„
                        const draggedColumn = selectedColumns[draggedIndex];
                        selectedColumns.splice(draggedIndex, 1);
                        selectedColumns.splice(targetIndex, 0, draggedColumn);
                        
                        // é‡æ–°æ¸²æŸ“ç½‘æ ¼
                        updateComparisonGrid();
                    }
                });
            });
        }

        // Markdownæ¸²æŸ“å‡½æ•° - å¤ç”¨md_check.htmlçš„é€»è¾‘
        function renderMarkdown(md) {
            if (!md) return '';

            // 1. å¤„ç†ä»£ç å— - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/```([^`\n]*)\n([\s\S]*?)```/g, (match, lang, code) => {
                return `<pre style="display: block; background: #f3f4f6; padding: 16px; border-radius: 4px; margin: 16px 0; overflow-x: auto;"><code>${escapeHtml(code)}</code></pre>`;
            });

            // 2. å¤„ç†å›¾ç‰‡ - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, (match, alt, src) => {
                return `<img class="markdown-img" alt="${alt}" src="${src}" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                  <div style="display: none; border: 2px dashed #ddd; padding: 20px; text-align: center; border-radius: 8px; background: #f8f9fa; margin: 10px 0;">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸ–¼ï¸</div>
                    <div style="color: #666; margin-bottom: 10px;">å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                    <div style="font-size: 12px; color: #999; margin-bottom: 10px;">${alt || 'å›¾ç‰‡'}</div>
                    <a href="${src}" target="_blank" rel="noopener noreferrer" style="color: #2563eb; text-decoration: none; font-size: 14px;">
                      ğŸ”— ç‚¹å‡»æŸ¥çœ‹åŸå›¾
                    </a>
                  </div>`;
            });

            // 3. å¤„ç†å¤šå›¾ç‰‡æ¨ªå‘å¸ƒå±€ - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/<p>((?:<img[^>]*>[\s]*)+)<\/p>/g, function(match, images) {
                const imgMatches = images.match(/<img[^>]*>/g);
                if (!imgMatches || imgMatches.length < 2) return match;

                const imageCount = imgMatches.length;
                const imageWidth = imageCount === 2 || imageCount === 4
                    ? 'calc(50% - 0.25rem)'
                    : 'calc(33.333% - 0.34rem)';

                const wrappedImages = imgMatches.map(img =>
                    `<div style="width: ${imageWidth}; flex-shrink: 0;">${img}</div>`
                ).join('');

                return `<div style="display: flex; flex-wrap: wrap; margin-bottom: 16px; gap: 0.5rem;">${wrappedImages}</div>`;
            });

            // 4. å¤„ç†é“¾æ¥
            md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');

            // 5. å¤„ç†ç²—ä½“ã€æ–œä½“ã€åˆ é™¤çº¿
            md = md.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>')
                   .replace(/\*([^*]+)\*/g, '<em>$1</em>')
                   .replace(/~~([^~]+)~~/g, '<del class="markdown-del">$1</del>');

            // 6. å¤„ç†æ ‡é¢˜ - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/^#\s+(.*)$/gm, '<h1 class="markdown-h1">$1</h1>')
                   .replace(/^##\s+(.*)$/gm, '<h2 class="markdown-h2">$1</h2>')
                   .replace(/^###\s+(.*)$/gm, '<h3 class="markdown-h3">$1</h3>')
                   .replace(/^####\s+(.*)$/gm, '<h4 class="markdown-h4">$1</h4>')
                   .replace(/^#####\s+(.*)$/gm, '<h5 class="markdown-h5">$1</h5>')
                   .replace(/^######\s+(.*)$/gm, '<h6 class="markdown-h6">$1</h6>');

            // 7. å¤„ç†å¼•ç”¨
            md = md.replace(/^>\s?(.*)$/gm, '<blockquote class="markdown-blockquote">$1</blockquote>');

            // 8. å¤„ç†æ°´å¹³çº¿
            md = md.replace(/^---$/gm, '<hr class="markdown-hr">');

            // 9. å¤„ç†æ— åºåˆ—è¡¨ - æ”¯æŒåµŒå¥—ï¼Œå¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/^(?:\s{0,3})[*+-]\s+.+(?:\n(?:\s{0,3})[*+-]\s+.+)*/gm, (match) => {
                const lines = match.split('\n');
                const result = [];
                let currentLevel = 0;
                let currentList = [];
                let listStack = [];

                for (const line of lines) {
                    const match = line.match(/^(\s*)([*+-])\s+(.+)$/);
                    if (match) {
                        const [, indent, bullet, content] = match;
                        const level = Math.floor(indent.length / 2);

                        if (level > currentLevel) {
                            if (currentList.length > 0) {
                                listStack.push(currentList);
                            }
                            currentList = [];
                            currentLevel = level;
                        } else if (level < currentLevel) {
                            if (currentList.length > 0) {
                                const nestedUl = `<ul class="markdown-ul">${currentList.join('')}</ul>`;
                                if (listStack.length > 0) {
                                    listStack[listStack.length - 1].push(`<li class="markdown-li">${nestedUl}</li>`);
                                } else {
                                    result.push(nestedUl);
                                }
                            }
                            currentList = [];
                            currentLevel = level;
                        }

                        currentList.push(`<li class="markdown-li">${content}</li>`);
                    }
                }

                if (currentList.length > 0) {
                    const finalUl = `<ul class="markdown-ul">${currentList.join('')}</ul>`;
                    if (listStack.length > 0) {
                        listStack[listStack.length - 1].push(`<li class="markdown-li">${finalUl}</li>`);
                    } else {
                        result.push(finalUl);
                    }
                }

                while (listStack.length > 0) {
                    const nestedList = listStack.pop();
                    const nestedUl = `<ul class="markdown-ul">${nestedList.join('')}</ul>`;
                    if (listStack.length > 0) {
                        listStack[listStack.length - 1].push(`<li class="markdown-li">${nestedUl}</li>`);
                    } else {
                        result.push(nestedUl);
                    }
                }

                return result.join('');
            });

            // 10. å¤„ç†æœ‰åºåˆ—è¡¨ - æ”¯æŒåµŒå¥—ï¼Œä¿ç•™åŸå§‹æ•°å­—ç¼–å·
            md = md.replace(/^(?:\s{0,3})\d+\.\s+.+(?:\n(?:\s{0,3})\d+\.\s+.+)*/gm, (match) => {
                const lines = match.split('\n');
                const result = [];
                let currentLevel = 0;
                let currentList = [];
                let listStack = [];

                for (const line of lines) {
                    const match = line.match(/^(\s*)(\d+)\.\s+(.+)$/);
                    if (match) {
                        const [, indent, number, content] = match;
                        const level = Math.floor(indent.length / 2);

                        if (level > currentLevel) {
                            if (currentList.length > 0) {
                                listStack.push(currentList);
                            }
                            currentList = [];
                            currentLevel = level;
                        } else if (level < currentLevel) {
                            if (currentList.length > 0) {
                                const nestedOl = `<ol class="markdown-ol">${currentList.join('')}</ol>`;
                                if (listStack.length > 0) {
                                    listStack[listStack.length - 1].push(`<li class="markdown-li">${nestedOl}</li>`);
                                } else {
                                    result.push(nestedOl);
                                }
                            }
                            currentList = [];
                            currentLevel = level;
                        }

                        currentList.push(`<li class="markdown-li" value="${number}">${content}</li>`);
                    }
                }

                if (currentList.length > 0) {
                    const finalOl = `<ol class="markdown-ol">${currentList.join('')}</ol>`;
                    if (listStack.length > 0) {
                        listStack[listStack.length - 1].push(`<li class="markdown-li">${finalOl}</li>`);
                    } else {
                        result.push(finalOl);
                    }
                }

                while (listStack.length > 0) {
                    const nestedList = listStack.pop();
                    const nestedOl = `<ol class="markdown-ol">${nestedList.join('')}</ol>`;
                    if (listStack.length > 0) {
                        listStack[listStack.length - 1].push(`<li class="markdown-li">${nestedOl}</li>`);
                    } else {
                        result.push(nestedOl);
                    }
                }

                return result.join('');
            });

            // 11. å¤„ç†è¡Œå†…ä»£ç 
            md = md.replace(/`([^`]+)`/g, '<code class="markdown-code">$1</code>');

            // 12. å¤„ç†è¡¨æ ¼ - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            md = md.replace(/^(\|.+\|)\s*\n(\|[ :\-|]+\|)\s*\n((?:\|.*\|\s*\n?)*)/gm, (match, header, sep, body) => {
                if (!sep.match(/^[\s|]*[-:|\s]+[\s|]*$/)) return match;

                const toRow = line => line.trim().replace(/^\||\|$/g, '').split('|').map(s => s.trim());
                const headers = toRow(header);
                const rows = body.trim().split(/\n/).filter(Boolean).map(toRow);

                const alignRow = toRow(sep);
                const aligns = alignRow.map(align => {
                    if (align.startsWith(':') && align.endsWith(':')) return 'center';
                    if (align.endsWith(':')) return 'right';
                    if (align.startsWith(':')) return 'left';
                    return null;
                });

                const thead = `<thead class="markdown-table-thead"><tr>${headers.map((h, i) =>
                    `<th class="markdown-table-th"${aligns[i] ? ` style="text-align: ${aligns[i]}"` : ''}>${h}</th>`
                ).join('')}</tr></thead>`;

                const tbody = `<tbody>${rows.map(r =>
                    `<tr class="markdown-table-tr">${r.map((c, i) =>
                        `<td class="markdown-table-td"${aligns[i] ? ` style="text-align: ${aligns[i]}"` : ''}>${c}</td>`
                    ).join('')}</tr>`
                ).join('')}</tbody>`;

                return `<div class="markdown-table-wrapper" style="overflow-x: auto; margin: 16px 0; -webkit-overflow-scrolling: touch;"><table class="markdown-table">${thead}${tbody}</table></div>\n`;
            });

            // 13. å¤„ç†æ®µè½ - å®Œå…¨å¯¹é½ MarkdownRenderer.tsx
            return md.split(/\n/).map(line => {
                if (/^<h\d|^<ul>|^<ol>|^<pre>|^<blockquote>|^<img|^<table|^<hr|^<div|^<code/.test(line)) return line;
                if (!line.trim()) return '';
                return `<p class="markdown-p">${line}</p>`;
            }).join('\n');
        }

        // HTMLè½¬ä¹‰å‡½æ•°
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

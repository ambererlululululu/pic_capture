"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["39886"],{464975:function(e,t,i){i.d(t,{default:function(){return a}}),i(713738);var n=i(430261),l=i(345660),a=(0,n.IconFactory)((0,l.jsx)(e=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,l.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M15.524 3.4 2 7.024l2.847 10.625.754-.202V9.11a2 2 0 0 1 2-2h8.915zm3.064 3.71h3.014a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2h-14a2 2 0 0 1-2-2v-.593l-.237.064a2 2 0 0 1-2.45-1.414L.07 7.54a2 2 0 0 1 1.414-2.449l13.523-3.623a2 2 0 0 1 2.45 1.414zm-10.986 2h14v7.865L18.3 14.429a1.67 1.67 0 0 0-2.09.045l-3.432 2.886-1.363-1.167a1.67 1.67 0 0 0-2.151-.015l-1.662 1.385zm4.125 5.25a1.625 1.625 0 1 0 0-3.25 1.625 1.625 0 0 0 0 3.25",clipRule:"evenodd"})}),{}))},204454:function(e,t,i){i.d(t,{isBetaEnv:function(){return n}});let n=!1},118098:function(e,t,i){i.d(t,{UploadButton:function(){return _}});var n=i(713738),l=i(436114),a=i(812650),r=i.n(a),o=i(986443),s=i(837921),u=i(214902),c={"chat-input-icon":"chat-input-icon-btdgGw","chat-input-icon__disabled":"chat-input-icon__disabled-_Zf5gP","chat-input-icon-area":"chat-input-icon-area-MpWPWn",popover:"popover-NoVv7e"},p=i(345660);let d=e=>{let{disabled:t=!1,onClick:i,popoverContent:n,toolTip:a,isOverflow:d,isToolButtonSmall:_,borderlessTheme:f=!0,disableFocusListener:g=!1,renderIcon:m,className:h,popoverProps:v,renderCustomButton:y}=e,b="function"==typeof y,C=f?(0,p.jsx)("div",{className:r()(c["chat-input-icon"],{[c["chat-input-icon__disabled"]]:t},h),onClick:t||b?l.default:i,children:(0,p.jsx)("div",{"data-testid":"upload_file_button",className:c["chat-input-icon-area"],children:m()})}):(0,p.jsx)(o.ToolButtonUI,{isOverflow:d,small:_,renderIcon:m,buttonProps:{disabled:t,"data-testid":"upload_file_button"},onMouseUp:t||b?l.default:i});return b?(0,p.jsx)(p.Fragment,{children:y({onClick:i,originButton:C})}):n?(0,p.jsx)(s.default,{className:c.popover,clickToHide:!0,content:n,trigger:"click",position:"topLeft",...v,children:C}):a&&!t?(0,p.jsx)(u.SamanthaTooltip,{content:a,position:"top",disableFocusListener:g,children:C}):C},_=(0,n.forwardRef)(function(e,t){let{accept:i="",multiple:l=!1,onFileChange:a,onOpenFileDialogInterceptor:r,...o}=e,{popoverContent:s,onClick:u}=o,c=(0,n.useRef)(null),_=async e=>{!1!==await (null==r?void 0:r())&&c.current&&(null==u||u(e),c.current.value="",c.current.click())};return(0,n.useImperativeHandle)(t,()=>({click:()=>_()})),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(d,{...o,onClick:e=>{!s&&(_(),null==e||e.stopPropagation())}}),(0,p.jsx)("input",{ref:c,"data-testid":"upload-file-input",className:"hidden",multiple:l,type:"file",accept:i,onChange:a})]})})},547338:function(e,t,i){i.d(t,{useUploadSupportedFileTypesInSamantha:function(){return r}});var n=i(18244),l=i(949932),a=i(345698);function r(e){let t=(0,a.useUploadImageFeature)(),{supportedCodeFileTypesInFree:i}=(0,n.useSupportCommonCodeTypes)();return(e||(i=[]),t)?[...l.allowedExtensions,...i,"png","jpeg","jpg","webp"]:[...l.allowedExtensions,...i]}},845322:function(e,t,i){i.d(t,{useFilterValidUploadCodeFiles:function(){return I},useFilterValidUploadFilesInSamanthaBot:function(){return S},useValidateUploadFilesInSamanthaBot:function(){return x}});var n=i(713738),l=i(453157),a=i(214071),r=i(666196),o=i(698392),s=i(300841),u=i(761835),c=i(212183),p=i(971857),d=i(631122),_=i(645298),f=i(204454),g=i(18244),m=i(777422),h=i(915299),v=i(949932),y=i(249254),b=i(296493),C=i(345698),F=i(547338);let w=e=>{var t;return!!e&&(null==e?void 0:null===(t=e.type)||void 0===t?void 0:t.indexOf("image"))!==-1};function x(e,t){var i;let n=(0,h.useTranslateFn)(),l=(0,C.useUploadImageFeature)(),{clearAttachments:o}=(0,u.useAttachmentActions)({chatId:null!=e?e:""}),s=(0,d.useToast)(),c=(0,r.useChatService)("chatConfigService"),{loginSource:p}=null!==(i=null==c?void 0:c.chatReportParams)&&void 0!==i?i:{};return(e,i,r)=>{let{maxFileCount:u,maxImageCount:c,enableImageVlm:d,trackParams:f,hasLink:g}=r;if((0,a.default)(e))return!1;let h=i.some(e=>"link"===e.type)||g,b=i.some(e=>"directory"===e.type);if(!l&&e.length+i.length>_.MAX_IMG_COUNT&&(e.find(e=>w(e))||i.find(e=>"image"===e.type)))return e.find(e=>!w(e))||i.find(e=>"image"!==e.type)?s.warning(n("multi_upload_toast_mixedtype")):s.warning(n("image_upload_toast_maxNum",{s_number:_.MAX_IMG_COUNT})),!1;if(e.length+i.length>u)return s.error(n("file_token_limit",{postProcess:"sprintf",sprintf:["\u8C46\u5305",u.toString()]})),e.forEach(e=>{(0,m.trackEvent)("upload_status",{...f,status:"0",error_code:"over_file_numberlimit",collection_name:e.name,upload_type:w(e)?"pic":"pdf",upload_file_type:(0,v.getFileType)((0,v.getFileExt)((0,y.pickAsString)("name")(e))),upload_file_size:String(e.size),...p?{previous_page:p}:{}})}),!1;if(d){let t=e.filter(w),l=i.filter(e=>{let{type:t}=e;return"image"===t});if(t.length+l.length>c)return s.error(n("image_upload_toast_maxNum",{s_number:c})),e.forEach(e=>{(0,m.trackEvent)("upload_status",{...f,status:"0",error_code:"over_image_numberlimit",collection_name:e.name,upload_type:w(e)?"pic":"pdf",upload_file_type:(0,v.getFileType)((0,v.getFileExt)((0,y.pickAsString)("name")(e))),upload_file_size:String(e.size)})}),!1}if(h){if(!t)return s.warning(n("skill_pdf_error_exclusive")),!1;null==o||o({})}if(b){if(!t)return s.warning(n("skill_pdf_error_exclusive")),!1;null==o||o({})}return!0}}function S(e,t){let i=(0,h.useTranslateFn)(),a=(0,d.useToast)(),{chatId:r,chatType:_}=(0,o.useChatSlice)("chatViewCoreStore",e=>{var t,i;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(i=e.currentChatViewConfig)||void 0===i?void 0:i.chatType}},l.shallow),g=(0,c.getBotIdByConversationId)(r),C=x(r,t),S=I(),k=(0,p.useIsSamantha)(r||"",_),E=(0,F.useUploadSupportedFileTypesInSamantha)(e),{uploadFileAllowedTypes:T,uploadFileMaxSize:B,enabledSendMultiFileMessage:j,enableImageVlm:z,uploadMultiEntityConf:{maxFileCount:L,maxFileSize:U,maxImageCount:A,maxImageSize:N}}=(0,u.useAttachmentUploadConfig)(),P=(0,n.useMemo)(()=>k?E:(0,s.isLongCtxBot)(g)?v.SupportedFileExtsInLongCtxBot:T,[k,E,g,T]),M=j||f.isBetaEnv,V=k&&M?U:Number(B),O=(0,n.useMemo)(()=>k&&M||(0,s.isLongCtxBot)(g)?null!=L?L:50:L?1:50,[k,M,g,L]),D=(0,n.useCallback)(e=>{let t=(0,v.getFileExt)(e.name);return P.includes(t)},[P]);return async(e,t,n)=>{let{trackParams:l,hasLink:r}=n;if(!C(e,t,{maxFileCount:O,maxImageCount:A,trackParams:l,enableImageVlm:z,hasLink:r}))return[];let o=e.filter(e=>!D(e)),s=e.filter(e=>!o.includes(e)),u=s.filter(e=>z&&w(e)?e.size>N:e.size>V),c=s.filter(e=>!u.includes(e));if(o.forEach(e=>{a.error(i("read_file_type_error",{postProcess:"sprintf",sprintf:[e.name]}))}),u.forEach(e=>{let t=z&&w(e)?N:V;a.error(i("file_size_over_limit",{postProcess:"sprintf",sprintf:[e.name,(0,b.convertBytes)(t)]}))}),u.forEach(e=>{(0,m.trackEvent)("upload_status",{...l,status:"0",error_code:z&&w(e)?`image_is_over_${N}`:"file_is_over_50mb",collection_name:e.name,upload_type:w(e)?"pic":"pdf",upload_file_type:(0,v.getFileType)((0,v.getFileExt)((0,y.pickAsString)("name")(e))),upload_file_size:String(e.size)})}),!k)return c;{let{filterFileList:e}=await S({fileList:c,attachmentStates:t,toastImmediately:!0,isFree:!0});return e}}}let I=()=>{let e=(0,h.useTranslateFn)(),t=(0,d.useToast)();return async i=>{let{fileList:n,attachmentStates:l,toastImmediately:a=!1,isFree:r=!1,trackParams:o}=i,s=[],u=[],c=[],p=[],d=[],_={abort:!1,warningList:p,filterFileList:[],errorList:d};if(await (0,g.preloadCodeFileExtList)(),n=n.filter(e=>{let t;if(!(t=r?(0,g.assertCodeFileSyncInFree)(e.name):(0,g.assertCodeFileSync)(e.name))&&r)return!0;let i=!0;return t?e.size<=0?(i=!1,o&&(0,m.trackEvent)("upload_status",{...o,status:"0",error_code:"empty_file",collection_name:e.name,upload_file_type:(0,v.getFileType)((0,v.getFileExt)((0,y.pickAsString)("name")(e))),upload_file_size:String(e.size)}),u.push(e)):e.size>204800&&(i=!1,o&&(0,m.trackEvent)("upload_status",{...o,status:"0",error_code:"file_is_over_200kb",collection_name:e.name,upload_file_type:(0,v.getFileType)((0,v.getFileExt)((0,y.pickAsString)("name")(e))),upload_file_size:String(e.size)}),c.push(e)):(s.push(e),i=!1),i}),null==s?void 0:s.length){let i=s.length>1?e("cici_web_ai_coding_file_type_limit_multiple",{postProcess:"sprintf",sprintf:[s[0].name,s.length]}):e("cici_web_ai_coding_file_type_limit_single",{postProcess:"sprintf",sprintf:[s[0].name]});p.push(i),a&&t.warning(i)}if(u.length>0){let i=1===u.length?e("cici_web_ai_coding_file_null_limit",{postProcess:"sprintf",sprintf:[u[0].name]}):e("cici_web_ai_coding_file_null_limit_mutiple",{postProcess:"sprintf",sprintf:[u[0].name,u.length]});p.push(i),a&&t.warning(i)}if(n.length+l.length>50){let i=e("cici_web_ai_coding_file_num_limit");t.error(i),d.push(i),_.abort=!0}if(1===c.length){let i=e("cici_web_ai_coding_file_size_limit_single");p.push(i),a&&t.warning(i)}if(c.length>1){let i=c.length>1?e("cici_web_ai_coding_file_size_limit_multiple",{postProcess:"sprintf",sprintf:[c[0].name,c.length]}):`${c[0].name}${e("cici_web_ai_coding_file_size_limit_single")}`;p.push(i),t.warning(i)}return n.length||(_.abort=!0),_.filterFileList=n,_}}},443199:function(e,t,i){i.r(t),i.d(t,{ImageUploadToolButtonPlugin:function(){return w}});var n=i(464975),l=i(453157),a=i(812650),r=i.n(a),o=i(698392),s=i(10597),u=i(783147),c=i(300841),p=i(761835),d=i(212183),_=i(971857),f=i(604889),g=i(204454),m=i(777422),h=i(915299),v=i(118098),y=i(345660);let b=e=>{let{className:t,onSubmitFiles:i,disabled:a}=e,b=(0,h.useTranslateFn)(),{chatInputRef:C}=(0,f.useChatRef)(),{chatId:F,chatType:w}=(0,o.useChatSlice)("chatViewCoreStore",e=>{var t,i;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(i=e.currentChatViewConfig)||void 0===i?void 0:i.chatType}},l.shallow),x=(0,o.useChatSlice)("chatInputStore",e=>e.activeSkillTypeMap[null!=F?F:""]),S=(0,d.getBotIdByConversationId)(F),I=(0,_.useIsSamantha)(F||"",w),{enabledSendMultiFileMessage:k,enableImageVlm:E,uploadMultiEntityConf:{maxFileCount:T}}=(0,p.useAttachmentUploadConfig)(),B=k||g.isBetaEnv,j=I&&B||(0,c.isLongCtxBot)(S)?T:1,z=(0,u.useBotSendImageEnabled)(null!=F?F:"",w),{onClickGuestDisabled:L}=(0,s.useGuestInteract)({source:"unlog_click_upload",checkNewGuidanceAb:!0}),U=(e,t)=>{let n="dataTransfer"in e?e.dataTransfer.files:e.target.files;n&&0!==n.length&&i([...n],t)};return z&&(!I||E)?(0,y.jsx)(v.UploadButton,{className:t,toolTip:(0,y.jsx)("div",{className:"text-11 leading-14",children:b("add_image")}),renderIcon:function(){let{className:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,y.jsx)(n.default,{className:r()("block",e)})},disableFocusListener:!0,accept:".png,.jpg,.jpeg",onOpenFileDialogInterceptor:L,disabled:a,borderlessTheme:!0,onClick:async()=>{var e;(0,m.trackEvent)("pin_button_click",{upload_id:await (0,p.getPreGeneratedLocalMessageIdWithDefault)({chatId:null!=F?F:"",skillType:x}),button_name:"upload_pic",click_from:"chat_enter_bar"}),(0,m.trackEvent)("click_upload_entrance",{bot_id:(0,d.getBotIdByConversationId)(F)}),null===(e=C.current)||void 0===e||e.blur()},multiple:j>1,onFileChange:e=>U(e,{from:"click",uploadWay:"browse_folder"})}):null};var C=i(163603);let F=e=>{let{className:t,enableUpload:i,disabled:n,onAfterSendMessage:l,beforeUpload:a}=e,{uploadFiles:r}=(0,C.useInputUploadFiles)({enableUpload:i,onAfterSendMessage:l,beforeUpload:a});return(0,y.jsx)(b,{className:t,onSubmitFiles:r,disabled:n})};class w{constructor(){var e,t;(e="symbol"==typeof(t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e="Content","string"))?t:t+"")in this?Object.defineProperty(this,e,{value:F,enumerable:!0,configurable:!0,writable:!0}):this[e]=F}}}}]);
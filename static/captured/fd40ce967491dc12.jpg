"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["35086"],{124997:function(e,t,a){var n=a(92477),i=a(713738),r=a(690600);t.default=function(e){var t=(0,r.default)(),a=(0,n.__read)((0,i.useState)(e),2),l=a[0],o=a[1];return[l,(0,i.useCallback)(function(e){t.current||o(e)},[])]}},690600:function(e,t,a){var n=a(713738);t.default=function(){var e=(0,n.useRef)(!1);return(0,n.useEffect)(function(){return e.current=!1,function(){e.current=!0}},[]),e}},615288:function(e,t){t.default={fade:"fade-m0SUfJ","fade-entering":"fade-entering-A0_s9J",fadeEntering:"fade-entering-A0_s9J",fadein:"fadein-QZnFSd","fade-exiting":"fade-exiting-VlWgqD",fadeExiting:"fade-exiting-VlWgqD",fadeout:"fadeout-uLXCAl","fade-exited":"fade-exited-eTV7eJ",fadeExited:"fade-exited-eTV7eJ","skill-guidance-view":"skill-guidance-view-J2D7ak",skillGuidanceView:"skill-guidance-view-J2D7ak","guidance-padding-right":"guidance-padding-right-b7SN1K",guidancePaddingRight:"guidance-padding-right-b7SN1K","guidance-max-width-container":"guidance-max-width-container-ZazIpr",guidanceMaxWidthContainer:"guidance-max-width-container-ZazIpr"}},941114:function(e,t){t.default={"slide-up":"slide-up-DojkpW",slideUp:"slide-up-DojkpW","slide-down":"slide-down-LkrGKH",slideDown:"slide-down-LkrGKH","fade-entering":"fade-entering-_qf9ae",fadeEntering:"fade-entering-_qf9ae",fadein:"fadein-qTmax8","fade-exiting":"fade-exiting-NPFbX9",fadeExiting:"fade-exiting-NPFbX9",fadeout:"fadeout-LrJ63V","fade-exited":"fade-exited-LLN4RE",fadeExited:"fade-exited-LLN4RE","chat-header-placeholder":"chat-header-placeholder-llToWW",chatHeaderPlaceholder:"chat-header-placeholder-llToWW"}},333461:function(e,t,a){a.d(t,{default:function(){return r}}),a(713738);var n=a(430261),i=a(345660),r=(0,n.IconFactory)((0,i.jsx)(e=>(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,i.jsx)("path",{fill:"currentColor",d:"M10.586 12 8.464 9.879A1 1 0 1 1 9.88 8.464L12 10.586l2.121-2.122a1 1 0 0 1 1.415 1.415L13.414 12l2.122 2.121a1 1 0 0 1-1.415 1.415L12 13.414l-2.121 2.122a1 1 0 1 1-1.415-1.415z"}),(0,i.jsx)("path",{fill:"currentColor",d:"M1 12c0 6.075 4.925 11 11 11s11-4.925 11-11S18.075 1 12 1 1 5.925 1 12m20 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0"})]}),{}))},160717:function(e,t,a){a.d(t,{DeprecatedIconButton:function(){return c}});var n=a(713738),i=a(812650),r=a.n(i),l=a(172320),o=a(441259),s=a(424785),d={container:"container-G2_qkq","size-small":"size-small-XcNWdw",sizeSmall:"size-small-XcNWdw","size-default":"size-default-al8bvc",sizeDefault:"size-default-al8bvc","size-large":"size-large-feUPIF",sizeLarge:"size-large-feUPIF","theme-primary":"theme-primary-E5tmdy",themePrimary:"theme-primary-E5tmdy","set-svg-full":"set-svg-full-GYIMUI",setSvgFull:"set-svg-full-GYIMUI",hoverable:"hoverable-z11eml",mobile:"mobile-TKrBIX","theme-borderless":"theme-borderless-GZK9FJ",themeBorderless:"theme-borderless-GZK9FJ","theme-light":"theme-light-Up2P5W",themeLight:"theme-light-Up2P5W"},u=a(345660);let c=(0,n.forwardRef)(function(e,t){let{theme:a="borderless",setSvgFull:n=!0,hoverable:i=!0,className:c,onMouseEnter:v,...g}=e,{disabled:h=!1,size:f="default"}=g;return(0,u.jsx)(s.default,{ref:t,className:r()(d.container,d[`size-${f}`],d[`theme-${a}`],`!w-40 !h-40 ${c}`,{"opacity-30":h,[d.hoverable]:i,[d.mobile]:(0,o.isMobile)(),[d["set-svg-full"]]:n}),...g,onMouseEnter:async e=>{(0,o.isMobile)()&&(0,o.isAppleWebkit)()&&await (0,l.timeoutPromise)(100),null==v||v(e)}})})},525029:function(e,t,a){a.d(t,{SamanthaPopover:function(){return s}});var n=a(713738),i=a(812650),r=a.n(i),l=a(837921),o=a(345660);let s=n.forwardRef(function(e,t){return(0,o.jsx)(l.default,{ref:t,...e,className:r()("samantha-popover-DRtvK_",e.className),children:e.children})})},573966:function(e,t,a){a.d(t,{useEstablished:function(){return i}});var n=a(713738);let i=e=>{let t=(0,n.useRef)(e);return t.current=t.current||e,t.current}},828617:function(e,t,a){a.d(t,{useLatestFunction:function(){return r}});var n=a(713738),i=a(580622);function r(e){let t=(0,i.default)(e),a=(0,n.useCallback)(function(){for(var e,a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return null===(e=t.current)||void 0===e?void 0:e.call(t,...n)},[]);return e&&a}},154615:function(e,t,a){a.d(t,{ResetErrorFallback:function(){return s}});var n=a(713738),i=a(915299),r=a(178230),l=a(970946),o=a(345660);let s=e=>{let{error:t}=e;return(0,n.useEffect)(()=>{r.logger.persist.error({eventName:"boundary_reset_error_fallback",error:t,meta:{is_package:1}})},[]),(0,l.useAutoReload)("reset_error_fallback",i.getUnreactiveTranslate),(0,o.jsx)("div",{className:"retry-button-wrapper-SmFCqE",children:(0,o.jsx)("button",{onClick:()=>window.location.reload(),children:(0,i.getUnreactiveTranslate)("chat_list_load_failed")})})}},747854:function(e,t,a){a.d(t,{FullScreenOverlay:function(){return d}});var n=a(870539),i=a(385093),r=a(812650),l=a.n(r),o={container:"container-ESz2xm","animate-both":"animate-both-l3mtFW",animateBoth:"animate-both-l3mtFW","animate-in":"animate-in-MeIewZ",animateIn:"animate-in-MeIewZ",exiting:"exiting-wWn0v1",exited:"exited-lIr8cV",entering:"entering-GaArQb",entered:"entered-lCTMmX"},s=a(345660);let d=e=>{let{className:t,style:a,visible:r,keepDOM:d=!1,mountOnEnter:u=!d,animate:c="both",children:v}=e;return(0,s.jsx)(n.default,{in:r,timeout:200,mountOnEnter:u,unmountOnExit:!d,children:e=>(0,s.jsx)("div",{className:l()(o.container,t,o[e],o[`animate-${c}`]),style:a,"data-testid":"full_screen_overlay","data-visible":r,children:(0,i.default)(v)?null==v?void 0:v({animationFinished:"entered"===e}):v})})}},725172:function(e,t,a){a.d(t,{ScrollViewProvider:function(){return o},useScrollView:function(){return s}});var n=a(713738),i=a(161284),r=a(345660);let l=(0,n.createContext)(null),o=e=>{let{containerRef:t,controller:a,children:n}=e,{width:o,height:s}=(0,i.useResizeObserver)({ref:t});return(0,r.jsx)(l.Provider,{value:{ref:t,width:o,height:s,...a},children:n})},s=()=>{let e=(0,n.useContext)(l);if(!e)throw Error("require ScrollViewContext when calling useScrollView");return e}},220197:function(e,t,a){a.d(t,{BizChatCommonErrorFallback:function(){return s}});var n=a(713738),i=a(698392),r=a(154615),l=a(337524),o=a(345660);let s=e=>{let{currentChatViewConfig:t}=(0,i.useChatSlice)("chatViewCoreStore"),a=(0,n.useRef)(!0);return(0,n.useEffect)(()=>{a.current?a.current=!1:null==e||e.resetErrorBoundary()},[null==t?void 0:t.chatId]),(0,o.jsx)(l.SamanthaLayout.MaxWidthLayout,{children:(0,o.jsx)(r.ResetErrorFallback,{...e})})}},370012:function(e,t,a){a.d(t,{GuidanceGreeting:function(){return _}});var n=a(557298),i=a(713738),r=a(385093),l=a(217957),o=a(812650),s=a.n(o),d=a(749286),u=a(441259),c=a(178230),v=a.p+"static/image/OnboardingAvatar.0f4f29a4.webp",g=a.p+"static/image/OnboardingAvatar.683a7a39.gif",h={header:"header-QbctxK",thin:"thin-yBuxBX","center-thin":"center-thin-Nue3Vu",centerThin:"center-thin-Nue3Vu","center-gray":"center-gray-S4JF__",centerGray:"center-gray-S4JF__","chrome70-header":"chrome70-header-o4CxcW",chrome70Header:"chrome70-header-o4CxcW"},f=a(345660);let p=e=>{let{t,className:a,hideUsernameBr:n,theme:i,narrowScreen:r}=e;return(0,f.jsx)("div",{className:s()(h.header,"chrome70-header flex items-center",a),children:(0,f.jsx)("div",{className:"flex justify-center flex-1",children:(0,f.jsxs)("div",{className:s()("m-0 s-font-h1 w-full select-none flex-1",{"!leading-20":r,[h.thin]:"thin"===i,[h["center-thin"]]:"center-thin"===i,[h["center-gray"]]:"center-gray"===i}),children:[(0,f.jsx)("p",{className:"text-transparent bg-[rgba(153,153,153,0.1)] rounded-8",children:t("newChat_greeting_title_doubao")}),(0,f.jsx)("p",{className:s()("text-transparent bg-[rgba(153,153,153,0.1)] rounded-8",!n&&"!mt-12"),children:t("newChat_greeting_TitleLine2")})]})})})},{Media:m,MediaContextProvider:S}=(0,d.createMedia)({breakpoints:{sm:0,md:560,"sidebar-expanded-md":840}}),_=e=>{var t;let{className:a,avatar:o=!0,loading:d=!1,guest:_=!1,greeting:y,username:C,title:w,t:b,theme:x="default",dynamicGreetingSize:T=!1,extraNode:k,titleClassName:I,greetingClassName:P,hideUsernameBr:A=!1,narrowScreen:E=!1,greetingWrapperClassName:B,isSidebarExpanded:F}=e,M=(0,u.isAppleWebkit)()||(0,u.isFirefox)(),L="";L=M?g:v;let N="thin"===x,j=e=>_?e?b("touristMode_newChat_greeting_title_doubao"):b("newChat_greeting_title_doubao"):b("newChat_greeting_TitleLine1",{postProcess:"sprintf",sprintf:[C]}),R=N&&T,G=(0,i.useRef)(null),V=(0,i.useRef)(null),O=G.current,U=V.current,D=()=>{try{if(O&&window&&(0,r.default)(window.getComputedStyle)&&R){let e=()=>{var t,a;let{width:n}=null!==(t=null==O?void 0:O.getBoundingClientRect())&&void 0!==t?t:{},{width:i}=null!==(a=null==U?void 0:U.getBoundingClientRect())&&void 0!==a?a:{},r=parseInt(getComputedStyle(O).fontSize.replace("px",""),10);i&&n&&n>i&&(r<=16?(O.style.overflow="hidden",O.style.textOverflow="ellipsis"):(O.style.fontSize=`${r-1}px`,O.style.overflow="visible",O.style.textOverflow="",e()))};e()}}catch(e){c.logger.persist.error({eventName:"guidance_greeting_resize_error",error:e instanceof Error?e:Error(String(e))})}},{width:$}=null!==(t=null==U?void 0:U.getBoundingClientRect())&&void 0!==t?t:{};return((0,i.useEffect)(()=>{D()},[y,$]),(0,i.useEffect)(()=>{var e;(null===(e=window)||void 0===e?void 0:e.document.fonts)&&!(0,l.default)(document.fonts.onloadingdone)&&(document.fonts.onloadingdone=D)},[]),d)?(0,f.jsx)(p,{t:b,className:a,narrowScreen:E,theme:x,hideUsernameBr:A}):(0,f.jsx)(S,{children:(0,f.jsxs)("div",{className:s()(h.header,"chrome70-header flex items-center",a),children:[o&&(0,f.jsx)("img",{src:(0,n.filterUrlModule)(L,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"flow_web",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!0,escapeRule:"escape-report",reportUrl:"https://mon.zijieapi.com/monitor_browser/collect/batch/security/?bid=flow_web",scmBranch:"release_train_samantha_2025-10-14_552097",scmName:"$20xN*Rt%j$P$E5h$jBsMldr-z$N$mx0%m5aWldFcH$aRmhO%FE9PQ",scmVersion:"1.0.5.6233",webpackPluginVersion:"3.4.5",filename:"$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1scHpZak5qZ*xwd*$IWmtl$E$6$2xkSmRHSlhPWFZpTTBwc1kw-zRkb%5I%m1waE1rWn$Xb*hOZ*xSR$N-%lJNamw1$2xNNWFtRkhSakJNTW5od1dXa3hhb%ZI%mpCT$-y%XhZ$mRT-%dKdFRteE1NMD%1$1hrNWFtSXlNW*RpTWpWc1ltN$Jkb*96$m5C-$IwWjFX$EpWZEZvelNte*FXRkp3WW0xamRtRlhO$3Rh$0dkM$pFaE9ORmxZ%201a1dFMDk"}),className:s()("rounded-full mr-20",h.avatar),draggable:"false"}),(0,f.jsxs)("div",{className:s()("flex justify-between flex-1 max-w-full",{"flex-col":E}),children:[(0,f.jsxs)("div",{ref:V,className:s()("s-font-h1 !font-[Montserrat] overflow-hidden flex-1 text-s-color-text-primary",{"!leading-20":E,[h.thin]:N,[h["center-thin"]]:"center-thin"===x,[h["center-gray"]]:"center-gray"===x},B),children:[(0,f.jsxs)(m,{lessThan:F?"sidebar-expanded-md":"md",children:[(0,f.jsx)("p",{className:s()(I),children:(0,l.default)(w)?j(!1):w}),(0,f.jsx)("p",{ref:G,className:s()(w||C||_?"!mt-12":void 0,P),"data-testid":"skill-page-title",children:y})]}),(0,f.jsxs)(m,{greaterThanOrEqual:F?"sidebar-expanded-md":"md",children:[(0,f.jsx)("p",{className:s()(_&&"!inline",I),children:(0,l.default)(w)?j(_):w}),(0,f.jsx)("p",{ref:G,className:s()(_&&"!inline",(w||C)&&!_?"!mt-12":void 0,P),"data-testid":"skill-page-title",children:y})]})]}),k]})]})})}},595495:function(e,t,a){a.d(t,{PluginLazyImmersivePage:function(){return S},temporaryImmersivePlugin:function(){return m}});var n=a(713738),i=a(865607),r=a(321647),l=a(214071),o=a(831370),s=a(666196),d=a(220197),u=a(747854),c=a(426156),v=a(460821),g=a(573966),h=a(178230);let f=(0,a(559891).withSuspense)((0,n.lazy)(()=>Promise.all([a.e("43361"),a.e("7414"),a.e("23426"),a.e("71331"),a.e("85781"),a.e("34210"),a.e("88883"),a.e("65823"),a.e("39079"),a.e("38354"),a.e("42546"),a.e("27024"),a.e("38754"),a.e("77970"),a.e("92322"),a.e("59346"),a.e("79948"),a.e("98222"),a.e("99543"),a.e("25438"),a.e("24817"),a.e("60437"),a.e("34812"),a.e("53756"),a.e("32179"),a.e("35235"),a.e("49690"),a.e("79630"),a.e("50182"),a.e("33247"),a.e("27678"),a.e("56076")]).then(a.bind(a,209212)).then(e=>({default:e.FlowChatSplitterLayoutCompose}))));var p=a(345660);let m=[],S=e=>{let{chatViewConfig:t}=e,a=(0,s.useChatService)("chatViewService"),{immersive:m,exactImmersiveMode:S}=(0,r.useStore)(a.immersiveStore,e=>e,i.shallow),{lastActiveValue:_,enterTime:y}=function(e){let{current:t}=(0,n.useRef)({lastActiveValue:e,lastValue:e,enterTime:Date.now()});return(0,l.default)(e)||(t.lastActiveValue=e,t.lastValue!==e&&(t.enterTime=Date.now())),t.lastValue=e,(0,v.useCompareMemo)(t,i.shallow)}(S),C=(0,g.useEstablished)(!!S),w=(0,n.useMemo)(()=>{var e;return null==a?void 0:null===(e=a.immersiveChatViews)||void 0===e?void 0:e.find(e=>e.name===_)},[_]);return(0,n.useEffect)(()=>{if(S){let e={chat_id:null==t?void 0:t.chatId,chat_type:null==t?void 0:t.chatType,immesive_type:S};return h.logger.persist.info({message:"chat_immersive_mode_enter",meta:e}),()=>h.logger.persist.info({message:"chat_immersive_mode_exit",meta:e})}},[S]),C&&w?(0,p.jsx)(u.FullScreenOverlay,{visible:!!(S&&(null==m?void 0:m[S])),keepDOM:!0,mountOnEnter:!0,animate:"in",children:e=>{var n;let{animationFinished:i}=e,r=S?null==m?void 0:m[S]:void 0;return(0,p.jsx)(c.ErrorBoundary,{errorBoundaryName:w.errorBoundaryName||`${w.name}_error`,logger:h.logger,FallbackComponent:d.BizChatCommonErrorFallback,errorBoundaryScope:c.ErrorBoundaryScopeEnum.Component,children:(0,p.jsx)(o.FlowChatSplitterLayoutSlotProvider,{value:f,children:S&&(null==m?void 0:m[S])?null==w?void 0:null===(n=w.render)||void 0===n?void 0:n.call(w,{chatViewConfig:t,showChatHeader:!1,onClose:()=>a.exitImmersiveMode(),...r,teaCtx:{enterTime:y,...null==r?void 0:r.teaCtx}}):null})})}},_):null}},379009:function(e,t,a){a.d(t,{CodeArtifactsShareUrlAction:function(){return i}});var n=a(228494);let i={matcher:e=>e===n.EUrlActionName.Code_Artifacts_Share,handler:e=>Promise.all([a.e("85824"),a.e("70942")]).then(a.bind(a,729629)).then(t=>{t.default(e)}),prehandler:e=>Promise.all([a.e("85824"),a.e("11567")]).then(a.bind(a,642388)).then(t=>t.default(e))}},655570:function(e,t,a){a.d(t,{CodeArtifactsUrlAction:function(){return i}});var n=a(228494);let i={matcher:e=>e===n.EUrlActionName.Code_Artifacts,handler:e=>Promise.all([a.e("85824"),a.e("30489")]).then(a.bind(a,137327)).then(t=>{t.default(e)})}},848968:function(e,t,a){a.d(t,{AISpaceMinuteMettingUrlAction:function(){return i}});var n=a(228494);let i={matcher:e=>e===n.EUrlActionName.AISpace_MinuteMettingOpen,handler:e=>a.e("22712").then(a.bind(a,762281)).then(t=>{t.default(e)}),prehandler:e=>a.e("12775").then(a.bind(a,142554)).then(t=>t.default(e))}},400745:function(e,t,a){a.d(t,{useOpenBotSettings:function(){return v},BotSettingButton:function(){return c}}),a(713738);var n=a(430261),i=a(345660),r=(0,n.IconFactory)((0,i.jsx)(e=>(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:20,height:20,fill:"currentColor",viewBox:"0 0 22 22",...e,children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M5.5 11a1.833 1.833 0 1 1-3.667 0A1.833 1.833 0 0 1 5.5 11m7.333 0a1.833 1.833 0 1 1-3.666 0 1.833 1.833 0 0 1 3.666 0m5.5 1.834a1.833 1.833 0 1 0 0-3.667 1.833 1.833 0 0 0 0 3.667",clipRule:"evenodd"})}),{})),l=a(865607),o=a(301302),s=a(721118),d=a(230932),u=a(160717);let c=e=>{let{className:t,visible:a=!0,showPicTemBtn:n=!1,chatId:l,icon:o,theme:s="borderless",enterMethod:d,...c}=e,{wrapperToggle:g}=v(l,n);return a?(0,i.jsx)(u.DeprecatedIconButton,{...c,theme:s,className:t,icon:o||(0,i.jsx)(r,{}),onClick:()=>g({enter_from:d||"click_chat_setting"})}):null},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[a,n,i,r,u,c]=(0,o.useChatLayoutStore)(e=>[e.activeKey,e.setActiveKey,e.setStack,e.setLastShowStatus,e.changeMode,e.mode],l.shallow),v=()=>(0,s.conversationSelector)(d.useFeedStore.getState(),e);return{wrapperToggle:function(){let{enter_from:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=v();"setting"===c&&a===e?n(void 0):(u("setting"),n(e),i(["/bot-setting"],{enter_from:l}),t&&s&&(null==s?void 0:s.bot_id)&&r(null==s?void 0:s.bot_id,{status:o.TemplatePageStatus.CLOSE}))},toggle:function(){let{enter_from:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=v();a===e?(n(void 0),u("")):(i(["/bot-setting"],{enter_from:l}),u("setting"),n(e),t&&s&&(null==s?void 0:s.bot_id)&&r(null==s?void 0:s.bot_id,{status:o.TemplatePageStatus.CLOSE}))},close(){n(void 0)},openCharacterSetting:()=>{i(["/bot-setting","/character-setting"]),n(e)},visible:e&&a===e}}},498400:function(e,t,a){a.d(t,{changePluginAuthType:function(){return d},fetchPluginList:function(){return u},usePluginAuthString:function(){return c}});var n=a(865607),i=a(212183),r=a(773289),l=a(910214),o=a(178230),s=a(145756);let d=async function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];try{await l.botApiService.PluginAuth({bot_id:e,plugin_ids:t,op_type:a?1:2}),t.forEach(t=>{s.usePluginAuthStore.getState().updatePluginAuthType(e,t,a?r.PluginAuthType.Always:r.PluginAuthType.Ask)})}catch(e){o.logger.persist.warning({message:"change ugc bot plugin auth type fail"})}},u=e=>{try{let t=1,a=async()=>{var n,i,r,o,d;let u=await l.botApiService.PluginList({bot_id:e,page_no:t,page_size:20}),c=s.usePluginAuthStore.getState().getBotPluginInfo(e);s.usePluginAuthStore.getState().setBotPluginInfo(e,(null===(n=u.data)||void 0===n?void 0:n.items)?c.concat(null===(i=u.data)||void 0===i?void 0:i.items):[]);let v=c.length+((null===(o=u.data)||void 0===o?void 0:null===(r=o.items)||void 0===r?void 0:r.length)||0);(null===(d=u.data)||void 0===d?void 0:d.total)&&v<Number(u.data.total)&&(t++,a())};a()}catch(e){o.logger.persist.warning({message:"fetch bot Plugin list fail"})}},c=e=>(0,s.usePluginAuthStore)(t=>{try{var a;let n=null!==(a=(0,i.getBotIdByConversationId)(e))&&void 0!==a?a:"";return JSON.stringify(t.getPluginAuth(n))}catch(e){return""}},n.shallow)},145756:function(e,t,a){a.d(t,{usePluginAuthStore:function(){return o}});var n=a(321647),i=a(554450),r=a(746479);let l={pluginAuthMap:{},botPluginInfoMap:{}},o=(0,n.create)()((e,t)=>({...l,getPluginAuth:e=>t().pluginAuthMap[e]||[],updatePluginAuth:t=>{let{botId:a,pluginAuth:n}=t;e((0,r.produce)(e=>{let t=e.pluginAuthMap[a];if(Array.isArray(t)){let e=t.findIndex(e=>e.plugin_id===n.plugin_id);e>=0?t[e]=n:t.push(n)}else e.pluginAuthMap[a]=[n]}))},getBotPluginInfo:e=>t().botPluginInfoMap[e]||[],setBotPluginInfo:(t,a)=>{e((0,r.produce)(e=>{e.botPluginInfoMap[t]=(0,i.default)(a,"plugin_id")}))},updatePluginDetail:(t,a,n)=>{e((0,r.produce)(e=>{let i=e.botPluginInfoMap[t];if(Array.isArray(i)){let e=i.findIndex(e=>e.plugin_id===a);e>=0?i[e]={...i[e],...n}:i.push(n)}else e.botPluginInfoMap[t]=[n]}))},updatePluginAuthType:(t,a,n)=>{e((0,r.produce)(e=>{let i=e.botPluginInfoMap[t],r=e.pluginAuthMap[t];if(Array.isArray(i)){let e=i.find(e=>e.plugin_id===a);e&&(e.auth_type=n)}if(Array.isArray(r)){let e=r.find(e=>e.plugin_id===a);e&&(e.auth_type=n)}}))}}))},348339:function(e,t,a){a.d(t,{useOnOpenFile:function(){return p},OpenFileContext:function(){return h},OpenFileProvider:function(){return f}});var n=a(713738),i=a(57392),r=a(666196),l=a(698392),o=a(721118),s=a(230932),d=a(212183),u=a(604278),c=a(777422);let v=()=>{let e=(0,r.useChatService)("chatViewService");return{onOpenCodeFile:(t,a)=>{let{messageId:n,conversationId:r,fileKey:l,attachments:o,isCodeFile:s,chatId:d,teaCtx:u}=t;e.openCanvasPanel({messageId:n,conversationId:r,canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY,fileKey:l,attachments:o,isCodeFile:s,chatId:d,teaCtx:u},a)}}};var g=a(345660);let h=(0,n.createContext)(null),f=e=>{let{children:t,...a}=e;return(0,g.jsx)(h.Provider,{value:a,children:t})},p=function(){let{enableOpenCanvas:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId}),{onOpenCodeFile:a}=v(),g=(0,n.useContext)(h),f=(0,r.useChatService)("chatViewService"),p=e=>{let a=(0,o.conversationSelector)(s.useFeedStore.getState(),t);(0,c.trackEvent)("copilot_button_click",{bot_id:(0,d.getBotIdByConversationId)(t),conversation_type:null==a?void 0:a.conversation_type,conversation_id:t,collection_id:null==e?void 0:e.collectionId,message_id:null==e?void 0:e.messageId,entrance_type:null==e?void 0:e.entranceType})};return{onAfterOpenFile:p,onOpenFileByKey:(a,n,r,l,o)=>{if(null==g?void 0:g.onOpenFileByKey)return g.onOpenFileByKey(a,n,r,l,o);let{pdf:s={},messageId:d,openFrom:u,fileName:c}=r||{};if("video"===n||"audio"===n)return f.openCanvasPanel({conversationId:t||"",messageId:d||"",mediaInfo:{type:n,title:c,vid:a},canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY},o),!1;if("PDF"===n&&e){let{anchorPage:e,highlightArea:n,assetList:r,realFileKey:c,fileName:v}=s;return f.openCanvasPanel({conversationId:t||"",messageId:d||"",readContent:{pdfId:a,realFileKey:null!=c?c:a,pdfName:v,assetList:r,pdfAnchorConfig:{page:e,areas:n},teaCtx:l,openFrom:u},canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY},o),p(l),!1}},onOpenFileByLink:(a,n,r,l)=>{if(null==g?void 0:g.onOpenFileByLink)return g.onOpenFileByLink(a,n,r,l);let{attchmentType:o,pdf:s={},messageId:d,openFrom:c}=n||{};if("pdf"===o&&e){let{anchorPage:e,highlightArea:n,assetList:o,realFileKey:v}=s;return a=(0,u.tryChangeToPDFlink)(a),f.openCanvasPanel({conversationId:t||"",messageId:d||"",readContent:{pdfUrl:a,pdfName:a,realFileKey:null!=v?v:a,assetList:o,pdfAnchorConfig:{page:e,areas:n},teaCtx:r,openFrom:c},canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY},l),p(r),!1}},onOpenCodeFile:(t,n)=>{e&&a(t,n)}}}},831370:function(e,t,a){a.d(t,{FlowChatSplitterLayoutSlotProvider:function(){return l},useFlowChatSplitterLayoutSlot:function(){return r}});var n=a(713738);let i=(0,n.createContext)(void 0),r=()=>{let e=(0,n.useContext)(i);if(!e)throw Error("useFlowChatSplitterLayoutSlot must be used within a FlowChatSplitterLayoutSlotProvider");return e},l=i.Provider},771144:function(e,t,a){a.r(t),a.d(t,{default:function(){return tR}});var n,i=a(713738),r=a(865607),l=a(321647),o=a(251913),s=a(228494);let d={matcher:e=>s.EUrlActionName.AISpace_DocCanvasOpen===e,handler:e=>a.e("99709").then(a.bind(a,676144)).then(t=>{t.default(e)})};var u=a(698897),c=a(400745),v=a(848968),g=a(57160);let h={matcher:e=>s.EUrlActionName.ReadPDF_LatestReading===e,handler:e=>a.e("63210").then(a.bind(a,611131)).then(t=>{t.default(e)})},f={matcher:e=>e===s.EUrlActionName.PptCanvasOpen,handler:e=>a.e("79068").then(a.bind(a,227498)).then(t=>{t.default(e)})};var p=a(379009),m=a(655570),S=a(956801),_=a(666196),y=a(698392),C=a(460821),w=a(165994),b=a(227587),x=a(443666),T=a(683204),k=a(783477),I=a(845647),P=a(388240),A=a(241709),E=a(230932);let B=(e,t)=>{let a=(0,E.useFeedStore)(e=>e.conversationMap,r.shallow),{currentChatViewConfig:n}=(0,y.useChatSlice)("chatViewCoreStore"),i=(null==n?void 0:n.chatType)===I.ChatType.Bot||(null==n?void 0:n.chatType)===I.ChatType.ProfileBot;return(0,k.useBotStore)(n=>{let{choicenessBotLinks:r,choicenessBotListStatus:l}=n,o=r.some(e=>e.botID===t),s=(0,T.default)(a,e);return l.loading||0===l.count&&!l.failed?!i:s||o})},F=(0,P.ChatLargeAvatarComposer)(A.LargeAvatarUI,e=>{let{conversationId:t,botId:a}=e,n=(0,P.useLargeAvatarData)({conversationId:t,botId:a}),i=B(t,a);return{...n,hideButton:i,enableBotHeat:!0,enableOpenJump:!0,enableShowHandleName:!0}});var M=a(913821),L=a(500825),N=a(761515),j=a(239686),R=a(501108),G=a(870539),V=a(678669),O=a(812650),U=a.n(O),D=a(39199);let $=[a(37435).AISpaceImageEditUrlAction];var W=a(717529),z=a(717554),K=a(845362),H=a(803147),J=a(689368),Z=a(922851),q=a(10597),X=a(23226),Q=a(453157),Y=a(4137),ee=a(918952),et=a(695422),ea=a(44502),en=a(344333),ei=a(269249),er=a(777422),el=a(915299),eo=a(721118),es=a(334312),ed=a(524129);let eu=e=>{var t;let a=null!==(t=null==e?void 0:e.toString())&&void 0!==t?t:ed.SkillType.Default.toString(),{currentChatViewConfig:n}=(0,y.useChatSlice)("chatViewCoreStore");if(e)return{conversation_id:null==n?void 0:n.chatId,conversation_type:"default_new",bot_id:(0,eo.mainConvBotIdSelector)(E.useFeedStore.getState())||"",skill_id:a,skill_name:(0,es.getSkillTeaNameByType)(e)||""}};var ec=a(333461),ev=a(992528),eg=a(345660);let eh=e=>{let{className:t}=e,{toChatPage:a}=(0,ev.useChat)();return(0,eg.jsx)("div",{className:"flex items-center cursor-pointer",children:(0,eg.jsx)(ec.default,{className:U()("text-s-color-text-disable !text-18 p-3 hover:bg-s-color-bg-trans rounded-s-radius-xs",t),onClick:()=>{var e,t;null==a||a(),null===(e=(t=(0,y.getChatSlice)("chatGuidanceStore")).setActiveSkillGuidanceIdentifier)||void 0===e||e.call(t),(0,y.getChatSlice)("chatInputStore").resetActiveSkillTypeMap()},"data-testid":"skill-page-close"})})};var ef=a(615288),ep=a(370012);let em=e=>{let{className:t,hideCloseBtn:a,inputSkillType:n,skillGuidancePageFrom:r,onBeforeSendMessage:l}=e,o=(0,el.useTranslateFn)(),{activeSkillIdentifier:s,className:d,appear:u}=(0,y.useChatSlice)("chatGuidanceStore",e=>({activeSkillIdentifier:e.activeSkillIdentifier,className:e.className,appear:e.appear}),Q.shallow),c=(0,ei.useChatId)(),v=(0,ea.useActiveSkillType)(null!=c?c:""),g=(0,E.useFeedStore)(e=>{var t,a;return null===(a=e.localConversationMap[null!=c?c:""])||void 0===a?void 0:null===(t=a.local)||void 0===t?void 0:t.createStatus}),h=(0,w.default)(n);(0,i.useEffect)(()=>{let e;if(n&&!(0,Y.default)(c)&&g===ee.CreateConversationStatus.Pending&&v!==n){let t=()=>{let e=r===H.SkillGuidancePageFrom.DEFAULT?et.SkillFrom.UseURL:et.SkillFrom.ClickSkill;(0,y.getChatSlice)("chatInputStore").updateActiveSkillTypeMap(c,n,e)};t(),e=setTimeout(t)}return()=>{clearTimeout(e)}},[n,v,c,g,r]),(0,i.useEffect)(()=>{!n&&h&&c&&(0,y.getChatSlice)("chatInputStore").resetActiveSkillTypeMap()},[n]);let{plugin:f}=(0,J.useGuidancePlugin)(s),p=(0,X.useSkillConfig)(),m=null==p?void 0:p.find(e=>e.skill_type===n),S=eu(n),_=(0,en.getTeaShowSceneBySkillGuidancePageFrom)(r||H.SkillGuidancePageFrom.DEFAULT),C=e=>{let{exitSkill:t}=e||{};return c&&v&&(t?(0,y.getChatSlice)("chatInputStore").closeSkillPanel(c):(0,y.getChatSlice)("chatInputStore").updateActiveSkillTypeMap(c,v,et.SkillFrom.AfterSkill)),Promise.resolve()},b=function(){let{className:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a?null:(0,eg.jsx)(eh,{className:e})},x=()=>{let e={renderClose:b,renderHeader:e=>{let{theme:t="default",icon:a,title:n,greeting:i,className:r,titleClassName:l,close:s=!0,renderClose:d}=e,u=i?(0,eg.jsx)(ep.GuidanceGreeting,{t:o,avatar:!1,title:null,theme:"centered"===t?"center-gray":"thin",greeting:i,dynamicGreetingSize:!0,extraNode:s?d?d(b):b():null}):null;return"centered"===t?(0,eg.jsxs)("div",{className:r,children:[n&&(0,eg.jsx)("div",{className:`
                    mt-28 mb-10 flex items-center justify-center text-s-color-text-secondary
                  `,children:(0,eg.jsx)("p",{className:U()("m-0 s-font-h1",l),children:n})}),u]}):(0,eg.jsxs)("div",{className:U()("pb-10 pt-8",r),children:[(a||n)&&(0,eg.jsxs)("div",{className:"mb-4 flex items-center text-s-color-text-primary",children:[a&&(0,eg.jsx)("div",{className:"mr-4 flex h-20 w-20 items-center justify-center text-16",children:a}),(0,eg.jsx)("p",{className:"m-0 s-font-small-em",children:n})]}),u]})},reportParams:{scene:(0,en.getTeaSendSceneBySkillGuidancePageFrom)(r||H.SkillGuidancePageFrom.DEFAULT),send_source:"skill_guidance_page_click"},trackParams:{...S,..._?{show_scene:_}:{}},skillConfig:m,from:r||H.SkillGuidancePageFrom.DEFAULT,onBeforeSendMessage:l,onAfterSendMessage:C};return f?(0,eg.jsx)(f.Content,{...e}):null},T=(0,en.getTeaEnterFromBySkillGuidancePageFrom)(r||H.SkillGuidancePageFrom.DEFAULT);return(0,i.useEffect)(()=>{s&&(0,er.trackEvent)("enter_page",{enter_from:T})},[s]),(0,eg.jsx)(G.default,{in:!0,appear:u,timeout:300,children:e=>(0,eg.jsx)("div",{className:U()(ef.default[`fade-${e}`],ef.default["skill-guidance-view"],"w-full overflow-auto",void 0,d,t),"data-testid":"skill-page-root",children:x()})},null!=s?s:"default")};var eS=a(604889),e_=a(201272),ey=a(426156),eC=a(728319),ew=a(997022);let eb=(e,t)=>{(0,ew.useOnce)(e),(0,i.useEffect)(e,t)};var ex=a(580622),eT=a(172320),ek=a(640380),eI=a(178230),eP=a(941114);let eA=(0,i.forwardRef)(e=>{let{chatId:t,chatType:a,skillType:n}=e,r=(0,b.useLocation)(),l=(0,ek.useNavigate)(),[s,d]=(0,i.useState)(!0),{scrollRef:c}=(0,eS.useChatRef)(),{sendMessageHelper:v,localThreadSendMessage:g}=(0,z.useInitNewThread)({chatId:t,chatType:a,eventPrefix:"skill_guidance_chat_view",navigate:l});(0,u.useParseUrlActions)({onReadyToParse:async()=>{await (0,eT.timeoutPromise)(300)},plugins:[...$],isLazy:!1}),(0,i.useEffect)(()=>{let e=async(e,t)=>{var a;await (null===(a=c.current)||void 0===a?void 0:a.scrollToBottom()),d(!1);let{resolveLocalConversationId:n,toNewChat:i}=v(),r=await g(n,t);return i(),r};return K.chatViewMessageEventBus.on("processMessageBefore",e),()=>{K.chatViewMessageEventBus.off("processMessageBefore",e)}},[v,g]);let h=(0,X.useGuidanceActiveSkillIdentifier)();(0,i.useEffect)(()=>{n===ed.SkillType.ImageGeneration&&(0,J.getChatCanvasPlugin)("image-artifact-preview")},[n]);let f=(0,i.useMemo)(()=>{var e,t,a,n;let i=(null===(e=r.state)||void 0===e?void 0:e.from)||H.SkillGuidancePageFrom.DEFAULT;return null===(n=window)||void 0===n||null===(a=n.history)||void 0===a||null===(t=a.replaceState)||void 0===t||t.call(a,(0,V.default)(r.state,"from"),""),i},[r.state]);eb(()=>{(0,Z.getChatService)("chatGuidanceService").then(e=>{var t;return null==e?void 0:null===(t=e.setSkillGuidancePageFrom)||void 0===t?void 0:t.call(e,f)})},[f]);let p=(0,ex.default)(f),m=(0,ex.default)(n),S=(0,i.useCallback)((0,o.default)(()=>{eI.logger.persist.info({eventName:"skill_guidance_page_start",meta:{from:p.current,skill_type:m.current,skill_type_str:(0,es.getSkillTypeStr)(m.current),skill_id:(0,es.getSkillTypeStr)(m.current)}})}),[h]);(0,i.useLayoutEffect)(()=>{s&&h&&S()},[s,h]);let _=(0,D.useAppInitEventEmitted)();(0,i.useEffect)(()=>{_&&(e_.DeprecatedFlowEvent.emit("app.init"),(0,D.setAppInitEventEmitted)(!0))},[_]),eb(()=>{(0,Z.getChatService)("chatGuidanceService").then(e=>{var t;return null==e?void 0:null===(t=e.setAppear)||void 0===t?void 0:t.call(e,!0)})},[]);let{isNewGuidance:y}=(0,W.useNewGuidanceAb)(),{onBeforeSendMessage:C}=(0,q.useGuestInputInteract)({chatId:t,chatType:a,source:`skill_guidance_${n}`,activeSkillType:h});return(0,eg.jsx)(ey.ErrorBoundary,{logger:eI.logger,FallbackComponent:eC.DefaultErrorFallback,errorBoundaryName:"skill_guidance_chat_view_error",errorBoundaryScope:ey.ErrorBoundaryScopeEnum.Component,children:(0,eg.jsx)(G.default,{in:s,unmountOnExit:!0,timeout:400,children:e=>(0,eg.jsx)(em,{className:U()(eP.default[`fade-${e}`],eP.default["slide-up"]),hideCloseBtn:y,inputSkillType:n,onBeforeSendMessage:C,skillGuidancePageFrom:f},null!=h?h:"default")})})});var eE=a(551886),eB=a(93178),eF=a(971857),eM=a(337524),eL=a(498400),eN=a(996406),ej=a(218679),eR=a(348339);let eG=e=>{var t;let{conversationId:a}=e,{onOpenFileByKey:n,onOpenFileByLink:r}=(0,eR.useOnOpenFile)(),l=(0,b.useLocation)(),o=()=>{eI.logger.persist.info({eventName:"auto_open_pdf_page",meta:{success:1}})},{autoOpenPdfPage:s}=null!==(t=null==l?void 0:l.state)&&void 0!==t?t:{};(0,i.useEffect)(()=>{if(s){if((0,eN.default)(s)){let e={..."assetList"in s&&Array.isArray(s.assetList)?{assetList:s.assetList}:{},..."realFileKey"in s&&(0,ej.default)(s.realFileKey)?{realFileKey:s.realFileKey}:{}};"key"in s&&(0,ej.default)(s.key)&&s.key&&n?(n(s.key,"PDF",{pdf:e,openFrom:s.openFrom},{entranceType:s.entranceType}),o()):"url"in s&&(0,ej.default)(s.url)&&s.url&&r&&(r(s.url,{attchmentType:"pdf",pdf:e,openFrom:s.openFrom},{entranceType:s.entranceType}),o())}window.history.replaceState({},"")}},[a,s])};var eV=a(619352),eO=a(212183);let eU=e=>{let{chatId:t,chatType:a}=e,{onConversationChatPageVisibilityChange:n}=(0,ev.useChat)(),{scrollRef:r,chatInputRef:l,chatViewRef:o,chatPageTargetRef:s,chatDropTargetRef:d}=(0,eS.useChatRef)();(0,i.useEffect)(()=>{if(a!==I.ChatType.Conversation)return;let e=()=>{if(null==n||n({visible:"visible"===document.visibilityState,scrollRef:r,chatInputRef:l,chatViewRef:o,chatPageTargetRef:s,chatDropTargetRef:d}),"visible"===document.visibilityState&&o&&"current"in o&&o.current){var e,t;null===(e=(t=o.current).syncData)||void 0===e||e.call(t)}};return window.addEventListener("visibilitychange",e),()=>{window.removeEventListener("visibilitychange",e)}},[t,a])},eD=e=>{let{chatId:t}=e;return eG({conversationId:t}),null},e$=e=>{let{chatId:t,extraExtRef:a}=e,n=(0,eL.usePluginAuthString)(t);return(0,i.useEffect)(()=>{(null==a?void 0:a.current)&&(a.current={...a.current,ugc_plugin_auth_infos:n})},[n]),(0,i.useEffect)(()=>{let e=(0,eO.getBotIdByConversationId)(t);e&&(0,eL.fetchPluginList)(e||"")},[t]),null},eW=(0,i.forwardRef)(function(e,t){let{chatId:a,chatType:n,extraExtRef:i}=e;return eU({chatId:a,chatType:n}),(0,eV.useChatView)(t,{conversationId:a,extraExtRef:i}),null}),ez=(0,o.default)(()=>S.useTracingStore.getState().markMessageListPerformance("messageListRenderStartTimestamp")),eK=(0,i.forwardRef)(function(e,t){let{chatId:a,chatType:n,MessageListSlot:r}=e,l=(0,eF.useIsSamantha)(a,n),o=(0,i.useRef)({});if(n!==I.ChatType.Conversation&&n!==I.ChatType.ThreadLocalConversation)return null;let s=(0,eg.jsx)(eM.SamanthaLayout.MaxWidthLayout,{children:(0,eg.jsx)(eB.ChatContentSkeletonUI,{})}),d={chatId:a,chatType:n,extraExtRef:o},u=(0,eg.jsxs)(eg.Fragment,{children:[l&&(0,eg.jsx)(eD,{...d}),!l&&(0,eg.jsx)(e$,{...d}),n===I.ChatType.Conversation&&(0,eg.jsx)(eW,{...d,ref:t}),n===I.ChatType.ThreadLocalConversation&&(0,eg.jsx)(eE.NewThreadLocalChatViewPeerComp,{...d})]});return ez(),(0,eg.jsxs)(i.Suspense,{fallback:s,children:[(0,eg.jsx)(G.default,{in:!0,timeout:400,appear:I.ChatType.Conversation!==n,exit:!1,children:e=>(0,eg.jsx)(r,{section:!0,conversationId:a,enableLoadMore:n===I.ChatType.Conversation,className:U()(eP.default[`fade-${e}`],eP.default["slide-up"])})}),u]})});var eH=a(214071),eJ=a(486677),eZ=a(506979),eq=a(739036),eX=a(30999),eQ=a(156272),eY=a(101874),e0=a(840738),e1=a(629006),e2=a(229079);let e3=e=>({onboarding_content_source:(0,e2.default)(e,["ext","onboarding_content_source"],"")});var e7=a(800477),e8=a(83990),e4=a(637319),e6=a(645298),e5=a(773289),e9=a(910214),te=a(458524),tt=a(198660),ta=a(888130),tn=a(712980),ti=a(856392);let tr=()=>{let e=(0,k.useBotStore)(e=>e.choicenessBotLinks,r.shallow),[t,a]=(0,k.useBotStore)(e=>[e.botMap,e.botIdToLocalConversationMap],r.shallow),[n]=(0,E.useFeedStore)(e=>[e.conversationLinks],r.shallow);return e.filter(e=>{var i;let r=t[e.botID],l=a[e.botID]||"";return!r.has_conversation&&(null===(i=r.action)||void 0===i?void 0:i.action_type)===e5.BotActionType.ArchiveConversation&&!n.find(e=>e.conversationId===l)})},tl=()=>(0,k.useBotStore)(e=>e.discoveryBotListStatus||{},r.shallow),to=e=>(0,k.useBotStore)(t=>e?t.botIdToLocalConversationMap[e]:void 0),ts=e=>{let t=E.useFeedStore.getState().addNewLocalConversation({conversation:{conversation_type:eY.PcchatExprConversationType.Bot}});return k.useBotStore.getState().setLocalConversationIdForBot({botId:e,localConversationId:t}),t};async function td(e,t){if(2!==Number(null==e?void 0:e.version))return{msgList:[],onboarding_content_source:"preset"};let a=null==e?void 0:e.message_list,n={};if((null==e?void 0:e.call_mode)===e5.CallMode.Real||(null==e?void 0:e.call_mode)===e5.CallMode.RealNone)try{a=(null==e?void 0:e.call_mode)===e5.CallMode.Real?e.message_list:[];let{data:i}=await e9.botApiService.GetFirstMet({bot_id:t});n=i}catch(e){}if(!(0,eH.default)(null==n?void 0:n.message_list)){var i;a=null==n?void 0:null===(i=n.message_list)||void 0===i?void 0:i.slice()}let r=e3(null==a?void 0:a[0]);return{msgList:a,...r}}async function tu(e,t,a,n){let i=(0,e0.getTemporaryReplyMessageId)(e6.onBoardingConstantMessageId);if(2===Number(null==t?void 0:t.version)&&!(0,eH.default)(a)){if(a)for(let[t,r]of(0,eJ.default)(a)){let a={...r,message_id:e6.onBoardingConstantMessageId+t,local_message_id:i+t,conversation_id:e,local_conversation_id:e,reply_id:e6.onBoardingConstantMessageId,status:te.PushMessageStatus.Available,conversation_type:eY.PcchatExprConversationType.Bot,user_type:te.UserType.Bot};if(!(0,e1.isSuggestMessage)(a)){let e=await (0,e7.transformAliceChatMessageToMessage)(a);n.draftMessageLinks.push({isLocalMessage:!1,messageId:e6.onBoardingConstantMessageId+t}),n.draftMessageMap[e6.onBoardingConstantMessageId+t]={...e,is_delta:!1}}}return}2!==Number(null==t?void 0:t.version)&&function(e,t,a,n,i,r){let l={is_delta:!1,content_obj:{text:r},content_type:te.ContentType.Text,conversation_id:t,create_time:Date.now(),local_info:{from:eY.MessageFrom.Api,log_id:"none"},ext:{is_finish:"1",onboarding:"1",stream:"1",sp:JSON.stringify(i)},is_finish:!0,index:1,local_message_id:a,message_id:e6.onBoardingConstantMessageId,message_type:te.MessageType.Message,meta_infos:void 0,reply_id:e6.onBoardingConstantMessageId,status:te.PushMessageStatus.Available},o={isLocalMessage:!1,messageId:e6.onBoardingConstantMessageId};n.draftMessageLinks.push(o),n.draftMessageMap[e6.onBoardingConstantMessageId]=l}(0,e,i,n,[],null==t?void 0:t.content)}let tc=(0,i.forwardRef)(e=>{let{chatId:t,chatType:a,MessageListSlot:n}=e,l=(0,ek.useNavigate)(),o=(0,b.useLocation)(),{enter_from:s,from_visit_page:d,bot_position:u}=(0,tn.parseHashOrQuery)(o.search)||{},c=to(t),v=(0,k.useBotInfo)(t),g=(0,i.useRef)(0),h=(0,i.useRef)(!1),{tagList:f,selectedTagId:p}=tl(),m=tr(),[S,_]=(0,e8.useMessageStore)(e=>[e.updateMessageList,e.clearConversationMessages],r.shallow),[y]=(0,k.useBotStore)(e=>[e.fetchToUpdateBot],r.shallow);return(0,i.useEffect)(()=>{let e=(e,a)=>a.map(e=>{var a,n;return{...e,localConversationId:c,botId:t,reportEvents:{create_conversation_by_message:(0,ti.createReportEvent)({eventName:"create_conversation_by_message",meta:{scene:"new_bot_conversation"}})},reportParams:{...e.reportParams,enter_from:(null==o?void 0:null===(a=o.state)||void 0===a?void 0:a.enter_from)||s,from:(null===(n=e.reportParams)||void 0===n?void 0:n.from)||""},chatType:I.ChatType.Bot,botType:"UGC"}}),a=(e,t)=>(l(o.pathname.concat(o.search),{state:{backToRoute:void 0}}),t);return K.chatViewMessageEventBus.on("processMessageBefore",e),K.chatViewMessageEventBus.on("beforeMessageSending",a),()=>{K.chatViewMessageEventBus.off("processMessageBefore",e),K.chatViewMessageEventBus.off("beforeMessageSending",a)}},[c]),(0,i.useEffect)(()=>{var e,n,i,r,C,w,b;let x=ts(t);async function T(e){var n;let i;if((a===I.ChatType.Bot||a===I.ChatType.ProfileBot)&&!(i=k.useBotStore.getState().botMap[t]))try{i=await y({botId:t})}catch(e){eI.logger.persist.error({message:"fetchToUpdateBotInfo Error",error:e})}if((null==i?void 0:i.has_conversation)&&i.conversation_id){let e=`${eX.CHAT_PAGE_ROUTE}${i.conversation_id}`,{guest_landing:t,login_source:a}=(0,tn.parseHashOrQuery)(o.search);if(1===Number(t)){let t={guest_landing:"1"};a&&(t.login_source=a),e=(0,tn.toURL)(`${eX.CHAT_PAGE_ROUTE}${i.conversation_id}`,t)}return l(e,{state:{create_chat_type:"chat_with_bot",page_start_time:g.current}})}if(!i&&(null==o?void 0:null===(n=o.state)||void 0===n?void 0:n.shareFallbackToChatNew)){let e=(0,tn.addQuery)(eX.NEW_CHAT_PAGE_ROUTE,{botId:t,enter_from:"url_new_invisible"});return(0,tt.getIsLoginLoading)()&&await (0,tt.getLoginLoadingPromise)(),(0,tt.getIsLoggedIn)()?l(e):l((0,eQ.addHideHomepageUrl)((0,tn.addQuery)(eX.LOGIN_PAGE_ROUTE,{loginSuccessBackUrl:e})))}let{onboarding:r}=i||{},s={onboarding_content_source:""};if(r&&x){_(x);let{msgList:e=[],onboarding_content_source:a="preset"}=await td(r,t);S({conversationId:x,immerUpdate:async t=>{await tu(x,r,e,t),s={onboarding_content_source:a}}})}(0,er.trackEvent)("enter_page",{...e,...s})}let P=(0,eQ.getLoginSourceQuery)(o),A="bot_discover"===((null==o?void 0:null===(e=o.state)||void 0===e?void 0:e.enter_from)||s),B=(null===(n=o.state)||void 0===n?void 0:n.from_visit_page)||d,F={current_page:eZ.VisitPage.CHAT,previous_page:P||B||"other"},M={...F,page:"chat",bot_id:t,is_tts:0,enter_method:"bot_discover"===((null==o?void 0:null===(i=o.state)||void 0===i?void 0:i.enter_from)||s)?"bot_list_discover":null!==(w=(null==o?void 0:null===(r=o.state)||void 0===r?void 0:r.enter_from)||s)&&void 0!==w?w:"other",bot_position:null!==(b=String((null==o?void 0:null===(C=o.state)||void 0===C?void 0:C.bot_position)||u))&&void 0!==b?b:"other",chat_type:(0,eO.getChatTypeForTea)("","",v),user_id:A?(0,ta.getUserId)():void 0,req_id:A?(0,k.getRequestIdByBotId)(t):void 0,recommend_from:A?"bot_list_discover":void 0};g.current=Date.now(),T(M);let L=E.useFeedStore.subscribe(e=>e.localConversationMap[x],e=>{var a,n,i,r,o,s,d,u;if((null==e?void 0:null===(a=e.local)||void 0===a?void 0:a.createStatus)===ee.CreateConversationStatus.Done&&(null==e?void 0:null===(n=e.local)||void 0===n?void 0:n.newConversationId)){null===(r=e.local)||void 0===r||null===(i=r.reportEvent)||void 0===i||i.success();let{botInfo:a}=(0,eO.getInfoByConversationId)(e.local.newConversationId),n={...F,enter_method:null==e?void 0:null===(o=e.local)||void 0===o?void 0:o.createFrom,click_from:"chatted",bot_id:t,chat_type:(0,eO.getChatTypeForTea)("",null===(s=e.local)||void 0===s?void 0:s.newConversationId,a),discover_page_bot_type:A?null===(d=f.find(e=>e.tag_id===p))||void 0===d?void 0:d.tag_name:void 0,user_id:A?(0,ta.getUserId)():void 0,req_id:A?(0,k.getRequestIdByBotId)(t):void 0,recommend_from:A?"bot_list_discover":void 0};h.current=!0,m.find(e=>e.botID===t)||(0,er.trackEvent)("follow_bot",n),l(`${eX.CHAT_PAGE_ROUTE}${null===(u=e.local)||void 0===u?void 0:u.newConversationId}`,{state:{create_chat_type:"chat_with_bot",page_start_time:g.current,enter_from:A?"bot_discover":"other_default",localConversationId:c}})}});return()=>{var e;L();let a="bot_discover"===((null==o?void 0:null===(e=o.state)||void 0===e?void 0:e.enter_from)||s);h.current||(0,er.trackEvent)("leave_chat_page",{...F,bot_id:t,duration:String(Date.now()-g.current),chat_type:(0,eO.getChatTypeForTea)("","",v),user_id:a?(0,ta.getUserId)():void 0,recommend_from:a?"bot_list_discover":void 0,req_id:a?(0,k.getRequestIdByBotId)(t):void 0})}},[t]),(0,i.useEffect)(()=>{let e=async(e,t)=>{if("UGC"===t[0].botType&&(0,e4.isFirstChatSelector)(e8.useMessageStore.getState(),t[0].conversationId||"")){let e=(0,ti.createReportEvent)({eventName:"hide_large_avatar"});await Promise.race([P.useLargeAvatarStore.getState().hideAvatar(),new Promise(e=>setTimeout(()=>e(!0),250))])?e.error({reason:"timeout",meta:{visibility:document.visibilityState}}):e.success()}return t};return eq.appMessageEventBus.on("processMessageBefore",e),()=>{eq.appMessageEventBus.off("processMessageBefore",e)}},[]),c?(0,eg.jsx)(n,{section:!1,conversationId:c}):null}),tv=(0,i.forwardRef)(function(e,t){var a;let n=(0,y.useChatSlice)("chatViewCoreStore",e=>e.currentChatViewConfig,M.default),r=(null==n?void 0:n.chatKey)||(null==n?void 0:n.chatId),l=(0,_.useChatService)("chatViewService");(0,N.default)(()=>{let e=(0,y.getChatStore)("chatViewCoreStore");if(!0===e.getState().needSkipRouteAutoClosing){e.setState({needSkipRouteAutoClosing:!1});return}l.closeCanvasPanel()},[r]),(0,j.default)(()=>l.closeCanvasPanel());let o=null===(a=(0,R.useParams)())||void 0===a?void 0:a.id,s=(0,i.useMemo)(()=>{var e,t;let a=(0,L.getSkillGuidanceIdentifierBySkillGuidancePageType)(o);return null===(e=(t=(0,y.getChatSlice)("chatGuidanceStore")).setActiveSkillGuidanceIdentifier)||void 0===e||e.call(t,a),a},[o]),d=(0,i.useMemo)(()=>(0,L.getSkillTypeBySkillGuidancePageType)(o),[o]),u=null==n?void 0:n.chatType;return u===I.ChatType.ThreadLocalConversation||u===I.ChatType.Conversation?(0,eg.jsx)(eK,{...e,ref:t}):u===I.ChatType.Bot||u===I.ChatType.ProfileBot?(0,eg.jsx)(tc,{...e,ref:t}):u===I.ChatType.NewThread&&s?(0,eg.jsx)(eA,{...e,skillType:d,ref:t}):null});tv.displayName="CustomChatView";var tg=a(216714),th=a(708693);let tf=a(436114).default;var tp=a(831566),tm=a(366119);let tS=e=>{let t=(0,ek.useNavigate)(),{run:a}=(0,tm.default)(a=>{a.localConversationId===(null==e?void 0:e.chatId)&&t(`${eX.CHAT_PAGE_ROUTE}${a.newConversationId}`,{relative:"route",replace:!0,state:{localConversationId:a.localConversationId}})});(0,i.useEffect)(()=>(tp.DeprecatedChatEvent.on("chat.thread.created",a),()=>{tp.DeprecatedChatEvent.off("chat.thread.created",a)}),[])};var t_=a(510534),ty=a(633486);let tC=()=>{let e=(0,el.useTranslateFn)(),t=(0,t_.getBrandName)(),a=(0,ty.useIsInSuperApp)();return`${a?t:e("web_seo_doubao_index")}`},tw=((n={})[n.SkillType=0]="SkillType",n[n.TranslateKey=1]="TranslateKey",n[n.RoutePath=2]="RoutePath",n[n.SkillGuidancePageType=3]="SkillGuidancePageType",n[n.Icon=4]="Icon",n),tb=()=>[[ed.SkillType.WriteAssistant,"skill_writing_title",L.SkillGuidancePageRoute[L.SkillGuidancePageType.Write],L.SkillGuidancePageType.Write],[ed.SkillType.ImageGeneration,"skill_image_title",L.SkillGuidancePageRoute[L.SkillGuidancePageType.Image],L.SkillGuidancePageType.Image],[ed.SkillType.Search,"skill_search_title2",L.SkillGuidancePageRoute[L.SkillGuidancePageType.Search],L.SkillGuidancePageType.Search],[ed.SkillType.ReadPDF,"skill_readPdf_btn_immersive",L.SkillGuidancePageRoute[L.SkillGuidancePageType.Pdf],L.SkillGuidancePageType.Pdf],[ed.SkillType.DeepSearch,"deepsearch",L.SkillGuidancePageRoute[L.SkillGuidancePageType.DeepSearch],L.SkillGuidancePageType.DeepSearch],[ed.SkillType.CodeAssistant,"cici_web_ai_coding_skill_title",L.SkillGuidancePageRoute[L.SkillGuidancePageType.Coding],L.SkillGuidancePageType.Coding],[ed.SkillType.VoiceCall,"web_skill_voice_call","",L.SkillGuidancePageType.Voice],[ed.SkillType.VideoGeneration,"skill_video_title",L.SkillGuidancePageRoute[L.SkillGuidancePageType.VideoGeneration],L.SkillGuidancePageType.VideoGeneration]],tx=e=>{var t;let{pageType:a}=e;return null!==(t=tb().find(e=>{let[,,,t]=e;return t===a}))&&void 0!==t?t:null},tT=e=>{let t=(0,el.useTranslateFn)(),a=(0,X.useGuidanceActiveSkillIdentifier)(),n=(0,L.getSkillGuidancePageTypeBySkillGuidanceIdentifier)(a),i=(0,tt.useIsLoggedIn)();return(0,E.useFeedStore)(a=>{if((null==e?void 0:e.chatType)===I.ChatType.NewThread){let e=tx({pageType:n});return e?t(null==e?void 0:e[tw.TranslateKey]):void 0}if((null==e?void 0:e.chatType)===I.ChatType.Bot){var r;return null===(r=k.useBotStore.getState().botMap[e.chatId||""])||void 0===r?void 0:r.name}if((null==e?void 0:e.chatType)!==I.ChatType.Conversation)return;let l=(0,eo.conversationSelector)(a,e.chatId);return(null==l?void 0:l.conversation_type)&&[eY.PcchatExprConversationType.Coco,eY.PcchatExprConversationType.CocoWeb].includes(null==l?void 0:l.conversation_type)&&i?t("recent_chats_main_bot_doubao_title"):null==l?void 0:l.name},r.shallow)},tk=e=>{let t=tC(),a=tT(e),n=(0,t_.getBrandName)();return a?`
            ${a} - ${n}`:t};var tI=a(577180),tP=a(595495),tA=a(249458),tE=a(301302),tB=a(643404);let tF=(0,a(559891).withSuspense)(i.lazy(()=>(0,tB.retryLoadWithFallBack)({fn:()=>Promise.all([a.e("12836"),a.e("15390"),a.e("18748"),a.e("64404"),a.e("81070"),a.e("9812"),a.e("29114"),a.e("99898"),a.e("87330"),a.e("76778"),a.e("94296"),a.e("7278"),a.e("47768"),a.e("15179"),a.e("32529"),a.e("62488"),a.e("89783"),a.e("82446"),a.e("19142"),a.e("33742"),a.e("75029")]).then(a.bind(a,881359))})));function tM(){let e=(0,y.useChatSlice)("chatViewCoreStore").currentChatViewConfig,{chatId:t}=null!=e?e:{chatId:""},{activeKey:a,mode:n}=(0,tE.useChatLayoutStore)(),i=(0,eF.useConversation)(t),r=(null==i?void 0:i.bot_id)||t,l="setting"===n?t===a:void 0!==r&&r===a;return e&&l?(0,eg.jsx)(tF,{...e}):null}let tL={ChatView:tv,LargeAvatar:F,ChatHeader:tg.CustomChatHeader,ChatInput:th.ChatInput},tN=(0,o.default)(()=>{S.useTracingStore.getState().addDurationPoint("chat_page_first_render")}),tj=()=>{var e;let t=(0,b.useLocation)(),a=(0,tI.useChatViewConfigByPath)(),n=(0,C.useCompareMemo)(a?{...a,chatKey:null==t?void 0:null===(e=t.state)||void 0===e?void 0:e.localConversationId}:void 0,r.shallow),i=(0,w.default)(n),o=(0,_.useChatService)("chatViewService");return(0,l.useStore)(o.immersiveStore,e=>{var a,r,l;return n?{...n,chatKey:(null==i?void 0:i.chatId)===n.chatId?null!==(l=null==t?void 0:null===(a=t.state)||void 0===a?void 0:a.localConversationId)&&void 0!==l?l:null==i?void 0:i.chatKey:null==t?void 0:null===(r=t.state)||void 0===r?void 0:r.localConversationId,isImmersiveMode:null!=e&&!!e.exactImmersiveMode||void 0}:void 0},r.shallow)};function tR(){var e;tN(),(0,i.useEffect)(()=>{S.useTracingStore.getState().addDurationPoint("chat_page_mount")},[]);let t=tj();(0,g.useShareConfigInit)(),(0,i.useEffect)(()=>{(null==t?void 0:t.chatKey)&&(0,y.getChatSlice)("chatViewCoreStore").currentLocalConversationId===(null==t?void 0:t.chatKey)&&(0,y.getChatStore)("chatViewCoreStore").setState({currentLocalConversationId:""})},[null==t?void 0:t.chatKey]),tS(t);let{wrapperToggle:a}=(0,c.useOpenBotSettings)(null!==(e=null==t?void 0:t.chatId)&&void 0!==e?e:"");return tf(),(0,u.useParseUrlActions)({plugins:[d,v.AISpaceMinuteMettingUrlAction,p.CodeArtifactsShareUrlAction,h,m.CodeArtifactsUrlAction,f]}),(0,eg.jsxs)(eg.Fragment,{children:[(0,eg.jsx)(x.Helmet,{children:(0,eg.jsx)("title",{children:tk(t)})}),!(null==t?void 0:t.isImmersiveMode)&&(0,eg.jsx)(tA.ChatKitPage,{chatViewConfig:t,bizSlots:tL,onOpenCurrentBotSideBar:e=>{let{enterFrom:t}=e;a({enter_from:t})},children:(0,eg.jsx)(tM,{})}),(0,eg.jsx)(tP.PluginLazyImmersivePage,{chatViewConfig:t})]})}},792433:function(e,t,a){var n=a(651750),i=(0,a(19526).default)(function(e,t,a){(0,n.default)(e,t,a)});t.default=i}}]);
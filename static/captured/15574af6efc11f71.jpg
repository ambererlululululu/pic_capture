"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["72319"],{522455:function(e,t,a){var o,l;a.d(t,{BotType:function(){return r},EntityType:function(){return i}});let r=((o={})[o.User=0]="User",o[o.Coco=1]="Coco",o[o.GuanFang=2]="GuanFang",o[o.CocoWeb=3]="CocoWeb",o),i=((l={})[l.EntityType_Unknown=0]="EntityType_Unknown",l[l.EntityType_File=1]="EntityType_File",l[l.EntityType_Image=2]="EntityType_Image",l)},390031:function(e,t,a){a.r(t),a.d(t,{AttachmentUploadStoreService:function(){return er}});var o=a(218679),l=a(698392),r=a(522455),i=a(722038),n=a(910214),d=a(458524),s=a(249254),p=a(856392),c=a(178230);let u=()=>(0,l.getChatStore)("attachmentUploadStore").getState().preGeneratedIdMap;function y(e){let t=u().get(e);return(0,l.getChatStore)("attachmentUploadStore").setState(e=>({...e,preGeneratedIdMap:new Map})),t}let _={file:r.EntityType.EntityType_File,image:r.EntityType.EntityType_File},g={file:i.FileType.File,image:i.FileType.OCRImage};async function S(e){var t,a;let{info:y,task:f,directoryId:v}=e;if(!f)return;let{file:m,preHandle:h,ctx:k,md5:I}=f;if(h&&k){if("pre_handle"===h.version)n.messageApiService.MessagePreHandle({content:JSON.stringify({file_list:[{file_name:(0,s.pickAsString)("name")(m),key:(null==y?void 0:y.uploadResult.ImageUri)||""}]}),content_type:d.ContentType.File});else if("pre_handle_v2"===h.version&&("file"===f.type||"image"===f.type)){let e={entity_type:_[f.type],entity_content:{file:{file_name:(0,s.pickAsString)("name")(m),key:(null==y?void 0:y.uploadResult.ImageUri)||"",md5:I,file_type:g[f.type]||i.FileType.File,image:{key:(null==y?void 0:y.uploadResult.ImageUri)||""},size:null==m?void 0:m.size}},identifier:f.localKey||""};if(h.enableImageVlm&&"image"===f.type&&(e={entity_type:r.EntityType.EntityType_Image,entity_content:{image:{key:(null==y?void 0:y.uploadResult.ImageUri)||""}},identifier:f.localKey||""}),h.sectionId){let t=(0,p.createReportEvent)({eventName:"PreHandleV2_MultiMessagePreHandle_api",meta:{conversationId:k.conversationId,sectionId:h.sectionId,preGeneratedLocalMessageId:h.preGeneratedLocalMessageId,preGeneratedId:u().get(h.preGeneratedLocalMessageId),...m,...f}});try{await n.messageApiService.MultiMessagePreHandle({conversation_id:k.conversationId,bot_id:k.botId,section_id:h.sectionId,local_message_id:h.preGeneratedLocalMessageId,uplink_entity:e}),t.success()}catch(e){t.error({reason:"api error",error:e})}}else{let a=(0,p.createReportEvent)({eventName:"PreHandleV2_MultiMessagePreHandleWithoutConv_api",meta:{conversationId:k.conversationId,sectionId:h.sectionId,preGeneratedLocalMessageId:h.preGeneratedLocalMessageId,preGeneratedId:u().get(h.preGeneratedLocalMessageId),...m,...f}});try{let r=u().get(h.preGeneratedLocalMessageId),i=await n.messageApiService.MultiMessagePreHandleWithoutConv({bot_id:k.botId,local_message_id:h.preGeneratedLocalMessageId,uplink_entity:e,pre_generate_id:r});if(a.success(),!r){let e=u().get(h.preGeneratedLocalMessageId);if(e)r!==e?S.call(this,{info:y,task:f}):c.logger.persist.error({eventName:"PreHandleV2_MultiMessagePreHandleWithoutConv_failed",error:Error("[upload complete] MultiMessagePreHandleWithoutConv preGeneratedId duplicate")});else{let e=null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.pre_generate_id;e&&(0,o.default)(e)?(0,l.getChatStore)("attachmentUploadStore").setState(t=>{let a=new Map(t.preGeneratedIdMap);return a.set(h.preGeneratedLocalMessageId,e),{...t,preGeneratedIdMap:a}}):c.logger.persist.error({eventName:"PreHandleV2_MultiMessagePreHandleWithoutConv_failed",error:Error("[upload complete] MultiMessagePreHandleWithoutConv response no preGeneratedId")})}}}catch(e){a.error({reason:"api error",error:e})}}}else if("pre_handle_code"===h.version){let e=(0,p.createReportEvent)({eventName:"CodePreHandle_api",meta:{conversationId:k.conversationId,...m,...f}});try{let t=await n.samanthaApiService.CodePreHandle({directory_id:v});return e.success(),null==t?void 0:null===(a=t.data)||void 0===a?void 0:a.name_review_status}catch(t){e.error({reason:"api error",error:t})}}}}var f=a(544044),v=a(459271),m=a.n(v),h=a(705033),k=a(4137),I=a(217957),C=a(746479),T=a(746167),U=a(544052),E=a(277828),M=a(785926),P=a(230932),F=a(884181),D=a(334312),K=a(239358),A=a(18244),R=a(101001),w=a(777422),b=a(524129),L=a(710733),G=a(949932),N=a(634046);let x=e=>{let{chatId:t,skillType:a="default"}=e;(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>(0,h.default)(e,["preGeneratedLocalMessageIdMap",t,`_${a}`],(0,E.createLocalMessageId)())))},H=function(e,t,a){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{preHandle:l}=o;return{type:t,key:"",localKey:(0,f.default)(),percent:0,blobUrl:URL.createObjectURL(e),loading:!0,failed:!1,fileKey:"",file:e,ctx:a,preHandle:l}},O=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{preHandle:o}=a;return{type:"directory",key:"",localKey:(0,f.default)(),fileKey:"",ctx:t,preHandle:o,blobUrl:"",file:e[0],loading:!0,failed:!1,percent:0}};async function W(){var e,t,a;let o=N.chatInputCoreServiceContainer.get("chatConfigService",!0),{imageUploader:r,fileUploader:i,mediaUploader:n}=(0,l.getChatStore)("attachmentUploadStore").getState();if(!r){let t=await (null==o?void 0:o.createUploader({type:R.UPLOADER_TYPE.Image,scene:R.UPLOADER_SCENE_ID.BOT_CHAT,userId:null!==(e=o.userId)&&void 0!==e?e:"",appId:o.appId}));(0,l.getChatStore)("attachmentUploadStore").setState({imageUploader:t})}if(!i){let e=await (null==o?void 0:o.createUploader({type:R.UPLOADER_TYPE.File,scene:R.UPLOADER_SCENE_ID.BOT_CHAT,userId:null!==(t=o.userId)&&void 0!==t?t:"",appId:o.appId}));(0,l.getChatStore)("attachmentUploadStore").setState({fileUploader:e})}if(!n){let e=await (null==o?void 0:o.createUploader({type:R.UPLOADER_TYPE.Video,scene:R.UPLOADER_SCENE_ID.BOT_CHAT,userId:null!==(a=o.userId)&&void 0!==a?a:"",appId:o.appId}));(0,l.getChatStore)("attachmentUploadStore").setState({mediaUploader:e})}}function B(e){let{fileUploadCallbacks:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{ctx:a,file:o}=e,r=a?(0,p.createReportEvent)({eventName:"attachment_upload",meta:{upload_type:e.type,upload_from:a.uploadFrom}}):void 0,i=(e,t)=>async a=>{let o=(0,C.createDraft)((0,l.getChatStore)("attachmentUploadStore").getState()),r=o.preprocessTaskMap[e];try{if(!r)return;await t(a,r)}finally{(0,l.getChatStore)("attachmentUploadStore").setState((0,C.finishDraft)(o))}};return{complete:i(e.localKey,(i,n)=>{if(n.loading=!1,n.failed=!1,i){var d,p;null==t||null===(d=t.complete)||void 0===d||d.call(t,i),n.percent=i.percent,n.uploadResult=i.uploadResult,n.key=i.uploadResult.ImageUri||"",n.fileKey=i.key,r&&(r.addDurationPoint("success"),r.success({meta:{upload_file_size:String(i.fileSize)}})),a&&(0,w.trackEvent)("upload_status",{status:"1",conversation_id:a.conversationId,conversation_type:(0,M.conversationTypeByIdSelector)(P.useFeedStore.getState(),a.conversationId)||1,chat_type:a.chatType,skill_name:a.skillType?(0,D.getSkillTeaNameByType)(a.skillType):void 0,skill_id:a.skillId||void 0,upload_id:a.uploadId,duration:i.duration.toString(),upload_way:a.uploadWay,upload_collection_way:a.uploadCollectionWay,collection_id:null===(p=i.uploadResult)||void 0===p?void 0:p.ImageUri,collection_name:(0,s.pickAsString)("name")(o),upload_type:a.uploadType||("file"===e.type?"pdf":"pic"),upload_file_type:(0,G.getFileType)((0,G.getFileExt)((0,s.pickAsString)("name")(o))),upload_token_length:"",upload_file_size:String(i.fileSize),upload_from:a.uploadFrom,upload_collection_id:a.uploadCollectionId,upload_method:a.uploadMethod,click_from:a.from,...(null==a?void 0:a.extraParams)||{}}),S.call(this,{info:i,task:(0,l.getChatStore)("attachmentUploadStore").getState().preprocessTaskMap[e.localKey]})}}),progress:i(e.localKey,(e,a)=>{if(a.loading=!0,a.failed=!1,e){var o;null==t||null===(o=t.progress)||void 0===o||o.call(t,e),a.percent=e.percent,a.fileKey=e.key}}),error:i(e.localKey,(l,i)=>{if(i.loading=!1,i.failed=!0,i.uploadResult=void 0,i.key="",l){var n,d,p;null==t||null===(n=t.error)||void 0===n||n.call(t,l),i.fileKey=l.key,r&&r.error({reason:"upload attachment failed",meta:{upload_file_size:String(l.fileSize)}}),a&&((0,w.trackEvent)("upload_file_status",{bot_id:a.botId,message_type:e.type,enter_method:a.from,success:"0",result:null!==(p=null===(d=l.extra)||void 0===d?void 0:d.message)&&void 0!==p?p:""}),(0,w.trackEvent)("upload_status",{status:"0",error_code:"fail_to_upload",conversation_id:a.conversationId,conversation_type:(0,M.conversationTypeByIdSelector)(P.useFeedStore.getState(),a.conversationId)||1,chat_type:a.chatType,skill_name:a.skillType?a.skillType.toString():void 0,skill_id:a.skillId||void 0,upload_id:a.uploadId,duration:l.duration.toString(),upload_way:a.uploadWay,upload_collection_way:a.uploadCollectionWay,collection_id:"",collection_name:(0,s.pickAsString)("name")(o),upload_type:"file"===e.type?"pdf":"pic",upload_file_type:(0,G.getFileType)((0,G.getFileExt)((0,s.pickAsString)("name")(o))),upload_token_length:"",upload_file_size:String(l.fileSize),upload_from:a.uploadFrom}))}})}}async function z(e,t){c.logger.persist.log({eventName:"start_attachment_upload_getUploader_start",meta:{...t||{},type:e}});let{imageUploader:a,fileUploader:o,mediaUploader:r}=(0,l.getChatStore)("attachmentUploadStore").getState();a&&o&&r||await this.initUploader();let{imageUploader:i,fileUploader:n,mediaUploader:d}=(0,l.getChatStore)("attachmentUploadStore").getState();return"file"===e?n:"video"===e||"audio"===e?d:i}let V=(()=>{let e=null;async function t(){let{imageUploader:t,fileUploader:a}=(0,l.getChatStore)("attachmentUploadStore").getState();t&&a||await this.initUploader();let{imageUploader:o,fileUploader:r}=(0,l.getChatStore)("attachmentUploadStore").getState();null==r||r.refreshToken(),null==o||o.refreshToken(),e=null}return function(){return null!=e?e:e=t.call(this)}})();function Y(e,t,a,o){var r,i;let n=H(e,t,a,o),{localKey:d}=n,{calculateMd5:s=!0}=o||{};s&&e.arrayBuffer().then(e=>{let t=m()(new Uint8Array(e));(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{let a=e.preprocessTaskMap[d];a&&(a.md5=t)}))}).catch(e=>{}),(0,l.getChatStore)("attachmentUploadStore").setState(e=>{let{preprocessTaskMap:t}=e;return{preprocessTaskMap:{...t,[n.localKey]:n}}});let p=B.call(this,n,{fileUploadCallbacks:null==o?void 0:o.fileUploadCallbacks});return this._getUploader(t,{local_key:n.localKey,upload_id:null===(r=n.ctx)||void 0===r?void 0:r.uploadId,upload_type:n.type,upload_from:null===(i=n.ctx)||void 0===i?void 0:i.uploadFrom}).then(a=>{var o,l;c.logger.persist.log({eventName:"start_attachment_upload",meta:{local_key:n.localKey,upload_id:null===(o=n.ctx)||void 0===o?void 0:o.uploadId,upload_type:n.type,upload_from:null===(l=n.ctx)||void 0===l?void 0:l.uploadFrom,type:t}}),null==a||a.upload(e,{complete:p.complete,progress:p.progress,error:p.error})},()=>p.error()),{local_key:n.localKey,key:n.key}}async function j(e,t,a,o){let r;let n=O(Array.from(e),a,o),d=F.feedServiceContainer.get("chatInputService"),s=await (null==d?void 0:d.getDirectoryService()),p=null==s?void 0:s.uploadDirectory(e,{mountNodeId:"0"});(0,l.getChatStore)("attachmentUploadStore").setState(e=>{let{preprocessDirTaskMap:t}=e;return{preprocessDirTaskMap:{...t,[n.localKey]:n}}});let c=0;if(!p||(null==p?void 0:p.length)===0)return{local_key:n.localKey,key:n.key};let u=p.length,y=p[0].id,_=e[0].webkitRelativePath,g=null==_?void 0:_.split("/")[0],f=a?{conversation_id:a.conversationId,conversation_type:(0,M.conversationTypeByIdSelector)(P.useFeedStore.getState(),a.conversationId)||1,chat_type:a.chatType,skill_name:a.skillType?(0,D.getSkillTeaNameByType)(a.skillType):"",skill_id:a.skillId,upload_id:a.uploadId,upload_way:a.uploadWay,upload_collection_way:a.uploadCollectionWay,upload_type:"folder",upload_from:a.uploadFrom,file_cnt:null==p?void 0:p.length,upload_file_type:T.ChatTeaFileType.UPLOAD_FILE_TYPE_FOLDER,collection_name:g,collection_id:y,...(null==a?void 0:a.extraParams)||{}}:null;return null==p||p.forEach(e=>{e.status$.subscribe(async t=>{if(e.id===y&&(r=e),t===U.UploadTaskStatus.Success){let e=Math.round(++c/u*100);if((0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(t=>{let a=t.preprocessDirTaskMap[n.localKey];a&&(a.percent=e,a.key=(null==r?void 0:r.getNodeId())||"")})),c===u){let e=await S.call(this,{directoryId:null==r?void 0:r.getNodeId(),task:(0,l.getChatStore)("attachmentUploadStore").getState().preprocessDirTaskMap[n.localKey]});(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(t=>{let a=t.preprocessDirTaskMap[n.localKey];a&&(a.loading=!1,a.failed=!1,a.reviewState=e||i.ReviewState.ReviewState_Access)})),f&&(0,w.trackEvent)("upload_status",{...f,success:"true"})}}else if(t===U.UploadTaskStatus.Error&&((0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{let t=e.preprocessDirTaskMap[n.localKey];t&&(t.failed=!0,t.loading=!1)})),f)){let t="other",a="getErrorType"in e?e.getErrorType():void 0;if(a)switch(a){case U.FileTaskErrorType.UploadError:t="upload_file_error";break;case U.FileTaskErrorType.MountError:t="mount_file_error";break;default:t="other"}else e.type===U.ReadOnlyUploadTaskType.Directory&&(t="mount_dir_error");(0,w.trackEvent)("upload_status",{...f,error_code:t,success:"false"})}})}),{local_key:n.localKey,key:n.key}}function $(e,t){let a={type:"link",key:"",localKey:(0,f.default)(),percent:0,loading:!0,failed:!1,fileKey:""};(0,l.getChatStore)("attachmentUploadStore").setState(e=>{let{preprocessTaskMap:t}=e;return{preprocessTaskMap:{...t,[a.localKey]:a}}});let o=t?{conversation_id:t.conversationId,conversation_type:(0,M.conversationTypeByIdSelector)(P.useFeedStore.getState(),t.conversationId)||1,chat_type:t.chatType,skill_name:t.skillType?(0,D.getSkillTeaNameByType)(t.skillType):"",skill_id:t.skillId,upload_id:t.uploadId,upload_way:t.uploadWay,upload_collection_way:t.uploadCollectionWay,upload_type:"github",upload_from:t.uploadFrom,upload_file_type:T.ChatTeaFileType.UPLOAD_FILE_TYPE_LINK,collection_name:"",collection_id:"",meta_info:t.metaInfo,...(null==t?void 0:t.extraParams)||{}}:null;return(0,K.getGithubRepoInfo)(e).then(e=>{if(!(null==e?void 0:e.repository)){(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{let t=e.preprocessTaskMap[a.localKey];t&&(t.loading=!1,t.failed=!0)})),o&&(0,w.trackEvent)("upload_status",{...o,success:"false"});return}let{is_repo:t,id:r,source:i,language:n,ref:d,name:s}=(null==e?void 0:e.repository)||{};o&&(0,w.trackEvent)("upload_status",{...o,success:"true",collection_name:s,collection_id:r,source:i}),(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{let o=e.preprocessTaskMap[a.localKey];o&&(o.percent=100,o.key=r||"",o.isRepo=t||!1,o.repoInfo={id:r,source:i,language:n,ref:d,name:s||""},o.loading=!1)}))}),{local_key:a.localKey,key:a.key}}function J(e){var t,a;let o=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessTaskMap[e];if(!o){c.logger.persist.warning({eventName:"reUpload_mismatch_preprocessTask",meta:{local_key:e}});return}let r=B.call(this,o);r.progress(),this._getUploader(o.type,{local_key:o.localKey,upload_id:null===(t=o.ctx)||void 0===t?void 0:t.uploadId,upload_type:o.type,upload_from:null===(a=o.ctx)||void 0===a?void 0:a.uploadFrom}).then(e=>{var t;return null==e?void 0:null===(t=e.client)||void 0===t?void 0:t.start()},()=>r.error())}function q(e){var t,a;let{imageUploader:o,fileUploader:r}=(0,l.getChatStore)("attachmentUploadStore").getState();null==o||null===(t=o.client)||void 0===t||t.cancel(e),null==r||null===(a=r.client)||void 0===a||a.cancel(e)}function Q(e,t){this._getUploader(t).then(t=>{null==t||t.pause(e)})}function X(e,t){this._getUploader(t).then(t=>{null==t||t.resume(e)})}function Z(e,t){!(0,k.default)(t)&&(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(a=>{let o=a.preprocessTaskMap[e];o&&(o.parseState=t)}))}function ee(e,t){!(0,k.default)(t)&&(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(a=>{let o=a.preprocessTaskMap[e];o&&(o.reviewState=t)}))}async function et(e,t,a){let o=a&&!t;await (0,A.preloadCodeFileExtList)();let r=e.map(e=>{let t=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessTaskMap[e];if(!t)return"";if((null==t?void 0:t.type)!=="file")return(null==t?void 0:t.isRepo)||(o=!1),"";let a=(0,s.pickAsString)("name")(t.file);return(null==t?void 0:t.type)!=="file"||(0,A.assertCodeFileSyncInFree)(a)||(o=!1),t.key}).filter(e=>!!e),d=e.every(e=>{let t=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessTaskMap[e];if(!t||"file"!==t.type)return!1;let a=(0,s.pickAsString)("name")(t.file),o=(0,G.getFileExt)(a);return(0,G.isExcel)(o)||(0,G.isCsv)(o)}),u=e.map(e=>{let t=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessDirTaskMap[e];return(null==t?void 0:t.type)!=="directory"?"":t.key}).filter(e=>!!e),y=e.map(e=>{let t=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessTaskMap[e];return(null==t?void 0:t.isRepo)?t.key:""}).filter(e=>!!e);if(!d&&(t===b.SkillType.CodeAssistant||o)){let t=(0,p.createReportEvent)({eventName:"ChatInputUpload_GetCodeInfo_api",meta:{fileCount:u.length,taskKeys:u,localKeys:e}});try{let t,a;let o=u.length>0;if(u.length>0)t=L.CodeResourceType.DirectoryID,a=u;else if(y.length>0)t=L.CodeResourceType.RepoID,a=y;else{if(!(r.length>0))return;t=L.CodeResourceType.File,a=r}let{data:d}=await n.samanthaApiService.GetCodeContextState({type:t,resource_key:a}),s=null==d?void 0:d.states;if(!s)return;let p={[L.ContextStatus.Failed]:i.ParseState.ParseState_Failed,[L.ContextStatus.Succeed]:i.ParseState.ParseState_Success,[L.ContextStatus.Processing]:i.ParseState.ParseState_Processing,[L.ContextStatus.Ready]:i.ParseState.ParseState_Success};for(let t of e)(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{let a=o?e.preprocessDirTaskMap[t]:e.preprocessTaskMap[t],{status:l,percentage:r}=s.find(e=>e.resource_key===a.key)||{};if(!(0,I.default)(l)){var n,d,u,y;let e=p[l];a.parseState=e,e===i.ParseState.ParseState_Success&&c.logger.persist.success({eventName:"ChatInputUpload_GetCodeInfo_parseState_success",meta:{status:String(l),local_key:a.localKey,upload_id:null===(n=a.ctx)||void 0===n?void 0:n.uploadId,upload_type:a.type,upload_from:null===(d=a.ctx)||void 0===d?void 0:d.uploadFrom}}),e===i.ParseState.ParseState_Failed&&c.logger.persist.error({eventName:"ChatInputUpload_GetCodeInfo_parseState_failed",error:Error("[ChatInputUpload]: GetCodeInfo parseState failed"),meta:{status:String(l),local_key:a.localKey,upload_id:null===(u=a.ctx)||void 0===u?void 0:u.uploadId,upload_type:a.type,upload_from:null===(y=a.ctx)||void 0===y?void 0:y.uploadFrom}})}(0,I.default)(r)||(a.parsePercent=Number(r))}))}catch(e){t.error({reason:"api error",error:e})}}else{if(0===r.length)return;let t=(0,p.createReportEvent)({eventName:"ChatInputUpload_GetDocumentInfo_api",meta:{fileCount:r.length,taskKeys:r,localKeys:e}});try{let{data:a}=await n.samanthaApiService.GetDocumentInfo({uris:r}),o=null==a?void 0:a.infos;if(!o)return;for(let t of e)(0,l.getChatStore)("attachmentUploadStore").setState((0,C.produce)(e=>{var a,l,r,n,d;let s=e.preprocessTaskMap[t],{status:p,char_count:u}=(null===(a=o[s.key])||void 0===a?void 0:a.parse_info)||{};(0,I.default)(p)||(s.parseState=p,p===i.ParseState.ParseState_Success&&c.logger.persist.success({eventName:"ChatInputUpload_GetDocumentInfo_parseState_success",meta:{status:String(p),parsedCharCount:Number(u),local_key:s.localKey,upload_id:null===(l=s.ctx)||void 0===l?void 0:l.uploadId,upload_type:s.type,upload_from:null===(r=s.ctx)||void 0===r?void 0:r.uploadFrom}}),p===i.ParseState.ParseState_Failed&&c.logger.persist.error({eventName:"ChatInputUpload_GetDocumentInfo_parseState_failed",error:Error("[ChatInputUpload]: GetDocumentInfo parseState failed"),meta:{status:String(p),parsedCharCount:Number(u),local_key:s.localKey,upload_id:null===(n=s.ctx)||void 0===n?void 0:n.uploadId,upload_type:s.type,upload_from:null===(d=s.ctx)||void 0===d?void 0:d.uploadFrom}})),(0,I.default)(u)||(s.parsedCharCount=Number(u))}));let d=r.reduce((e,t)=>{var a;let{status:l}=(null===(a=o[t])||void 0===a?void 0:a.parse_info)||{},r=`parseState_${null!=l?l:"undefined"}`;return e[r]=[...e[r]||[],t],e},{});t.success({meta:{fileCount:r.length,taskKeys:r,localKeys:e,...d}})}catch(e){t.error({reason:"api error",error:e})}}}function ea(e){let t=(0,l.getChatStore)("attachmentUploadStore").getState().preprocessDirTaskMap[e];return{percent:t.percent,loading:t.loading,failed:t.failed}}async function eo(e,t){return this._getUploader(e,t)}function el(e,t,a){var o;return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var o=a.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:o+"")in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class er{constructor(){el(this,"initUploader",W),el(this,"_getUploader",z),el(this,"updatePreGeneratedLocalMessageId",x),el(this,"refreshUploadToken",V),el(this,"preprocessFile",Y),el(this,"reUpload",J),el(this,"cancel",q),el(this,"pause",Q),el(this,"resume",X),el(this,"updateAttachmentParseState",Z),el(this,"updateAttachmentReviewState",ee),el(this,"fetchAndUpdateParseState",et),el(this,"getUploader",eo),el(this,"preprocessGithubLink",$),el(this,"getDirUploadStatus",ea),el(this,"preprocessDir",j),el(this,"popPreGeneratedId",y),el(this,"tryPreHandleFile",S)}}}}]);
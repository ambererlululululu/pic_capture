"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["90943"],{523156:function(e,t,i){i.d(t,{DOCX_ARTIFACT_LATEST_MINOR_VERSION:function(){return r},DOCX_ARTIFACT_LATEST_VERSION:function(){return a},writeArtifactPreviewCanvasPluginIdentifier:function(){return s}});let a=-1,r=-1,s="write-artifact-preview"},18905:function(e,t,i){i.d(t,{convertArtifactVersionToArtifactItem:function(){return C},filterArtifactsBySameRegenerated:function(){return R},getActiveTargetByArtifactId:function(){return I},getActiveTargetByArtifactKey:function(){return b},getLatestArtifactVersion:function(){return L},getMessageArtifactDataByArtifactKey:function(){return y},isFirstArtifactWithMessage:function(){return T},isFirstMessageOfArtifact:function(){return k},isHumanCreatedArtifact:function(){return h},isHumanEditArtifact:function(){return K},isLastMessageOfArtifactId:function(){return B}});var a=i(754358),r=i(362684),s=i(81575),n=i(878809),l=i(283448),o=i(159738),u=i(579715),c=i(629006),f=i(503124),d=i(83990),g=i(637319),v=i(296493),_=i(871886),M=i(910663),A=i(523156);let y=e=>{let{conversationId:t,artifactKey:i}=e,a=(0,u.getMessageByArtifactKey)({conversationId:t,artifactKey:i});return(0,f.getArtifactDataByMessage)(a)},m=e=>{var t;let{conversationId:i,artifactId:r}=e,s=d.useMessageStore.getState(),n=s.messageLinkMap[i],l=null===(t=(0,a.default)(n,e=>{var t,a,n,l;let o=(0,g.getMessageSelector)(s,i,e);if((0,c.isDeepResearchBlockMessage)(o)){let{artifactId:e}=null!==(a=(0,f.getArtifactDataByBlockMessage)(o))&&void 0!==a?a:{};return r===e}if(!o||!(0,c.isMessageVisible)(o)||!(0,c.isWriteArtifactMessage)(o))return!1;if((0,c.isArtifactBlockMessage)(o)){let{artifactId:e}=null!==(n=(0,f.getArtifactDataByMessage)(o))&&void 0!==n?n:{};return r===e}let{artifact_id:u,offset:d}=null!==(l=null===(t=o.content_obj)||void 0===t?void 0:t.artifact_meta)&&void 0!==l?l:{};return r===u&&!!d}))||void 0===t?void 0:t.messageId;if(!l)return;let o=(0,_.getRegeneratedMessages)({conversationId:i,messageId:l});if(!(null==o?void 0:o.length))return l;let u=null==o?void 0:o.find(e=>(0,c.isMessageVisible)(e));return null==u?void 0:u.message_id},B=(e,t,i)=>!!i&&!!t&&m({conversationId:e,artifactId:i})===t,k=(e,t)=>{var i;let a=d.useMessageStore.getState(),r=(null!==(i=a.messageLinkMap[e])&&void 0!==i?i:[]).find(t=>{let i=(0,g.getMessageSelector)(a,e,t);return i&&(0,c.isMessageVisible)(i)&&(0,c.isWriteArtifactMessage)(i)});return(null==r?void 0:r.messageId)===t},S=e=>{var t,i;let r=(0,a.default)(e,e=>!!(0,c.isDeepResearchBlockMessage)(e)),s=(0,a.default)(e,e=>!!(0,f.getArtifactDataByMessage)(e));return r?null===(i=(0,f.getArtifactDataByBlockMessage)(s))||void 0===i?void 0:i.artifactKey:null===(t=(0,f.getArtifactDataByMessage)(s))||void 0===t?void 0:t.artifactKey},D=e=>{var t;let i=null==e?void 0:e.find(e=>!!(0,f.getArtifactDataByMessage)(e));return null===(t=(0,f.getArtifactDataByMessage)(i))||void 0===t?void 0:t.artifactKey},p=(e,t)=>!!(0,u.getMessageByArtifactKey)({conversationId:e,artifactKey:t}),b=e=>{let{conversationId:t,artifacts:i,artifactKey:a}=e,l=(0,u.getMessageByArtifactKey)({conversationId:t,artifactKey:a}),o=i.find(e=>e.artifact_key===a),d=null==o?void 0:o.artifact_id,g=(0,r.default)(i,e=>e.version,"desc").filter(e=>!d||e.artifact_id===d),M=e=>{let a=(0,s.default)(g,t=>t.artifact_key!==e),r=(0,v.findAndGet)(a,e=>{var a,r;return null!==(r=b({conversationId:t,artifacts:i,artifactKey:null!==(a=e.artifact_key)&&void 0!==a?a:""}))&&void 0!==r&&r});return r?r[1]:null};if(l){var A,y,m;let{message_id:e=""}=l,i=(0,_.getRegeneratedMessages)({conversationId:t,messageId:e}),r=null!==(y=S(i))&&void 0!==y?y:a,s=null===(A=(0,n.default)(g,e=>e.artifact_key!==r).find(e=>{var i;return!p(t,null!==(i=e.artifact_key)&&void 0!==i?i:"")}))||void 0===A?void 0:A.artifact_key,o=B(t,null==l?void 0:l.message_id,d),u=null==i?void 0:i.find(e=>(0,c.isMessageVisible)(e));if(!(null==i?void 0:i.length))return(0,c.isMessageVisible)(l)?{messageId:e,artifactKey:o&&s?s:a}:M(a);if(!u)return M(null!==(m=D(i))&&void 0!==m?m:a);let v=(0,f.getArtifactDataByMessage)(u)||(0,f.getArtifactDataByBlockMessage)(u);if(v){let{artifactKey:e=""}=v,{message_id:t=""}=u;return{messageId:t,artifactKey:o&&s?s:e}}return null}if(!o)return null;let k=M(a);if(k){let{messageId:e}=k;return{artifactKey:a,messageId:e}}return null},I=e=>{let{conversationId:t,artifacts:i,artifactId:a,messageId:r}=e,s=d.useMessageStore.getState();for(let e of(0,l.default)(i.slice())){var n,o,u,c,f,v;if(e.artifact_id!==a)continue;let i=(0,g.getReplyMessageSelector)(s,t,null!==(n=e.question_message_id)&&void 0!==n?n:"");if(!i)continue;if(!r)return{artifactKey:null!==(o=e.artifact_key)&&void 0!==o?o:"",messageId:null!==(u=i.message_id)&&void 0!==u?u:""};let l=(0,_.getRegeneratedMessages)({conversationId:t,messageId:null!==(c=i.message_id)&&void 0!==c?c:""}),d=((null==l?void 0:l.length)?l:[i]).find(e=>e.message_id===r);if(d)return{artifactKey:null!==(f=e.artifact_key)&&void 0!==f?f:"",messageId:null!==(v=d.message_id)&&void 0!==v?v:""}}return null},R=e=>{let{conversationId:t,artifacts:i,onlyLegacyDoc:a=!1}=e;return i.filter(e=>{let{resource_type:i,artifact_key:r}=e;if(!(0,o.default)([M.ArtifactResourceType.Pages,M.ArtifactResourceType.WriteDoc],i))return!a;let s=(0,u.getMessageByArtifactKey)({conversationId:t,artifactKey:null!=r?r:""});if(!s)return!0;let{message_id:n=""}=s,l=(0,_.getRegeneratedMessages)({conversationId:t,messageId:n});if(!(null==l?void 0:l.length))return(0,c.isMessageVisible)(s);let d=null==l?void 0:l.find(e=>(0,c.isMessageVisible)(e)),g=(0,f.getArtifactDataByMessage)(d);return!!d&&!!g&&g.artifactKey===r})},h=e=>{var t;let i=(0,f.getArtifactDataByMessage)(e);return!!i&&(null===(t=i.artifactId)||void 0===t?void 0:t.startsWith("human-created"))},K=e=>{let t=(0,f.getArtifactDataByMessage)(e);return null!=t&&!!t.artifactId&&(t.artifactId.startsWith("human-edit")||t.artifactId.startsWith("human-created"))},T=e=>{var t;let{conversationId:i,artifactKey:a}=e;if(!a)return!1;let r=d.useMessageStore.getState(),{messageLinkMap:s}=r;return D((null!==(t=s[i])&&void 0!==t?t:[]).map(e=>(0,g.getMessageSelector)(r,i,e)).filter(e=>!!e))===a},C=e=>{let{id:t,source_id:i,topic:a,title:r,version:s,status:n,resource_type:l,resource_id:o,resource_version:u,create_time:c}=e;return{conversation_id:i,artifact_id:a,title:r,version:s,status:n,resource_type:l,resource_id:o,resource_version:(0,v.toValidNumber)(u),create_time:c,artifact_key:t,id:t}},L=e=>{var t;let{version_list:i=[]}=null!=e?e:{};return null!==(t=i.find(e=>e.resource_version===A.DOCX_ARTIFACT_LATEST_VERSION))&&void 0!==t?t:{}}},871886:function(e,t,i){i.d(t,{getMessageReferences:function(){return v},getRegeneratedMessages:function(){return g}});var a=i(229079),r=i(204418),s=i(907929),n=i(4137),l=i(82760),o=i(674157),u=i(629006),c=i(83990),f=i(637319),d=i(752544);let g=e=>{var t,i;let{conversationId:a,messageId:r}=e,s=c.useMessageStore.getState(),{reply_id:n}=null!==(t=(0,f.getMessageByIdSelector)(s,a,r))&&void 0!==t?t:{};if(!n)return;let l=(0,d.createGetMessage)({messageMap:s.messageMap[a],localMessageMap:s.localMessageMap[a]});return(null!==(i=s.messageLinkMap[a])&&void 0!==i?i:[]).filter(e=>{var t;return(null===(t=l(e))||void 0===t?void 0:t.reply_id)===n&&(0,o.isRegenerateMessage)(l(e))}).map(e=>(0,f.getMessageSelector)(s,a,e)).filter(e=>!!e)},v=e=>{var t,i,o,c;let f,{message:d}=e;if(!d)return;(0,u.isBlockMessage)(d)&&(f=null==d?void 0:null===(o=d.content_blocks)||void 0===o?void 0:null===(i=o.find(e=>e.block_type===l.ContentType.BLOCK_SEARCH_QUERY_RESULT))||void 0===i?void 0:null===(t=i.content_obj)||void 0===t?void 0:t.results);let g=(0,a.default)(d,"content_obj.search_card.search_references"),v=(0,a.default)(d,"content_obj.search_references"),_=null!==(c=null!=f?f:g)&&void 0!==c?c:v;if(_){let e=(0,r.default)(_,e=>e.text_card);return(0,s.default)(e,e=>!(0,n.default)(e))}}},579715:function(e,t,i){i.d(t,{getMessageByArtifactKey:function(){return u},getMessageByDocId:function(){return c},subscribeMessageWithArtifact:function(){return d}});var a=i(214071),r=i(159738),s=i(629006),n=i(83990),l=i(637319),o=i(808666);let u=e=>{var t;let{conversationId:i,artifactKey:a}=e,r=n.useMessageStore.getState(),{messageLinkMap:u}=r;return(null!==(t=u[i])&&void 0!==t?t:[]).map(e=>(0,l.getMessageSelector)(r,i,e)).find(e=>{var t,i,r,n;return(0,s.isWriteArtifactMessage)(e)&&(null===(i=e.content_obj)||void 0===i?void 0:null===(t=i.artifact_meta)||void 0===t?void 0:t.artifact_key)===a||(0,s.isDeepResearchBlockMessage)(e)&&(null===(r=(0,o.getResearchBlockContentArtifact)(e))||void 0===r?void 0:r.find(e=>{var t,i;return(null===(i=e.content_obj)||void 0===i?void 0:null===(t=i.artifact)||void 0===t?void 0:t.artifact_key)===a}))||(0,s.isArtifactBlockMessage)(e)&&(null===(n=(0,o.getArtifactBlockContent)(e))||void 0===n?void 0:n.artifact_version_id)===a})},c=e=>{var t;let{conversationId:i,docId:a}=e,r=n.useMessageStore.getState(),{messageLinkMap:u}=r;return(null!==(t=u[i])&&void 0!==t?t:[]).map(e=>(0,l.getMessageSelector)(r,i,e)).find(e=>{var t,i,r,n,l,u;return(0,s.isWriteArtifactMessage)(e)&&(null===(i=e.content_obj)||void 0===i?void 0:null===(t=i.artifact_meta)||void 0===t?void 0:t.resource_id)===a||(0,s.isDeepResearchBlockMessage)(e)&&(null===(r=(0,o.getResearchBlockContentArtifact)(e))||void 0===r?void 0:r.find(e=>{var t,i;return(null===(i=e.content_obj)||void 0===i?void 0:null===(t=i.artifact)||void 0===t?void 0:t.resource_id)===a}))||(0,s.isArtifactBlockMessage)(e)&&(null===(n=(0,o.getArtifactBlockContent)(e))||void 0===n?void 0:n.resource_id)===a||(0,s.isProfessionalWritingDocCardMessage)(e)&&(null===(l=e.content_obj)||void 0===l?void 0:l.pages_id)===a||(0,s.isProfessionalWritingDocXCardMessage)(e)&&(null===(u=e.content_obj)||void 0===u?void 0:u.pages_id)===a})},f=e=>{let{conversationId:t,matcher:i,timeout:r=15e3}=e;return new Promise((e,s)=>{let o=null,u=setTimeout(()=>{null==o||o(),s(Error(`Subscribe matching message with artifact timeout: ${r}`))},r);o=n.useMessageStore.subscribe(e=>{var i;let{messageLinkMap:a}=e;return(null!==(i=a[t])&&void 0!==i?i:[]).map(i=>(0,l.getMessageSelector)(e,t,i))},t=>{if((0,a.default)(t))return;let r=t.find(e=>i(e));null==o||o(),u&&clearTimeout(u),e(r)},{fireImmediately:!0})})},d=e=>{let{artifacts:t,...i}=e,a=t.map(e=>e.artifact_key);return f({...i,matcher:e=>{var t,i,n,l;if(!(0,s.isMessageVisible)(e))return!1;if((0,s.isWriteArtifactMessage)(e))return a.includes(null===(i=e.content_obj)||void 0===i?void 0:null===(t=i.artifact_meta)||void 0===t?void 0:t.artifact_key);if((0,s.isDeepResearchBlockMessage)(e)){for(let t of(0,o.getResearchBlockContentArtifact)(e))if((0,r.default)(a,null==t?void 0:null===(l=t.content_obj)||void 0===l?void 0:null===(n=l.artifact)||void 0===n?void 0:n.artifact_key))return!0}return!1}})}}}]);
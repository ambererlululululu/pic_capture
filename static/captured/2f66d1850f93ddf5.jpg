"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["41309"],{959354:function(t,e,r){r.d(e,{MessageTracer:function(){return T}});var i=r(777422);function n(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}let s=Number.MAX_SAFE_INTEGER;class a{isValid(){return"0"!==this.high||"0"!==this.low}constructor(t,e){n(this,"high",void 0),n(this,"low",void 0),this.high=`${t}`,this.low=`${e}`}}let o=(t,e)=>{let r=`${e}`,i=t-r.length;if(i<=0)return r;for(;i;)r=`0${r}`,i--;return r};function d(t){return Number(t).toString(16)}function h(t){return parseInt(t,16)}let u=()=>Math.floor(Math.random()*s+1);class l{genId(){let t=this.addAndGet();return t>=this.maxId?(this.seed=this.randomNumber(),this.genId()):t}addAndGet(){return this.seed+=this.delta,this.seed}constructor(t){n(this,"seed",void 0),n(this,"delta",void 0),n(this,"maxId",void 0),n(this,"randomNumber",void 0),this.randomNumber=t.randomNumber,this.seed=t.randomNumber(),this.maxId=t.maxId,this.delta=t.delta}}let c={toStringW3C(t){let e=o(2,t.version),r=this.traceIdToString(t.traceId),{spanId:i}=t,n=o(2,t.flags);return`${e}-${r}-${i}-${n}`},inject(t){let e={"x-flow-trace":this.toStringW3C(t)};return t.baggage.size>0&&(e["x-flow-baggage"]=this.encodeBaggage(t.baggage)),e},spanIdToString:t=>o(16,d(t)),traceIdToString(t){let e=d(t.high),r=d(t.low);return o(16,e)+o(16,r)},parseCommaSeparatedMap(t,e){try{t=decodeURIComponent(t)}catch(t){return e}let r=t.split(",");for(let t=0;t<r.length;t++){let i=r[t].split("=");2===i.length&&void 0===e.get(i[0])&&e.set(i[0],i[1])}return e},encodeBaggage(t){let e="";for(let[r,i]of t){if(r.includes("=")||r.includes(",")||i.includes("=")||i.includes(","))return"";let t=encodeURIComponent(i||"");e+=e?`,${r}=${t}`:`${r}=${t}`}return e}},g=t=>{let e=t.getContext(),r=t.tags.reduce((t,e)=>({...t,[e[0]]:e[1]}),{});return{trace_log_id:t.logId,trace_id:c.traceIdToString(e.traceId),trace_span_duration:t.duration,trace_parent_id:e.parentId,trace_span_id:t.spanId,trace_span_name:t.name,trace_span_scene:t.scene,trace_span_start_timestamp:t.startTime,trace_status:0,...r}},p=t=>{let e=g(t);(0,i.trackEvent)("flow_telemetry_web",e)},v=()=>1e3*Date.now();function m(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class f{getBaggageItem(t){return"string"!=typeof t||""===t?"":this.baggage.get(t)||""}isValid(){var t;return void 0!==this.debugInfo||(null===(t=this.traceId)||void 0===t?void 0:t.isValid())}constructor(){m(this,"version",4),m(this,"spanId",void 0),m(this,"parentId",void 0),m(this,"flags",void 0),m(this,"debugInfo",void 0),m(this,"traceId",void 0),m(this,"baggage",void 0),this.spanId="0",this.parentId="0",this.flags=1,this.debugInfo="",this.traceId=new a(0,0),this.baggage=new Map}}function b(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class I{setTag(t,e){!this._ended&&this.tags.push([t,e])}setParentSpanId(t){this.parentSpanId=t}setTraceId(t){let e=t.slice(0,16),r=t.slice(16);this.traceId=new a(h(e),h(r))}setTags(t){if(!this._ended)for(let e of Object.entries(t))this.tags.push(e)}setBaggageItem(t,e){return this.baggage.set(t,e),this}elapse(){return(v()-this.startTime)/1e3}get duration(){return this._duration}get ended(){return this._ended}get scene(){return this._scene}set scene(t){this._scene=t}init(t){this.baggage=t}start(){this.startTime=v()}finish(){this._ended=!0,this.endTime=v(),this._duration=this.endTime-this.startTime}isRecording(){return!this._ended}toCarrier(){return this.trace.toCarrier(this.getContext())}abort(){this._ended=!0,this.startTime=0}getContext(){let t=new f;return t.traceId=this.traceId,t.spanId=this.spanId,t.parentId=this.parentSpanId,t.baggage=this.baggage,t}constructor(t,e,r,i){b(this,"startTime",0),b(this,"endTime",0),b(this,"_duration",0),b(this,"_ended",!1),b(this,"name",void 0),b(this,"isRootSpan",!0),b(this,"_scene",""),b(this,"parentSpanId",void 0),b(this,"spanId",void 0),b(this,"logId",void 0),b(this,"traceId",void 0),b(this,"trace",void 0),b(this,"tags",void 0),b(this,"baggage",void 0),b(this,"now",v),this.name=t,this.trace=e,this.traceId=r,this.parentSpanId=i||"0",this.baggage=new Map,this.spanId="",this.tags=[]}}function _(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class S{static create(t){return new S(t)}getSpan(t){return this.spans.get(t)}startSpan(t){let e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.context){let{spanId:i,baggage:n,traceId:s}=r.context;(e=new I(t,this,s,i)).baggage=n}else(e=new I(t,this,this.genTraceId())).spanId=this.genSpanId();return e.start(),e}enableSampling(){return!1}genTraceId(){return new a(u(),u())}genSpanId(){return c.spanIdToString(this.spanIdGenerator.genId())}toCarrier(t){return c.inject(t)}constructor(t){_(this,"name",void 0),_(this,"spans",void 0),_(this,"spanIdGenerator",void 0),this.name=t,this.spans=new Map,this.spanIdGenerator=new l({randomNumber:u,maxId:Number.MAX_SAFE_INTEGER,delta:1})}}var w=r(78346);function y(t,e,r){var i;return(e="symbol"==typeof(i=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?i:i+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class T{static getInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";return T.traceInstances[t]||(T.traceInstances[t]=new T),T.traceInstances[t]}static moveInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default",r=T.traceInstances[t];T.traceInstances[e]=r,delete T.traceInstances[t]}startSpan(t){var e;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(null===(e=this.rootSpan)||void 0===e?void 0:e.isRecording())&&this.rootSpan.finish(),this.rootSpan=this.tracer.startSpan(t,r),this.rootSpan.scene="samantha_send_message",this.rootSpan}isValid(){var t;return!!(null===(t=this.rootSpan)||void 0===t?void 0:t.logId)}addWaiter(t){this.waiters.set(t,new Promise(e=>this.resolvers.set(t,e)))}resolveWaiter(t){var e;null===(e=this.resolvers.get(t))||void 0===e||e()}async wait(){return Promise.race([Promise.all(this.waiters.values()),(0,w.sleep)(5e3)])}resetWaiter(){this.waiters=new Map,this.resolvers=new Map}report(){this.rootSpan&&this.isValid()&&p(this.rootSpan),this.rootSpan=void 0}async reportAfterWaiters(){return this.waiters.size&&(await this.wait(),this.resetWaiter()),this.report()}async finishAndReport(){var t;(null===(t=this.rootSpan)||void 0===t?void 0:t.isRecording)&&(this.rootSpan.finish(),await this.reportAfterWaiters())}constructor(){y(this,"rootSpan",void 0),y(this,"tracer",void 0),y(this,"waiters",new Map),y(this,"resolvers",new Map),this.tracer=new S("message-tracer")}}y(T,"traceInstances",{})}}]);
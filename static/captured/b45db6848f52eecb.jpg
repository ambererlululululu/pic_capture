"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["11202"],{771982:function(e,t,n){n.d(t,{T:function(){return a}});let a="semi"},926778:function(e,t,n){var a=n(814986),i=n(885037);class r{static get cssClasses(){return{}}static get strings(){return{}}static get numbers(){return{}}static get defaultAdapter(){return{getProp:a.Z,getProps:a.Z,getState:a.Z,getStates:a.Z,setState:a.Z,getContext:a.Z,getContexts:a.Z,getCache:a.Z,setCache:a.Z,getCaches:a.Z,stopPropagation:a.Z,persistEvent:a.Z}}constructor(e){this._adapter=Object.assign(Object.assign({},r.defaultAdapter),e)}getProp(e){return this._adapter.getProp(e)}getProps(){return this._adapter.getProps()}getState(e){return this._adapter.getState(e)}getStates(){return this._adapter.getStates()}setState(e,t){return this._adapter.setState(Object.assign({},e),t)}getContext(e){return this._adapter.getContext(e)}getContexts(){return this._adapter.getContexts()}getCaches(){return this._adapter.getCaches()}getCache(e){return this._adapter.getCache(e)}setCache(e,t){return e&&this._adapter.setCache(e,t)}stopPropagation(e){this._adapter.stopPropagation(e)}_isControlledComponent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"value";return e in this.getProps()}_isInProps(e){return e in this.getProps()}init(e){}destroy(){}log(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];(0,i.Z)(e,...n)}_persistEvent(e){this._adapter.persistEvent(e)}}t.Z=r},739185:function(e,t,n){n.d(t,{Z:function(){return a}});function a(e){return Object.keys(e).reduce((t,n)=>("data-"===n.substr(0,5)&&(t[n]=e[n]),t),{})}},705709:function(e,t,n){n.d(t,{Z:function(){return a}});function a(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}}},112230:function(e,t,n){n.d(t,{Z:function(){return a}});function a(e){return null==e}},885037:function(e,t,n){var a=n(118200),i=n(378999);t.Z=function(e){if("development"===(0,a.Z)(i,"env.NODE_ENV"))for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]}},881719:function(e,t,n){function a(e){return`${e}-${new Date().getTime()}-${Math.random()}`}function i(){var e,t;try{return null!==(t=null===(e=null==crypto?void 0:crypto.randomUUID)||void 0===e?void 0:e.call(crypto))&&void 0!==t?t:String(-99990013e3).replace(/[018]/g,e=>(Number(e)^crypto.getRandomValues(new Uint8Array(1))[0]&15>>Number(e)/4).toString(16))}catch(e){return a("semi")}}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{prefix:t="",length:n=7}=e,a="0123456789abcdefghijklmnopqrstuvwxyz",i=a.length,r="";for(let e=0;e<n;e++){let e=Math.floor(Math.random()*i);r+=a.charAt(e)}return t?`${t}-${r}`:r}n.d(t,{Cd:function(){return i},Ms:function(){return r},ZP:function(){return a}})},991558:function(e,t,n){n.d(t,{Z:function(){return a}});function a(e,t){}},70059:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(429996),i=n(885037),r=n(739185);let{hasOwnProperty:o}=Object.prototype;class s extends a.Component{constructor(e){super(e),this.isControlled=e=>!!(e&&this.props&&"object"==typeof this.props&&o.call(this.props,e)),this.cache={},this.foundation=null}componentDidMount(){this.foundation&&"function"==typeof this.foundation.init&&this.foundation.init()}componentWillUnmount(){this.foundation&&"function"==typeof this.foundation.destroy&&this.foundation.destroy(),this.cache={}}get adapter(){return{getContext:e=>{if(this.context&&e)return this.context[e]},getContexts:()=>this.context,getProp:e=>this.props[e],getProps:()=>this.props,getState:e=>this.state[e],getStates:()=>this.state,setState:(e,t)=>this.setState(Object.assign({},e),t),getCache:e=>e&&this.cache[e],getCaches:()=>this.cache,setCache:(e,t)=>e&&(this.cache[e]=t),stopPropagation:e=>{try{e.stopPropagation(),e.nativeEvent&&e.nativeEvent.stopImmediatePropagation()}catch(e){}},persistEvent:e=>{e&&e.persist&&"function"==typeof e.persist&&e.persist()}}}log(e){for(var t=arguments.length,n=Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return(0,i.Z)(e,...n)}getDataAttr(e){return(0,r.Z)(e)}}s.propTypes={},s.defaultProps={}},345185:function(e,t,n){var a=n(474227),i=n(429996);class r extends i.Component{constructor(e){super(e),this.handleAnimationStart=()=>{var e,t;null===(t=(e=this.props).onAnimationStart)||void 0===t||t.call(e)},this.handleAnimationEnd=()=>{this.setState({currentClassName:this.props.endClassName,extraStyle:{animationFillMode:this.props.fillMode},isAnimating:!1},()=>{var e,t;null===(t=(e=this.props).onAnimationEnd)||void 0===t||t.call(e,!1)})},this.state={currentClassName:this.props.startClassName,extraStyle:{animationFillMode:this.props.fillMode},isAnimating:!0}}componentDidMount(){var e,t,n,a;null===(t=(e=this.props).onAnimationStart)||void 0===t||t.call(e),this.props.motion||(null===(a=(n=this.props).onAnimationEnd)||void 0===a||a.call(n,!1),this.setState({isAnimating:!1}))}componentDidUpdate(e,t,n){let i=Object.keys(this.props).filter(t=>!(0,a.Z)(this.props[t],e[t]));i.includes("animationState"),(i.includes("startClassName")||i.includes("replayKey")||i.includes("motion"))&&this.setState({currentClassName:this.props.startClassName,extraStyle:{animationFillMode:this.props.fillMode},isAnimating:!0},()=>{var e,t,n,a;null===(t=(e=this.props).onAnimationStart)||void 0===t||t.call(e),this.props.motion||(null===(a=(n=this.props).onAnimationEnd)||void 0===a||a.call(n,this.state.isAnimating),this.setState({isAnimating:!1}))})}render(){var e;return this.props.motion?this.props.children({animationClassName:null!==(e=this.state.currentClassName)&&void 0!==e?e:"",animationStyle:this.state.extraStyle,animationEventsNeedBind:{onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},isAnimating:this.state.isAnimating}):this.props.children({animationClassName:"",animationStyle:{},animationEventsNeedBind:{},isAnimating:this.state.isAnimating})}}r.defaultProps={motion:!0,replayKey:""},t.Z=r},156287:function(e,t,n){n.d(t,{GO:function(){return k},Tq:function(){return function e(t,n){return m(this,void 0,void 0,function*(){if(0===n){yield t();return}yield new Promise(a=>{setTimeout(()=>m(this,void 0,void 0,function*(){yield e(t,n-1),a()}),0)})})}},Xh:function(){return S},UW:function(){return _},GW:function(){return P},J2:function(){return y},np:function(){return w},ql:function(){return A},vY:function(){return I},ID:function(){return C}});var a=n(118200),i=n(817835),r=n(734010),o=n(429996),s=n(991558),l=n(477041);let u=e=>e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),c=e=>{let{autoEscape:t,caseSensitive:n,searchWords:a,sourceString:i}=e;return a.filter(e=>e).reduce((e,a)=>{let r;t&&(a=u(a));let o=new RegExp(a,n?"g":"gi");for(;r=o.exec(i);){let t=r.index,n=o.lastIndex;n>t&&e.push({highlight:!1,start:t,end:n}),r.index===o.lastIndex&&o.lastIndex++}return e},[])},d=e=>{let{chunks:t}=e;return t.sort((e,t)=>e.start-t.start).reduce((e,t)=>{if(0===e.length)return[t];{let n=e.pop();if(t.start<=n.end){let a=Math.max(n.end,t.end);e.push({highlight:!1,start:n.start,end:a})}else e.push(n,t);return e}},[])},p=e=>{let{chunksToHighlight:t,totalLength:n}=e,a=[],i=(e,t,n)=>{t-e>0&&a.push({start:e,end:t,highlight:n})};if(0===t.length)i(0,n,!1);else{let e=0;t.forEach(t=>{i(e,t.start,!1),i(t.start,t.end,!0),e=t.end}),i(e,n,!1)}return a},f=e=>{let{autoEscape:t=!0,caseSensitive:n=!1,searchWords:a,sourceString:i}=e;return(0,l.Z)(a)&&(a=[a]),p({chunksToHighlight:d({chunks:c({autoEscape:t,caseSensitive:n,searchWords:a,sourceString:i})}),totalLength:i?i.length:0})};var v=n(705709),g=new class{constructor(){this.config={}}},h=n(378999),m=function(e,t,n,a){return new(n||(n=Promise))(function(i,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}l((a=a.apply(e,t||[])).next())})};function _(e,t){e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!t&&e.nativeEvent&&"function"==typeof e.nativeEvent.stopImmediatePropagation&&e.nativeEvent.stopImmediatePropagation()}function S(e,t){return(0,r.Z)(e,e=>{if("function"==typeof t)return t(e);if("function"==typeof e||o.isValidElement(e)||"[object Error]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e)&&0===e.length){let t=Object.keys(e);if(t.length){let n=[];t.forEach(t=>{(0,i.Z)(n,t,e[t])});try{(0,s.Z)("production"!==(0,a.Z)(h,"env.NODE_ENV"),`[Semi] You may use an out-of-bounds array. In some cases, your program may not behave as expected.
                    The maximum length of an array is 4294967295.
                    Please check whether the array subscript in your data exceeds the maximum value of the JS array subscript`)}catch(e){}return n}}})}let y=e=>{let{sourceString:t="",searchWords:n=[],option:a={autoEscape:!0,caseSensitive:!1}}=e,i=f(Object.assign({sourceString:t,searchWords:n},a)),r=a.highlightTag||"mark",s=a.highlightClassName||"",l=a.highlightStyle||{};return i.map((e,n)=>{let{end:a,start:i,highlight:u}=e,c=t.substr(i,a-i);return u?o.createElement(r,{style:l,className:s,key:c+n},c):c})},A=(e,t)=>{let{match:n,unmatch:a,callInInit:i=!0}=t;if("undefined"!=typeof window){let t=window.matchMedia(e);function r(e){e.matches?n&&n(e):a&&a(e)}return(i&&r(t),Object.prototype.hasOwnProperty.call(t,"addEventListener"))?(t.addEventListener("change",r),()=>t.removeEventListener("change",r)):(t.addListener(r),()=>t.removeListener(r))}return()=>void 0},C=e=>o.isValidElement(e)&&"Icon"===(0,a.Z)(e.type,"elementType");function I(){return document?document.activeElement:null}function k(e){return(0,v.Z)(e)?Array.from(e.querySelectorAll("input:not([disabled]):not([tabindex='-1']),textarea:not([disabled]):not([tabindex='-1']),button:not([disabled]):not([tabindex='-1']),a[href]:not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']),area[href]:not([tabindex='-1']),iframe:not([tabindex='-1']),object:not([tabindex='-1']),*[tabindex]:not([tabindex='-1']),*[contenteditable]:not([tabindex='-1'])")):[]}function w(){return globalThis&&"[object Window]"===Object.prototype.toString.call(globalThis)?window.innerWidth-document.documentElement.clientWidth:0}function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=()=>{var t,n;return(null===(n=null===(t=null==g?void 0:g.config)||void 0===t?void 0:t.overrideDefaultProps)||void 0===n?void 0:n[e])||{}};return new Proxy(Object.assign({},t),{get(e,t,a){let i=n();return t in i?i[t]:Reflect.get(e,t,a)},set:(e,t,n,a)=>Reflect.set(e,t,n,a),ownKeys(){let e=n();return Array.from(new Set([...Reflect.ownKeys(t),...Object.keys(e)]))},getOwnPropertyDescriptor(e,t){let a=n();return t in a?Reflect.getOwnPropertyDescriptor(a,t):Reflect.getOwnPropertyDescriptor(e,t)}})}},925962:function(e,t,n){let a=n(429996).createContext({});t.Z=a},543281:function(e,t,n){var a,i,r;n.d(t,{MZ:function(){return s},i1:function(){return o},m9:function(){return l}});let o=((a={})[a.Coco=1]="Coco",a[a.Bot=2]="Bot",a[a.CocoSub=3]="CocoSub",a[a.CocoWeb=4]="CocoWeb",a[a.CocoWebSub=5]="CocoWebSub",a),s=((i={})[i.ParseState_Default=0]="ParseState_Default",i[i.ParseState_Success=1]="ParseState_Success",i[i.ParseState_Failed=2]="ParseState_Failed",i[i.ParseState_Processing=3]="ParseState_Processing",i),l=((r={})[r.ReviewState_Default=0]="ReviewState_Default",r[r.ReviewState_Access=1]="ReviewState_Access",r[r.ReviewState_NotCompliant=2]="ReviewState_NotCompliant",r[r.ReviewState_Processing=3]="ReviewState_Processing",r)},46499:function(e,t,n){n.d(t,{P:function(){return i}});let a=/\.pdf$/i,i=e=>{if(!(e=e.trim()).startsWith("https://arxiv.org/"))return e;let t=e;return t.startsWith("https://arxiv.org/abs")&&(t=t.replace("https://arxiv.org/abs","https://arxiv.org/pdf")),a.test(t)&&(t=t.replace(a,"")),t}},200235:function(e,t,n){n.d(t,{AP:function(){return A},Dc:function(){return p},E5:function(){return m},GJ:function(){return S},LA:function(){return h},Rs:function(){return f},hx:function(){return C},r9:function(){return v},rp:function(){return g},vQ:function(){return _}});var a=n(354187),i=n(474227),r=n(107481),o=n(93708),s=n(15348),l=n(947020),u=n(811208),c=n(851510);let d=(e,t)=>{var n,a,i;let{chatId:r,skillType:o="default"}=t;return null!==(i=null===(a=e.attachmentsMap)||void 0===a?void 0:null===(n=a[r])||void 0===n?void 0:n[`_${o}`])&&void 0!==i?i:[]},p=e=>d((0,o.GX)("attachmentsStore"),e),f=e=>(0,o.sQ)("attachmentsStore",t=>d(t,e)),v=(e,t)=>e.map(e=>{var n,a,i,o,s,d;let p=(0,c.u$)(e)&&(0,l.zq)(e.url)&&e.localKey;if((0,c.u$)(e)&&!p)return{type:"link",fileName:e.url,fileKey:"",url:e.url,uploadPercent:100,status:r.O.Normal};if((0,c.Q1)(e))return{type:"remote",fileName:e.fileName,fileKey:e.key,size:e.size,uploadPercent:100,status:r.O.Normal};let f=t.preprocessTaskMap[e.localKey]||t.preprocessDirTaskMap[e.localKey];if(!f)return{type:"file",fileName:(0,u.G)("name")(e.file),fileKey:"",uploadPercent:0,status:r.O.Retry};let v=f.key||"",g=[{key:v,image_thumb:{url:null!==(s=null==f?void 0:f.blobUrl)&&void 0!==s?s:"",width:0,height:0,format:""},image_ori:{url:null!==(d=null==f?void 0:f.blobUrl)&&void 0!==d?d:"",width:0,height:0,format:""},feedback:"",request_id:"",description:""}],h=(null===(n=e.file)||void 0===n?void 0:n.size)||(null==e?void 0:e.size),{fileName:m}=e||{},{type:_}=e;return{type:_,fileName:"string"==typeof m?m:"directory"===_?e.dirName:p?(0,u.G)("name")(f.repoInfo||{}):(0,u.G)("name")(e.file),fileKey:v,isRepo:f.isRepo,repoInfo:f.repoInfo,size:h,imageList:g,uploadPercent:f.percent,status:f.failed?r.O.Retry:f.loading?r.O.Uploading:r.O.Normal,parseState:f.parseState,parsePercent:f.parsePercent,reviewState:f.reviewState,uploadWay:null===(a=f.ctx)||void 0===a?void 0:a.uploadWay,localKey:f.localKey,md5:f.md5,imageWidth:null===(i=f.uploadResult)||void 0===i?void 0:i.ImageWidth,imageHeight:null===(o=f.uploadResult)||void 0===o?void 0:o.ImageHeight,parsedCharCount:f.parsedCharCount}}),g=e=>v(p(e),(0,o.GX)("attachmentUploadStore")),h=e=>{let t=f(e);return(0,o.sQ)("attachmentUploadStore",e=>v(t,e),i.Z)},m=()=>(0,o.sQ)("attachmentUploadStore",e=>e.attachmentUploadConfig,a.X),_=e=>{let t=f(e);return(0,o.sQ)("attachmentUploadStore",e=>t.map(t=>{if((0,c.u$)(t))return;if((0,c.Q1)(t))return t.key;let n=e.preprocessTaskMap[t.localKey];return(null==n?void 0:n.key)||void 0}),a.X)},S=e=>{let{chatId:t,skillType:n="default"}=e;return(0,o.sQ)("attachmentUploadStore",e=>{var a;return null===(a=e.preGeneratedLocalMessageIdMap[t])||void 0===a?void 0:a[`_${n}`]},a.X)},y=e=>{var t;let{chatId:n,skillType:a="default"}=e;return null===(t=(0,o.GX)("attachmentUploadStore").preGeneratedLocalMessageIdMap[n])||void 0===t?void 0:t[`_${a}`]},A=async e=>{if(!y(e)){let t=await (0,s.D)("attachmentUploadStoreService");null==t||t.updatePreGeneratedLocalMessageId(e)}return y(e)},C=e=>{let t=t=>async n=>{var a;let i=await (0,s.D)("attachmentsStoreService");return null==i?void 0:null===(a=i[t])||void 0===a?void 0:a.call(i,{...e,...n})};return{clearAttachments:t("clearAttachments"),addAttachment:t("addAttachment"),addDirAttachment:t("addDirAttachment"),addLink:t("addLink"),addGitHubLink:t("addGitHubLink"),addRemoteAttachment:t("addRemoteAttachment"),clearAllAttachments:t("clearAllAttachments"),clearChatAttachments:t("clearChatAttachments"),deleteAttachment:t("deleteAttachment"),replaceLink:t("replaceLink"),reuploadAttachment:t("reuploadAttachment"),getPreGeneratedLocalMessageId:()=>A(e),updatePreGeneratedLocalMessageId:async()=>{let t=await (0,s.D)("attachmentUploadStoreService");null==t||t.updatePreGeneratedLocalMessageId(e)},addAttachmentDirectly:t("addAttachmentDirectly")}}},200694:function(e,t,n){n.d(t,{M:function(){return r},X:function(){return i}});var a=n(210230);let i=(e,t)=>{let n=e.chunk_seq,i=null==t?void 0:t.chunk_seq;return!!(!(0,a.Z)(n)&&!(0,a.Z)(i)&&Number(n)<=Number(i))},r=(e,t)=>{let n=e.chunk_seq,i=null==t?void 0:t.chunk_seq;return!!(!(0,a.Z)(n)&&!(0,a.Z)(i)&&Number(n)<Number(i))}},257149:function(e,t,n){n.d(t,{Kr:function(){return r},Pf:function(){return i},X1:function(){return o}});var a=n(708481);let i=async e=>{let t=await (0,a.cf)("AliceChatStream");null==t||t.pullMessage([e])},r=async e=>{let t=await (0,a.cf)("AliceChatFallback");null==t||t.cancelTask(e)},o=async e=>{let{replyId:t,localMessageId:n}=e;if(t){let e=await (0,a.cf)("AliceChatStream"),n=await (0,a.cf)("AliceChatFallback");null==e||e.cancelTask(t),null==n||n.cancelTask(t)}if(n){let e=await (0,a.cf)("SamanthaChat");null==e||e.cancelTask(n)}}},626101:function(e,t,n){n.d(t,{s:function(){return P}});var a=n(177056),i=n(210230),r=n(81192),o=n(669384),s=n(81307),l=n(148824),u=n(228535),c=n(200694),d=n(589944),p=n(708481),f=n(126628),v=n(792288),g=n(468494),h=n(666396),m=n(644367),_=n(831929),S=n(623666),y=n(744947),A=n(777433),C=n(530836),I=n(789691),k=n(298113),w=n(969537);let P=e=>{var t,n;let P=C.useMessageStore.getState(),{conversation_id:b,message_id:M,reply_id:R="",stream_id:L}=e,E=!!(null===(t=e.content_blocks)||void 0===t?void 0:t.find(e=>e.block_type===o.zc.SamanthaSuggest));try{let t=(0,v.QW)(g.useFeedStore.getState(),b),n=(0,l.zu)(e),o=(0,u.FFC)(e),S=(0,u.ZFo)(e),N=(0,u.qF)(e),D=(0,l.bf)(e),T=(0,u.AS7)(e),Z=(0,u.vlk)(e),x=N?h.YR:R;if(P.updateMessageList({conversationId:b,immerUpdate:function(){for(var l,u,f,v,g=arguments.length,S=Array(g),y=0;y<g;y++)S[y]=arguments[y];let[C]=S,{draftLocalMessageMap:k,draftMessageMap:w,draftMessageLinks:P,draftRegenerateMessageMap:R}=C,E=!!w[M],N=k[M];if(!E&&!N){let{messageLink:n}=(0,_.Bi)(C,x,L)||{};(0,_.ae)({isRegenerate:D,immerUpdateMessage:S,newLocalMessageId:M,messageId:"",conversationId:b,replyId:x,message:e,sectionId:e.section_id,localMessageStatus:s.JR.ReceivingStream,conversationType:t,skillType:null==e?void 0:null===(l=e.skill)||void 0===l?void 0:l.skill_type}),(0,_.eD)({isRegenerate:D,immerUpdateMessage:S,newLocalMessageId:M,messageKey:null!==(u=null==n?void 0:n.messageKey)&&void 0!==u?u:(0,I.s)()}),N=k[M]}if(!E&&N){if((0,c.M)(e,N))return;let{receiveStreamPackageUpdateTimeout:t=h.Gv}=(0,d.$)("chatMessageConfig")||{};if(k[M]={...N,local:{...N.local,status:s.JR.ReceivingStream,failed:!1,failedExpired:n||o?void 0:Date.now()+t},...(0,a.Z)(e,i.Z),local_message_id:N.local_message_id},n){if(m.k.console.info({namespace:null===(f=e.local_info)||void 0===f?void 0:f.from,message:"replaceLocalMessageByRemote",meta:{message:e}}),(0,A.yk)({draft:C,localMessage:N,message:e}),N.local.isRegenerate){let t=(0,r.Z)(e);t.is_regen=!0,t.regen_active=!0,R.messageMap={...R.messageMap,[M]:t}}x&&(0,p.cf)("AliceChatFallback").then(e=>null==e?void 0:e.cancelTask(x))}}else{let t=w[M];if((0,c.M)(e,t))return;w[M]=e,E||P.push({isLocalMessage:!1,messageId:M}),n&&m.k.persist.info({namespace:null===(v=e.local_info)||void 0===v?void 0:v.from,message:"Receive Non-local Finished Message",meta:{message_id:M,conversation_id:b,is_exist:E}})}}}),e.section_id&&!S){let t=N?void 0:(0,y.K9)(C.useMessageStore.getState(),b,{isLocalMessage:!1,messageId:x});(null==t?void 0:t.section_id)!==e.section_id&&g.useFeedStore.getState().updateLastSectionId(b,e.section_id)}let O=(0,u.LxO)(e);if(n&&O&&e.reply_id){let{receiveStreamPackageUpdateTimeout:e=h.Gv}=(0,d.$)("chatMessageConfig")||{};P.updateSuggestMessage(b,()=>({replyId:R,loading:!0,failed:!1,expired:Date.now()+e,suggests:[]}))}T&&O&&P.updateSuggestMessage(b,()=>{});let F=k.t.getSessionIdBySentMessageId(b,R);T||(E?(0,w.cV)(b,F,e):(0,w.il)(b,F,e)),o?(0,w.Kr)(b,F,e):Z?(0,w.ox)(b,F,e):n&&O&&!T?(0,w.ZL)(b,F,e):T&&(E?(0,w.Pw)(b,F,e):(0,w.hV)(b,F,e)),(0,f.IK)().then(t=>{let n=t.filter(t=>t.matchPlugin(e)).map(e=>e.pluginIdentifier);(0,p.$$)(n).then(t=>{t.forEach(t=>{var n;null==t||null===(n=t.handleReceivingMessageError)||void 0===n||n.call(t,e)})}),n.length>0&&m.k.persist.warning({message:"receive message failed"})})}catch(i){let t=(0,r.Z)(e);t.final_status={message:null===(n=t.final_status)||void 0===n?void 0:n.message,session:(0,S.RB)(i)};let a=k.t.getSessionIdBySentMessageId(b,R);throw E?(0,w.Pw)(b,a,e):((0,w.wJ)(b,a,t),(0,w.Kr)(b,a,t)),i}}},831929:function(e,t,n){n.d(t,{$_:function(){return S},BH:function(){return h},Bi:function(){return y},ae:function(){return m},eD:function(){return _}});var a=n(475666),i=n(508830),r=n(260325),o=n(81307),s=n(900730),l=n(589944),u=n(666396),c=n(455746),d=n(63746),p=n(297562),f=n(436462),v=n(334578),g=n(777433);function h(e,t){let{conversationId:n,replyId:r}=t,o=(0,a.Z)(e.localMessageMap[n],e=>(null==e?void 0:e.reply_id)===r);return(0,i.Z)(o)}function m(e){var t;let{isRegenerate:n,immerUpdateMessage:a,newLocalMessageId:i,conversationId:r,replyId:o,sectionId:s,message:v={},timeout:g=0,localMessageStatus:h}=e,[m]=a,{receiveMessageStartTimeout:_=u.Gr}=(0,l.$)("chatMessageConfig")||{},S=(0,d.UQ)({messageMap:m.draftMessageMap});m.draftLocalMessageMap[i]=(0,p.W)({prevMessageId:n?null===(t=(0,f.Pw)(m.draftMessageLinks,e=>{var t;return(null===(t=S(e))||void 0===t?void 0:t.reply_id)===o}))||void 0===t?void 0:t.messageId:o,localMessageStatus:h,message:{...v,is_delta:!1,user_type:c.UserType.Bot,conversation_id:r,section_id:s,local_message_id:i,reply_id:o},failedExpired:Date.now()+(1e3*Number(g)||_),messageLinks:m.draftMessageLinks,isRegenerate:n})}function _(e){let{immerUpdateMessage:t,newLocalMessageId:n,messageKey:a}=e,[i]=t;if(!(0,r.Z)(i.draftMessageLinks,e=>e.messageId===n)){let e={isLocalMessage:!0,messageId:n,...a?{messageKey:a}:{}};i.draftMessageLinks.push(e)}}function S(e){let[t]=e,{draftLocalMessageMap:n,draftMessageLinks:a,draftMessageMap:i}=t;a.filter(e=>{var t,a;let{isLocalMessage:i,messageId:r}=e;return i&&(null===(a=n[r])||void 0===a?void 0:null===(t=a.local)||void 0===t?void 0:t.status)===o.JR.ReceivingFirstPackage}).sort((e,t)=>(0,v.Z)(i[n[t.messageId].reply_id||""],i[n[e.messageId].reply_id||""])).forEach((e,n)=>{n&&(0,g.Tt)(t,e)})}function y(e,t,n){let{draftLocalMessageMap:a}=e,i=(0,s.J)(t,n),r=(0,s.J)(t),o=a[u.lf],l=a[r],c=a[i];return o?(0,g.FL)(e,u.lf):l?(0,g.FL)(e,r):c?(0,g.FL)(e,i):void 0}},575836:function(e,t,n){n.d(t,{T:function(){return a}});let a=new(n(537065)).Z},844108:function(e,t,n){n.d(t,{D:function(){return w}});var a=n(81192),i=n(327386),r=n(985871),o=n.n(r),s=n(81307),l=n(414817),u=n(148824),c=n(228535),d=n(729813),p=n(455746),f=n(51679),v=n(967037),g=n(644367),h=n(920679),m=n(436462),_=n(744947),S=n(530836),y=n(298113),A=n(969537),C=n(626101),I=n(257149);async function k(e,t,n,r){if(!n)return;let{message_id:m,local_message_id:k,reply_id:w}=n,P=e.getState();if((0,l.H)(n)&&((0,u.ad)(n)||(0,c.TDR)(n)||(0,u.Oy)(n))){P.finishSendMessageTask(k),await P.updateMessageList({conversationId:t,immerUpdate:e=>{let{draftLocalMessageMap:t}=e,a=t[(null==n?void 0:n.local_message_id)||""];a&&(a.local.hasBroken=!0,a.status=p.PushMessageStatus.InVisible,a.local.status=s.JR.Broken)}}),d.v.emit("chat.localBreak");let e=(0,a.Z)(n);e.final_status={message:"Broken",session:"Broken"};let i=y.t.getSessionIdBySentMessageId(t,n.local_message_id||"");await (0,A.BF)(t,i,e),await (0,I.X1)({localMessageId:(0,u.Oy)(n)?null==n?void 0:n.reply_id:null==n?void 0:n.local_message_id});return}if(!(0,u.zu)(n)||(0,l.H)(n)&&(0,c.pdQ)(n)){let e=(0,_.K9)(S.useMessageStore.getState(),t,{isLocalMessage:!1,messageId:w||""});if((0,l.H)(n)&&(0,u.ph)(n))await P.updateMessageList({conversationId:t,immerUpdate:e=>{let{draftLocalMessageMap:i,draftMessageLinks:r}=e,o=i[k||""];o&&(o.local.hasBroken=!0,o.status=p.PushMessageStatus.InVisible,o.local.status=s.JR.Broken,o.final_status={message:"Broken",session:"Broken"});let l=r.find(e=>e.messageId===k);l&&(l.messageKey=`${l.messageId}_break`);let u=y.t.getSessionIdBySentMessageId(t,n.reply_id||"");(0,A.ox)(t,u,(0,a.Z)(o))}});else if(((0,l.H)(n)&&(0,c.$28)(n)||!(0,u.zu)(n))&&m){let e={conversation_id:t,message_id:m,...(0,i.Z)(n,["local","local_message_id"]),status:p.PushMessageStatus.Broken,chunk_seq:"999999",is_finish:!0,is_delta:!1,final_status:{message:"Broken",session:"Broken"}};(0,C.s)(e)}await (0,I.X1)({replyId:w||"",localMessageId:null==e?void 0:e.local_message_id}),d.v.emit("chat.localBreak");let b=w||m,M=(0,v.zQ)({eventName:"break_message"});if(!function(e){if(!e)return!1;let t=(0,h.v)(Number(e.create_time||Date.now()));return o()().isBefore(o()(t).add(10,"minute"))}(n)||!b||(null==t?void 0:t.startsWith("local"))||(0,c.vlk)(n)){g.k.persist.log({eventName:"break_message_invalid",meta:{replyId:String(b),conversation_id:String(t),is_finished:(0,u.zu)(n)?"1":"0",create_time:String(n.create_time),message_type:String(n.message_type),content_type:String(n.content_type),status:String(n.status),localMessageStatus:(0,l.H)(n)&&String(n.local.status)}});return}f.kz.MessageReport({reply_id:b,conversation_id:t,action:"break"}).then(()=>{M.addDurationPoint("success"),M.success()},e=>{M.error({reason:"break message failed",error:e,meta:{replyId:String(b),conversation_id:String(t),is_finished:(0,u.zu)(n)?"1":"0",create_time:String(n.create_time),message_type:String(n.message_type),content_type:String(n.content_type),status:String(n.status),localMessageStatus:(0,l.H)(n)&&String(n.local.status)}}),null==r||r()})}}async function w(e,t){let n=e.getState(),a=(0,_.Sv)(n,t);if((0,c.Q5B)(a)){let n=(0,m.MF)(t);(null==n?void 0:n.length)&&await Promise.all(null==n?void 0:n.map(n=>k(e,t,n)))}else{if((0,u.Wj)(a))return;await k(e,t,a)}}},445620:function(e,t,n){n.d(t,{x:function(){return _}});var a=n(444614),i=n(67864),r=n(477710),o=n(156217),s=n(530836),l=n(744947),u=n(93708),c=n(234761),d=n(468494),p=n(886421),f=n(46499),v=n(17135),g=n(636674);let h=async e=>e?e.startsWith("local_")?new Promise(t=>{let n=!0,a=!1,r=()=>{n&&(s(),n=!1,a||clearTimeout(l))},o=e=>{r(),t(e)},s=(0,u.Wp)("chatViewCoreStore").subscribe(t=>{let{currentChatViewConfig:n}=t;if(!n)return;let{chatType:a,chatId:r,chatKey:s}=n;a===i.z.Conversation&&(s&&s===e?o(r):o(null))}),l=window.setTimeout(()=>{a=!0,o(null)},6e4)}):e:null,m=async e=>{let t=await h(e);return!!t&&new Promise(e=>{let n=!0,i=!1,r=()=>{n&&(u(),n=!1,i||clearTimeout(c))},o=t=>{r(),e(t)},u=s.useMessageStore.subscribe(e=>{var n,i;let r=(0,l.Sv)(e,t);!(0,a.Z)(null==r?void 0:r.verbose)&&o(Number(null==r?void 0:null===(i=r.verbose)||void 0===i?void 0:null===(n=i.agent_to_skill)||void 0===n?void 0:n.skill_type)===g.SkillType.ReadPDF)}),c=window.setTimeout(()=>{i=!0,o(!1)},6e4)})},_=function(){let{chatViewConfig:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,o.GL)("chatViewService"),n=t=>{let{chatId:n}=null!=e?e:{},a=(0,c.jo)(d.useFeedStore.getState(),n);(0,v.trackEvent)("copilot_button_click",{bot_id:(0,p.SR)(n),conversation_type:null==a?void 0:a.conversation_type,conversation_id:n,collection_id:null==t?void 0:t.collectionId,message_id:null==t?void 0:t.messageId,entrance_type:null==t?void 0:t.entranceType})};return{onAfterOpenFile:n,openFileByKey:(a,i,o,s,l)=>{let{pdf:u={},messageId:c,openFrom:d,delayToIntension:p=!1}=o||{},f=async()=>{let{anchorPage:i,highlightArea:o,assetList:f,realFileKey:v,fileName:g}=u;(!p||await m(null==e?void 0:e.chatId))&&(t.openCanvasPanel({conversationId:(null==e?void 0:e.chatId)||"",messageId:c||"",readContent:{pdfId:a,realFileKey:null!=v?v:a,pdfName:g,assetList:f,pdfAnchorConfig:{page:i,areas:o},teaCtx:s,openFrom:d},canvasLayoutState:r.P.CANVAS_ONLY},l),n(s))};if("PDF"===i)return f(),!1},openFileByLink:(a,i,o,s)=>{let{attchmentType:l,pdf:u={},messageId:c,openFrom:d,delayToIntension:p=!1}=i||{},v=async()=>{let{anchorPage:i,highlightArea:l,assetList:v,realFileKey:g}=u;(!p||await m(null==e?void 0:e.chatId))&&(a=(0,f.P)(a),t.openCanvasPanel({conversationId:(null==e?void 0:e.chatId)||"",messageId:c||"",readContent:{pdfUrl:a,pdfName:a,realFileKey:null!=g?g:a,assetList:v,pdfAnchorConfig:{page:i,areas:l},teaCtx:o,openFrom:d},canvasLayoutState:r.P.CANVAS_ONLY},s),n(o))};if("pdf"===l)return v(),!1}}}},236543:function(e,t,n){n.d(t,{D:function(){return _},s:function(){return m}});var a=n(429996),i=n(721219),r=n(861431),o=n(210230),s=n(291375),l=n(81307),u=n(67864),c=n(93708),d=n(234761),p=n(468494),f=n(107599),v=n(729813),g=n(836031),h=n(967037);let m=e=>{let{chatType:t}=e,n=(0,g.T)();return(e,a)=>{let o=(0,d.dg)(p.useFeedStore.getState(),e);if(o){p.useFeedStore.getState().updateLocalConversationLocal(e,{createStatus:s.ns.Creating});let c=(0,d.IO)(p.useFeedStore.getState());return(0,i.Z)(a).map(a=>{var i,s,d,p;return{...a,reportParams:{...null==a?void 0:a.reportParams,from:(null==a?void 0:null===(i=a.reportParams)||void 0===i?void 0:i.from)||"",enter_from:null==n?void 0:null===(s=n.state)||void 0===s?void 0:s.enter_from,conversation_type:l.VI.CocoWebSub},localConversationId:e,conversationId:"0",botId:c,chatType:null!=t?t:u.z.NewThread,botType:"Main",extraExt:{...null==a?void 0:a.extraExt,...(null==o?void 0:null===(d=o.local)||void 0===d?void 0:d.relatedShareId)?{related_share_id:null==o?void 0:null===(p=o.local)||void 0===p?void 0:p.relatedShareId}:{},need_create_thread:"1"},reportEvents:{create_conversation_by_message:(0,h.zQ)({eventName:"create_conversation_by_message",meta:{scene:"new_thread"}}),new_thread_message_full:(0,h.zQ)({eventName:"new_thread_message_full",meta:{...(0,r.Z)(a,["scene"]),...(0,r.Z)(null==a?void 0:a.reportParams,["send_source"])}})}}})}return a}},_=e=>{let t=(0,f.vf)(e);(0,a.useEffect)(()=>{if(t&&e)return p.useFeedStore.subscribe(t=>t.localConversationMap[e],t=>{var n,a,i,r,l,u,d,p;!(0,o.Z)(t)&&((null===(n=t.local)||void 0===n?void 0:n.createStatus)===s.ns.Done&&(null===(a=t.local)||void 0===a?void 0:a.newConversationId)?(null===(u=t.local)||void 0===u||null===(l=u.reportEvent)||void 0===l||l.success(),setTimeout(()=>{var n;(0,c.Wp)("chatViewCoreStore").setState({needSkipChatKey:e}),v.v.emit("chat.thread.created",{localConversationId:e,newConversationId:(null===(n=t.local)||void 0===n?void 0:n.newConversationId)||""})})):(null===(i=t.local)||void 0===i?void 0:i.createStatus)===s.ns.Failed&&(null===(r=t.local)||void 0===r?void 0:r.failReason)===s.t2.ReachLimit&&(null==t||null===(p=t.local)||void 0===p||null===(d=p.reportEvent)||void 0===d||d.error({reason:"guest_reach_limit"}),setTimeout(()=>v.v.emit("chat.guest.login",{backToRoot:!0}))))},{fireImmediately:!0})},[t,e])}},165439:function(e,t,n){n.d(t,{O:function(){return o}});var a=n(429996),i=n(882156),r=n(93708);let o=()=>{let{pageInteractive:e,businessInit:t}=(0,r.sQ)("flowWebLayoutStore");return(0,a.useEffect)(()=>{(0,i.k)("visible")},[]),{pageInteractive:e,businessInit:t}}},493913:function(e,t,n){n.d(t,{O:function(){return i}});var a=n(454083);let i={matcher:e=>e===a.G.AISpace_ImageEdit,handler:e=>Promise.all([n.e("277"),n.e("57382")]).then(n.bind(n,858125)).then(t=>{t.default(e)}),prehandler:e=>Promise.all([n.e("277"),n.e("81263")]).then(n.bind(n,586478)).then(t=>t.default(e))}},716832:function(e,t,n){n.d(t,{C:function(){return s}});var a=n(429996),i=n(477710),r=n(156217),o=n(93708);let s=()=>{let e=(0,o.sQ)("chatViewCoreStore",e=>{var t;return(null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId)||""}),t=(0,r.GL)("chatViewService"),n=(0,a.useRef)(0);return{openFileByKey:(a,r,o,s)=>{let{attachments:l=[],messageId:u="",conversationId:c="",activePath:d}=r||{};t.openCanvasPanel({messageId:u,conversationId:c,canvasLayoutState:i.P.CANVAS_ONLY,fileKey:a,attachments:l,isCodeFile:!0,activePath:d,canvasVersion:n.current,chatId:e,teaCtx:o},s),n.current+=1},openCodeContent:(n,a,r,o,s)=>{let{messageId:l="",conversationId:u="",autoRun:c,autoQuote:d=!0}=r||{};t.openCanvasPanel({messageId:l,conversationId:u,canvasLayoutState:i.P.CANVAS_ONLY,fileKey:"",attachments:[],modelGenContent:{code:n,language:a},isCodeFile:!0,chatId:e,autoQuote:d,teaCtx:o,autoRun:c},s)},openRepo:(a,r,o)=>{let{id:s,name:l,url:u,activePath:c}=a||{};t.openCanvasPanel({messageId:"",conversationId:"",canvasLayoutState:i.P.CANVAS_ONLY,fileKey:s,canvasVersion:n.current,activePath:c,attachments:[{key:s,type:"link",identifier:s,local_key:s,name:l,url:u,repo_id:s}],isCodeFile:!0,chatId:e,teaCtx:r},o),n.current+=1},openArtifact:(e,n,a,r,o,s)=>{let{messageId:l="",conversationId:u="",isAutoOpen:c}=r||{},{version:d}=a||{};t.openCanvasPanel({conversationId:u,messageId:l,artifactId:e,artifactKey:n,defaultArtifacts:void 0,isCodeFile:!0,canvasLayoutState:i.P.CANVAS_ONLY,chatId:u,version:d,isAutoOpen:c,artifactMeta:a,teaCtx:o},s,c)}}}},625116:function(e,t,n){var a;n.d(t,{Ts:function(){return r},ev:function(){return i}});let i=((a={}).Auto="2",a.On="1",a.Off="0",a),r=(e,t)=>{let{deepThinkingAutoCotMode:n,deepThinkingSwitchUseAutoCot:a,deepThinkingSwitchValue:r,showDeepThinkingBinaryMode:o}=e;return t?i.Off:("optional"===n&&a||"hidden_force"===n)&&!o?i.Auto:r?i.On:i.Off}},424228:function(e,t,n){n.d(t,{C:function(){return D}});var a=n(429996),i=n(354187),r=n(625116),o=n(716832),s=n(713688),l=n(774370),u=n(67864),c=n(572231),d=n(156217),p=n(93708),f=n(15348),v=n(445620),g=n(200235),h=n(475879),m=n(636674),_=n(910157),S=n(233034),y=n(927746),A=n(836031),C=n(644367),I=n(126473),k=n(143024),w=n(454083);async function P(e){return Promise.resolve(!1)}var b=n(669384),M=n(551450);let R={matcher:e=>w.G.Send_Message===e,handler:async function(e){var t,n,a;let{payload:i,sendMessage:r,toggleDeepThink:o,options:s,updateActiveSkillTypeMap:u,openReadCanvasByFile:c,openReadCanvasByLink:d,openCodingCanvasByKey:p,openCodingCanvasByRepo:v,updateRefContents:g,toggleSuperTask:h}=e;if(!i)return;let m=Array.isArray(i)?i:[i];if(((null==s?void 0:s.deepThinkingSwitchValue)!==void 0||(null==s?void 0:s.deepThinkingActiveType)!==void 0)&&await o({deepThinkingSwitchValue:s.deepThinkingSwitchValue,deepThinkingActiveType:s.deepThinkingActiveType}),m.some(e=>{var t;let n=(0,_.R)(null==e?void 0:null===(t=e.extraExt)||void 0===t?void 0:t.input_skill,{}),a=b.W.DesExtSkillSuperTask;return(null==n?void 0:n.skill_type)===a||(null==n?void 0:n.skill_type)===`${a}`})){let e=null==s?void 0:null===(a=s.superTaskStatus)||void 0===a?void 0:a.safeToken;if(!(e&&await P(e))){M.pJ.error("\u68C0\u6D4B\u5230\u8C46\u5305\u8D85\u80FD\u6A21\u5F0F\u975E\u6B63\u5E38\u8BBF\u95EE\uFF0C\u8BF7\u6CE8\u610F\u6D4F\u89C8\u7684\u7F51\u7AD9\u662F\u5426\u5B89\u5168"),C.k.persist.error({eventName:"super_task_attack_risk",error:Error("super_task_attack_risk"),meta:{token:e}}),(0,f.D)("chatNavigateService").then(e=>null==e?void 0:e.navigateToChatGuidancePage());return}}if((null==s?void 0:s.superTaskStatus)&&h(s.superTaskStatus||{switchValue:l.CH.SuperTask,taskMode:l.qX.Simple}),(null==s?void 0:s.activeSkill)&&(null==s?void 0:s.activeSkill.skillId)&&(null==s?void 0:s.activeSkill.skillId)&&(null==s?void 0:s.activeSkill.skillFrom)&&u(null==s?void 0:s.activeSkill.skillId,null==s?void 0:s.activeSkill.skillFrom),null==s?void 0:s.openReadCanvas){let{link:e,fileName:t,uri:n}=s.openReadCanvas;n&&t?c(n,{fileName:t}):e&&d(e)}if(null==s?void 0:s.openCodingCanvas){let{key:e,repoId:t,repoName:n,repoUrl:a,type:i}=s.openCodingCanvas;e?p(e,{attachments:[{type:i,key:e}]}):t&&n&&a&&v({id:t,name:n,url:a})}if((null==s?void 0:null===(t=s.setRefContent)||void 0===t?void 0:t.skillId)&&Array.isArray(null==s?void 0:null===(n=s.setRefContent)||void 0===n?void 0:n.refContents)){let e=s.setRefContent.refContents.map(e=>{let{type:t,fileKey:n,fileName:a,link:i,text:r}=e;return{type:t,fileKey:n,fileName:a,link:i,text:r}});g(s.setRefContent.skillId,e)}r(m)}};var L=n(473920),E=n(75699);let N=e=>/\/chat(\/\d*)?$/.test(e);function D(e){var t;let{onReadyToParse:n=()=>Promise.resolve(),isLazy:w=!1,plugins:P,phase2StartTime:b,resolveLocalConversationId:M,sendMessage:D}=e,T=(0,S.s)(),Z=(0,p.sQ)("chatViewCoreStore",e=>{var t,n,a,i;return{chatId:null!==(a=null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId)&&void 0!==a?a:"",chatType:null!==(i=null===(n=e.currentChatViewConfig)||void 0===n?void 0:n.chatType)&&void 0!==i?i:u.z.ThreadLocalConversation}},i.X),x=(0,d.GL)("chatMessageService"),O=(0,d.GL)("chatViewService"),F=(0,d.GL)("chatInputService"),{openFileByKey:B,openRepo:V,openArtifact:$}=(0,o.C)(),{openFileByKey:K,openFileByLink:G}=(0,v.x)({chatViewConfig:Z}),{openImageCanvas:U}=function(){let e=(0,d.GL)("chatViewService");return{openImageCanvas:t=>{var n;let{image:a,canvasLayoutState:i,imageCanvasInitStatus:r}=t,{uri:o,url:s,name:l,width:u,height:c,initialEditTool:d}=a||{};C.k.persist.info({eventName:"UrlAction_OpenImageCanvasStart"});let p={url:s,format:(0,I.lm)(l||""),width:null!=u?u:200,height:null!=c?c:200},f={key:o,image_raw:p,image_ori:p,feedback:"",request_id:"",description:""};null==e||null===(n=e.openCanvasPanel)||void 0===n||n.call(e,{conversationId:"",messageId:"",canvasLayoutState:i,imageEditorProps:{imageCanvasInitStatus:r,image:f,autoScrollIntoViewMessageId:void 0,initialEditTool:d||"default",imageList:[f],editImageConfig:{},isLocalUploadImage:!0,skillId:m.SkillType.ImageGeneration.toString(),skillName:"images_generation",onClose:()=>{null==e||e.closeCanvasPanel()}}})}}}(),[W,j]=(0,y.l)(),z=(0,a.useRef)(!1),H=(0,a.useRef)(""),Q=null===(t=W.get("action"))||void 0===t?void 0:t.trim(),q=W.get("preSendId"),X=(0,a.useRef)(Date.now()),J=(0,a.useRef)(),Y=(0,a.useRef)(),ee=()=>{if(N(H.current)){let{pfTrackParams:e,pluginId:t}=Y.current||{};e&&c.Z.setState({urlActionDuration:{urlActionNavEndTime:Date.now(),urlActionCanvasEventName:e.phaseCanvasRenderEventName||`urlparseplugin_canvasrender_duration${t?`_${t}`:""}`}})}},et={...O,openCanvasPanel:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];O.openCanvasPanel(...t),ee()}},en=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];K(...t),ee()},ea=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];G(...t),ee()},ei=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];B(...t),ee()},er=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];V(...t),ee()},eo=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];$(...t),ee()},es=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];J.current||(J.current=Date.now());let a=null==t?void 0:t[0];if("string"==typeof a){let e=a.split("?"),n=e[0],i=new URLSearchParams(e[1]||""),r=new URLSearchParams(W);for(let[e,t]of(r.delete("action"),i))r.set(e,t);t[0]=`${n}?${r.toString()}`}return T(...t)},el=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return J.current||(J.current=Date.now()),(null!=D?D:x.sendMessage)(...t)},eu=e=>{let{deepThinkingSwitchValue:t,deepThinkingActiveType:n}=e,a={deepThinkingSwitchValue:"boolean"==typeof t?t:n===r.ev.On,deepThinkingSwitchUseAutoCot:n===r.ev.Auto};return new Promise(e=>{let t=(0,p.Wp)("deepThinkingControlStore");if("persist"in t&&!t.persist.hasHydrated()){var n;let i=!0;null===(n=t.persist)||void 0===n||n.onFinishHydration(()=>{i&&t.setState(a),i=!1,e(!0)});return}t.setState(a),e(!0)})},ec=e=>{e&&s.GL.getState().setStatusByConvId("",{taskModeValue:e.taskMode||l.qX.Simple,switchValue:e.switchValue||l.CH.Base})},ed=(e,t)=>{let n=(0,p.Wp)("chatInputStore").getState();M&&n.updateActiveSkillTypeMap(M,e,t)},{addAttachmentDirectly:ep}=(0,g.hx)({chatId:null!=M?M:""}),ef=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,p.Wp)("chatViewCoreStore").setState({currentLocalConversationId:M}),ep(...t)},ev=(e,t)=>{M&&(0,f.D)("refContentStoreService").then(n=>{null==n||n.setRefContents({refContents:t,channel:`skill_${e}`},M)})};(0,a.useEffect)(()=>{let e=(0,_.R)(Q,null);if(!e)return;let{pfTrackParams:t,pluginId:n}=e;return t&&!w&&C.k.persist.info({eventName:t.phase1EventName||`urlparseplugin_phase1_duration_${n}`,meta:{duration:Date.now()-t.startJumpTime,isLazy:!!w,pluginId:n}}),t&&w&&b&&C.k.persist.info({eventName:t.phase2EventName||`urlparseplugin_phase2_duration_${n}`,meta:{duration:Date.now()-b,isLazy:!!w,pluginId:n}}),()=>{!N(H.current)&&(t&&J.current&&C.k.persist.info({eventName:t.phaseNavEventName||`urlparseplugin_phasenav_duration${n?`_${n}`:""}`,meta:{duration:Date.now()-J.current,isLazy:!!w}}),t&&c.Z.setState({urlActionDuration:{urlActionNavEndTime:Date.now(),urlActionChatRenderEventName:t.phaseChatRenderEventName||`urlparseplugin_chatrender_duration${n?`_${n}`:""}`,urlActionCanvasEventName:t.phaseCanvasRenderEventName||`urlparseplugin_canvasrender_duration${n?`_${n}`:""}`}}))}},[]);let eg=(0,A.T)();(0,a.useEffect)(()=>{H.current?H.current!==eg.pathname&&(z.current=!1):H.current=eg.pathname},[eg]);let eh=()=>{W.delete("action"),["/chat/new-thread","/chat/url-action"].includes(H.current)||j(W,{replace:!0})};return(0,a.useEffect)(()=>{if(!Q||z.current)return;let e=(0,_.R)(Q,null);if(Y.current=e,z.current=!0,!e.pluginId){C.k.persist.info({eventName:"UrlParser_actionDataInvalid"});return}let{pluginId:t,payload:a}=e,i=[...P||[],R].find(e=>e.matcher(t));if(!i)return;let{prehandler:r=()=>Promise.resolve(void 0)}=i;(q?(0,k.l)(q):Promise.resolve()).then(async t=>{let o=null==t?void 0:t.conversationId;o||await n(),z.current=!0,Promise.all([r({payload:a,preSendConversationId:o})]).then(t=>{let[n]=t;!function(e,t,n,a){let{pluginId:i,payload:r,pfTrackParams:o,options:s}=e;i.startsWith("AISpace")&&(0,L.Pj)(E.aG.AI_SPACE),setTimeout(async()=>{null==a||a();try{var e;let a=Date.now();await (null==t?void 0:null===(e=t.handler)||void 0===e?void 0:e.call(t,{payload:r,options:s,...n,phase3EndTime:Date.now()})),C.k.persist.info({eventName:o.phase4EventName||`urlparseplugin_phase4_duration${i?`_${i}`:""}`,meta:{duration:Date.now()-a}})}catch(e){C.k.persist.info({eventName:`UrlParser_PluginFail_${i}`,meta:{pluginId:i}})}})}(e,i,{prehandlerData:n,navigate:es,openImageCanvas:U,sendMessage:el,openReadCanvasByFile:(e,t)=>{let{fileName:n,originUri:a}=t;null==en||en(e,"PDF",{pdf:{fileName:n,realFileKey:a}},{skillType:m.SkillType.ReadPDF})},openReadCanvasByLink:e=>{null==ea||ea(e,{attchmentType:"pdf"},{skillType:m.SkillType.ReadPDF})},chatInputService:F,chatViewService:et,getChatSlice:p.GX,getChatService:f.D,useChatRef:h.E,toggleDeepThink:eu,updateActiveSkillTypeMap:ed,openCodingCanvasByKey:ei,openCodingCanvasByRepo:er,updateRefContents:ev,openCodingArtifact:eo,toggleSuperTask:ec,addAttachmentDirectly:ef,preSendConversationId:o},()=>{eh();let{pfTrackParams:t,pluginId:n}=e;t&&C.k.persist.info({eventName:t.phase3EventName||`urlparseplugin_phase3_duration_${n}`,meta:{duration:Date.now()-X.current,isLazy:!!w,pluginId:n}})})})})},[Q]),null}},143024:function(e,t,n){n.d(t,{j:function(){return o},l:function(){return s}});var a=n(575836),i=n(72856);let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((n,r)=>{var o,s;let l=null===(o=e[0])||void 0===o?void 0:o.localConversationId,u=null===(s=e[0])||void 0===s?void 0:s.conversationId;(0,i.O)(e,t).then(()=>a.T.on("on_send_message_end",e=>{(u===e.conversation_id||l===e.local_conversation_id)&&n(e)})).catch(e=>{r(e)})})},o=async(e,t,n)=>{let a=await r(t,n);if((null==a?void 0:a.conversation_id)&&"function"==typeof BroadcastChannel){let t=new BroadcastChannel(e),n=0,i=setInterval(()=>{t.postMessage({conversationId:a.conversation_id}),++n>60&&(clearInterval(i),t.close())},50);t.onmessage=n=>{var a;(null==n?void 0:null===(a=n.data)||void 0===a?void 0:a.receivedId)===e&&(clearInterval(i),t.close())}}return null==a?void 0:a.conversation_id},s=e=>new Promise(t=>{if("function"==typeof BroadcastChannel){let n=new BroadcastChannel(e);n.onmessage=a=>{var i;let r=null==a?void 0:null===(i=a.data)||void 0===i?void 0:i.conversationId;r&&"undefined"!==r?t({conversationId:a.data.conversationId}):t({}),n.postMessage({receivedId:e}),n.close()},setTimeout(()=>{n.close(),t({})},3e3)}else t({})})},454083:function(e,t,n){n.d(t,{G:function(){return a}});var a={Send_Message:"Send_Message",AISpace_FileAIRead:"AISpace_FileAIRead",AISpace_WordFileAIRead:"AISpace_WordFileAIRead",AISpace_LinkAIRead:"AISpace_LinkAIRead",AISpace_ImageAskDoubao:"AISpace_ImageAskDoubao",AISpace_ImageCreate:"AISpace_ImageCreate",AISpace_ImageEdit:"AISpace_ImageEdit",AISpace_FileAskDoubao:"AISpace_FileAskDoubao",AISpace_LinkAskDoubao:"AISpace_LinkAskDoubao",AISpace_ExcelCodeInterpreter:"AISpace_ExcelCodeInterpreter",AISpace_ExcelAIRead:"AISpace_ExcelAIRead",AISpace_DocCanvasOpen:"AISpace_DocCanvasOpen",PC_ImageCanvasOpen:"PC_ImageCanvasOpen",PC_ChatOpen:"PC_ChatOpen",Code_Artifacts_Share:"Code_Artifacts_Share",Code_Artifacts:"Code_Artifacts",Code_Canvas_Open_Repo:"Code_Canvas_Open_Repo",AISpace_MinuteMettingOpen:"AISpace_MinuteMettingOpen",AISpace_VideoRead:"AISpace_VideoRead",AISpace_AudioRead:"AISpace_AudioRead",AISpace_VideoSummary:"AISpace_VideoSummary",AISpace_AudioSummary:"AISpace_AudioSummary",AISpace_VideoMindMap:"AISpace_VideoMindMap",AISpace_AudioMindMap:"AISpace_AudioMindMap",ReadPDF_LatestReading:"ReadPDF_LatestReading",PptCanvasOpen:"PptCanvasOpen",AISpace_Coding_File:"AISpace_Coding_File",AISpace_Coding_Dir:"AISpace_Coding_Dir",AISpace_Coding_Artifact:"AISpace_Coding_Artifact",SuperTask_DuplicateStyle:"SuperTask_DuplicateStyle",AISPace_ImageEditorAction:"AISPace_ImageEditorAction",Credit_AutoOpenCreditPanel:"Credit_AutoOpenCreditPanel"}},988930:function(e,t,n){var a=n(234401);t.Z=function(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:(0,a.Z)(e,t,n)}},965307:function(e,t){var n=RegExp("[\\u200d\ud800-\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");t.Z=function(e){return n.test(e)}},412183:function(e,t,n){n.d(t,{Z:function(){return v}});var a=n(965307),i="\ud800-\udfff",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\ud83c[\udffb-\udfff]",s="[^"+i+"]",l="(?:\ud83c[\udde6-\uddff]){2}",u="[\ud800-\udbff][\udc00-\udfff]",c="(?:"+r+"|"+o+")?",d="[\\ufe0e\\ufe0f]?",p="(?:\\u200d(?:"+[s,l,u].join("|")+")"+d+c+")*",f=RegExp(o+"(?="+o+")|"+("(?:"+[s+r+"?",r,l,u,"["+i+"]"].join("|"))+")"+(d+c+p),"g"),v=function(e){return(0,a.Z)(e)?e.match(f)||[]:e.split("")}},734010:function(e,t,n){var a=n(497182);t.Z=function(e,t){return t="function"==typeof t?t:void 0,(0,a.Z)(e,5,t)}},509403:function(e,t,n){n.d(t,{Z:function(){return l}});var a,i=n(477404),r=n(589303),o=n(894997),s=function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n},l=(a=n(445863).Z,function(e){var t,n=(0,r.Z)(e);return"[object Map]"==n?(0,o.Z)(e):"[object Set]"==n?s(e):(t=a(e),(0,i.Z)(t,function(t){return[t,e[t]]}))})},810197:function(e,t,n){var a=n(923583);t.Z=function(e){return e&&e.length?(0,a.Z)(e):[]}},944746:function(e,t,n){n.d(t,{Z:function(){return s}});var a=n(988930),i=n(965307),r=n(412183),o=n(880502),s=function(e){e=(0,o.Z)(e);var t=(0,i.Z)(e)?(0,r.Z)(e):void 0,n=t?t[0]:e.charAt(0),s=t?(0,a.Z)(t,1).join(""):e.slice(1);return n.toUpperCase()+s}}}]);
/*! For license information please see 93157.cc5a320c.js.LICENSE.txt */
(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["93157"],{808649:function(e,t,i){var n=i(88335);!function(e){"use strict";var t;let s,o,r;function a(e,t,i,n){return new(i||(i=Promise))(function(s,o){function r(e){try{h(n.next(e))}catch(e){o(e)}}function a(e){try{h(n.throw(e))}catch(e){o(e)}}function h(e){var t;e.done?s(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(r,a)}h((n=n.apply(e,t||[])).next())})}let h="";function l(){return 1e4*Date.now()+Math.floor(1e4*Math.random())}function d(e){return("000"+parseInt(e,2).toString(16)).slice(-4)}function c(e,t){switch(t){case 0:for(;128&E(e););break;case 2:g(e,C(e));break;case 5:g(e,4);break;case 1:g(e,8);break;default:throw Error("Unimplemented type: "+t)}}function u(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let _=[];function f(){let e=_.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function g(e,t){if(e.offset+t>e.limit)throw Error("Skip past limit");e.offset+=t}function p(e){return e.offset>=e.limit}function v(e,t){let i=e.bytes,n=e.offset,s=e.limit,o=n+t;if(o>i.length){let t=new Uint8Array(2*o);t.set(i),e.bytes=t}return e.offset=o,o>s&&(e.limit=o),n}function m(e,t){let i=e.offset;if(i+t>e.limit)throw Error("Read past limit");return e.offset+=t,i}function y(e,t){let i=m(e,t),n=String.fromCharCode,s=e.bytes,o="";for(let e=0;e<t;e++){let r,a,h,l;let d=s[e+i];(128&d)==0?o+=n(d):(224&d)==192?e+1>=t?o+="\uFFFD":(192&(r=s[e+i+1]))!=128?o+="\uFFFD":(l=(31&d)<<6|63&r)<128?o+="\uFFFD":(o+=n(l),e++):(240&d)==224?e+2>=t?o+="\uFFFD":(((r=s[e+i+1])|(a=s[e+i+2])<<8)&49344)!=32896?o+="\uFFFD":(l=(15&d)<<12|(63&r)<<6|63&a)<2048||l>=55296&&l<=57343?o+="\uFFFD":(o+=n(l),e+=2):(248&d)==240?e+3>=t?o+="\uFFFD":(r=s[e+i+1],((r|(a=s[e+i+2])<<8|(h=s[e+i+3])<<16)&0xc0c0c0)!=8421504?o+="\uFFFD":(l=(7&d)<<18|(63&r)<<12|(63&a)<<6|63&h)<65536||l>1114111?o+="\uFFFD":(l-=65536,o+=n((l>>10)+55296,(1023&l)+56320),e+=3)):o+="\uFFFD"}return o}function w(e,t){let i=t.length,n=0;for(let e=0;e<i;e++){let s=t.charCodeAt(e);s>=55296&&s<=56319&&e+1<i&&(s=(s<<10)+t.charCodeAt(++e)-0x35fdc00),n+=s<128?1:s<2048?2:s<65536?3:4}T(e,n);let s=v(e,n),o=e.bytes;for(let e=0;e<i;e++){let n=t.charCodeAt(e);n>=55296&&n<=56319&&e+1<i&&(n=(n<<10)+t.charCodeAt(++e)-0x35fdc00),n<128?o[s++]=n:(n<2048?o[s++]=n>>6&31|192:(n<65536?o[s++]=n>>12&15|224:(o[s++]=n>>18&7|240,o[s++]=n>>12&63|128),o[s++]=n>>6&63|128),o[s++]=63&n|128)}}function E(e){return e.bytes[m(e,1)]}function b(e,t){let i=v(e,1);e.bytes[i]=t}function C(e){let t,i=0,n=0;do t=E(e),i<32&&(n|=(127&t)<<i),i+=7;while(128&t);return n}function T(e,t){for(t>>>=0;t>=128;)b(e,127&t|128),t>>>=7;b(e,t)}function I(e,t){let i,n=0,s=0,o=0;return n=127&(i=E(e)),128&i&&(n|=(127&(i=E(e)))<<7,128&i&&(n|=(127&(i=E(e)))<<14,128&i&&(n|=(127&(i=E(e)))<<21,128&i&&(s=127&(i=E(e)),128&i&&(s|=(127&(i=E(e)))<<7,128&i&&(s|=(127&(i=E(e)))<<14,128&i&&(s|=(127&(i=E(e)))<<21,128&i&&(o=127&(i=E(e)),128&i&&(o|=(127&(i=E(e)))<<7))))))))),{low:n|s<<28,high:s>>>4|o<<24,unsigned:t}}function k(e,t){let i=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,s=t.high>>>24,o=0===s?0===n?i<16384?i<128?1:2:i<2097152?3:4:n<16384?n<128?5:6:n<2097152?7:8:s<128?9:10,r=v(e,o),a=e.bytes;switch(o){case 10:a[r+9]=s>>>7&1;case 9:a[r+8]=9!==o?128|s:127&s;case 8:a[r+7]=8!==o?n>>>21|128:n>>>21&127;case 7:a[r+6]=7!==o?n>>>14|128:n>>>14&127;case 6:a[r+5]=6!==o?n>>>7|128:n>>>7&127;case 5:a[r+4]=5!==o?128|n:127&n;case 4:a[r+3]=4!==o?i>>>21|128:i>>>21&127;case 3:a[r+2]=3!==o?i>>>14|128:i>>>14&127;case 2:a[r+1]=2!==o?i>>>7|128:i>>>7&127;case 1:a[r]=1!==o?128|i:127&i}}function L(e){var t;return function(e){let t={};e:for(;!p(e);){let i=C(e);switch(i>>>3){case 0:break e;case 1:t.SeqID=I(e,!0);break;case 2:t.LogID=I(e,!0);break;case 3:t.service=C(e);break;case 4:t.method=C(e);break;case 5:{let i=function(e){let t=C(e),i=e.limit;return e.limit=e.offset+t,i}(e);(t.headers||(t.headers=[])).push(function(e){let t={};e:for(;!p(e);){let i=C(e);switch(i>>>3){case 0:break e;case 1:t.key=y(e,C(e));break;case 2:t.value=y(e,C(e));break;default:c(e,7&i)}}if(void 0===t.key)throw Error("Missing required field: key");if(void 0===t.value)throw Error("Missing required field: value");return t}(e)),e.limit=i;break}case 6:t.payloadEncoding=y(e,C(e));break;case 7:t.payloadType=y(e,C(e));break;case 8:t.payload=function(e,t){let i=m(e,t);return e.bytes.subarray(i,i+t)}(e,C(e));break;case 9:t.LogIDNew=y(e,C(e));break;default:c(e,7&i)}}if(void 0===t.SeqID)throw Error("Missing required field: SeqID");if(void 0===t.LogID)throw Error("Missing required field: LogID");if(void 0===t.service)throw Error("Missing required field: service");if(void 0===t.method)throw Error("Missing required field: method");return t}({bytes:t=e,offset:0,limit:t.length})}function S(e){return function(e){let t=f();return function(e,t){let i=e.SeqID;void 0!==i&&(T(t,8),k(t,i));let n=e.LogID;void 0!==n&&(T(t,16),k(t,n));let s=e.service;void 0!==s&&(T(t,24),k(t,u(s)));let o=e.method;void 0!==o&&(T(t,32),k(t,u(o)));let r=e.headers;if(void 0!==r)for(let e of r){var a;T(t,42);let i=f();(function(e,t){let i=e.key;void 0!==i&&(T(t,10),w(t,i));let n=e.value;void 0!==n&&(T(t,18),w(t,n))})(e,i),T(t,i.limit),function(e,t){let i=v(e,t.limit),n=e.bytes,s=t.bytes;for(let e=0,o=t.limit;e<o;e++)n[e+i]=s[e]}(t,i),a=i,_.push(a)}let h=e.payloadEncoding;void 0!==h&&(T(t,50),w(t,h));let l=e.payloadType;void 0!==l&&(T(t,58),w(t,l));let d=e.payload;void 0!==d&&(T(t,66),T(t,d.length),function(e,t){let i=v(e,t.length);e.bytes.set(t,i)}(t,d));let c=e.LogIDNew;void 0!==c&&(T(t,74),w(t,c))}(e,t),function(e){let t=e.bytes,i=e.limit;return t.length===i?t:t.subarray(0,i)}(t)}(e)}let B=String.prototype.charCodeAt;class D{constructor(e,t,i){this.isLong=!0,this.low=0|e,this.high=0|t,this.unsigned=!!i}static isLong(e){return e&&!0===e.isLong}static fromBits(e,t,i){return new D(e,t,i)}static fromBytes(e,t,i){return i?D.fromBytesLE(e,t):D.fromBytesBE(e,t)}static fromBytesLE(e,t){return new D(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new D(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}static fromHash(e){return"\0\0\0\0\0\0\0\0"===e?O:new D((B.call(e,0)|B.call(e,1)<<8|B.call(e,2)<<16|B.call(e,3)<<24)>>>0,(B.call(e,4)|B.call(e,5)<<8|B.call(e,6)<<16|B.call(e,7)<<24)>>>0,!0)}toHash(){return String.fromCharCode(255&this.low,this.low>>>8&255,this.low>>>16&255,this.low>>>24,255&this.high,this.high>>>8&255,this.high>>>16&255,this.high>>>24)}static fromNumber(e,t=!0){if(isNaN(e))return t?x:O;if(t){if(e>=0xffffffffffffffff)return M}else{if(e<=-0x8000000000000000)return A;if(e+1>=0x8000000000000000)return R}return D.fromBits(e%0x100000000|0,e/0x100000000|0,t)}toNumber(){return this.unsigned?(this.high>>>0)*0x100000000+(this.low>>>0):0x100000000*this.high+(this.low>>>0)}isZero(){return 0===this.high&&0===this.low}add(e){D.isLong(e)||(e=D.fromNumber(e));let t=this.high>>>16,i=65535&this.high,n=this.low>>>16,s=65535&this.low,o=e.high>>>16,r=65535&e.high,a=e.low>>>16,h=65535&e.low,l=0,d=0,c,u;return c=0+((u=0+(s+h))>>>16),u&=65535,c+=n+a,d+=c>>>16,c&=65535,d+=i+r,l+=d>>>16,d&=65535,l+=t+o,l&=65535,D.fromBits(c<<16|u,l<<16|d,this.unsigned)}equals(e){return D.isLong(e)||(e=D.fromNumber(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}addOne(){return -1===this.low&&-1===this.high?D.fromBits(0,0,this.unsigned):-1===this.low?D.fromBits(0,this.high+1,this.unsigned):D.fromBits(this.low+1,this.high,this.unsigned)}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){let e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]}}let O=new D(0,0,!1),x=new D(0,0,!0),R=D.fromBits(-1,0x7fffffff,!1),M=D.fromBits(-1,-1,!0),A=D.fromBits(0,-0x80000000,!1);e.ErrorCode=void 0,(t=e.ErrorCode||(e.ErrorCode={}))[t.NATIVE_ERROR=5001]="NATIVE_ERROR",t[t.CONNECTING_ERROR=5002]="CONNECTING_ERROR",t[t.MAX_RETRIES_ERROR=5003]="MAX_RETRIES_ERROR",t[t.MESSAGE_ERROR=5004]="MESSAGE_ERROR",t[t.OPEN_ERROR=5005]="OPEN_ERROR";class N{constructor(e){this.type=e,this.target=null}}class q extends N{constructor(e,t){super(e),this.message=t&&t.message||null}}class P extends N{constructor(t,i){super(t),this.error=i&&i.error||null,this.colno=i&&i.colno||0,this.filename=i&&i.filename||"",this.lineno=i&&i.lineno||0,this.message=i&&i.message||"",this.code=i&&i.code||e.ErrorCode.NATIVE_ERROR}}class W extends N{constructor(e,t){super(e),this.code=t&&t.code||0,this.reason=t&&t.reason||"",this.wasClean=t&&t.wasClean||!1,this.willReconnect=t&&t.willReconnect||!1}}class $ extends N{constructor(e,t){super(e),this.data=t&&t.data||null}}class j extends ${constructor(e,t){super(e),this.data=t&&t.data||null,this.message=t&&t.message||null}}class F extends N{constructor(e,t){super(e),this.data=t&&t.data||null}}function G(e,{message:t,code:i}){return new P(e,{message:t,code:i})}function U(e,{code:t,reason:i,wasClean:n,willReconnect:s}){return new W(e,{code:t,reason:i,wasClean:n,willReconnect:s})}function H(e,{data:t,message:i}){return new j(e,{data:t,message:i})}function J(e,{data:t}){return new F(e,{data:t})}function Q(e,{message:t}){return new q(e,{message:t})}class X{constructor(e,t){this.endpoints=e,this.maxRetries=t,this.currentIndex=0,this.currentEndpointTriesCount=0}resetEndpointConfig(){this.currentIndex=0,this.currentEndpointTriesCount=0}resetTries(){this.currentEndpointTriesCount=0}getCurrentEndpoint(){return this.endpoints[this.currentIndex]}getCurrentEndpointTriesCount(){return this.currentEndpointTriesCount}checkReachMaxTries(){return this.currentIndex>=this.endpoints.length||this.currentIndex===this.endpoints.length-1&&this.currentEndpointTriesCount===this.maxRetries}checkCurrentEndpointReachedMaxRetries(){return this.currentIndex==this.endpoints.length||this.currentEndpointTriesCount>this.maxRetries}replaceBackupEndpointAndUpdateCount(){return this.currentEndpointTriesCount=1,this.currentIndex++,this.endpoints[this.currentIndex]}getCurrentEndpointAndUpdateCount(){return this.currentEndpointTriesCount++,this.getCurrentEndpoint()}}let V=("undefined"!=typeof globalThis&&"Window"===globalThis.constructor.name||"undefined"!=typeof window&&"Window"===window.constructor.name)&&"undefined"!=typeof document,K="undefined"!=typeof globalThis&&("Object"===globalThis.constructor.name||"DedicatedWorkerGlobalScope"===globalThis.constructor.name)&&"undefined"!=typeof tt,z=("undefined"!=typeof globalThis&&"Object"===globalThis.constructor.name||"undefined"==typeof globalThis||"undefined"!=typeof globalThis&&!!globalThis.WeixinJSBridge)&&"undefined"!=typeof wx,Z="undefined"!=typeof globalThis&&("DedicatedWorkerGlobalScope"===globalThis.constructor.name||"SharedWorkerGlobalScope"===globalThis.constructor.name||"ServiceWorkerGlobalScope"===globalThis.constructor.name)&&"undefined"!=typeof self,Y="undefined"!=typeof globalThis&&"Object"===globalThis.constructor.name&&"Object"===i.g.constructor.name&&void 0!==n&&n.version;class ee{constructor(){this._listeners={}}emit(e,...t){let i=this._listeners[e];if(i)i.slice().forEach(e=>e.fn.apply(e.ctx,t));else if("error"===e&&!this.onerror){let e=t.length&&t[0];if(e instanceof Error)throw e;throw Error("Unhandled error."+(e?" ("+e.message+")":"")).context=e,e}return this}off(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=null;else{let i=this._listeners[e];if(i)for(let e=0;e<i.length;)i[e].fn===t?i.splice(e,1):++e}return this}on(e,t,i){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:i||this}),this}}class et extends ee{constructor(e,t,i){super(),this._socket=null,z&&wx.connectSocket&&(this._socket=wx.connectSocket({url:e,protocols:t,header:i,fail:this._createSocketFailHandler.bind(this),success:this._createSocketSuccessHandler.bind(this)})),K&&tt.connectSocket&&(this._socket=tt.connectSocket({url:e,protocols:t,header:i,fail:this._createSocketFailHandler.bind(this),success:this._createSocketSuccessHandler.bind(this)}))}_createSocketSuccessHandler(){Promise.resolve().then(()=>{this._addWsListeners()})}_createSocketFailHandler(e){Promise.resolve().then(()=>{let t=G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)});this.emit("error",t);let i=U("close",{reason:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)});this.emit("close",i)})}_addWsListeners(){this._socket.onOpen(e=>{this.emit("open",J("open",Object.assign(Object.assign({},e),{data:e.errMsg||""})))}),this._socket.onClose(e=>{this.emit("close",U("close",Object.assign({},e)))}),this._socket.onMessage(e=>{this.emit("message",H("message",Object.assign({},e)))}),this._socket.onError(e=>{this.emit("error",G("error",Object.assign(Object.assign({},e),{message:e.errMsg||""})))})}send(e){if(e instanceof Uint8Array){let t=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);this._socket&&this._socket.send({data:t,fail:e=>{this.emit("error",G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)}))}})}else this._socket&&this._socket.send({data:e,fail:e=>{this.emit("error",G("error",{message:e.errMsg||e.errNo?`message: ${e.errMsg}`||`code: ${e.errNo}`||"":JSON.stringify(e)}))}})}close(e,t){this._socket&&this._socket.close({code:e,reason:t})}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}get readyState(){return this._socket.readyState}get binaryType(){return this._socket.binaryType}set binaryType(e){}get url(){return this._socket.url}get protocol(){return this._socket.protocol}get extensions(){return this._socket.extensions}get bufferedAmount(){return 0}}function ei(e,t,i){return!!(null==e?void 0:e.find(e=>e.key===t&&e.value===i))}function en(e,t){var i;return null===(i=null==e?void 0:e.find(e=>e.key===t))||void 0===i?void 0:i.value}function es(e){return a(this,void 0,void 0,function*(){let{enableAutoAck:t}=this._options,i=ei(e.message.headers,"need_ack","1"),n=ei(e.message.headers,"is_ack","1"),s=ei(e.message.headers,"x_frontier_qos_ack","1");if(t&&i){let{SeqID:t,LogID:i,service:n,LogIDNew:s,method:o}=e.message;this._sendAck({SeqID:t,LogID:i,LogIDNew:s,service:n,method:o,headers:[{key:"is_ack",value:"1"},{key:"ack_id",value:s||""},{key:"ack_code",value:"0"}]})}n&&!s&&this._dispatchAckMessageEvent(e)})}function eo(e){return a(this,void 0,void 0,function*(){if("string"==typeof e){let t=new Uint8Array(function(e){let t=0,i=0;for(let n=0;n<e.length;++n)(i=e.charCodeAt(n))<128?t+=1:i<2048?t+=2:(64512&i)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t}(e));return function(e,t,i){let n,s;for(let o=0;o<e.length;++o)(n=e.charCodeAt(o))<128?t[i++]=n:(n<2048?t[i++]=n>>6|192:((64512&n)==55296&&(64512&(s=e.charCodeAt(o+1)))==56320?(n=65536+((1023&n)<<10)+(1023&s),++o,t[i++]=n>>18|240,t[i++]=n>>12&63|128):t[i++]=n>>12|224,t[i++]=n>>6&63|128),t[i++]=63&n|128)}(e,t,0),t}return e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)})}function er(e){return a(this,void 0,void 0,function*(){let t=L((yield eo(e.data)));try{if(t.payload instanceof Uint8Array){let e=this._options.payloadEncoding instanceof Object?{force:!!this._options.payloadEncoding.force,encoding:this._options.payloadEncoding.encoding?this._options.payloadEncoding.encoding.replace(/\s/g,"").toLowerCase():""}:{force:!1,encoding:this._options.payloadEncoding?this._options.payloadEncoding.replace(/\s/g,"").toLowerCase():""},i=t.payloadEncoding?t.payloadEncoding.replace(/\s/g,"").toLowerCase():"",n=this._options.payloadType instanceof Object?{force:!!this._options.payloadType.force,type:this._options.payloadType.type?this._options.payloadType.type.replace(/\s/g,"").toLowerCase():""}:{force:!1,type:this._options.payloadType?this._options.payloadType.replace(/\s/g,"").toLowerCase():""},s=t.payloadType?t.payloadType.replace(/\s/g,"").toLowerCase():"",o=n.force?n.type:s||n.type,r=e.force?e.encoding:i||e.encoding;this._options.enableTransformTextPayload&&["text/plain;charset=utf-8","application/json","application/json;charset=utf-8","string"].includes(o)&&(!r||["none_none","binary"].includes(r))?t.textPayload=function(e,t,i){if(i-0<1)return"";let n="";for(let t=0;t<i;){let i=e[t++];if(i<=127)n+=String.fromCharCode(i);else if(i>=192&&i<224)n+=String.fromCharCode((31&i)<<6|63&e[t++]);else if(i>=224&&i<240)n+=String.fromCharCode((15&i)<<12|(63&e[t++])<<6|63&e[t++]);else if(i>=240){let s=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536;n+=String.fromCharCode(55296+(s>>10)),n+=String.fromCharCode(56320+(1023&s))}}return n}(t.payload,0,t.payload.byteLength):t.textPayload=""}else t.textPayload=""}catch(e){t.textPayload=""}e.message=t})}function ea(e,t,i){let n=-1;return function t(s){return++n<i.length?i[n].bind(e)(s).then(()=>t(s)):Promise.resolve()}(t)}let eh=(e,t)=>t.some(t=>e instanceof t),el=new WeakMap,ed=new WeakMap,ec=new WeakMap,eu=new WeakMap,e_=new WeakMap,ef={get(e,t,i){if(e instanceof IDBTransaction){if("done"===t)return ed.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ec.get(e);if("store"===t)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return eg(e[t])},set:(e,t,i)=>(e[t]=i,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eg(e){if(e instanceof IDBRequest)return function(e){let t=new Promise((t,i)=>{let n=()=>{e.removeEventListener("success",s),e.removeEventListener("error",o)},s=()=>{t(eg(e.result)),n()},o=()=>{i(e.error),n()};e.addEventListener("success",s),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&el.set(t,e)}).catch(()=>{}),e_.set(t,e),t}(e);if(eu.has(e))return eu.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(o||(o=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ep(this),t),eg(el.get(this))}:function(...t){return eg(e.apply(ep(this),t))}:function(t,...i){let n=e.call(ep(this),t,...i);return ec.set(n,t.sort?t.sort():[t]),eg(n)};return(e instanceof IDBTransaction&&function(e){if(ed.has(e))return;let t=new Promise((t,i)=>{let n=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",o),e.removeEventListener("abort",o)},s=()=>{t(),n()},o=()=>{i(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",s),e.addEventListener("error",o),e.addEventListener("abort",o)});ed.set(e,t)}(e),eh(e,s||(s=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,ef):e}(e);return t!==e&&(eu.set(e,t),e_.set(t,e)),t}let ep=e=>e_.get(e),ev=["get","getKey","getAll","getAllKeys","count"],em=["put","add","delete","clear"],ey=new Map;function ew(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ey.get(t))return ey.get(t);let i=t.replace(/FromIndex$/,""),n=t!==i,s=em.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!(s||ev.includes(i)))return;let o=async function(e,...t){let o=this.transaction(e,s?"readwrite":"readonly"),r=o.store;return n&&(r=r.index(t.shift())),(await Promise.all([r[i](...t),s&&o.done]))[0]};return ey.set(t,o),o}ef={...r=ef,get:(e,t,i)=>ew(e,t)||r.get(e,t,i),has:(e,t)=>!!ew(e,t)||r.has(e,t)};class eE extends ee{constructor(){super(),this._qosDB=void 0,this._intervalTimeoutId=null,this._interval=36e5,this._init()}openDB(){return a(this,void 0,void 0,function*(){yield this._init()})}_init(){return a(this,void 0,void 0,function*(){return new Promise(e=>{this._qosDB?e(this):((function(e,t,{blocked:i,upgrade:n,blocking:s,terminated:o}={}){let r=indexedDB.open(e,1),a=eg(r);return n&&r.addEventListener("upgradeneeded",e=>{n(eg(r.result),e.oldVersion,e.newVersion,eg(r.transaction))}),i&&r.addEventListener("blocked",()=>i()),a.then(e=>{o&&e.addEventListener("close",()=>o()),s&&e.addEventListener("versionchange",()=>s())}).catch(()=>{}),a})("frontier",0,{upgrade(e,t,i,n){e.createObjectStore("qos",{keyPath:"message_id"})}}).then(e=>{this._qosDB=e,this._intervalFlush(),this.emit("ready")}),this.on("ready",()=>{e(this),this.off()}))})})}_intervalFlush(){return a(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}get(e){var t;return a(this,void 0,void 0,function*(){return yield null===(t=this._qosDB)||void 0===t?void 0:t.get("qos",e)})}set(e,t){var i;return a(this,void 0,void 0,function*(){return yield null===(i=this._qosDB)||void 0===i?void 0:i.put("qos",{message_id:e,timestamp:t})})}del(e){var t;return a(this,void 0,void 0,function*(){return yield null===(t=this._qosDB)||void 0===t?void 0:t.delete("qos",e)})}clear(){var e;return a(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.clear("qos")})}keys(){var e;return a(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.getAllKeys("qos")})}getAll(){var e;return a(this,void 0,void 0,function*(){return yield null===(e=this._qosDB)||void 0===e?void 0:e.getAll("qos")})}flushExpired(){var e;return a(this,void 0,void 0,function*(){((yield null===(e=this._qosDB)||void 0===e?void 0:e.getAll("qos"))||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{var t;null===(t=this._qosDB)||void 0===t||t.delete("qos",e.message_id)})})}closeDB(){var e;return a(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),null===(e=this._qosDB)||void 0===e||e.close(),this._qosDB=void 0})}get isReady(){return this._qosDB}}class eb{constructor(){this._qosDB=localStorage,this._intervalTimeoutId=null,this._interval=36e5,this._intervalFlush()}openDB(){return a(this,void 0,void 0,function*(){if(!this._intervalTimeoutId)return this._intervalFlush(),this})}_intervalFlush(){return a(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}_add_prefix(e){return`${this._prefix}${e}`}get _prefix(){return"frontier_qos_msg_id_"}get(e){return a(this,void 0,void 0,function*(){return JSON.parse(this._qosDB.getItem(this._add_prefix(e))||"{}")})}set(e,t){return a(this,void 0,void 0,function*(){return this._qosDB.setItem(this._add_prefix(e),JSON.stringify({message_id:e,timestamp:t}))})}del(e){return a(this,void 0,void 0,function*(){return this._qosDB.removeItem(this._add_prefix(e))})}clear(){return a(this,void 0,void 0,function*(){return this._qosDB.clear()})}keys(){return a(this,void 0,void 0,function*(){let e=[];for(let t=0;t<this._qosDB.length;t++)e.push(this._qosDB.key(t));return e.filter(e=>null==e?void 0:e.startsWith(this._prefix))})}getAll(){return a(this,void 0,void 0,function*(){let e=[],t=yield this.keys();for(let i in t){let t=this._qosDB.getItem(i);e.push(JSON.parse(t||"{}"))}return e})}flushExpired(){return a(this,void 0,void 0,function*(){((yield this.getAll())||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{this.del(e.message_id)})})}closeDB(){clearInterval(this._intervalTimeoutId)}get isReady(){return this._qosDB}}class eC{constructor(){this._qosDB=K?tt:z?wx:null,this._intervalTimeoutId=null,this._interval=36e5,this._intervalFlush()}openDB(){return a(this,void 0,void 0,function*(){if(!this._intervalTimeoutId)return this._intervalFlush(),this})}_intervalFlush(){return a(this,void 0,void 0,function*(){clearInterval(this._intervalTimeoutId),this._intervalTimeoutId=setInterval(()=>{this.flushExpired()},this._interval)})}_add_prefix(e){return`${this._prefix}${e}`}get _prefix(){return"frontier_qos_msg_id_"}get(e){return a(this,void 0,void 0,function*(){return JSON.parse(this._qosDB.getStorageSync(this._add_prefix(e))||"{}")})}set(e,t){return a(this,void 0,void 0,function*(){return this._qosDB.setStorageSync(this._add_prefix(e),JSON.stringify({message_id:e,timestamp:t}))})}del(e){return a(this,void 0,void 0,function*(){return this._qosDB.removeStorageSync(this._add_prefix(e))})}clear(){return a(this,void 0,void 0,function*(){return this._qosDB.clearStorageSync()})}keys(){return a(this,void 0,void 0,function*(){let{keys:e}=this._qosDB.getStorageInfoSync();return e.filter(e=>null==e?void 0:e.startsWith(this._prefix))})}getAll(){return a(this,void 0,void 0,function*(){let e=[];for(let t of yield this.keys()){let i=yield this.get(t);e.push(i)}return e})}flushExpired(){return a(this,void 0,void 0,function*(){((yield this.getAll())||[]).filter(({timestamp:e})=>e<Date.now()).forEach(e=>{this.del(e.message_id)})})}closeDB(){clearInterval(this._intervalTimeoutId)}get isReady(){return this._qosDB}}function eT(){return K||K?new eC:V||Z?new eE:V||Z?new eb:null}function eI(e){var t,i,n,s;return a(this,void 0,void 0,function*(){let o=ei(e.message.headers,"code","-1"),r=ei(e.message.headers,"is_ack","1"),a=en(e.message.headers,"x_frontier_msgid"),h=Number(en(e.message.headers,"x_frontier_ttl"))||0,l=ei(e.message.headers,"x_frontier_qos","2");if(!ei(e.message.headers,"x_frontier_qos_ack","1")||!l){if(l&&!this._qosDB&&(this._qosDB=eT(),this._qosDB&&(yield this._qosDB.openDB())),l&&!this._qosDB.isReady&&(yield this._qosDB.openDB()),e.message.service>0&&r&&!o){a&&l?(yield null===(t=this._qosDB)||void 0===t?void 0:t.get(a))||(this._dispatchMessageEvent(e),yield null===(i=this._qosDB)||void 0===i?void 0:i.set(a,Date.now()+h)):this._dispatchMessageEvent(e);return}if(e.message.service>0){a&&l?(yield null===(n=this._qosDB)||void 0===n?void 0:n.get(a))||(this._dispatchMessageEvent(e),yield null===(s=this._qosDB)||void 0===s?void 0:s.set(a,Date.now()+h)):this._dispatchMessageEvent(e);return}}})}function ek(e){return a(this,void 0,void 0,function*(){this._uptimeTimeoutId=setTimeout((()=>eL.bind(this)(e)).bind(this),this._options.uptimeInterval)})}function eL(e){var t,i;return a(this,void 0,void 0,function*(){if(!this._ws||this._ws.readyState!==this.OPEN)return;let{pingInterval:n}=this._options;null===(t=this._endpointManager)||void 0===t||t.resetEndpointConfig();for(let e=0;e<this._messageQueue.length;e++){let t=this._messageQueue[e];if(this._ws.readyState===this.OPEN&&null!==t)this._ws&&this._ws.send(t),this._messageQueue[e]=null;else break}this._messageQueue=this._messageQueue.filter(e=>!!e),this._pingPongTimeoutId=setTimeout(()=>this._ping(),n),this._dispatchOpenEvent(e),this._isBrowser&&this._ws&&(this._ws.binaryType=this._binaryType);let s=null===(i=this._endpointManager)||void 0===i?void 0:i.getCurrentEndpoint();this._debug(`open ${s} success`)})}function eS(){return a(this,void 0,void 0,function*(){this._isInit=!1,clearTimeout(this._connectionTimeoutId)})}function eB(e){var t,i;return a(this,void 0,void 0,function*(){let n=ei(e.message.headers,"x_frontier_qos","2"),s=ei(e.message.headers,"x_frontier_is_ack","1"),o=null===(t=en(e.message.headers,"x_frontier_ack_msgid"))||void 0===t?void 0:t.split(",");if(n&&!this._qosDB&&(this._qosDB=eT(),this._qosDB&&(yield this._qosDB.openDB())),n&&!this._qosDB.isReady&&(yield this._qosDB.openDB()),n&&s&&o&&o.length)for(let e of o)yield null===(i=this._qosDB)||void 0===i?void 0:i.del(e)})}let eD=(e,t)=>{switch(e){case"boe":case"ppe":return{[`x-use-${e}`]:1,"x-tt-env":t};default:return{}}};class eO{constructor(e){this.maxLossCount=e,this.count=0}addCount(){this.count++}checkReachMaxCount(){return this.count>=this.maxLossCount}resetCounter(e=0){this.maxLossCount=e,this.count=0}}e.CustomCloseEvent=W,e.CustomErrorEvent=P,e.Event=N,e.FWS=class extends ee{constructor(t){super(),this._miniNavigatorOnline=!0,this._isBrowser=V,this._isNode=Y,this._isMiniTT=K,this._isMiniWX=z,this._isWorker=Z,this._messageQueue=[],this._endpointManager=null,this._readyClosed=!1,this._binaryType="arraybuffer",this._connectLock=!1,this._connectionTimeoutId=null,this._uptimeTimeoutId=null,this._reconnectTimeoutId=null,this._pingPongTimeoutId=null,this._seqId=0,this._isInit=!1,this._url="",this._qosDB=null,this._pingLossCounter=null,this._protocols="pbbp2",this.CLOSED=3,this.CONNECTING=0,this.OPEN=1,this.CLOSING=2,this._onOpen=t=>{ea(this,t,[eS,ek]).then(()=>{var e;let t=null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpoint();this._debug(`open ${t}`)}).catch(t=>{let i=G("error",{message:t.message,code:e.ErrorCode.OPEN_ERROR});this._dispatchErrorEvent(i)})},this._onMessage=t=>a(this,void 0,void 0,function*(){let{pingInterval:i,pingFrequency:n}=this._options;("hi"===t.data&&"always"===n||"auto"===n)&&(this._clearPingTimer(),this.emit("ping_once_success","success"),this._pingPongTimeoutId=setTimeout(()=>this._ping(),i)),"hi"!==t.data&&ea(this,t,[er,es,eB,eI]).then(()=>{this._debug("received",t.message)}).catch(t=>{let i=G("error",{message:t.message,code:e.ErrorCode.MESSAGE_ERROR});this._dispatchErrorEvent(i)})}),this._onError=t=>{var i,n;let s=null===(i=this._endpointManager)||void 0===i?void 0:i.checkReachMaxTries(),o=null===(n=this._endpointManager)||void 0===n?void 0:n.getCurrentEndpoint();if(s&&!t.message){let t=`connect ${o} fail, max retries reached`;this._dispatchErrorEvent(G("error",{message:t,code:e.ErrorCode.MAX_RETRIES_ERROR}));return}this._ws&&this._ws.readyState===this.OPEN&&this._disconnect(),this._dispatchErrorEvent(G("error",{message:t.message,code:e.ErrorCode.NATIVE_ERROR}))},this._onClose=t=>a(this,void 0,void 0,function*(){var i,n,s,o,r,h,l,d,c,u,_,f;this._clearTimer(),this._clearPingTimer(),this._removeWsListeners(),this._ws=null,this._connectLock=!1;let g=null===(i=this._endpointManager)||void 0===i?void 0:i.checkReachMaxTries();if(!g&&this._navigatorOnline()&&!this._readyClosed){let e=null===(n=this._endpointManager)||void 0===n?void 0:n.getCurrentEndpoint(),i=this._options.reconnectInterceptor(t.code,t.reason);this._dispatchCloseEvent(U("close",{code:1006,reason:t.reason||`connecting failed, unknown reason, hostname: ${e}`,willReconnect:i})),i&&this._connect();return}if(1e3!==t.code&&this._readyClosed){this._dispatchCloseEvent(U("close",{code:1e3,reason:"bye"})),null===(s=this._endpointManager)||void 0===s||s.resetEndpointConfig(),null===(o=this._pingLossCounter)||void 0===o||o.resetCounter();return}if(1e3!==t.code&&g){let i=null===(r=this._endpointManager)||void 0===r?void 0:r.getCurrentEndpoint(),n=t.reason;n||(n=yield function(e){return a(this,void 0,void 0,function*(){return new Promise(t=>{if(!V)return t("unknown reason");try{let i=document.createElement("script");window.frontierJSONP=e=>{document.body.removeChild(i),window.frontierJSONP=void 0,t(e&&e.msg||"unknown reason")},i.type="text/javascript",i.src=e.replace(/^ws/,"http")+"&jscallback=frontierJSONP";try{document.body.appendChild(i)}catch(e){document.body.removeChild(i)}}catch(e){window.frontierJSONP=void 0,t("unknown reason")}})})}(this._url)),n=`connecting failed, ${n}, hostname: ${i}, max retries reached`,this._dispatchCloseEvent(U("close",{code:t.code,reason:n}));let s=`connect ${i} fail, max retries reached`;this._dispatchErrorEvent(G("error",{message:s,code:e.ErrorCode.MAX_RETRIES_ERROR})),null===(h=this._endpointManager)||void 0===h||h.resetEndpointConfig(),null===(l=this._pingLossCounter)||void 0===l||l.resetCounter();return}if(1e3!==t.code&&!t.reason){let e=null===(d=this._endpointManager)||void 0===d?void 0:d.getCurrentEndpoint();this._dispatchCloseEvent(U("close",{code:t.code,reason:`connecting failed, unknown reason, hostname: ${e}`})),null===(c=this._endpointManager)||void 0===c||c.resetEndpointConfig(),null===(u=this._pingLossCounter)||void 0===u||u.resetCounter();return}this._dispatchCloseEvent(t),null===(_=this._endpointManager)||void 0===_||_.resetEndpointConfig(),null===(f=this._pingLossCounter)||void 0===f||f.resetCounter()}),this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this.onStartReconnect=null,this.onReceiveAck=null,this.onStopImmediatelyReconnect=null,this._options={url:"",automaticOpen:!0,initReconnectInterval:1e3,maxReconnectInterval:1e4,reconnectIntervalGrowFactor:2,timeoutInterval:5e3,uptimeInterval:1e3,maxRetries:5,debug:!1,maxMessageQueueLength:1/0,service:0,logIDGenerator:l,headers:void 0,payloadEncoding:"",payloadType:"",fpID:"",deviceID:"",accessKey:"",ttwID:"",bddID:"",aID:"",disableAutoReconnect:!1,customParams:{},pingInterval:15e3,pingTimeoutInterval:4e3,pingFrequency:"auto",pingLossCount:2,enableTransformTextPayload:!1,logIDNewConfig:{enableAutoGenerateLogIDNew:!1,userIp:""},miniProgramParams:{customHttpHeader:{}},enableAutoAck:!1,reconnectInterceptor:()=>!0,enableQoS:!1,env:{xTTEnv:"",xUseEnv:""},listenNetworkChanged:!0};let{url:i,ws:n}=t,s=Array.isArray(i)?i:"string"==typeof i?[i]:[];if(!s||0===s.length)throw Error("please provide valid url");if(!(n||z&&wx.connectSocket||K&&tt.connectSocket||(V||Z)&&"undefined"!=typeof WebSocket&&WebSocket))throw Error("please provide ws params, WebSocket constructor is undefined");Object.assign(this._options,t),this._endpointManager=new X(s,this._options.maxRetries),this._pingLossCounter=new eO(this._options.pingLossCount),this._options.automaticOpen&&(this._isInit=!0,this._connect()),this._options.listenNetworkChanged&&(this._isMiniTT||this._isMiniWX?this._onPageNetWorkChange():this._isBrowser&&this._initGlobalEventListener())}_handleOnLine(){!this._options.disableAutoReconnect&&!this._readyClosed&&this._handleReconnect()}_handleOffLine(){this._destroyWebSocket();let e=Q("reconnect",{message:"stop immediately reconnect"});this.onStopImmediatelyReconnect&&this.onStopImmediatelyReconnect(e)}_initGlobalEventListener(){this._isBrowser&&window.addEventListener("online",this._handleOnLine.bind(this)),this._isBrowser&&window.addEventListener("offline",this._handleOffLine.bind(this)),this._isBrowser&&window.addEventListener("pagehide",this._handlePageHide.bind(this)),this._isBrowser&&window.addEventListener("pageshow",this._handlePageShow.bind(this))}_dropGlobalEventListener(){this._isBrowser&&window.removeEventListener("online",this._handleOnLine),this._isBrowser&&window.removeEventListener("offline",this._handleOffLine),this._isBrowser&&window.removeEventListener("pagehide",this._handlePageHide),this._isBrowser&&window.removeEventListener("pageshow",this._handlePageShow)}_handlePageHide(e){e.persisted||(this._isBrowser&&window.removeEventListener("pagehide",this._handlePageHide),this._isBrowser&&window.removeEventListener("pageshow",this._handlePageShow),this.close()),this._isBrowser&&window.removeEventListener("online",this._handleOnLine),this._isBrowser&&window.removeEventListener("offline",this._handleOffLine)}_handlePageShow(e){e.persisted&&(this._navigatorOnline()&&(!this._ws||this._ws.readyState!==this.OPEN||this._ws.readyState!==this.CONNECTING)&&this._handleOnLine(),this._isBrowser&&window.addEventListener("online",this._handleOnLine.bind(this)),this._isBrowser&&window.addEventListener("offline",this._handleOffLine.bind(this)))}_generateUrl(e){return a(this,void 0,void 0,function*(){let t,i,n;let{fpID:s,deviceID:o,bddID:r,ttwID:a,accessKey:h,aID:l,customParams:d={},enableAutoAck:c,enableQoS:u,env:_}=this._options;this._isBrowser||this._isMiniWX||this._isMiniTT?(t=location&&"https:"==location.protocol?"wss://":"ws://",i=e.replace(/((^ws)|(^http))((?:[s]*:\/\/))/,""),n=/^wss(.*:\/\/)/.test(e)?e:`${t}${i}`):(t="wss://",i=e.replace(/(^http)((?:[s]*:\/\/))/,""),n=/(^ws)((?:[s]*:\/\/))/.test(i)?i:`${t}${i}`);let f=r?"bd_did":a?"ttwid":"device_id",g=r||a||o;if(!g||!f)throw Error("please provide bddID, deviceID or ttwID");let p="function"==typeof d?yield d():d,v=Object.assign(Object.assign({device_platform:"web",version_code:"fws_1.0.0",access_key:h,fpid:s,aid:l,[f]:g,xsack:+!!c,xaack:+!!c,xsqos:+!!u},_?eD(_.xUseEnv,_.xTTEnv):{}),p),m=Object.keys(v).reduce((e,t)=>`${e}${e?"&":"?"}${t}=${v[t]}`,"");return`${n}/ws/v2${m}`})}_connect(){var t,i,n,s,o,r,h;return a(this,void 0,void 0,function*(){if(!this._connectLock&&!this._readyClosed){this._connectLock=!0;try{var a,l;let d=null===(t=this._endpointManager)||void 0===t?void 0:t.checkCurrentEndpointReachedMaxRetries(),{timeoutInterval:c}=this._options;if(d){let t=null===(i=this._endpointManager)||void 0===i?void 0:i.getCurrentEndpoint(),o=null===(n=this._endpointManager)||void 0===n?void 0:n.replaceBackupEndpointAndUpdateCount(),r=null===(s=this._endpointManager)||void 0===s?void 0:s.getCurrentEndpointTriesCount();if(o){let i=`connect ${t} timeout, max retries reached, will use backup endpoint ${o} to retry`,n=G("error",{message:i,code:e.ErrorCode.MAX_RETRIES_ERROR});this._debug(i),this._dispatchErrorEvent(n),this._url=yield this._generateUrl(o),this._debug(`connect ${o} ${r} times`),this._removeWsListeners()}else{let i=`connect ${t} timeout, max retries reached`;this._debug(i),this._dispatchErrorEvent(G("error",{message:i,code:e.ErrorCode.MAX_RETRIES_ERROR}));return}}else{let e=null===(o=this._endpointManager)||void 0===o?void 0:o.getCurrentEndpointAndUpdateCount(),t=null===(r=this._endpointManager)||void 0===r?void 0:r.getCurrentEndpointTriesCount();this._url=yield this._generateUrl(e||""),this._debug(`connect ${e} ${t} times`),this._removeWsListeners()}if(this._isInit)this._isInit=!1;else{let e=Q("reconnect",{message:"start"});this.onStartReconnect&&this.onStartReconnect(e)}let u=(null===(h=this._endpointManager)||void 0===h?void 0:h.getCurrentEndpointTriesCount())||0;u>1&&(yield this._wait(u-1)),this._debug(`connecting url: ${this._url} protocols: ${this._protocols}`),this._ws=(a={url:this._url,protocols:[this._protocols],headers:this._options.miniProgramParams.customHttpHeader},(l=this._options.ws)?new l(a.url,a.protocol):z||K?new et(a.url,a.protocol,a.headers):(V||Z)&&"undefined"!=typeof WebSocket&&WebSocket?new WebSocket(a.url,a.protocols):void 0),(this._isBrowser||this._isWorker)&&this._ws&&(this._ws.binaryType=this._binaryType),this._addWsListeners(),this._connectionTimeoutId=setTimeout(()=>this._onTimeout(),c)}catch(e){throw this._connectLock=!1,e}}})}_clearTimer(){clearTimeout(this._connectionTimeoutId),clearTimeout(this._uptimeTimeoutId),this._connectionTimeoutId=null,this._uptimeTimeoutId=null}_clearPingTimer(){clearTimeout(this._pingPongTimeoutId),clearTimeout(this._reconnectTimeoutId),this._pingPongTimeoutId=null,this._reconnectTimeoutId=null}_debug(...e){this._options.debug}_getIntervalValue(e){let{initReconnectInterval:t,maxReconnectInterval:i,reconnectIntervalGrowFactor:n}=this._options,s=t*Math.pow(n,e-1);return s>i?i:s}_ping(){if(this._ws&&this._ws.readyState===this.CONNECTING){this._pingPongTimeoutId=setTimeout(()=>this._ping(),this._options.pingInterval);return}if(!this._ws||this._ws.readyState!==this.OPEN){this._handleReconnect();return}this._ws&&this._ws.send("hi"),this._reconnectTimeoutId=setTimeout(()=>{var e,t;null===(e=this._pingLossCounter)||void 0===e||e.addCount(),this.emit("ping_once_timeout","timeout"),(null===(t=this._pingLossCounter)||void 0===t?void 0:t.checkReachMaxCount())?this._handleReconnect():this._ping()},this._options.pingTimeoutInterval)}_navigatorOnline(){return this._isMiniTT||this._isMiniWX?this._miniNavigatorOnline:!this._isBrowser&&!this._isWorker||!this._options.listenNetworkChanged||navigator.onLine}_handleReconnect(){var e,t;this._navigatorOnline()&&!this._readyClosed&&(null===(e=this._endpointManager)||void 0===e||e.resetEndpointConfig(),null===(t=this._pingLossCounter)||void 0===t||t.resetCounter(),this._ws?this._disconnect(1001,"going away, try reconnecting server",!0):this._connect())}_onPageNetWorkChange(){this._isMiniTT?tt.onNetworkStatusChange(({isConnected:e})=>{this._miniNavigatorOnline=e,e?this._handleOnLine():this._handleOffLine()}):this._isMiniWX&&wx.onNetworkStatusChange(({isConnected:e})=>{this._miniNavigatorOnline=e,e?this._handleOnLine():this._handleOffLine()})}_wait(e){return new Promise(t=>{setTimeout(t,this._getIntervalValue(e))})}_disconnect(e=1e3,t="",i=!1){this._ws&&this._destroyWebSocket(e,t,i)}_onTimeout(){var e;let t=null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpoint();this._debug(`connect ${t} timeout`),this._disconnect(1001,"timeout, try reconnecting",!0)}_sendAck(e){let t=S(e);this._ws&&this._ws.readyState===this.OPEN&&(this._ws&&this._ws.send(t),this._debug("send_ack",e))}_removeWsListeners(){this._ws&&(this._ws.removeEventListener("open",this._onOpen),this._ws.removeEventListener("close",this._onClose),this._ws.removeEventListener("message",this._onMessage),this._ws.removeEventListener("error",this._onError))}_addWsListeners(){this._ws&&(this._ws.addEventListener("open",this._onOpen),this._ws.addEventListener("close",this._onClose),this._ws.addEventListener("message",this._onMessage),this._ws.addEventListener("error",this._onError))}_wsInstanceClose(e=1e3,t=""){try{this._ws&&this._ws.close(e,t)}catch(e){}}_destroyWebSocket(e=1e3,t="",i=!1){var n,s,o,r;if(this._clearPingTimer(),this._clearTimer(),this._removeWsListeners(),this._wsInstanceClose(1e3,t),this._connectLock=!1,i&&this._navigatorOnline()&&!this._readyClosed){if(null===(n=this._endpointManager)||void 0===n?void 0:n.checkReachMaxTries()){let e=null===(s=this._endpointManager)||void 0===s?void 0:s.getCurrentEndpoint();this._dispatchCloseEvent(U("close",{code:1006,reason:`connect ${e} timeout, max retries reached`,wasClean:!0}))}else{let i=this._options.reconnectInterceptor(e,t);this._dispatchCloseEvent(U("close",{code:e,reason:t,wasClean:!0,willReconnect:i})),i&&this._connect()}return}this._navigatorOnline()||this._readyClosed?this._dispatchCloseEvent(U("close",{code:e,reason:"bye"})):this._dispatchCloseEvent(U("close",{code:1006,reason:"going away, network offline"})),this._ws=null,null===(o=this._endpointManager)||void 0===o||o.resetEndpointConfig(),null===(r=this._pingLossCounter)||void 0===r||r.resetCounter()}_dispatchOpenEvent(e){this.emit("open",e),this.onopen&&this.onopen(e)}_dispatchMessageEvent(e){this.emit("message",e),this.onmessage&&this.onmessage(e)}_dispatchAckMessageEvent(e){this.emit("ack",e),this.onReceiveAck&&this.onReceiveAck(e)}_dispatchErrorEvent(e){this.emit("error",e),this.onerror&&this.onerror(e)}_dispatchCloseEvent(e){this.emit("close",e),this.onclose&&this.onclose(e)}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){var e;return(null===(e=this._endpointManager)||void 0===e?void 0:e.getCurrentEndpointTriesCount())||0}get bufferedAmount(){return this._messageQueue.reduce((e,t)=>e+=t&&t.byteLength||0,0)+(this._ws?this._ws.bufferedAmount:0)}get extensions(){return this._ws?this._ws.extensions:""}get protocol(){return this._ws?this._ws.protocol:""}get readyState(){return this._ws?this._ws.readyState:this._options.automaticOpen?this.CONNECTING:this.CLOSED}get url(){return this._ws?this._ws.url:this._url}close(e=1e3,t){var i;if(this._readyClosed=!0,this._clearTimer(),this._clearPingTimer(),null===(i=this._qosDB)||void 0===i||i.closeDB(),this._dropGlobalEventListener(),!this._ws){this._debug("close, ws instance not initialized");return}if(this._ws.readyState===this.CLOSED||this._ws.readyState===this.CLOSING){this._debug("close, ws already closed");return}this._destroyWebSocket(e,t)}send(e,t){return a(this,void 0,void 0,function*(){if(null==e)throw Error("please provide a valid data, data must be a string or an arraybuffer");"number"==typeof e&&(e=JSON.stringify(e)),"string"==typeof e||e instanceof ArrayBuffer||e.buffer&&e.buffer instanceof ArrayBuffer||(e=JSON.stringify(e));let i=yield eo(e),n=function(e){try{if("string"!=typeof e&&(e instanceof ArrayBuffer||e.buffer&&e.buffer instanceof ArrayBuffer))return"";if("string"==typeof e)return JSON.parse(e),"application/json";return""}catch(t){if("string"==typeof e)return"text/plain;charset=utf-8";return""}}(e),{method:s=0,service:o=this._options.service,logID:r=this._options.logIDGenerator(),headers:a=this._options.headers,payloadEncoding:l=this._options.payloadEncoding,payloadType:c=this._options.payloadType,logIDNew:u=this._options.logIDNewConfig.enableAutoGenerateLogIDNew?function(e=""){let t=`${Date.now()}`;return"02"+t+(h||(h=function(e){let t=/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}/.test(e),i=/(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))/.test(e);return t?function(e){let t=e.split(/\./).map(e=>(Array(8).join("0")+parseInt(e,10).toString(2)).slice(-8)),i=[];return i[0]=d(t[0]+t[1]),i[1]=d(t[2]+t[3]),["0000","0000","0000","0000","0000","ffff",i[0],i[1]].join("")}(e):i?function(e){let t="",i=[],n=0,s=0,o=!0,r="0000";if(e.indexOf("::")>-1){let a=e.split("::");for(let e=0;e<a.length;e++){let t=a[e];if(t.indexOf(":")>0){let e=t.split(":");o&&(n=e.length),s+=e.length;for(let t=0;t<e.length;t++)if(4!==e[t].length){let n=r.substring(0,4-e[t].length).concat(e[t]);i.push(n)}else i.push(e[t]);o=!1}else{if(4!==t.length){let e=r.substring(0,4-t.length).concat(t);i.push(e)}else i.push(t);o&&(n+=1),s+=1,o=!1}}let h="";for(let e=0;e<8-s;e++)h=h.concat(r);for(let e=0;e<i.length;e++)t=e===n?(t=t.concat(h)).concat(i[e]):t.concat(i[e]);return t}{let i=e.split(":");for(let e=0;e<i.length;e++){let n=i[e];if(4!==i[e].length){let s=r.substring(0,4-i[e].length).concat(n);t=t.concat(s)}else t=t.concat(n)}return t}}(e):"00000000000000000000000000000000"}(e)))+Math.random().toString(16).slice(-6)}(this._options.logIDNewConfig.userIp):""}=t||{};if(!o)throw Error("please provide a valid service");let _={SeqID:D.fromNumber(this._seqId++),LogID:D.fromNumber(r),service:o,method:s,headers:a,payloadEncoding:l instanceof Object?l.encoding?l.encoding:"":l,payloadType:c instanceof Object?c.type?c.type:n:c||n,payload:i,LogIDNew:u},f=S(_);return this._ws&&this._ws.readyState===this.OPEN?(this._ws&&this._ws.send(f),this._debug("sent",_)):this._messageQueue.length<this._options.maxMessageQueueLength?(this._messageQueue.push(f),this._debug("enqueue",_)):(this._messageQueue.shift(),this._messageQueue.push(f)),this._seqId})}reconnect(e){var t,i;return a(this,void 0,void 0,function*(){let{url:n}=e||{},s=Array.isArray(n)?n:"string"==typeof n?[n]:[];e&&Object.assign(this._options,e),s&&s.length?this._endpointManager=new X(s,this._options.maxRetries):null===(t=this._endpointManager)||void 0===t||t.resetEndpointConfig(),null===(i=this._pingLossCounter)||void 0===i||i.resetCounter(this._options.pingLossCount),this._readyClosed=!1,this._ws&&this._ws.readyState!==this.CLOSED?this._disconnect(1e3,"manual reconnecting",!0):(this._isInit=!0,this._connect())})}connect(){var e,t;return a(this,void 0,void 0,function*(){this._connectLock||(null===(e=this._endpointManager)||void 0===e||e.resetEndpointConfig(),null===(t=this._pingLossCounter)||void 0===t||t.resetCounter(),this._readyClosed=!1,this._isInit=!0,this._connect())})}addEventListener(e,t){this.on(e,t)}dispatchEvent(e){let{type:t}=e;this.emit(t,e)}removeEventListener(e,t){this.off(e,t)}pingOnce(){return new Promise((e,t)=>{this._clearPingTimer(),this._pingPongTimeoutId=setTimeout(()=>this._ping(),this._options.pingInterval);let i=()=>{e("success"),this.off("ping_once_success",i),this.off("ping_once_timeout",n)},n=()=>{t("timeout"),this.off("ping_once_success",i),this.off("ping_once_timeout",n)};this.on("ping_once_success",i),this.on("ping_once_timeout",n),this._ping()})}},e.FrontierMessageEvent=j,e.MessageEvent=$,e.OpenEvent=F,e.ReconnectEvent=q,e.createCloseEvent=U,e.createErrorEvent=G,e.createMessageEvent=H,e.createOpenEvent=J,e.createReconnectEvent=Q,e.decodedFrame=L,e.encodeFrame=S,Object.defineProperty(e,"__esModule",{value:!0})}(t)}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["99543"],{250357:function(e,t,n){n.d(t,{checkIsPDFLink:function(){return m},useIsPDFLink:function(){return g}});var i=n(713738),r=n(4137),u=n(910214),l=n(712980),a=n(604278);let o=/^https:\/\/(www\.)?arxiv\.org\/pdf\/.+$/i,s=e=>{let t=(0,a.tryChangeToPDFlink)(e);return o.test(t)},c=e=>/^https:\/\/.*\.pdf$/i.test(e),d=e=>s(e)||c(e),f=new Map,v=new Map,p=e=>f.get(e),S=async e=>{let t=v.get(e);if(t)return t;let n=0,i=async()=>{try{var t,l,a;let n=await u.samanthaApiService.SniffUrl({urls:[e]}),i=null===(a=n.data)||void 0===a?void 0:null===(l=a.results)||void 0===l?void 0:null===(t=l.find(t=>t.url===e))||void 0===t?void 0:t.ContentType;if((0,r.default)(i)||!i)throw Error("Invalid Response.");return/^application\/pdf\b/.test(i)}catch(e){if(n>1)return!1;return n++,await i()}},l=i();v.set(e,l);let a=await l;return f.set(e,a),v.delete(e),a},g=e=>{e=(0,a.tryChangeToPDFlink)(e);let[t,n]=(0,i.useState)(0),r=()=>{n(t+1)},u=!!(e&&(0,l.isValidUrl)(e,{allowedProtocols:["https:"]}))&&p(e);return void 0===u?(S(e).then(()=>{r()}),d(e)):u},m=async e=>{let t=(0,l.isValidUrl)(e,{allowedProtocols:["https:"]})&&p(e);return void 0!==t?t:t=await S(e)}},604278:function(e,t,n){n.d(t,{tryChangeToPDFlink:function(){return r}});let i=/\.pdf$/i,r=e=>{if(!(e=e.trim()).startsWith("https://arxiv.org/"))return e;let t=e;return t.startsWith("https://arxiv.org/abs")&&(t=t.replace("https://arxiv.org/abs","https://arxiv.org/pdf")),i.test(t)&&(t=t.replace(i,"")),t}},970377:function(e,t,n){n.d(t,{useConversationDisabled:function(){return c}});var i=n(713738),r=n(865607),u=n(992528),l=n(217957);let a=e=>{let t=(0,i.useRef)(),n=()=>{t.current&&(clearTimeout(t.current),t.current=null)};return(0,i.useEffect)(()=>n,[]),{setExpired:i=>{if(n(),(0,l.default)(i))return;let r=Math.max(i-Date.now(),0);t.current=window.setTimeout(()=>{e()},r)},reset:n}};var o=n(83990);let s=()=>{let{limitExpired:e,limitTips:t,isLimited:n}=(0,o.useMessageStore)(e=>e.rateLimitConfig,r.shallow);(0,i.useEffect)(()=>{u(e)},[e]);let{setExpired:u}=a(()=>{o.useMessageStore.getState().updateRateLimitConfig({isLimited:!1,limitExpired:void 0,limitTips:""})});return{limitTips:t,isLimited:n}},c=()=>{let{conversationDisabledParams:e}=(0,u.useChat)({optionalProvider:!0}),{isLimited:t,limitTips:n}=s();return(null==e?void 0:e.isDisabled)?{...e}:{disabledText:t?n:void 0,isDisabled:!!t}}},188355:function(e,t,n){n.d(t,{getTeaRecommendNameByTag:function(){return r}});var i=n(710733);let r=e=>{if(void 0!==e)return({[i.RecommendSkillTag.New]:"new_skill",[i.RecommendSkillTag.Recommend]:"suggested_skill",[i.RecommendSkillTag.Upgrade]:"upgrade_skill"})[e]}},124267:function(e,t,n){n.d(t,{emitBeforeBreakMessage:function(){return h},emitBeforeSendMessage:function(){return _},emitEmptySlash:function(){return m},emitKeyDown:function(){return v},emitMessageSendingBefore:function(){return S},emitMessageSendingEnd:function(){return p},emitPaste:function(){return g}});var i=n(220051),r=n(385093),u=n(698392),l=n(516655),a=n(689368),o=n(165482),s=n(856392),c=n(178230);let d=()=>{let{chatId:e,chatType:t,chatKey:n}=(0,u.getChatSlice)("chatViewCoreStore").currentChatViewConfig||{},i={activeSkillType:(0,u.getChatSlice)("chatGuidanceStore").activeSkillIdentifier},r=e?(0,u.getChatSlice)("chatInputStore").activeSkillTypeMap[e]:void 0;return{chatId:e,chatType:t,chatKey:n,guidance:i,skillType:r}},f=function(e){let{needsReport:t=!0,reportReturnedValue:n=!0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(){for(var u=arguments.length,f=Array(u),v=0;v<u;v++)f[v]=arguments[v];return new Promise((u,v)=>{(async()=>{let p=t?(0,s.createReportEvent)({eventName:"chat_input_event",meta:{event:e}}):null;try{let t=await (0,l.getInputEventsPluginMatcher)();null==p||p.addDurationPoint("get_matchers_success");let s=d();null==p||p.updateMeta({matcher_params:s});let v=t.map(e=>{let t=e(s);if(t)return t}).filter(i.default);null==p||p.addDurationPoint("find_matcher_success"),null==p||p.updateMeta({plugin_identifiers:v.map(e=>e?e.toString():"undefined").join(",")});let S=await Promise.all(v.map(e=>(0,a.getInputEventsPlugin)(e))),g=S.filter(e=>!!e);null==p||p.addDurationPoint("get_plugins_success"),null==p||p.updateMeta({plugins_ready:S.map(e=>e?"1":"0").join(",")});let m=f[0];n&&(null==p||p.updateMeta({origin_returned_value:(0,o.stringifyJSON)(m)}));for(let t=0;t<g.length;t++){let i=g[t][e],u=(e,t)=>t,l=(0,r.default)(i)?i:u;try{m=await l(s,m,...f.slice(1)),null==p||p.addDurationPoint(`run_plugin_${t}_success`),n&&(null==p||p.updateMeta({[`plugin_${t}_returned_value`]:(0,o.stringifyJSON)(m)}))}catch(t){c.logger.persist.error({error:t,message:`input lifecycle [${e}] execute failed, reason:${t.message}`})}}n&&(null==p||p.updateMeta({returned_value:(0,o.stringifyJSON)(m)})),null==p||p.success(),u(m)}catch(e){null==p||p.error({reason:"run_event_failed",error:e instanceof Error?e:Error(String(e))}),v(e)}})()})}},v=f("onKeyDown",{needsReport:!1}),p=f("onMessageSendingEnd"),S=f("onMessageSendingBefore",{reportReturnedValue:!1}),g=f("onPaste"),m=f("onEmptySlash"),h=f("onBeforeBreakMessage"),_=f("onBeforeSendMessage")},783147:function(e,t,n){n.d(t,{useBotSendFileEnabled:function(){return s},useBotSendImageEnabled:function(){return c},useEnableCodeSkillRelate:function(){return d}});var i=n(713738),r=n(845647),u=n(698392),l=n(971857),a=n(524129),o=n(198660);let s=(e,t)=>{var n,a,o,s;let{launchData:c}=(0,u.useChatSlice)("launcherRawSettingStore"),d=null!==(s=null==c?void 0:null===(a=c.feature_config)||void 0===a?void 0:null===(n=a.enable_send_file_message)||void 0===n?void 0:n.enabled)&&void 0!==s&&s,f=null===(o=(0,l.useMainConversationLink)())||void 0===o?void 0:o.conversationId,v=(0,l.useBotConfigByConversationId)(t===r.ChatType.NewThread?null!=f?f:"":e,t),p=(0,l.useIsSamantha)(e,t),S=(0,i.useMemo)(()=>null==v?void 0:v.some(e=>"show_icon"===e.conf_group_key&&"show_file_icon"===e.conf_key&&"1"===e.conf_value),[v]);return!!p||!!S&&!!d},c=(e,t)=>{var n;let u=null===(n=(0,l.useMainConversationLink)())||void 0===n?void 0:n.conversationId,a=(0,l.useBotConfigByConversationId)(t===r.ChatType.NewThread?null!=u?u:"":e,t),o=(0,l.useIsSamantha)(e,t),s=(0,i.useMemo)(()=>null==a?void 0:a.some(e=>{let t=e.conf_group_key,n=e.conf_key,i=e.conf_value;return!!("show_icon"===t&&"show_image_icon"===n&&"1"===i||"show_icon"===t&&"show_icon"===n&&["album","camera"].includes(i||""))}),[a]);return!!o||!!s},d=e=>{let{chatId:t,chatType:n,skillType:i,exemptFromCodingReverse:r=!1}=e,s=(0,o.useIsLoggedIn)();return(0,l.useIsSamantha)(t||"",n)&&!i&&s&&((0,u.getChatSlice)("chatInputStore").checkSupportSkill(a.SkillType.CodeAssistant)||r&&!0)}},653322:function(e,t,n){n.d(t,{useEmitInputInit:function(){return l}});var i=n(713738),r=n(251913),u=n(831566);let l=e=>{let t=(0,i.useCallback)((0,r.default)(()=>{u.DeprecatedChatEvent.emit("chat.chatInput.init")}),[]);(0,i.useEffect)(()=>{e||setTimeout(t)},[e,t])}},857200:function(e,t,n){n.d(t,{ExitSkillScene:function(){return h.ExitSkillScene},TOOL_BUTTON_SMALL_BREAK_POINT:function(){return p.TOOL_BUTTON_SMALL_BREAK_POINT},getDisplaySkills:function(){return o.getDisplaySkills},trackExitSkill:function(){return h.trackExitSkill},useActiveSkill:function(){return o.useActiveSkill},useActiveSkillType:function(){return o.useActiveSkillType},useBotSendFileEnabled:function(){return s.useBotSendFileEnabled},useBotSendImageEnabled:function(){return s.useBotSendImageEnabled},useChatGuestLogin:function(){return S.useChatGuestLogin},useDisplaySkills:function(){return o.useDisplaySkills},useEmitInputInit:function(){return m.useEmitInputInit},useEnableCodeSkillRelate:function(){return s.useEnableCodeSkillRelate},useGuestInputInteract:function(){return S.useGuestInputInteract},useGuestInteract:function(){return S.useGuestInteract},useIsToolButtonSmall:function(){return p.useIsToolButtonSmall},useNewChatInputAb:function(){return g.useNewChatInputAb},useOnEnterOrExitSkill:function(){return y},useOnSwitchConversation:function(){return _},useOpenPdfImmersive:function(){return v.useOpenPdfImmersive},useOpenReadCanvas:function(){return f.useOpenReadCanvas},useSendAttachmentsStatus:function(){return c.useSendAttachmentsStatus},useSendMessageButtonText:function(){return d.useSendMessageButtonText}});var i=n(713738),r=n(918952),u=n(698392),l=n(230932),a=n(781313),o=n(44502),s=n(783147),c=n(847448),d=n(407727),f=n(169737),v=n(275821),p=n(644143),S=n(10597),g=n(242315),m=n(653322),h=n(588549);function _(e){let t=(0,u.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId}),n=(0,i.useRef)("");(0,i.useEffect)(()=>{var i;if(!t)return;let{localConversationMap:u,conversationMap:o}=l.useFeedStore.getState(),s=u[n.current||""]||o[n.current||""];if((0,a.isLocalConversation)(n.current)&&(null==s?void 0:null===(i=s.local)||void 0===i?void 0:i.createStatus)===r.CreateConversationStatus.Done){n.current=t;return}e(n.current||"",t),n.current=t},[t])}function y(e){let t=(0,u.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId}),n=(0,o.useActiveSkillType)(t||""),r=(0,i.useRef)(void 0);(0,i.useEffect)(()=>{t&&(r.current||n)&&(r.current!==n&&e(r.current,n),r.current=n)},[n])}},242315:function(e,t,n){n.d(t,{useNewChatInputAb:function(){return c}});var i=n(4137),r=n(23226),u=n(971857),l=n(102249),a=n(7625),o=n(992847),s=n(524129);let c=function(){let{chatId:e,chatType:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="true",c=(0,l.useFGValue)(a.FGLocalDebugKeys.newChatInput,{defaultValue:void 0,source:o.FGBuiltinNames.debugStorage}),d="true"===(c||n),f=(0,u.useIsSamantha)(e||"",t),v=(0,r.useGuidanceActiveSkillIdentifier)(),p=[s.SkillType.WriteAssistant,s.SkillType.ImageGeneration,s.SkillType.Search,s.SkillType.CodeAssistant].includes(v);return{isNewChatInput:d,isNewChatInputInChat:d&&f&&(!v||p),loading:(0,i.default)(c)&&(0,i.default)(n)&&f&&(!v||p)}}},407727:function(e,t,n){n.d(t,{useSendMessageButtonText:function(){return u}});var i=n(713738),r=n(915299);let u=e=>{let{showUltraLongText:t}=e,n=(0,r.useTranslateFn)();return(0,i.useMemo)(()=>{if(t)return n("skill_copliotreading_btn_2M")},[t])}},644143:function(e,t,n){n.d(t,{TOOL_BUTTON_SMALL_BREAK_POINT:function(){return a},useIsToolButtonSmall:function(){return s}});var i=n(713738),r=n(4137),u=n(863733),l=n(792642);let a=480,o=!1,s=()=>{var e;let t=(0,l.useIsNarrowScreen)(),n=(0,i.useRef)(null),s=null===(e=(0,u.default)(n))||void 0===e?void 0:e.width,c=t||((0,r.default)(s)||0===s?o:s<a);return o=c,{isToolButtonSmall:c,inputWidthDivRef:n}}},275821:function(e,t,n){n.d(t,{useOpenPdfImmersive:function(){return h}});var i=n(217957),r=n(845647),u=n(57392),l=n(666196),a=n(83990),o=n(637319),s=n(698392),c=n(721118),d=n(230932),f=n(212183),v=n(604278),p=n(777422),S=n(524129);let g=async e=>e?e.startsWith("local_")?new Promise(t=>{let n=!0,i=!1,u=()=>{n&&(a(),n=!1,i||clearTimeout(o))},l=e=>{u(),t(e)},a=(0,s.getChatStore)("chatViewCoreStore").subscribe(t=>{let{currentChatViewConfig:n}=t;if(!n)return;let{chatType:i,chatId:u,chatKey:a}=n;i===r.ChatType.Conversation&&(a&&a===e?l(u):l(null))}),o=window.setTimeout(()=>{i=!0,l(null)},6e4)}):e:null,m=async e=>{let t=await g(e);return!!t&&new Promise(e=>{let n=!0,r=!1,u=()=>{n&&(s(),n=!1,r||clearTimeout(c))},l=t=>{u(),e(t)},s=a.useMessageStore.subscribe(e=>{var n,r;let u=(0,o.getLastStreamingMessageSelector)(e,t);!(0,i.default)(null==u?void 0:u.verbose)&&l(Number(null==u?void 0:null===(r=u.verbose)||void 0===r?void 0:null===(n=r.agent_to_skill)||void 0===n?void 0:n.skill_type)===S.SkillType.ReadPDF)}),c=window.setTimeout(()=>{r=!0,l(!1)},6e4)})},h=function(){let{chatViewConfig:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,l.useChatService)("chatViewService"),n=t=>{let{chatId:n}=null!=e?e:{},i=(0,c.conversationSelector)(d.useFeedStore.getState(),n);(0,p.trackEvent)("copilot_button_click",{bot_id:(0,f.getBotIdByConversationId)(n),conversation_type:null==i?void 0:i.conversation_type,conversation_id:n,collection_id:null==t?void 0:t.collectionId,message_id:null==t?void 0:t.messageId,entrance_type:null==t?void 0:t.entranceType})};return{onAfterOpenFile:n,openFileByKey:(i,r,l,a,o)=>{let{pdf:s={},messageId:c,openFrom:d,delayToIntension:f=!1}=l||{},v=async()=>{let{anchorPage:r,highlightArea:l,assetList:v,realFileKey:p,fileName:S}=s;(!f||await m(null==e?void 0:e.chatId))&&(t.openCanvasPanel({conversationId:(null==e?void 0:e.chatId)||"",messageId:c||"",readContent:{pdfId:i,realFileKey:null!=p?p:i,pdfName:S,assetList:v,pdfAnchorConfig:{page:r,areas:l},teaCtx:a,openFrom:d},canvasLayoutState:u.CanvasLayoutState.CANVAS_ONLY},o),n(a))};if("PDF"===r)return v(),!1},openFileByLink:(i,r,l,a)=>{let{attchmentType:o,pdf:s={},messageId:c,openFrom:d,delayToIntension:f=!1}=r||{},p=async()=>{let{anchorPage:r,highlightArea:o,assetList:p,realFileKey:S}=s;(!f||await m(null==e?void 0:e.chatId))&&(i=(0,v.tryChangeToPDFlink)(i),t.openCanvasPanel({conversationId:(null==e?void 0:e.chatId)||"",messageId:c||"",readContent:{pdfUrl:i,pdfName:i,realFileKey:null!=S?S:i,assetList:p,pdfAnchorConfig:{page:r,areas:o},teaCtx:l,openFrom:d},canvasLayoutState:u.CanvasLayoutState.CANVAS_ONLY},a),n(l))};if("pdf"===o)return p(),!1}}}},169737:function(e,t,n){n.d(t,{useOpenReadCanvas:function(){return c}});var i=n(698392),r=n(883393),u=n(457251),l=n(250357),a=n(297547),o=n(949932),s=n(275821);let c=e=>{let{attachmentStates:t,openFrom:n}=e,c="sm"===(0,r.useAppSizeType)({sm:800,md:1200}),d=(0,i.useChatSlice)("chatViewCoreStore",e=>e.currentChatViewConfig),{openFileByKey:f,openFileByLink:v}=(0,s.useOpenPdfImmersive)({chatViewConfig:d});return{openReadCanvas:(0,a.default)(async e=>{if(c)return;let i=t[0];if(!i)return;let r=(null==e?void 0:e.skillType)?{skillType:e.skillType}:{};if(["file","remote"].includes(i.type)){let{fileKey:t}=i,l=(0,o.getFileType)((0,o.getFileExt)(i.fileName));if("Document"===l){let e=await (0,u.getDocPdfKey)(t);e&&(t=e,l="PDF")}"PDF"===l&&f(t,l,{pdf:{fileName:i.fileName,realFileKey:i.fileKey},openFrom:(null==e?void 0:e.openFrom)||n,delayToIntension:!0},r)}else"link"===i.type&&i.url&&await (0,l.checkIsPDFLink)(i.url)&&v(i.url,{attchmentType:"pdf",openFrom:(null==e?void 0:e.openFrom)||n,delayToIntension:!0},r)})}}}}]);
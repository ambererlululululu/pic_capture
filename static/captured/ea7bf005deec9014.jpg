"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["41188"],{167838:function(e,t,l){l.d(t,{default:function(){return i}}),l(713738);var n=l(430261),a=l(345660),i=(0,n.IconFactory)((0,a.jsx)(e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"currentColor",d:"M7.707 21.707a1 1 0 0 1 0-1.414L16 12 7.707 3.707a1 1 0 0 1 1.414-1.414l8.293 8.293a2 2 0 0 1 0 2.828l-8.293 8.293a1 1 0 0 1-1.414 0"})}),{}))},962406:function(e,t,l){l.d(t,{default:function(){return i}}),l(713738);var n=l(430261),a=l(345660),i=(0,n.IconFactory)((0,a.jsx)(e=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,a.jsx)("path",{fill:"url(#icon_filetype_doc_small_svg__a)",d:"M3.283 2.42C3 2.976 3 3.704 3 5.16v13.68c0 1.456 0 2.184.283 2.74a2.6 2.6 0 0 0 1.137 1.137C4.976 23 5.704 23 7.16 23h9.68c1.456 0 2.184 0 2.74-.283a2.6 2.6 0 0 0 1.137-1.137c.283-.556.283-1.284.283-2.74V7l-6-6H7.16c-1.456 0-2.184 0-2.74.283A2.6 2.6 0 0 0 3.283 2.42"}),(0,a.jsx)("path",{fill:"#fff",fillOpacity:.55,d:"m15 1 6 6h-1.84c-1.456 0-2.184 0-2.74-.283a2.6 2.6 0 0 1-1.137-1.137C15 5.024 15 4.296 15 2.84z"}),(0,a.jsx)("path",{fill:"#19205A",d:"M7.515 9.172a.402.402 0 0 0-.386.511l2 7.06a.4.4 0 0 0 .386.293h.868c.182 0 .34-.122.388-.298l1.233-4.56 1.224 4.56a.4.4 0 0 0 .388.297h.869c.18 0 .338-.119.386-.292l2-7.06a.4.4 0 0 0-.387-.511h-.87a.4.4 0 0 0-.39.301l-1.184 4.58-1.223-4.583a.4.4 0 0 0-.388-.298h-.849a.4.4 0 0 0-.388.298l-1.231 4.588-1.186-4.585a.4.4 0 0 0-.389-.301z"}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"icon_filetype_doc_small_svg__a",x1:21,x2:-.444,y1:23,y2:18.867,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#44ADFE"}),(0,a.jsx)("stop",{offset:1,stopColor:"#5580FF"})]})})]}),{}))},979776:function(e,t,l){l.d(t,{default:function(){return i}}),l(713738);var n=l(430261),a=l(345660),i=(0,n.IconFactory)((0,a.jsx)(e=>(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,a.jsx)("path",{fill:"url(#icon_filetype_pdf_small_svg__a)",fillRule:"evenodd",d:"M3.283 2.42C3 2.976 3 3.704 3 5.16v13.68c0 1.456 0 2.184.283 2.74a2.6 2.6 0 0 0 1.137 1.137C4.976 23 5.704 23 7.16 23h9.68c1.456 0 2.184 0 2.74-.283a2.6 2.6 0 0 0 1.137-1.137c.283-.556.283-1.284.283-2.74V7l-6-6H7.16c-1.456 0-2.184 0-2.74.283A2.6 2.6 0 0 0 3.283 2.42",clipRule:"evenodd"}),(0,a.jsx)("path",{fill:"#fff",fillOpacity:.55,d:"m15 1 6 6h-1.84c-1.456 0-2.184 0-2.74-.283a2.6 2.6 0 0 1-1.137-1.137C15 5.024 15 4.296 15 2.84z"}),(0,a.jsx)("path",{fill:"#5A150F",d:"M16.115 15.97a3.8 3.8 0 0 1-2.2-.891 21.3 21.3 0 0 0-3.538 1.13c-.922 1.635-1.784 2.467-2.527 2.467-.149 0-.327-.03-.446-.119a.88.88 0 0 1-.506-.802c0-.268.06-1.011 2.884-2.23a21 21 0 0 0 1.576-3.687c-.357-.713-1.13-2.467-.595-3.36.179-.326.535-.505.922-.475.297 0 .595.149.773.387.386.535.357 1.665-.149 3.33a9 9 0 0 0 1.844 2.378c.624-.12 1.248-.208 1.873-.208 1.397.03 1.605.683 1.575 1.07 0 1.01-.98 1.01-1.486 1.01M7.79 17.815l.09-.03c.416-.148.743-.446.98-.832a2.35 2.35 0 0 0-1.07.862m3.954-8.919h-.089c-.03 0-.089 0-.119.03-.119.505-.03 1.04.179 1.516a2.5 2.5 0 0 0 .03-1.546m.209 4.31-.03.06-.03-.03a25 25 0 0 1-.892 2.022l.06-.03v.06a17 17 0 0 1 2.021-.595l-.03-.03h.09a9 9 0 0 1-1.19-1.456m4.043 1.577c-.268 0-.506 0-.773.059.297.149.594.208.892.238.208.03.416 0 .594-.06 0-.089-.119-.237-.713-.237"}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"icon_filetype_pdf_small_svg__a",x1:21,x2:-.444,y1:23,y2:18.867,gradientUnits:"userSpaceOnUse",children:[(0,a.jsx)("stop",{stopColor:"#EE5872"}),(0,a.jsx)("stop",{offset:1,stopColor:"#FF7033"})]})})]}),{}))},979067:function(e,t,l){l.d(t,{getFilenameByKeyFromMessage:function(){return h},useImmersiveReadingFromMessage:function(){return x}});var n=l(865607),a=l(95569),i=l(101874),o=l(629006),r=l(674157),s=l(83990),c=l(637319),d=l(698392),u=l(250357),f=l(524129),v=l(722038),p=l(949932),m=l(96014);let _=e=>{let{attachments:t=[]}=e,l=t.filter(e=>"PDF"===(0,p.getFileType)((0,p.getFileExt)(e.name||""))&&e.file_review_state!==v.ReviewState.ReviewState_NotCompliant&&e.file_parse_state!==v.ParseState.ParseState_Failed).map(e=>({file_name:e.name||"",key:e.key||""}));if(!(l.length>1))return l},h=(e,t)=>{let{attachments:l=[]}=t;return l.filter(t=>e===t.key&&t.file_review_state!==v.ReviewState.ReviewState_NotCompliant&&t.file_parse_state!==v.ParseState.ParseState_Failed).map(e=>({file_name:e.name||"",key:e.key||""}))},g=e=>{var t;let{attachments:l=[]}=e;return null===(t=l.filter(e=>e.type===i.AttachmentEnum.Link)[0])||void 0===t?void 0:t.url},x=e=>{let{message:t}=e,l=(0,d.useChatSlice)("chatViewCanvasStore",e=>e.isExpand&&("read-preview"===e.matchedCanvasPluginIdentifier||e.matchedCanvasPluginIdentifier===m.ReadPreviewCanvasPluginIdentifier)),{isValid:i,pdfFile:v,pdfLink:p,skillTypeTrack:h}=(0,s.useMessageStore)(e=>{var l,n,i,s;let d=(0,o.isMessageHitRisk)(t),{reply_id:u}=null!=t?t:{},v=u?(0,c.getMessageSelector)(e,t.conversation_id||"",{isLocalMessage:!1,messageId:u}):null,p=null!==(i=v&&(0,a.default)(_(v)))&&void 0!==i?i:null,m=null!==(s=v&&g(v))&&void 0!==s?s:null,h=null==t?void 0:null===(l=t.skill)||void 0===l?void 0:l.skill_type;return{isValid:(h===f.SkillType.ReadPDF||h===f.SkillType.Default)&&!d&&!(0,o.isSendMessage)(t)&&(0,o.isWiderTextMessage)(t)&&(0,r.isMessageFinished)(t)&&!(0,o.isWriteArtifactMessage)(t)&&!!(p||m),pdfFile:p,pdfLink:m,skillTypeTrack:null==v?void 0:null===(n=v.skill)||void 0===n?void 0:n.skill_type_no_default}},n.shallow),x=(0,u.useIsPDFLink)(p||"");return{isValid:i&&(!p||x)&&!l,pdfFile:v,pdfLink:p,skillTypeTrack:h}}},25292:function(e,t,l){l.d(t,{useDocumentRefInsertElements:function(){return Z}});var n=l(748645),a=l(302958),i=l(486677),o=l(848095),r=l(853949),s=l(557298),c=l(828438),d=l(713738),u=l(217957),f=l(348339),v=l(114999),p=l(777210),m=l(250357),_=l(457251),h=l(949932),g=l(979776),x=l(962406),y=l(569648),w=l(865607),k=l(95569),F=l(913821),S=l(436114),C=l(812650),j=l.n(C),b=l(83990),$=l(637319),I=l(915299),R=l(712980),O=l(978529),E=l(837921),M=l(910214),N=l(231149),P=l(178230);let T=e=>{let{pdfId:t,pdfUrl:l}=e;return(0,N.default)(async()=>{let{data:e={}}=await M.samanthaApiService.GetPDFOcr({file_key:t,url:l,start_page:0,end_page:300}),{status:n}=e;if("success"===n)return e.pdf_content;throw Error(`status: ${n}`)},{cacheKey:`document_ref_load_ocr_data:${t||l}`,staleTime:6e4,onError:e=>{P.logger.persist.info({eventName:"flow_pdf_page_anchor_ocr",error:e})}})};var L=l(979067),D={input:"input-RURtur",body:"body-KK84lq",flash:"flash-Qa3UyU"},A=l(345660);let V=()=>(0,A.jsx)("div",{className:"flex flex-col gap-12 w-full",children:Array.from({length:8}).map((e,t)=>(0,A.jsx)("div",{className:j()(D.input,D.flash)},t))}),B=e=>{let{message:t,clickable:l,onClick:n,documentRefMetaInfoData:a}=e,i=(0,I.useTranslateFn)(),{file_key:o,url:r}=a,{filename:s}=(0,b.useMessageStore)(e=>{if(r)return{filename:r};if(!t||!o)return{filename:""};let{message:l}=(0,$.findLastMessageSelector)(e,t.conversation_id||"",e=>{let{getMessage:t}=e,l=t();if(l){let e=(0,L.getFilenameByKeyFromMessage)(o,l);return!!(e&&e.length>0)}return!1}),n=l&&(0,k.default)((0,L.getFilenameByKeyFromMessage)(o,l));return{filename:(null==n?void 0:n.file_name)||""}},w.shallow),{loading:c,data:u}=T({pdfId:o,pdfUrl:r||""}),f=(0,d.useMemo)(()=>{var e;if(!u||!a)return null;let t=u.find(e=>Number(e.page_id)+1===a.page),l=null==t?void 0:null===(e=t.text_blocks)||void 0===e?void 0:e.find(e=>{var t,l,n,i;return(0,F.default)([null===(t=e.norm_box)||void 0===t?void 0:t.x0,null===(l=e.norm_box)||void 0===l?void 0:l.y0,null===(n=e.norm_box)||void 0===n?void 0:n.x1,null===(i=e.norm_box)||void 0===i?void 0:i.y1],a.bbox)});return l||null},[u,a]);return l?(0,A.jsxs)("div",{className:j()("p-16 pb-12",{"cursor-pointer":l}),onClick:l?n:S.default,children:[(0,A.jsxs)("div",{className:j()("flex items-center s-font-xxs text-s-color-text-tertiary"),children:[r&&(0,R.isValidUrl)(r.trim(),{allowedProtocols:["https:"],allowedExtensions:["doc","docx"]})||"Document"===(0,h.getFileType)((0,h.getFileExt)(s))?(0,A.jsx)(x.default,{}):(0,A.jsx)(g.default,{}),(0,A.jsx)("span",{className:"grow ml-6 mr-4 truncate",children:s}),(0,A.jsx)("span",{className:"mr-4 shrink-0",children:i("skill_copliotreading_go_to_source")}),(0,A.jsx)(y.default,{className:"text-16 p-2 text-s-color-text-primary"})]}),c?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.default,{className:"!my-12"}),(0,A.jsx)(V,{})]}):(null==f?void 0:f.text)?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(O.default,{className:"!my-12"}),(0,A.jsx)("div",{className:j()("line-clamp-15 max-h-300 text-s-color-text-secondary",D.body),style:{"--base-font-size":"14px","--base-font-weight":f.is_bold?"bold":"normal","--base-font-style":f.is_italic?"italic":"normal"},children:null==f?void 0:f.text})]}):null]}):null},W=e=>{let{message:t,clickable:l,onClick:n,documentRefMetaInfoData:a,getPopupContainer:i,children:o}=e,[r,s]=(0,d.useState)(!1),c=p.messageServiceContainer.get("chatTeaService",!0),u=p.messageServiceContainer.get("chatViewService");return(0,d.useEffect)(()=>{r&&(null==c||c.trackEvent("reference_card_show",{enter_from:(null==u?void 0:u.exactImmersiveMode)?"copilot":"chat",collection_id:a.file_key||a.url||""}))},[r]),(0,A.jsx)(E.default,{className:"rounded-12 w-300",autoAdjustOverflow:!0,mouseEnterDelay:200,mouseLeaveDelay:200,spacing:10,content:(0,A.jsx)(B,{message:t,clickable:!!l,onClick:()=>null==n?void 0:n(),documentRefMetaInfoData:a}),getPopupContainer:i,clickToHide:!0,onVisibleChange:e=>s(e),children:null==o?void 0:o(r)})},K=e=>e.page,U=e=>e?{background:"var(--s-color-brand-primary-hover, #004ad9)",color:"var(--s-color-text-invert-primary, #fff) !important"}:{},H=e=>{let{value:t,content:l,message:n,viewOnly:a=!1,options:i}=e,o=p.messageServiceContainer.get("chatTeaService",!0),r=p.messageServiceContainer.get("chatViewService"),{message_id:g}=null!=n?n:{},{onOpenFileByKey:x,onOpenFileByLink:y}=(0,f.useOnOpenFile)(),w=t&&K(t),k=(0,m.useIsPDFLink)((null==t?void 0:t.url)||""),F=async()=>{var e;if(!t)return;let l=(null==n?void 0:null===(e=n.skill)||void 0===e?void 0:e.skill_type_no_default)||null,{file_key:a,url:i}=t,c={messageId:g,pdf:{anchorPage:w,highlightArea:[{page:null!=w?w:0,area:t.bbox,scrollIntoView:!0}]},openFrom:"click_anchor_point"};if(null==o||o.trackEvent("reference_card_click",{enter_from:(null==r?void 0:r.exactImmersiveMode)?"copilot":"chat",collection_id:a||i||""}),a){let e=a;try{if("Document"===(0,h.getFileType)((0,h.getFileExt)(a))){let t=await (0,_.getDocPdfKey)(a);t&&(e=t)}}finally{null==x||x(e,"PDF",c,{messageId:g,skillType:l,entranceType:"click_ai_anchor_point",collectionId:a})}}else if(i){if(!k){window.open((0,s.filterUrlModule)(i,null,{logType:"js.window.location",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"flow_web",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!0,escapeRule:"escape-report",reportUrl:"https://mon.zijieapi.com/monitor_browser/collect/batch/security/?bid=flow_web",scmBranch:"release_train_samantha_2025-10-14_552097",scmName:"$20xN*Rt%j$P$E5h$jBsMldr-z$N$mx0%m5aWldFcH$aRmhO%FE9PQ",scmVersion:"1.0.5.6233",webpackPluginVersion:"3.4.5",filename:"$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1scHpZak5qZ*xwd*$IWmtl$E$6$2xkSmRHSlhPWFZpTTBwc1kw-zRkb%5I%m1waE1rWn$Xb*hOZ*xSR$R-%lNi$lpvWk$o$2$WcFRP$2xr$0%1d1ltM$dlb%41T1hOaF-wbDBX$Epv-%dSRE1Xb*hXRzkwWTIx$2F*cERPWHBq-l%xMld%ST$kR05IT1hW-$Z6$XdZM2s1-TJJe$RqRmlWM$oxWk$Ne*$WcFhXWFpo$npWcldsa*5k$1JJ$*pSWldFcH$aRmhO%FE9PQ"}));return}null==y||y(i,{...c,attchmentType:k?"pdf":"unknown"},{messageId:g,skillType:l,entranceType:"click_ai_anchor_point",collectionId:a})}},[S,C]=(0,c.useInView)({triggerOnce:!0,initialInView:!1,threshold:1});(0,d.useEffect)(()=>{C&&(null==o||o.trackEvent("show_immersiveread_anchor_point",{collection_id:(null==t?void 0:t.file_key)||(null==t?void 0:t.url),number:w}))},[C]);let j=w&&!a;return(0,A.jsx)(A.Fragment,{children:t&&!(0,u.default)(w)&&(0,A.jsx)(W,{documentRefMetaInfoData:t,message:n,onClick:F,clickable:!!j,getPopupContainer:null==i?void 0:i.getPopupContainer,children:e=>(0,A.jsx)(v.RefContentCircle,{ref:S,page:l,style:U(e),onClick:j?()=>{F(),null==o||o.trackEvent("click_immersiveread_anchor_point",{collection_id:(null==t?void 0:t.file_key)||(null==t?void 0:t.url),number:w})}:void 0})})})},z=(e,t)=>t.map(t=>{let{data:l}=t;return{...t,data:{...l,index:(0,o.convertUnicodeIndexToStringIndex)(e,l.index)}}}),J=e=>{let t=e.map(e=>e.data),l=(0,n.default)(t,["page","index"]),a=1;return l.reduce((e,t)=>{var l;let n=null===(l=t.bbox)||void 0===l?void 0:l.toString();return n&&!e[n]&&(e[n]=a,a++),e},{})},Z=e=>{let{messageText:t,metaInfos:l,message:o,viewOnly:s,options:c}=e,d=z(t,l.filter(r.isDocumentRefMetaInfo)),u=(0,a.default)(d,e=>e.data.index),f=[],v=J(d);for(let[e,t]of(0,i.default)(u)){let l=[];for(let[a,i]of Object.entries((0,n.default)(t,e=>Number(e.data.page)).slice(0,4))){var p;l.push((0,A.jsx)(H,{value:i.data,content:v[null===(p=i.data.bbox)||void 0===p?void 0:p.toString()]||1,message:o,viewOnly:s,options:c},`${e}/${a}`))}f.push({range:Number(e),render:()=>(0,A.jsx)("span",{children:l})})}return f}},853949:function(e,t,l){l.d(t,{isDocumentRefMetaInfo:function(){return a}});var n=l(458524);let a=e=>e.type===n.MetaType.DocumentRef},348339:function(e,t,l){l.d(t,{useOnOpenFile:function(){return _},OpenFileContext:function(){return p},OpenFileProvider:function(){return m}});var n=l(713738),a=l(57392),i=l(666196),o=l(698392),r=l(721118),s=l(230932),c=l(212183),d=l(604278),u=l(777422);let f=()=>{let e=(0,i.useChatService)("chatViewService");return{onOpenCodeFile:(t,l)=>{let{messageId:n,conversationId:i,fileKey:o,attachments:r,isCodeFile:s,chatId:c,teaCtx:d}=t;e.openCanvasPanel({messageId:n,conversationId:i,canvasLayoutState:a.CanvasLayoutState.CANVAS_ONLY,fileKey:o,attachments:r,isCodeFile:s,chatId:c,teaCtx:d},l)}}};var v=l(345660);let p=(0,n.createContext)(null),m=e=>{let{children:t,...l}=e;return(0,v.jsx)(p.Provider,{value:l,children:t})},_=function(){let{enableOpenCanvas:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,o.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId}),{onOpenCodeFile:l}=f(),v=(0,n.useContext)(p),m=(0,i.useChatService)("chatViewService"),_=e=>{let l=(0,r.conversationSelector)(s.useFeedStore.getState(),t);(0,u.trackEvent)("copilot_button_click",{bot_id:(0,c.getBotIdByConversationId)(t),conversation_type:null==l?void 0:l.conversation_type,conversation_id:t,collection_id:null==e?void 0:e.collectionId,message_id:null==e?void 0:e.messageId,entrance_type:null==e?void 0:e.entranceType})};return{onAfterOpenFile:_,onOpenFileByKey:(l,n,i,o,r)=>{if(null==v?void 0:v.onOpenFileByKey)return v.onOpenFileByKey(l,n,i,o,r);let{pdf:s={},messageId:c,openFrom:d,fileName:u}=i||{};if("video"===n||"audio"===n)return m.openCanvasPanel({conversationId:t||"",messageId:c||"",mediaInfo:{type:n,title:u,vid:l},canvasLayoutState:a.CanvasLayoutState.CANVAS_ONLY},r),!1;if("PDF"===n&&e){let{anchorPage:e,highlightArea:n,assetList:i,realFileKey:u,fileName:f}=s;return m.openCanvasPanel({conversationId:t||"",messageId:c||"",readContent:{pdfId:l,realFileKey:null!=u?u:l,pdfName:f,assetList:i,pdfAnchorConfig:{page:e,areas:n},teaCtx:o,openFrom:d},canvasLayoutState:a.CanvasLayoutState.CANVAS_ONLY},r),_(o),!1}},onOpenFileByLink:(l,n,i,o)=>{if(null==v?void 0:v.onOpenFileByLink)return v.onOpenFileByLink(l,n,i,o);let{attchmentType:r,pdf:s={},messageId:c,openFrom:u}=n||{};if("pdf"===r&&e){let{anchorPage:e,highlightArea:n,assetList:r,realFileKey:f}=s;return l=(0,d.tryChangeToPDFlink)(l),m.openCanvasPanel({conversationId:t||"",messageId:c||"",readContent:{pdfUrl:l,pdfName:l,realFileKey:null!=f?f:l,assetList:r,pdfAnchorConfig:{page:e,areas:n},teaCtx:i,openFrom:u},canvasLayoutState:a.CanvasLayoutState.CANVAS_ONLY},o),_(i),!1}},onOpenCodeFile:(t,n)=>{e&&l(t,n)}}}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["43850"],{967037:function(e,t,n){n.d(t,{zQ:function(){return r}});var o=n(817835),i=n(644367);let a=e=>{let t,{eventName:n,logger:a=i.k,meta:r,once:l=!1}=e,d=[],s=0,u=!1,v=()=>{s=Date.now(),a.persist.info({eventName:`${n}_start`,meta:{...c()}})},c=()=>({...r,...u?{event_has_finished:!0}:{}}),_=()=>{if(0!==d.length)return d.reduce((e,t,n)=>{let{pointName:i}=t;return e[i]=t.time-s,(0,o.Z)(e,["interval",i],0===n?e[i]:t.time-d[n-1].time),e},{})},m=function(){let{meta:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(!l||!u)&&(a.persist.success({eventName:n,meta:{...c(),success:1,duration:_(),...e}}),u=!0)},C=e=>{let{reason:t,error:o,meta:i}=e;(!l||!u)&&(a.persist.error({eventName:n,error:o||Error(t),meta:{...c(),success:0,reason:t,duration:_(),...i}}),u=!0)};return v(),{name:"ReportEvent",start:v,cancel:()=>{clearTimeout(t),u=!0},success:m,successIfIdle:(e,n,o)=>{clearTimeout(t),t=setTimeout(()=>u?void 0:(m(n),null==o?void 0:o()),e)},error:C,errorIfIdle:(e,n,o)=>{clearTimeout(t),t=setTimeout(()=>u?void 0:(C(n),null==o?void 0:o()),e)},addDurationPoint:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=arguments.length>2?arguments[2]:void 0,o=d.find(t=>t.pointName===e);o?(t&&(o.time=Date.now()),n&&(o.time=n)):d.push({pointName:e,time:n||Date.now()}),d.sort((e,t)=>e.time-t.time)},getDuration:_,getDurationTimestamp:()=>{if(0!==d.length)return d.reduce((e,t)=>{let{pointName:n}=t;return e[n]=t.time,e},{})},reportDurationPoint:function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],o=d.find(t=>t.pointName===e);(!t||null==o||!o.reported)&&(a.persist.info({eventName:`${n}_duration_${e}`,meta:{...c()}}),o&&(o.reported=!0))},getMeta:c,updateMeta:e=>{r={...r,...e}},getFinishStatus:()=>u,setStartTime:e=>{s=e}}},r=e=>{let{logger:t=i.k,...n}=e;return a({logger:t,...n})}},592333:function(e,t,n){var o,i,a,r,l,d,s,u;n.d(t,{J4:function(){return c},L6:function(){return C},UE:function(){return _},W8:function(){return v},dm:function(){return m},vS:function(){return p},ym:function(){return h},z_:function(){return f}});let v=((o={})[o.CreateConversation=1]="CreateConversation",o[o.ArchiveConversation=2]="ArchiveConversation",o),c=((i={})[i.subject=1]="subject",i[i.guest=2]="guest",i),_=((a={})[a.Choiceness=1]="Choiceness",a[a.Discovery=2]="Discovery",a[a.NotLogin=3]="NotLogin",a[a.ConversationPage=4]="ConversationPage",a[a.ImmersiveMode=5]="ImmersiveMode",a[a.ParticipantPage=6]="ParticipantPage",a[a.ConversationChatMode=7]="ConversationChatMode",a[a.CocoWebNotLogin=8]="CocoWebNotLogin",a[a.ConvRcmdToOldUser=9]="ConvRcmdToOldUser",a[a.ConvRcmdToOldUserReGen=10]="ConvRcmdToOldUserReGen",a),m=((r={})[r.User=0]="User",r[r.Coco=1]="Coco",r[r.GuanFang=2]="GuanFang",r[r.CocoWeb=3]="CocoWeb",r),C=((l={})[l.None=0]="None",l[l.Real=1]="Real",l[l.RealNone=2]="RealNone",l),h=((d={})[d.BIZ_UNKNOWN=0]="BIZ_UNKNOWN",d[d.BIZ_BOT_ICON=1]="BIZ_BOT_ICON",d[d.BIZ_PROFILE_ICON=2]="BIZ_PROFILE_ICON",d[d.BIZ_AUDIO=3]="BIZ_AUDIO",d[d.BIZ_VOICE_ICON=4]="BIZ_VOICE_ICON",d[d.BIZ_BOT_REF_BG_IMAGE_ORIGIN=5]="BIZ_BOT_REF_BG_IMAGE_ORIGIN",d[d.BIZ_BOT_REF_BG_IMAGE_CROP=6]="BIZ_BOT_REF_BG_IMAGE_CROP",d[d.BIZ_BOT_BG_IMAGE=7]="BIZ_BOT_BG_IMAGE",d),p=((s={})[s.Ask=0]="Ask",s[s.Once=1]="Once",s[s.Always=2]="Always",s),f=((u={})[u.Public=1]="Public",u[u.Private=2]="Private",u[u.Unlisted=3]="Unlisted",u)},636242:function(e,t,n){var o;n.d(t,{i1:function(){return i}});let i=((o={})[o.Coco=1]="Coco",o[o.Bot=2]="Bot",o[o.CocoSub=3]="CocoSub",o[o.CocoWeb=4]="CocoWeb",o[o.CocoWebSub=5]="CocoWebSub",o)},6590:function(e,t,n){var o,i;n.d(t,{Sw:function(){return r},wp:function(){return a}});let a=((o={})[o.Default=0]="Default",o[o.Writing=1]="Writing",o[o.ImageGen=2]="ImageGen",o[o.MeetingRecord=3]="MeetingRecord",o[o.AICode=4]="AICode",o[o.Mobile=5]="Mobile",o[o.DeepResearch=6]="DeepResearch",o),r=((i={})[i.Default=0]="Default",i[i.Landing=1]="Landing",i)},917157:function(e,t,n){n.d(t,{j:function(){return u}});var o=n(118200),i=n(251263),a=n(45469),r=n(93708),l=n(51679);let d=async()=>{let e=await new Promise(e=>(0,r.Wp)("launcherRawSettingStore").subscribe(e=>({status:e.settingStatus,data:e.settingData}),t=>{let{status:n,data:o}=t,a=setTimeout(()=>{e(void 0)},5e3);n===i.I.Success&&(clearTimeout(a),e(o))},{fireImmediately:!0}));return"true"===(0,o.Z)(e,"ab_config.ab_results.enable_im_platform")},s=async()=>{try{var e,t,n;let o=await l.mH.GetAB({ab_request:{enable_im_platform:{parmas:["enable_im_platform","value"],ignore_login_status:!0}}});return(null!==(n=null==o?void 0:null===(t=o.data)||void 0===t?void 0:null===(e=t.ab_results)||void 0===e?void 0:e.enable_im_platform)&&void 0!==n?n:"")==="true"}catch{return!1}},u=async()=>{if(function(){if("undefined"==typeof window)return null;let{pathname:e}=window.location;return e&&e.startsWith("/code")?a.Kq.Code:null}()===a.Kq.Code)return!0;try{return await d()}catch{return await s()}}},420262:function(e,t,n){n.d(t,{C:function(){return d}});var o=n(742470),i=n(455746),a=n(910157);let r=e=>{if(e!==o.zc.UNSPECIFIED&&void 0!==e)return e},l=(e,t)=>{if(e===o.$m.NORMAL){if(t===o.rJ.MessageStatus_AVAILABLE)return i.PushMessageStatus.Available;if(t===o.rJ.MessageStatus_UNSELECTED)return i.PushMessageStatus.Unselected;if(t===o.rJ.MessageStatus_NotCompliant)return i.PushMessageStatus.NotCompliant}return e===o.$m.INTERRUPT&&t===o.rJ.MessageStatus_AVAILABLE?i.PushMessageStatus.Broken:e===o.$m.CONTENT_IN_STREAMING&&t===o.rJ.MessageStatus_AVAILABLE?i.PushMessageStatus.Streaming:i.PushMessageStatus.InVisible},d=e=>{var t,n,d,s;return{bot_id:null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.bot_id,conversation_id:null==e?void 0:e.conversation_id,local_conversation_id:null==e?void 0:e.local_conversation_id,section_id:null==e?void 0:e.section_id,message_id:null==e?void 0:e.message_id,local_message_id:null==e?void 0:e.local_message_id,index:null==e?void 0:e.index_in_conv,sender:null==e?void 0:e.sender_id,sec_sender:null==e?void 0:e.sec_sender,reply_id:null==e?void 0:e.bot_reply_message_id,create_time:null==e?void 0:e.create_time,message_type:void 0,content_type:r(null==e?void 0:e.content_type),content:null==e?void 0:e.content,display_content:null==e?void 0:e.content,reference_info:(null==e?void 0:e.reference_info)?{...null==e?void 0:e.reference_info,content_type:r(null==e?void 0:null===(n=e.reference_info)||void 0===n?void 0:n.content_type)}:void 0,ext:null==e?void 0:e.ext,feedback:null==e?void 0:e.feedback_type,tts_content:null==e?void 0:e.tts_content,next_connection_type:i.ConnectionType.WebSocket,chunk_seq:void 0,is_delta:void 0,update_time:null==e?void 0:e.update_time,biz_content_key:null==e?void 0:e.biz_content_type,user_type:(null==e?void 0:e.user_type)===o.FW.USER_TYPE_UNKNOWN?void 0:null==e?void 0:e.user_type,token:null==e?void 0:e.token,content_block:null==e?void 0:e.content_block,status:l(null==e?void 0:e.content_status,null==e?void 0:e.status),meta_infos:(null==e?void 0:null===(d=e.ext)||void 0===d?void 0:d.meta_info)?(0,a.R)(null==e?void 0:null===(s=e.ext)||void 0===s?void 0:s.meta_info,[]):void 0}}},603184:function(e,t,n){n.r(t),n.d(t,{imGatewayClient:function(){return r},initImGateway:function(){return a}});var o=n(673895);let i={getCommonParams:()=>({}),getCommonHeaders:()=>({}),httpClient:o.httpClient},a=e=>{i.getCommonParams=e.getCommonParams,i.getCommonHeaders=e.getCommonHeaders,i.httpClient=e.httpClient||o.httpClient,e.baseURL&&(i.baseURL=e.baseURL)},r=(e,t)=>{let{url:n,method:a,data:r,params:l,headers:d}=e;return(i.httpClient||o.httpClient)({url:i.baseURL?`${i.baseURL}${n}`:n,method:a,data:r,params:{...i.getCommonParams(),...l},headers:{...i.getCommonHeaders(),"Content-Type":"application/json; encoding=utf-8",...d}},t)}},372296:function(e,t,n){n.d(t,{A:function(){return i}});var o=n(411358);let i=e=>({...e,sequence_id:(0,o.Z)(),channel:2,version:"1"})},144245:function(e,t,n){n.d(t,{B:function(){return o}});function o(){let e={service:null};return{get(t,n){var o,i;let a=null===(i=e.service)||void 0===i?void 0:null===(o=i.ctx)||void 0===o?void 0:o[t];if(!a&&!n)throw Error(`target service [${t}] not found`);return a},get service(){return e.service},set service(service){e.service=service}}}},291375:function(e,t,n){var o,i;n.d(t,{ns:function(){return a},t2:function(){return r}});let a=((o={}).Pending="Pending",o.Creating="Creating",o.Done="Done",o.Failed="Failed",o),r=((i={}).ReachLimit="reach_limit",i)},151558:function(e,t,n){n.d(t,{SK:function(){return o}});var o={IMCMD_NOT_USED:0,IMCMD_COMMON:10,SEND_MESSAGE:100,SEND_MESSAGE_LIST:110,APP_ACTION:120,MATERIAL_UPLOAD:150,NEW_MSG_NOTIFY:200,FETCH_CHUNK_MESSAGE:300,CHUNK_UPDATE:310,SUMMON_BOT:400,PUll_CHAIN_MESSAGE:3e3,PULL_SINGLE_CHAIN:3100,BATCH_PULL_SINGLE_CHAIN:3101,PULL_RECENT_CONV_CHAIN:3200,PULL_CMD_CHAIN:3300,MARK_CONVERSATION_READ:2100,CLEAR_MSG_CONTEXT:2101,CLEAR_MSG_HISTORY:2202,BATCH_UPDATE_MSG_STATUS:2210,UPDATE_MSG_CONTENT:2211,FEEDBACK_MSG:2220,REGENERATE_MSG:2230,FIX_REGENERATE_MSG:2231,SWITCH_REGENERATE_MSG:2232,BREAK_MSG:2240,RETRY_BOT_REPLY_MSG:2250,CHECK_MESSAGE_SEND_RATE_LIMIT:2260,MULTI_PUT_MESSAGE_IN:2300,MULTI_PUT_MESSAGE_OUT:2310,LOCAL_MESSAGE_SYNC:2400,SYNC_UPDATE_MSG_INFO:2500,CREATE_CONVERSATION:1100,GET_CONVERSATION_INFO:1110,BATCH_GET_CONVERSATION_INFO:1111,OPERATE_CONVERSATION:1120,DELETE_USER_CONVERSATION:1121,DISSOLVE_CONVERSATION:1122,UPDATE_CONVERSATION:1123,CONVERSATION_AUTO_GEN:1130,ADD_CONVERSATION_PARTICIPANT:4100,DEL_CONVERSATION_PARTICIPANT:4110,DELETE_CONVERSATION_PARTICIPANT:4111,GET_CONVERSATION_PARTICIPANT:4120,UPDATE_CONVERSATION_NAME:4150,BATCH_GET_CONVERSATION_PARTICIPANTS:4160,UPDATE_CONVERSATION_PARTICIPANT:4170,BATCH_DELETE_USER_CONVERSATION:4171,UPDATE_CONVERSATION_CREATE_SCENE:4172,OPERATE_CELL:4173,REPORT_CONSISTENCY_DATA:4174,COUNT_CONVERSATION:4176,CONVERSATION_OUT:4200,CONVERSATION_IN:4210,AUTO_SPEAK:4230,BATCH_VERIFY_CONVERSATION_CONSISTENCY:4240,UPDATE_SECTION:4300,UPDATE_CONVERSATION_PARTICIPANT_NOTIFY:50001,UPDATE_CONVERSATION_INFO_NOTIFY:50002,OPERATE_CONVERSATION_NOTIFY:50003,REFRESH_PARTICIPANT_INFO_NOTIFY:50004,UPDATE_CONVERSATION_NAME_NOTIFY:50005,CLEAR_MSG_CONTEXT_NOTIFY:50010,CLEAR_MSG_HISTORY_NOTIFY:50020,MARK_READ_NOTIFY:50030,RED_DOT_NOTIFY:50031,UPDATE_MSG_STATUS_NOTIFY:50040,SUGGEST_QUESTION_UPDATE_NOTIFY:50050,DELETE_USER_CONVERSATION_NOTIFY:50060,DELETE_PARTICIPANTS_NOTIFY:50062,FEEDBACK_MSG_NOTIFY:50070,PULL_MSG_NOTIFY:50080,FIX_REGENERATE_MSG_NOTIFY:50090,BREAK_STREAM_MSG_NOTIFY:50100,DISSOLVE_CONVERSATION_NOTIFY:50110,BOT_REPLY_LOADING_UPDATE_NOTIFY:50200,CANCEL_FOLLOW_NOTIFY:50300,REPLY_END:50400,UPDATE_MESSAGE_ATTR:50041,UPDATE_MSG:50042,OPEN_FULL_DUPLEX_Call:50500,UPDATE_SECTION_NOTIFY:50600,CELL_INFO_UPDATE:50700,OAUTH_RESULT:50800,USER_BAN:60001,USER_BAN_RELEASE:60002,USER_LOGOUT:60003,USER_CONFIG_UPDATE:60010,NEED_LOCATION:60020,USER_PENALTY_CHANGE_NOTIFY:80001,CONVERSATION_PENALTY_CHANGE_NOTIFY:80002,IN_APP_BANNER_NOTIFY:80004,SSE_HEARTBEAT:100001,SSE_ACK:100010,STREAM_MSG_NOTIFY:100011,STREAM_CHUNK:100012,FULL_MSG_NOTIFY:100013,SSE_REPLY_END:100005,STREAM_ERROR:100006,STREAM_TIMEOUT_CONTROL:100007,FETCH_STREAM:100008}},45469:function(e,t,n){n.d(t,{GZ:function(){return a},Kq:function(){return o},cJ:function(){return i}});var o={Code:0},i={Common:0,LoadingHistory:1},a={Default:0,CASE:1,Evaluate:2,BotToken:3,Samantha:4}},558882:function(e,t,n){n.d(t,{E:function(){return z}});var o=n(917157),i=n(327386),a=n(742470),r=n(51679),l=n(644367),d=n(420262),s=n(636242),u=n(592333),v=n(910157);let c=e=>{switch(e){case a.p1.COCO:return s.i1.Coco;case a.p1.BOT:return s.i1.Bot;case a.p1.COCO_SUB:return s.i1.CocoSub;default:return}},_=e=>{switch(e){case s.i1.Coco:return a.p1.COCO;case s.i1.Bot:return a.p1.BOT;case s.i1.CocoSub:return a.p1.COCO_SUB;default:return a.p1.BOT_TYPE_UNKNOWN}},m=e=>{switch(e){case a.dm.BotType_Unknown:return;case a.dm.BotType_User:return u.dm.User;case a.dm.BotType_Coco:return u.dm.Coco;case a.dm.BotType_GuanFang:return u.dm.GuanFang;case a.dm.BotType_CocoWeb:return u.dm.CocoWeb;default:return}},C=(e,t)=>{var n;if(e)return Object.assign({},e,{conversation_id:null==e?void 0:e.conversation_id,conversation_type:c(null==e?void 0:e.bot_type),message_cursor:null==e?void 0:e.msg_cursor,message_index:null==e?void 0:e.latest_index,cmd_index:void 0,last_section_id:null==e?void 0:e.last_section_id,icon_url:null==t?void 0:t.icon_url,name:null==e?void 0:e.name,bot_id:null==t?void 0:t.id,tags:"Doubao",local_conversation_id:null==e?void 0:e.local_conversation_id,update_time:null==e?void 0:e.update_time,deleted:null==e?void 0:e.is_deleted,pinned:null==e?void 0:e.pinned_time,icon_image:null==t?void 0:null===(n=t.icon_image)||void 0===n?void 0:n.raw_image,bot_creator_info:null==t?void 0:t.creator_info,read_message_index:null==e?void 0:e.last_read_index,conversation_page:void 0,retention_cursor:null==e?void 0:e.retention_cursor,bot_disable_tag:null==t?void 0:t.disabled_tag,bot_type:m(null==t?void 0:t.real_bot_type),bg_img_url:null==t?void 0:t.bg_img_url,bg_img_avg_hue:null==t?void 0:t.bg_img_avg_hue,bot_conversation_type:void 0,content_dist_type:void 0,default_onboarding:null==e?void 0:e.default_onboarding,extra:null==e?void 0:e.extra,badge_count:null==e?void 0:e.badge_count,read_badge_count:null==e?void 0:e.read_badge_count})},h=e=>e===a.z_.Public?u.z_.Public:e===a.z_.Private?u.z_.Private:e===a.z_.Unlisted?u.z_.Unlisted:void 0,p=e=>e===a.J4.BotMode_Subject?u.J4.subject:e===a.J4.BotMode_Guest?u.J4.guest:void 0,f=e=>e===a.W8.ArchiveConversation?u.W8.ArchiveConversation:e===a.W8.CreateConversation?u.W8.CreateConversation:void 0,g=e=>{var t,n,o,i,a,r,l,s,u,v,c,_,C,g,T;if(e)return{...e,bot_type:m(null==e?void 0:e.real_bot_type),icon_image:{uri:null==e?void 0:null===(t=e.icon_image)||void 0===t?void 0:t.key,tiny_url:null==e?void 0:null===(o=e.icon_image)||void 0===o?void 0:null===(n=o.image_thumb)||void 0===n?void 0:n.url,origin_url:null==e?void 0:null===(a=e.icon_image)||void 0===a?void 0:null===(i=a.image_ori)||void 0===i?void 0:i.url},creator_info:{...null==e?void 0:e.creator_info,creator_avatar:{uri:null==e?void 0:null===(l=e.creator_info)||void 0===l?void 0:null===(r=l.creator_avatar)||void 0===r?void 0:r.key,tiny_url:null==e?void 0:null===(v=e.creator_info)||void 0===v?void 0:null===(u=v.creator_avatar)||void 0===u?void 0:null===(s=u.image_thumb)||void 0===s?void 0:s.url,origin_url:null==e?void 0:null===(C=e.creator_info)||void 0===C?void 0:null===(_=C.creator_avatar)||void 0===_?void 0:null===(c=_.image_ori)||void 0===c?void 0:c.url}},private_status:h(null==e?void 0:e.private_status),onboarding:{...null==e?void 0:e.onboarding,message_list:null==e?void 0:null===(T=e.onboarding)||void 0===T?void 0:null===(g=T.message_list)||void 0===g?void 0:g.map(d.C)},bot_mode:p(null==e?void 0:e.bot_mode),action:(null==e?void 0:e.action)?{action_path:e.action.action_path,action_type:f(e.action.action_type)}:void 0,conversation_page:void 0}},T=e=>{var t,n;if(e)return{conversation_type:c(null==e?void 0:e.bot_type),conversation_id:null==e?void 0:e.conversation_id,message_cursor:null==e?void 0:e.user_msg_cursor,message_index:null==e?void 0:e.latest_index,cmd_index:void 0,last_section_id:null==e?void 0:e.last_section_id,icon_url:null==e?void 0:e.icon_url,name:null==e?void 0:e.name,bot_id:null==e?void 0:e.bot_id,tags:null==e?void 0:e.tags,update_time:null==e?void 0:e.update_time,pinned:!!(null==e?void 0:e.pinned_time),icon_image:(null==e?void 0:e.image)?{uri:e.image.key,tiny_url:null===(t=e.image.image_thumb)||void 0===t?void 0:t.url,origin_url:null===(n=e.image.image_ori)||void 0===n?void 0:n.url}:void 0,read_message_index:null==e?void 0:e.last_read_index,retention_cursor:void 0,bot_conversation_type:void 0,badge_count:null==e?void 0:e.badge_count,read_badge_count:null==e?void 0:e.read_badge_count}},I=e=>{var t,n,o,i;let a=null===(n=e.conversation)||void 0===n?void 0:null===(t=n.conv_extra)||void 0===t?void 0:t.flowpc_thread_source,r=(0,v.R)(a,void 0),l=T(e.conversation);return{thread_id:e.id,thread_source:r,conversation:{...l,bot_conversation_type:void 0,intention_type:null==e?void 0:null===(i=e.conversation)||void 0===i?void 0:null===(o=i.conv_extra)||void 0===o?void 0:o.samantha_intention_type,conversation_type:null==l?void 0:l.conversation_type}}},S=e=>{var t,n,o,i,a,r;if(!e)return;let l=null===(n=e.conversation)||void 0===n?void 0:null===(t=n.conv_extra)||void 0===t?void 0:t.flowpc_thread_source;return{thread_source:(0,v.R)(l,void 0),thread_id:e.id,can_chat:(null===(i=e.conversation)||void 0===i?void 0:null===(o=i.conv_extra)||void 0===o?void 0:o.can_chat)!==void 0?(null===(r=e.conversation)||void 0===r?void 0:null===(a=r.conv_extra)||void 0===a?void 0:a.can_chat)==="true":void 0,conversation:T(e.conversation)}};var E=n(151558),O=n(372296),N=n(603184);let y=async(e,t)=>{let n=(0,O.A)({cmd:E.SK.UPDATE_CONVERSATION_NAME,uplink_body:{update_conversation_name_uplink_body:{conversation_id:e,name:t,conversation_type:a.i1.ONE_TO_BOT_CHAT}}});await (0,N.imGatewayClient)({url:"/im/conversation/update_name",method:"POST",data:n})};var b=n(45469);let A=async e=>{var t,n;let o=(0,O.A)({cmd:E.SK.CREATE_CONVERSATION,uplink_body:{create_conv_uplink_body:{conversation_type:a.i1.ONE_TO_BOT_CHAT,conversation_scene:b.GZ.Samantha,participant_list:[{user_id:null!==(n=e.bot_id)&&void 0!==n?n:"",user_type:a.FW.AIBOT}],onboarding_content:null===(t=e.samantha_onboarding)||void 0===t?void 0:t.value,ext:{},source_message_id:"",source_conversation_id:"",local_message_id_list:[],source_message_id_list:[]}}}),{status_code:i,status_desc:r,downlink_body:l}=await (0,N.imGatewayClient)({url:"/im/conversation/create",method:"POST",data:o}),{create_conv_downlink_body:d}=null!=l?l:{},{bot_info:s,conversation_info:u}=null!=d?d:{};return{code:i,msg:r,data:{thread_info:{conversation:C(u,s)},bot_info:g(s)}}},L=async(e,t)=>{let n=(0,O.A)({cmd:E.SK.OPERATE_CONVERSATION,uplink_body:{operate_conv_uplink_body:{conversation_id:e,operate_type:t,conversation_type:a.i1.ONE_TO_BOT_CHAT}}}),{status_code:o,status_desc:i}=await (0,N.imGatewayClient)({url:"/im/conversation/operate",method:"POST",data:n});return{code:o,msg:i}},R=async(e,t)=>{let n=(0,O.A)({cmd:E.SK.MARK_CONVERSATION_READ,uplink_body:{mark_conv_read_uplink_body:{conversation_id:e,conversation_type:a.i1.ONE_TO_BOT_CHAT,read_index:Number(t)}}}),{status_code:o,status_desc:i}=await (0,N.imGatewayClient)({url:"/im/message/mark_conv_read",method:"POST",data:n});return{code:o,msg:i}},M=async e=>{let{conversation_id:t="",bot_id:n="",ext:o={}}=e,i=(0,O.A)({cmd:E.SK.GET_CONVERSATION_INFO,uplink_body:{get_conv_info_uplink_body:{conversation_id:t,ext:o,bot_id:n,conversation_type:a.i1.ONE_TO_BOT_CHAT,option:{need_bot_info:!0}}}}),{status_code:r,status_desc:l,downlink_body:d}=await (0,N.imGatewayClient)({url:"/im/conversation/info",method:"POST",data:i}),{get_conv_info_downlink_body:s}=null!=d?d:{},{conversation_info:u,bot_info:v}=null!=s?s:{};return{code:r,msg:l,data:{conversation:C(u,v),bot_info:g(v)}}},x=async e=>{let t=(0,O.A)({cmd:E.SK.CREATE_CONVERSATION,uplink_body:{create_conv_uplink_body:{source_message_id:"",source_conversation_id:"",conversation_type:a.i1.ONE_TO_BOT_CHAT,ext:{},participant_list:[],local_message_id_list:[],source_message_id_list:[],token:e.token,conversation_scene:b.GZ.BotToken}}}),{status_code:n,status_desc:o,downlink_body:i}=await (0,N.imGatewayClient)({url:"/im/conversation/create",method:"POST",data:t}),{create_conv_downlink_body:r}=null!=i?i:{},{conversation_info:l}=null!=r?r:{};return{code:n,msg:o,data:{conversation:C(l,void 0)}}},P=async()=>{let e=(0,O.A)({cmd:E.SK.COUNT_CONVERSATION,uplink_body:{conversation_count_uplink_body:{}}}),{status_code:t,status_desc:n,downlink_body:o}=await (0,N.imGatewayClient)({url:"/im/conversation/count",method:"POST",data:e});return{code:t,msg:n,data:null==o?void 0:o.conversation_count_downlink_body}},B=async e=>{let t=(0,O.A)({cmd:E.SK.CLEAR_MSG_HISTORY,uplink_body:{clear_msg_history_uplink_body:{conversation_id:e,conversation_type:a.i1.ONE_TO_BOT_CHAT}}}),{status_code:n,status_desc:o}=await (0,N.imGatewayClient)({url:"/im/message/clear_history",method:"POST",data:t});return{code:n,msg:o}},w=async e=>{let t=(0,O.A)({cmd:E.SK.CLEAR_MSG_CONTEXT,uplink_body:{clear_msg_context_uplink_body:{conversation_id:e,conversation_type:a.i1.ONE_TO_BOT_CHAT,scene_type:b.cJ.Common}}}),{status_code:n,status_desc:o,downlink_body:i}=await (0,N.imGatewayClient)({url:"/im/message/clear_context",method:"POST",data:t}),{clear_msg_context_downlink_body:r}=null!=i?i:{},{new_section_id:l}=null!=r?r:{};return{code:n,msg:o,data:{section_id:l}}},U=async e=>{let{conv_version:t,option:n,...o}=e,i=Number(t),r=(0,O.A)({cmd:E.SK.PULL_RECENT_CONV_CHAIN,uplink_body:{pull_recent_conv_chain_uplink_body:{...o,api_version:Number("1"),conv_version:i,direction:0===i?a.Tk.FROM_LATEST:a.Tk.OLDER,option:{not_need_message:!0,need_complete_conversation:!0,need_coco_conversation:0===i,need_coco_bot:0===i,...n}}}}),{status_code:l,status_desc:d,downlink_body:s}=await (0,N.imGatewayClient)({url:"/im/chain/recent_conv",method:"POST",data:r}),{pull_recent_conv_chain_downlink_body:u}=null!=s?s:{},{cells:v,has_more:c,next_conv_version:_,extra:m}=null!=u?u:{};return{code:l,msg:d,data:{has_more:c,next_cursor:_,cells:v,extra:m}}},F=async(e,t)=>{let n=(0,O.A)({cmd:E.SK.BATCH_DELETE_USER_CONVERSATION,uplink_body:{batch_delete_user_conversation_uplink_body:{conversation_id:e,delete_all:t,conversation_type:a.i1.ONE_TO_BOT_CHAT}}});await (0,N.imGatewayClient)({url:"/im/conversation/batch_del_user_conv",method:"POST",data:n})};function G(e,t,n){var o;return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:o+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class k{constructor(){G(this,"getConversationList",async e=>{var t,n,o,i,r,d,s,u,v,c;let m={conv_version:null!==(r=e.cursor)&&void 0!==r?r:"",limit:Number(null!==(d=e.batch_size)&&void 0!==d?d:50),filter:e.conversation_types?{conversation_type:e.conversation_types.map(e=>_(e))}:void 0,message_count_per_conv:10,option:{need_pc_pin_chain:!0,pc_pin_query_type:null!==(s=e.pc_pin_query_type)&&void 0!==s?s:a.Xz.QueryPin}},{code:C,msg:h,data:p}=await U(m),{cells:f,has_more:g,next_cursor:T,extra:S}=null!=p?p:{},E=null==f?void 0:f.map(e=>I(e));return(null==E?void 0:E.length)||l.k.persist.info({eventName:"IM_recent_conv_empty",meta:{conv_version:m.conv_version,limit:m.limit,filter:null===(v=m.filter)||void 0===v?void 0:null===(u=v.conversation_type)||void 0===u?void 0:u.join(","),message_count_per_conv:m.message_count_per_conv,pc_pin_query_type:null===(c=m.option)||void 0===c?void 0:c.pc_pin_query_type}}),{code:C,msg:h,data:{has_more:g,next_cursor:T,thread_list:E,pc_pin_query_type:null==S?void 0:S.pc_pin_query_type,samantha_bot:(null==S?void 0:null===(t=S.extra)||void 0===t?void 0:t.coco_bot_id)?{bot_id:null==S?void 0:null===(n=S.extra)||void 0===n?void 0:n.coco_bot_id,name:null==S?void 0:null===(o=S.extra)||void 0===o?void 0:o.coco_bot_name,icon_url:null==S?void 0:null===(i=S.extra)||void 0===i?void 0:i.coco_bot_icon_url}:void 0}}}),G(this,"getTouristConversationList",async()=>{var e,t,n,o,i,r,l,d,s,u,v,c;let{code:_,msg:m,data:C}=await U({conv_version:0,limit:10,message_count_per_conv:10}),{cells:h,has_more:p,next_cursor:f,extra:g}=null!=C?C:{},T=(null!==(c=null==h?void 0:h.filter(e=>{var t;return(null===(t=e.conversation)||void 0===t?void 0:t.bot_type)!==a.p1.COCO}))&&void 0!==c?c:[]).map(e=>S(e)).filter(e=>void 0!==e);return{code:_,msg:m,data:{main_thread:S(null==h?void 0:h.find(e=>{var t;return(null===(t=e.conversation)||void 0===t?void 0:t.bot_type)===a.p1.COCO})),threads:{has_more:p,next_cursor:f,thread_list:T},samantha_bot:(null==g?void 0:null===(e=g.extra)||void 0===e?void 0:e.coco_bot_id)?{bot_id:null==g?void 0:null===(t=g.extra)||void 0===t?void 0:t.coco_bot_id,name:null==g?void 0:null===(n=g.extra)||void 0===n?void 0:n.coco_bot_name,icon_url:null==g?void 0:null===(o=g.extra)||void 0===o?void 0:o.coco_bot_icon_url}:void 0,can_chat:(null==g?void 0:null===(i=g.extra)||void 0===i?void 0:i.can_chat)!==void 0?(null==g?void 0:null===(r=g.extra)||void 0===r?void 0:r.can_chat)==="true":void 0,can_create_thread:(null==g?void 0:null===(l=g.extra)||void 0===l?void 0:l.can_create_thread)!==void 0?(null==g?void 0:null===(d=g.extra)||void 0===d?void 0:d.can_create_thread)==="true":void 0,can_send_message:(null==g?void 0:null===(s=g.extra)||void 0===s?void 0:s.can_send_message)!==void 0?(null==g?void 0:null===(u=g.extra)||void 0===u?void 0:u.can_send_message)==="true":void 0,reply_limit:null==g?void 0:null===(v=g.extra)||void 0===v?void 0:v.reply_limit}}}),G(this,"getConversationInfo",async e=>M(e)),G(this,"getConversationBasicInfo",async e=>{let{conversation_id:t}=e;return await M({conversation_id:t})}),G(this,"updateConversationInfo",e=>{let{conversation_id:t,name:n}=e;return y(t,null!=n?n:"")}),G(this,"deleteConversation",e=>{let{conversation_ids:t,delete_all:n}=e;return F(null!=t?t:[],null!=n&&n)}),G(this,"conversationInfoAddBot",e=>x(e)),G(this,"getConversationCount",async()=>P()),G(this,"markConversationRead",e=>{var t,n;return R(null!==(t=e.conversation_id)&&void 0!==t?t:"",String(null!==(n=e.latest_read_idx)&&void 0!==n?n:""))}),G(this,"clearConversationHistory",e=>{var t;return B(null!==(t=e.conversation_id)&&void 0!==t?t:"")}),G(this,"clearConversationContext",e=>{var t;return w(null!==(t=e.conversation_id)&&void 0!==t?t:"")}),G(this,"pin",async e=>{let{conversation_id:t}=e;return L(t,a.Bq.TOP)}),G(this,"unpin",e=>{let{conversation_id:t}=e;return L(t,a.Bq.CANCEL_TOP)}),G(this,"getFeed",()=>this.getTouristConversationList()),G(this,"threadCreate",async e=>A(e)),G(this,"getThreadShareInfo",async e=>{let t=(0,i.Z)(e,["thread_id"]);return await r.mH.GetThreadShareInfo(t)}),G(this,"saveThreadShareInfo",async e=>{let t=(0,i.Z)(e,["thread_id"]);return await r.mH.SaveThreadShareInfo(t)}),G(this,"createCollection",async e=>{var t;return(null==e?void 0:null===(t=e.collection)||void 0===t?void 0:t.thread)&&(e.collection.thread.thread_id="0"),await r.mH.CreateCollection(e)})}}var D=n(234761),H=n(468494),V=n(322639);function W(e,t,n){var o;return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:o+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Y{constructor(){W(this,"getConversationList",async e=>await r.A1.AGWConversationList(e)),W(this,"getTouristConversationList",async()=>await r.mH.GetTouristFeed()),W(this,"getConversationInfo",async e=>await r.qu.ConversationInfo(e)),W(this,"getConversationBasicInfo",async e=>await r.A1.AGWConversationBasicInfo(e)),W(this,"updateConversationInfo",async e=>{let{conversation_id:t,name:n}=e,o=(0,D.jo)(H.useFeedStore.getState(),t);(0,V.p5)(o)?await r.mH.ThreadUpdate({conversation_id:t,name:n}):await r.qu.ConversationUpdate({conversation_id:t,name:n})}),W(this,"deleteConversation",async e=>{let{conversation_ids:t,delete_all:n}=e;if(n)await r.A1.AGWBatchDeleteConversation({delete_all:!0});else if((null==t?void 0:t.length)===1){let e=(0,D.jo)(H.useFeedStore.getState(),t[0]);(0,V.p5)(e)?await r.mH.ThreadDelete({conversation_id:t[0]}):await r.qu.ConversationArchive({conversation_id:t[0]})}else await r.A1.AGWBatchDeleteConversation({conversation_ids:t})}),W(this,"conversationInfoAddBot",async e=>await r.qu.ConversationInfoAddBot(e)),W(this,"getConversationCount",async()=>await r.A1.AGWGetConversationCount()),W(this,"markConversationRead",async e=>r.qu.MarkConversationRead(e)),W(this,"clearConversationHistory",async e=>r.qu.ConversationClear(e)),W(this,"clearConversationContext",async e=>r.qu.CreateSection(e)),W(this,"pin",async e=>{let{conversation_id:t}=e;return r.A1.AGWConversationPin({conversation_id:t})}),W(this,"unpin",async e=>{let{conversation_id:t}=e;return r.A1.AGWConversationUnpin({conversation_id:t})}),W(this,"getFeed",async()=>await r.mH.GetFeed()),W(this,"threadCreate",async e=>await r.mH.ThreadCreate(e)),W(this,"getThreadShareInfo",async e=>await r.mH.GetThreadShareInfo(e)),W(this,"saveThreadShareInfo",async e=>await r.mH.SaveThreadShareInfo(e)),W(this,"createCollection",async e=>await r.mH.CreateCollection(e))}}let K=async()=>await (0,o.j)()?new k:new Y,z=async()=>K()},9591:function(e,t,n){n.d(t,{e:function(){return o}});let o="7338286299411103781"},976927:function(e,t,n){n.r(t),n.d(t,{ChatFeedService:function(){return l},createChatFeedService:function(){return s},feedServiceContainer:function(){return d}});var o=n(144245),i=n(729813),a=n(468494),r=n(902493);class l{resetStore(){a.useFeedStore.setState(r.jb)}constructor(){var e,t,n;t=void 0,(e="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e="ctx","string"))?n:n+"")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,i.v.on("chat.service.resetAll",this.resetStore.bind(this))}}let d=(0,o.B)(),s=()=>(d.service||(d.service=new l),d.service)},902493:function(e,t,n){n.d(t,{jb:function(){return M},FO:function(){return x},i1:function(){return g.i},LU:function(){return g.L},hm:function(){return f.h}});var o=n(344482),i=n(164303),a=n(210230),r=n(721219),l=n(406421),d=n(422931),s=n(561200),u=n(81307),v=n(291375),c=n(51679),_=n(636242),m=n(6590),C=n(993047),h=n(57637),p=n(967037),f=n(28817),g=n(163324);let T=(e,t)=>({prevActiveConversationId:null,currentActiveConversationId:null,latestArchivedConversationId:null,setActiveConversation:n=>{let{currentActiveConversationId:o}=t();e({prevActiveConversationId:o,currentActiveConversationId:n})},markLatestArchivedConversationId(t){e({latestArchivedConversationId:t})}});var I=n(729813),S=n(398976),E=n(644367),O=n(322639),N=n(137726),y=n(976927),b=n(558882);let A={conversationMap:{},localConversationMap:{},lastSectionIdMap:{},lastMessageIndexMap:{},actionBarTemplateMap:{}},L=(e,t,n)=>({...A,fetchUpdateConversationInfo:async(e,n)=>{var o,i,a;let{prevActiveConversationId:r}=t(),l=(0,p.zQ)({eventName:"load_conversation_info",meta:{cold_start:!r,conversation_id:e,main_conversation_id:null===(o=t().mainConversationLink)||void 0===o?void 0:o.conversationId,scene:n}});if(null===(i=t().localConversationMap[e])||void 0===i?void 0:i.local){l.error({reason:"local_conversation_id",error:Error("local_conversation_id")});return}try{let{data:n}=await (0,C.xK)(async()=>(await (0,b.E)()).getConversationInfo({conversation_id:e,ext:r?void 0:{cold_start:"true"}}).then(e=>{var t,n;if(!(null===(n=e.data)||void 0===n?void 0:null===(t=n.conversation)||void 0===t?void 0:t.conversation_id))throw Error("invalid conversationInfo");return e}),3,e=>500*e,e=>{var t;if((0,S.k)(e)&&"710012002"===String(null==e?void 0:null===(t=e.errorOption)||void 0===t?void 0:t.code))throw I.v.emit("chat.user.logoutToSignIn"),e}),{conversation:o}=n||{};if(!n)throw Error("updateConversationInfo: invalid data from api");return l.addDurationPoint("success"),l.success(),t().updateConversationInfo(n),o}catch(n){throw l.error({reason:"load_conversation_info_failed",error:n,meta:{latest_main_conversation_id:null===(a=t().mainConversationLink)||void 0===a?void 0:a.conversationId,is_in_conversation_map:t().conversationMap[e]?"1":"0"}}),n}},updateConversationInfo:n=>{let o=y.feedServiceContainer.get("chatBotService"),{conversation:i,bot_info:a,msg_templates:r,trace_map:l}=n,{conversation_id:d}=i||{};if(!d||!i||!a){E.k.persist.warning({message:"invalid conversationInfo to update",meta:{conversation_id:d,bot_id:null==a?void 0:a.bot_id}});return}e((0,s.Uy)(e=>{var n,s,u,v,c;let _=e.conversationMap[d];e.conversationMap[d]={...i,name:(null==i?void 0:i.name)||(null==_?void 0:_.name),icon_image:t().isOverallList&&(0,O.qU)(i.conversation_type)?null!==(n=null==_?void 0:_.icon_image)&&void 0!==n?n:i.icon_image:null==i?void 0:i.icon_image,thread_source:null==_?void 0:_.thread_source,extra:null!==(s=i.extra)&&void 0!==s?s:null==_?void 0:_.extra,intention_type:null!==(u=null==i?void 0:i.intention_type)&&void 0!==u?u:null==_?void 0:_.intention_type},(null==a?void 0:a.id)&&(null==o||o.updateBot(a)),i.last_section_id&&(e.lastSectionIdMap[d]=i.last_section_id),r&&(e.actionBarTemplateMap[d]=r.map(e=>({...e,req_id:null==l?void 0:l.request_id}))),e.lastMessageIndexMap[d]={message_index:Number(i.message_index)||0,read_message_index:Number(i.read_message_index)||0,read_badge_count:Number(null!==(v=i.read_badge_count)&&void 0!==v?v:i.read_message_index)||0,badge_count:Number(null!==(c=i.badge_count)&&void 0!==c?c:i.message_index)||0}}))},updateThreadConversationToMap:n=>{let{conversation_id:o}=n||{};o&&e((0,s.Uy)(e=>{var i,a,r,l;let d=e.conversationMap[o];e.conversationMap[o]={...n,name:(null==n?void 0:n.name)||(null==d?void 0:d.name),icon_image:t().isOverallList&&(0,O.qU)(n.conversation_type)?null!==(i=null==d?void 0:d.icon_image)&&void 0!==i?i:n.icon_image:null==n?void 0:n.icon_image,thread_source:null==d?void 0:d.thread_source,extra:null!==(a=n.extra)&&void 0!==a?a:null==d?void 0:d.extra},e.lastMessageIndexMap[o]={message_index:Number(n.message_index)||0,read_message_index:Number(n.read_message_index)||0,read_badge_count:Number(null!==(r=n.read_badge_count)&&void 0!==r?r:n.read_message_index)||0,badge_count:Number(null!==(l=n.badge_count)&&void 0!==l?l:n.message_index)||0}}))},updateLastSectionId:(t,n)=>{e((0,s.Uy)(e=>{n&&(e.lastSectionIdMap[t]=n)}))},clearContext:async e=>{var n;let o=await (await (0,b.E)()).clearConversationContext({conversation_id:e}),i=null==o?void 0:null===(n=o.data)||void 0===n?void 0:n.section_id;i&&t().updateLastSectionId(e,i)},updateConversationMessageIndex(t){let{conversationId:n,messageIndex:o,readMessageIndex:i,badgeCount:a=o,readBadgeCount:r=i}=t;e((0,s.Uy)(e=>{let t=e.lastMessageIndexMap[n];t&&a&&Number(t.badge_count)<a&&(t.badge_count=a,t.message_index=o),t&&r&&Number(t.read_badge_count)<r&&(t.read_badge_count=r,t.read_message_index=i)}))},removeConversationFromMap:t=>{let{conversationId:n}=t;e((0,s.Uy)(e=>{(0,N.$)(e,n)}))},removeConversationsFromMap:t=>{let{conversationIds:n}=t;e((0,s.Uy)(e=>{n.forEach(t=>{(0,N.$)(e,t)})}))}});var R=n(279349);let M={conversationListStatus:{loading:!0,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1},overallListStatus:{loading:!0,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1,nextIndex:""},conversationLinks:[],mainConversationLink:void 0,botConversationIndex:0,threadListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},threadFeedStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},guestCanChat:!0,chatNotReachLimitMap:{},guestReachCreateThreadLimit:!0,guestReachSendMessageLimit:!1,guestSendMessageLimit:0,chatCreateInFirstTime:{},samanthaBot:{samanthaBotInfo:{},isLazyCreate:!1},isOverallList:!1},x=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[I,S,E]=t,N=()=>{let{conversationLinks:e,botConversationIndex:t}=S();return e.slice(t)},A=e=>{let{conversationLinks:t,botConversationIndex:n}=S();I({conversationLinks:t.slice(0,n).concat(e)})},x=()=>{let{conversationLinks:e,botConversationIndex:t}=S();return e.slice(0,t)},P=e=>{let{conversationLinks:t,botConversationIndex:n}=S(),o=e.length;I({conversationLinks:e.concat(t.slice(n)),botConversationIndex:o})},B=()=>S().mainConversationLink,w=e=>{I({mainConversationLink:e})},U=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=y.feedServiceContainer.get("chatBotService");t&&e.forEach(e=>{if(e.bot_id&&e.bot_disable_tag){var t,o;let i={bot_id:null==e?void 0:e.bot_id,id:null==e?void 0:e.bot_id,bot_type:null==e?void 0:e.bot_type,disabled_tag:null!==(t=null==e?void 0:e.bot_disable_tag)&&void 0!==t?t:"normal",creator_info:null!==(o=null==e?void 0:e.bot_creator_info)&&void 0!==o?o:{}};(null==n?void 0:n.getBot(e.bot_id))||null==n||n.updateBot(i)}}),I(t=>({conversationMap:e.reduce((e,t)=>{if(t.conversation_id){var n;(null===(n=e[t.conversation_id])||void 0===n?void 0:n.extra)&&!t.extra&&(t.extra=e[t.conversation_id].extra),e[t.conversation_id]=(0,i.Z)({},e[t.conversation_id],t)}return e},{...t.conversationMap}),lastMessageIndexMap:e.reduce((e,t)=>{if(t.conversation_id){var n,o;e[t.conversation_id]={message_index:Number(t.message_index)||0,read_message_index:Number(t.read_message_index)||0,badge_count:Number(null!==(n=t.badge_count)&&void 0!==n?n:t.message_index)||0,read_badge_count:Number(null!==(o=t.read_badge_count)&&void 0!==o?o:t.read_message_index)||0}}return e},{...t.lastMessageIndexMap})}))},F=(e,t)=>{let{append:n=!0,ignoreOld:o=!1}=t,i=x(),r=e.map(e=>{var t,n,o,i;return{threadId:null!==(i=null==e?void 0:e.thread_id_str)&&void 0!==i?i:null==e?void 0:null===(t=e.thread_id)||void 0===t?void 0:t.toString(),isLocalConversation:!1,conversationId:(null===(n=e.conversation)||void 0===n?void 0:n.conversation_id)||"",conversationType:null===(o=e.conversation)||void 0===o?void 0:o.conversation_type}}).filter(e=>!(0,a.Z)(e.threadId)),l=o?[]:i,d=l.filter(e=>(0,R.r7)(e.threadId));return(0,f.Z)(n?[...d,...l,...r]:[...d,...r,...l])},G=(e,t)=>{e.conversationLinks.splice(t,1),t<e.botConversationIndex&&(e.botConversationIndex-=1)},k=(e,t)=>{var n,o,i;let{conversationId:a,originConversationKey:r,index:l,threadId:d,pinOperation:s=!1,isLocalConversation:u=!1,isOverallChatItem:v}=t,c=v||S().isOverallList,_=!!d||!!(null===(n=e.conversationLinks.find(e=>e.conversationId===a))||void 0===n?void 0:n.threadId)||(0,O.p5)(e.conversationMap[a])||(0,O.kJ)(e.conversationMap[a]),m=c?S().conversationLinks:_?x():N(),C=m.length,h=-1,p=!1,f=u?null===(o=e.localConversationMap[a])||void 0===o?void 0:o.conversation_type:null===(i=e.conversationMap[a])||void 0===i?void 0:i.conversation_type,T=d,I=C,E=g.i.Conversation;if(m.forEach((t,n)=>{var o,i;let r=t.isLocalConversation?null===(o=e.localConversationMap[t.conversationId])||void 0===o?void 0:o.pinned:null===(i=e.conversationMap[t.conversationId])||void 0===i?void 0:i.pinned;t.conversationId===a&&(h=n,p=null!=r&&r,f=t.conversationType,T=t.threadId,t.isLocalConversation&&(E=g.i.LocalConversation)),r||I!==C||(I=n)}),!l)return;if(~h){let t=_||c?h:h+e.botConversationIndex;e.conversationLinks.splice(t,1),I=I>h?I-1:I,_&&(e.botConversationIndex-=1)}let y=E===g.i.Conversation?e.conversationMap[a]:e.localConversationMap[a];s?(I=p?I:0,y&&(y.pinned=!y.pinned,y.pinned&&(y.update_time=Date.now()/1e3))):(I=p?0:I,y&&(y.update_time=Date.now()/1e3));let b=_||c?I:I+e.botConversationIndex;e.conversationLinks.splice(b,0,{isLocalConversation:u,conversationId:a,originConversationKey:r,conversationType:f,threadId:null==T?void 0:T.toString()}),_&&(e.botConversationIndex+=1)};return{...M,...L(...t),...T(...t),loadConversationList:async e=>{var t,n;let{type:o=[g.L.Feed,g.L.Thread,g.L.Bot],...i}=e,a=(0,r.Z)(o),s=(0,p.zQ)({eventName:"load_conversation_list",meta:{type:a.join(","),isRefresh:i.isRefresh,isReload:i.isReload,isInit:!i.isRefresh&&0===i.index,size:i.size,index:i.index,has_cache:(null===(t=S().conversationLinks)||void 0===t?void 0:t.length)||(null===(n=S().mainConversationLink)||void 0===n?void 0:n.conversationId)?"1":"0"}}),u=a.map(e=>{switch(e){case g.L.Bot:return S().loadBotConversationList(i);case g.L.Feed:return S().loadThreadFeed(i);case g.L.Thread:return S().loadThreadList({...i,index:void 0});case g.L.Guest:return S().loadGuestThreadFeed(i);case g.L.Overall:return S().loadOverallList({...i,index:void 0});default:return Promise.resolve([])}});try{let e=await Promise.all(u);return s.success(),(0,l.Z)((0,d.Z)(e),"conversation_id")}catch(e){throw e instanceof Error&&s.error({reason:`loadConversationList failed size:${i.size} index:${i.index} type:${a.join(",")}`,error:e}),e}},loadBotConversationList:async e=>{let{index:t,size:n,isReload:o,isRefresh:i}=e,{conversationListStatus:a}=S(),r=(0,p.zQ)({eventName:"load_bot_conversation_list",meta:{isRefresh:i,isReload:o,size:n,index:t,isInit:!a.initiated}}),l=N(),d=!i&&0===t;I({conversationListStatus:{...a,loading:!0,isReload:!!o}});try{let{data:e}=await (0,C.xK)(()=>c.qu.ConversationList({index:t,batch_size:n,conversation_types:[_.i1.Bot]}),3,e=>1e3*e);r.addDurationPoint("fetch_success");let{conversation_list:o=[],has_more:a}=e||{};U(o);let s=o.map(e=>({isLocalConversation:!1,conversationId:e.conversation_id||"",conversationType:null==e?void 0:e.conversation_type})).filter(Boolean),u=(0,f.Z)(i?[...s,...l]:[...d?[]:l,...s]);return A(u),I(e=>({conversationListStatus:{loading:!1,failed:!1,count:u.length,...i?{hasMore:e.conversationListStatus.hasMore}:{hasMore:a||!1},isReload:!1,initiated:!0}})),r.success(),o}catch(e){throw I(e=>({conversationListStatus:{...e.conversationListStatus,failed:!0,loading:!1}})),e instanceof Error&&r.error({reason:`loadBotConversationList failed size:${n} index:${t}`,error:e}),e}},loadThreadFeed:async function(){var e,t,n,o,i,r,l;let{isReload:d,isRefresh:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadFeedStatus:u}=S(),v=(0,p.zQ)({eventName:"load_thread_feed",meta:{isRefresh:s,isReload:d,isInit:!u.initiated,call_chain:null===(e=Error("trace").stack)||void 0===e?void 0:e.split("\n").slice(1,8).map(e=>{var t,n;return null==e?void 0:null===(n=e.trim())||void 0===n?void 0:null===(t=n.replace(/^at /,"- "))||void 0===t?void 0:t.replace(/\(http.*\/static\/js\//,"(/static/js/")}).join("\n")}});I({threadFeedStatus:{...u,loading:!0,isReload:!!d}});try{let{data:e}=await (0,C.xK)(async()=>(await (0,b.E)()).getFeed(),3,e=>1e3*e);v.addDurationPoint("fetch_success");let{threads:d,main_thread:c}=e||{},{thread_list:_=[],has_more:m,next_index:h}=d||{};c&&w({conversationId:null!==(i=null===(t=c.conversation)||void 0===t?void 0:t.conversation_id)&&void 0!==i?i:"",conversationType:null===(n=c.conversation)||void 0===n?void 0:n.conversation_type,threadId:null!==(l=null!==(r=c.thread_id_str)&&void 0!==r?r:null===(o=c.thread_id)||void 0===o?void 0:o.toString())&&void 0!==l?l:"",isLocalConversation:!1});let p=[null==c?void 0:c.conversation].concat(_.map(e=>e.conversation?{...e.conversation,thread_source:e.thread_source,thread_id:e.thread_id_str||e.thread_id}:void 0)).filter(e=>!(0,a.Z)(e));U(p);let f=F(_,{append:!1,ignoreOld:!u.initiated&&!S().threadListStatus.initiated});return P(f),I(e=>{var t;return{threadFeedStatus:{loading:!1,failed:!1,count:f.length,...s?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:m||!1},isReload:!1,nextIndex:null!==(t=null==h?void 0:h.toString())&&void 0!==t?t:"",initiated:!0}}}),v.success(),p}catch(e){throw I(e=>({threadFeedStatus:{...e.threadFeedStatus,failed:!0,loading:!1}})),e instanceof Error&&v.error({reason:"loadThreadFeed failed",error:e}),e}},loadOverallList:async function(){let{index:e,isReload:t,isRefresh:n,pcPinQueryType:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{overallListStatus:i,samanthaBot:r}=S(),l=(0,p.zQ)({eventName:"load_overall_list",meta:{isRefresh:n,isReload:t,isInit:!i.initiated}});I({overallListStatus:{...i,loading:!0,isReload:!!t}});try{let{data:t}=await (0,C.xK)(async()=>(await (0,b.E)()).getConversationList({cursor:e,batch_size:20,pc_pin_query_type:o}),3,e=>1e3*e);l.addDurationPoint("fetch_success");let{thread_list:d=[],has_more:s,next_cursor:u,samantha_bot:v,pc_pin_query_type:c}=t||{},_=d.map(e=>{var t,n,o,i;return e.conversation?{...e.conversation,thread_source:e.thread_source,conversation_type:null===(t=e.conversation)||void 0===t?void 0:t.conversation_type,thread_id:null!==(i=null!==(o=e.thread_id_str)&&void 0!==o?o:null===(n=e.thread_id)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}:void 0}).filter(e=>!(0,a.Z)(e));U(_);let{conversationLinks:m}=S(),h=d.map(e=>{var t,n,o,i,a,r;return{isLocalConversation:!1,conversationId:String(null!==(i=null===(t=e.conversation)||void 0===t?void 0:t.conversation_id)&&void 0!==i?i:""),conversationType:null===(n=e.conversation)||void 0===n?void 0:n.conversation_type,threadId:null!==(r=null!==(a=e.thread_id_str)&&void 0!==a?a:null===(o=e.thread_id)||void 0===o?void 0:o.toString())&&void 0!==r?r:""}}),p=i.initiated||S().overallListStatus.initiated?m:[],g=(0,f.Z)(n?[...h,...p]:[...p,...h]);return I(e=>{var t;return{conversationLinks:g,overallListStatus:{loading:!1,failed:!1,count:_.length,...n?{hasMore:e.overallListStatus.hasMore}:{hasMore:s||!1},isReload:!1,nextIndex:null!==(t=null==u?void 0:u.toString())&&void 0!==t?t:"",initiated:!0,pcPinQueryType:c},samanthaBot:{samanthaBotInfo:{...v,id:String(null==v?void 0:v.id)},isLazyCreate:r.isLazyCreate}}}),l.success(),_}catch(e){throw I(e=>({overallListStatus:{...e.overallListStatus,failed:!0,loading:!1}})),e instanceof Error&&l.error({reason:"loadOverallList failed",error:e}),e}},loadGuestThreadFeed:async function(){let{isReload:e,isRefresh:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadFeedStatus:n}=S(),o=y.feedServiceContainer.get("chatBotService"),i=(0,p.zQ)({eventName:"load_guest_thread_feed",meta:{isRefresh:t,isReload:e,isInit:!n.initiated}});I({threadFeedStatus:{...n,loading:!0,isReload:!!e}});try{let{data:e}=await (0,C.xK)(async()=>(await (0,b.E)()).getTouristConversationList(),3,e=>1e3*e);i.addDurationPoint("fetch_success");let{samantha_bot:_,main_thread:m,threads:h,can_create_thread:f,can_send_message:g,reply_limit:T}=null!=e?e:{},{thread_list:E=[],has_more:O,next_index:N}=h||{};if(m){var r,l,d,s,v,c;w({conversationId:null!==(s=null===(r=m.conversation)||void 0===r?void 0:r.conversation_id)&&void 0!==s?s:"",conversationType:null===(l=m.conversation)||void 0===l?void 0:l.conversation_type,threadId:null!==(c=null!==(v=m.thread_id_str)&&void 0!==v?v:null===(d=m.thread_id)||void 0===d?void 0:d.toString())&&void 0!==c?c:"",isLocalConversation:!1})}else{let e=(0,p.zQ)({eventName:"create_main_conversation",meta:{from:"header"}}),t=u.VI.CocoWeb,n=B(),i=S().addNewLocalConversation({reportEvent:e,conversation:{bot_id:null==_?void 0:_.bot_id,conversation_type:t},conversationId:(null==n?void 0:n.isLocalConversation)?null==n?void 0:n.conversationId:void 0});(null==_?void 0:_.bot_id)&&(null==o||o.setLocalConversationIdForBot({botId:_.bot_id,localConversationId:i})),w({conversationId:i,conversationType:t,threadId:(0,R.eg)(i,"FirstEnter","main"),isLocalConversation:!0})}let y=[null==m?void 0:m.conversation].concat(E.map(e=>{if(e.conversation){var t,n;return{...e.conversation,thread_id:null!==(n=null!==(t=e.thread_id_str)&&void 0!==t?t:e.thread_id)&&void 0!==n?n:""}}})).filter(e=>!(0,a.Z)(e));U(y);let A=F(E,{append:!1,ignoreOld:!n.initiated});return P(A),I(e=>{var n,o;return{threadFeedStatus:{loading:!1,failed:!1,count:A.length,...t?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:O||!1},isReload:!1,nextIndex:null!==(o=null==N?void 0:N.toString())&&void 0!==o?o:"",initiated:!0},chatNotReachLimitMap:{...e.chatNotReachLimitMap,...(null==m?void 0:null===(n=m.conversation)||void 0===n?void 0:n.conversation_id)?{[m.conversation.conversation_id]:!!m.can_chat}:{},...E.reduce((e,t)=>{var n;let{conversation_id:o}=null!==(n=t.conversation)&&void 0!==n?n:{};return o&&(e[o]=!!t.can_chat),e},{})},guestReachCreateThreadLimit:!f,guestReachSendMessageLimit:!1===g,guestSendMessageLimit:parseInt(String(null!=T?T:3*(!1!==g)),10),samanthaBot:{samanthaBotInfo:null!=_?_:{},isLazyCreate:null==m||!m.conversation}}}),i.success(),y}catch(e){throw I(e=>({threadFeedStatus:{...e.threadFeedStatus,failed:!0,loading:!1}})),e instanceof Error&&i.error({reason:"loadThreadFeed failed",error:e}),e}},loadThreadList:async function(){let{index:e,size:t,isReload:n,isRefresh:o=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadListStatus:i}=S(),r=(0,p.zQ)({eventName:"load_thread_list",meta:{isRefresh:o,isReload:n,size:t,index:e,isInit:!i.initiated}});I({threadListStatus:{...i,loading:!0,isReload:!!n}});try{let{data:n}=await (0,C.xK)(()=>c.mH.ThreadList({index:e&&(0,h.k)(e)?Number(e):void 0,batch_size:t}),3,e=>1e3*e);r.addDurationPoint("fetch_success");let{thread_list:l=[],has_more:d,next_index:s}=n||{},u=l.map(e=>e.conversation?{...e.conversation,thread_source:e.thread_source,thread_id:e.thread_id_str||e.thread_id}:void 0).filter(e=>!(0,a.Z)(e));U(u);let v=F(l,{append:!o,ignoreOld:!i.initiated&&!S().threadFeedStatus.initiated});return P(v),I(e=>{var t;return{threadListStatus:{loading:!1,failed:!1,count:v.length,...o?{hasMore:e.threadListStatus.hasMore}:{hasMore:d||!1},isReload:!1,nextIndex:null!==(t=null==s?void 0:s.toString())&&void 0!==t?t:"",initiated:!0}}}),r.success(),u}catch(n){throw I(e=>({threadListStatus:{...e.threadListStatus,failed:!0,loading:!1}})),n instanceof Error&&r.error({reason:`loadThreadList failed size:${t} index:${e}`,error:n}),n}},addNewLocalConversation:function(){let{reportEvent:e,conversation:t,conversationId:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n||(0,f.h)();return I((0,s.Uy)(n=>{n.localConversationMap[o]={local:{createStatus:v.ns.Pending,reportEvent:e},...t}})),o},updateLocalConversation:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];I((0,s.Uy)(o=>{if(n&&(null==t?void 0:t.conversation_id)){o.localConversationMap[t.conversation_id]={...t},delete o.localConversationMap[e];return}Object.assign(o.localConversationMap[e]||{},t)}))},updateLocalConversationLocal(e,t){I((0,s.Uy)(n=>{let{localConversationMap:{[e]:o}}=n;o&&(o.local=o.local?{...o.local,...t}:t)}))},updateConversationIdInLinks:(e,t)=>{I((0,s.Uy)(n=>{let o=n.conversationLinks.findIndex(t=>t.conversationId===e),i={...n.conversationLinks[o],conversationId:t,isLocalConversation:!1};n.conversationLinks[o]=i}))},fetchConversationAndUpdateLocalStatusForBot:async e=>{let{token:t,botId:n,conversationId:i,localConversationId:a,messageId:r,scene:l=m.Sw.Default,createFrom:d}=e,s=S().localConversationMap[a];if(!(null==s?void 0:s.local))return;let{local:{reportEvent:u}}=s;try{var _,C,h,p;let e;S().updateLocalConversation(a,{local:{createStatus:v.ns.Creating,createFrom:d}}),t?e=null===(C=await (await (0,b.E)()).conversationInfoAddBot({token:t}))||void 0===C?void 0:C.data:n?e=null===(h=await (await (0,b.E)()).getConversationInfo({bot_id:n}))||void 0===h?void 0:h.data:i&&(e=null===(p=await c.qu.CreateSubConversation({conversation_id:i,message_id:r,scene:l}))||void 0===p?void 0:p.data);let s=null==e?void 0:null===(_=e.conversation)||void 0===_?void 0:_.conversation_id;if(s&&e){if(S().updateConversationInfo(e),S().updateLocalConversation(a,{local:{createStatus:v.ns.Done,newConversationId:s,createFrom:d}}),S().conversationListStatus.loading){let e=E.subscribe(e=>({conversationListStatus:e.conversationListStatus}),t=>{let{conversationListStatus:n}=t;n.loading||(null==e||e(),S().insertConversationToLinks({conversationId:s,index:1}))},{fireImmediately:!0,equalityFn:o.X})}else S().insertConversationToLinks({conversationId:s,index:1})}else throw Error("Expect newConversationId, but not found");return null==u||u.addDurationPoint("success"),null==u||u.success(),e.conversation}catch(e){throw S().updateLocalConversation(a,{local:{createStatus:v.ns.Failed}}),e instanceof Error&&(null==u||u.error({error:e,reason:"create_conversation_error"})),e}},removeConversationFromLinks:e=>{let{conversationId:t}=e,n=S().conversationLinks.findIndex(e=>e.conversationId===t);~n&&I((0,s.Uy)(e=>G(e,n)))},removeConversationsFromLinks:e=>{let{conversationIds:t=[]}=e;I((0,s.Uy)(e=>{let n=!1,{botConversationIndex:o}=e,i=e.conversationLinks.filter((i,a)=>{let r=t.includes(i.conversationId);return r&&(n=!0,a<e.botConversationIndex&&(o-=1)),!r});n&&(e.conversationLinks=i,e.botConversationIndex=o)}))},insertConversationToLinks:e=>{I((0,s.Uy)(t=>k(t,{...e})))},insertNewConversationAndRemoveOldConversationFromLinks:(e,t)=>{I((0,s.Uy)(n=>{k(n,{...e});let o=n.conversationLinks.findIndex(e=>e.conversationId===t.conversationId);~o&&G(n,o)}))},setGuestCanChat:e=>{I({guestCanChat:e})},setNotReachLimitMap:e=>{I(t=>({chatNotReachLimitMap:{...t.chatNotReachLimitMap,...e}}))},setGuestReachCreateThreadLimit:e=>{I({guestReachCreateThreadLimit:e})},updateMainConvLink:e=>{let{conversation:t={},threadId:n="",isLocalConversation:o=!1}=e,i=(0,p.zQ)({eventName:"update_main_convLink"});try{var r,l;if(!t||!n)throw Error("getMainConversationInfo: invalid data from api");if(w({conversationId:null!==(r=null==t?void 0:t.conversation_id)&&void 0!==r?r:"",conversationType:null==t?void 0:t.conversation_type,threadId:null!==(l=null==n?void 0:n.toString())&&void 0!==l?l:"",isLocalConversation:o}),!o){let e=[t].filter(e=>!(0,a.Z)(e));U(e)}i.success()}catch(e){throw e instanceof Error&&i.error({reason:"getMainConversationInfo failed",error:e}),e}},updateChatCreateInFirstTime:e=>{let{conversationId:t="",status:n=!1}=e;I((0,s.Uy)(e=>{e.chatCreateInFirstTime[t]=n}))}}}},163324:function(e,t,n){var o,i;n.d(t,{L:function(){return r},i:function(){return a}});let a=((o={}).LocalConversation="LocalConversation",o.Conversation="Conversation",o),r=((i={}).Bot="bot",i.Feed="feed",i.Thread="thread",i.Guest="guest",i.Overall="overall",i)},468494:function(e,t,n){n.r(t),n.d(t,{createStore:function(){return r},initFeedStore:function(){return d},useFeedStore:function(){return l}});var o=n(613993),i=n(231462),a=n(902493);let r=e=>{let{prefix:t,isEnableDebug:n,reduxDevToolsSnapshot:r}=e;return n&&r?(0,i.Ue)()((0,o.mW)((0,o.XR)(a.FO),{name:`${t}-chat-feed-store`})):(0,i.Ue)()((0,o.XR)(a.FO))},l=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let{_useFeedStore:o}=l.prototype;if(o)return o(...t);throw Error("useFeedStore is not initialized")};function d(e){let{_useFeedStore:t}=l.prototype||{};if(!t){let t=r({...e});Object.setPrototypeOf(l.prototype,t),Object.defineProperties(l,{...Object.getOwnPropertyDescriptors(t)}),l.prototype._useFeedStore=t}}},234761:function(e,t,n){n.d(t,{EQ:function(){return a},IO:function(){return l},N$:function(){return v},aG:function(){return d},dg:function(){return s},jo:function(){return u},kB:function(){return r}});var o=n(792288),i=n(9591);let a=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,conversationListStatus:e.conversationListStatus,loadBotConversationList:e.loadBotConversationList}),r=e=>e.mainConversationLink,l=e=>{var t,n,a;return(0,o.Kn)(e,null===(t=r(e))||void 0===t?void 0:t.conversationId,!0)||(null===(a=e.samanthaBot)||void 0===a?void 0:null===(n=a.samanthaBotInfo)||void 0===n?void 0:n.bot_id)||i.e},d=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadThreadList:e.loadThreadList,loadThreadFeed:e.loadThreadFeed}),s=(e,t)=>t?e.localConversationMap[t]:void 0,u=(e,t)=>t?e.conversationMap[t]:void 0,v=e=>({conversationLinks:e.conversationLinks,conversationListStatus:e.conversationListStatus,overallListStatus:e.overallListStatus,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadOverallList:e.loadOverallList,loadConversationList:e.loadConversationList})},792288:function(e,t,n){n.d(t,{Bu:function(){return r},Kn:function(){return d},QW:function(){return i},WX:function(){return l},px:function(){return a}});var o=n(976927);let i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;let{conversation_type:o}=e.conversationMap[t]||{};if(o||!n)return o;let{conversation_type:i}=e.localConversationMap[t]||{};return t?i:void 0},a=(e,t)=>{if(!t)return;let n=[...e.conversationLinks,e.mainConversationLink].find(e=>(null==e?void 0:e.conversationId)===t);return null==n?void 0:n.threadId},r=(e,t,n)=>{if(!t)return{};let i=o.feedServiceContainer.get("chatBotService",!0),a=e.conversationMap[t],r=(null==a?void 0:a.bot_id)||n;return{conversation:a,botInfo:r?null==i?void 0:i.getBot(r):{}}},l=(e,t)=>t?e.conversationMap[t]:{},d=(e,t,n)=>{let{botInfo:i,conversation:a}=r(e,t),l=o.feedServiceContainer.get("chatBotService",!0),d=(null==i?void 0:i.id)||(null==i?void 0:i.bot_id)||(null==a?void 0:a.bot_id);return d||!n?d:t?null==l?void 0:l.getBotIdFromLocalConversation(t):void 0}},137726:function(e,t,n){n.d(t,{$:function(){return o}});function o(e,t){e.conversationMap[t]&&delete e.conversationMap[t],e.lastMessageIndexMap[t]&&delete e.lastMessageIndexMap[t]}},279349:function(e,t,n){n.d(t,{X0:function(){return a},eg:function(){return r},k9:function(){return o},r7:function(){return l},yx:function(){return i}});let o=e=>{var t,n;let o=Number(null!==(t=null==e?void 0:e.badge_count)&&void 0!==t?t:null==e?void 0:e.message_index)||0,i=Number(null!==(n=null==e?void 0:e.read_badge_count)&&void 0!==n?n:null==e?void 0:e.read_message_index)||0;return o>i?o-i:0};function i(e){let{conversationLinks:t,botConversationIndex:n}=e;return t.slice(0,n)}function a(e){let{conversationLinks:t,botConversationIndex:n}=e;return t.slice(n)}let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub";return`${"sub"===n?"localThread_":"localMainThread_"}${t||""}_${e}`},l=function(e,t){var n,o;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub",a="sub"===i?"localThread_":"localMainThread_";return t?null==e?void 0:null===(n=e.startsWith)||void 0===n?void 0:n.call(e,`${a}${t}_`):null==e?void 0:null===(o=e.startsWith)||void 0===o?void 0:o.call(e,a)}},322639:function(e,t,n){n.d(t,{CC:function(){return s},Mh:function(){return C},WC:function(){return p},Xo:function(){return c},ar:function(){return h},el:function(){return m},jx:function(){return _},kJ:function(){return u},p5:function(){return v},qU:function(){return d},x9:function(){return l}});var o=n(81307),i=n(67864),a=n(592333),r=n(636674);let l=e=>e===o.VI.CocoWeb||e===o.VI.Coco,d=e=>e===o.VI.CocoWebSub||e===o.VI.CocoSub,s=e=>e===o.VI.Bot,u=e=>l(null==e?void 0:e.conversation_type),v=e=>d(null==e?void 0:e.conversation_type),c=(e,t)=>{let n=u(e),o=v(e);return n||o||t===i.z.NewThread||t===i.z.ThreadLocalConversation||t===i.z.CollectionLocalConversation||t===i.z.SharedThreadContinueChat||t===i.z.NewDoc},_=e=>s(null==e?void 0:e.conversation_type),m=e=>e===a.dm.Coco||e===a.dm.CocoWeb,C=e=>e===a.dm.User,h=e=>e===a.dm.GuanFang,p=e=>{let t=!1;try{let n=JSON.parse((null==e?void 0:e.extra)||"");t=Number(n.share_from_review_status)===r.ReviewStatus.Reject}catch{}return t}}}]);
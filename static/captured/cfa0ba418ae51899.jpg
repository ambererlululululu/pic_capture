"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["43995"],{832099:function(e,t,a){a.d(t,{LazyMindMap:function(){return r}});var i=a(713738),n=a(559891),o=a(870693);let r=(0,n.withSuspense)(i.lazy(async()=>await (0,o.retryLoad)(()=>Promise.all([a.e("42431"),a.e("46195"),a.e("39598"),a.e("4474"),a.e("80921"),a.e("85572")]).then(a.bind(a,221062)))))},339666:function(e,t,a){a.d(t,{SearchVideoBox:function(){return p},SearchVideoBoxType:function(){return u}});var i,n=a(812650),o=a.n(n),r=a(883393),l=a(552148),d=a(950810),c={"container-list":"container-list-ijOCly",containerList:"container-list-ijOCly","video-card":"video-card-_0IW5l",videoCard:"video-card-_0IW5l","container-grid":"container-grid-DPzqlB",containerGrid:"container-grid-DPzqlB"},s=a(345660);let u=((i={}).List="list",i.Grid="grid",i);function p(e){let{onTrackEvent:t,videos:a,type:i,...n}=e,o=(0,r.useAppSizeType)({sm:419,md:899}),l=(0,s.jsx)(v,{videos:a,...n,onTrackEvent:t}),d=(0,s.jsx)(m,{videos:a,...n,onTrackEvent:t});return i?i===u.List?d:l:"sm"===o?l:d}function v(e){let{videos:t,onLoadVideo:a,onTrackEvent:i,inView:n,useNewShow:r}=e,l={video_list:t},u=t.slice(0,4);return(0,s.jsx)("div",{className:c["container-grid"],children:u.map((e,t)=>(0,s.jsx)(d.VideoCardWithPlayer,{videoContent:l,onVideoPlay:a,inView:n,currentPlay:e.item_id,useNewShow:r,videoCardClassName:o()(c["video-card"],r?"!h-auto":""),onClick:()=>{null==i||i("click_card",{card_position:t,module_type:"double_column"})},onShow:()=>{null==i||i("show_card",{card_position:t,module_type:"double_column"})},onTrackEvent:i},`${e.item_id}_${t}`))})}function m(e){let{videos:t,onLoadVideo:a,onTrackEvent:i,inView:n,useNewShow:r}=e,u={video_list:t};return(0,s.jsx)("div",{className:c["container-list"],children:(0,s.jsx)(l.Carousel,{arrowSize:"medium",carouselRowClassName:o()(c["carousel-row"],r?"!gap-12":"!gap-8"),children:t.map((e,t)=>(0,s.jsx)(d.VideoCardWithPlayer,{videoContent:u,onVideoPlay:a,inView:n,currentPlay:e.item_id,useNewShow:r,videoCardClassName:o()(c["video-card"],r?"!h-auto":""),onClick:()=>{null==i||i("click_card",{card_position:t,module_type:"multiple_card"})},onShow:()=>{null==i||i("show_card",{card_position:t,module_type:"multiple_card"})},onTrackEvent:i},`${e.item_id}_${t}`))})})}},610620:function(e,t,a){a.d(t,{batchRichMediaTypeIndex:function(){return W},getRichMediaTypeInsertElements:function(){return U}});var i,n=a(217957),o=a(302958),r=a(486677),l=a(266655),d=a(218679),c=a(915299),s=a(832099),u=a(843174),p=a(165482),v=a(26069),m=a(878453),_=a(828438),h=a(713738),f=a(910214),y=a(339666),g=a(345660);function x(e){let{videos:t,type:a}=e,i=null==t?void 0:t.map(e=>({item_id:e.item_id||"",video_captions:e.video_captions,source_from:e.source_from||2,source_app_icon:e.source_app_icon||"",album_image:e.album_image||"",vid:"",media_width:0,media_height:0})),n=async e=>{let{item_ids:t,source_from:a,...i}=e,n={item_ids:t,...i},o=2!==Number(a)?f.aliceApiService.LoadVideoDY(n):f.aliceApiService.LoadVideoTT(n),{data:r}=await o;return r},[o,r]=(0,_.useInView)({triggerOnce:!1,initialInView:!0,threshold:.1});return(0,g.jsx)("div",{className:"mt-20",ref:o,children:(0,g.jsx)(y.SearchVideoBox,{videos:i,onLoadVideo:n,inView:r,type:a})})}var S=a(945396),b=a(698392),j=a(212183),C=a(777422),T={text:"text-x_Pd7R",icon:"icon-fYFBMj",divide:"divide-jBLbKN"};let w=e=>{let{useNewShow:t=!1}=e,a=(0,c.useTranslateFn)();return t?(0,g.jsxs)("div",{className:"flex flex-col items-start justify-center gap-12 py-12",children:[(0,g.jsx)("div",{className:T.divide}),(0,g.jsx)("div",{className:T.text,children:a("related_video_cn")})]}):(0,g.jsxs)("div",{className:"flex items-center justify-center gap-12 pt-12 pb-8 pl-4",children:[(0,g.jsxs)("div",{className:"flex items-center justify-center gap-4",children:[(0,g.jsx)(S.default,{className:T.icon}),(0,g.jsx)("span",{className:T.text,children:a("related_video_cn")})]}),(0,g.jsx)("div",{className:T.divide})]})};function k(e){let{videos:t,message:a,type:i,hideHeader:n,useNewUIShow:o}=e,r=(0,b.useChatSlice)("chatViewCoreStore").currentChatViewConfig,l=null==t?void 0:t.map(e=>({item_id:e.item_id||"",video_captions:e.video_captions,source_from:e.source_from||2,source_app_icon:e.source_app_icon||"",album_image:e.album_image||"",vid:"",media_width:0,media_height:0})),[d,c]=(0,_.useInView)({triggerOnce:!1,initialInView:!0,threshold:.1}),s=async e=>{let{item_ids:t,source_from:a,...i}=e,n={item_ids:t,...i},o=2!==Number(a)?f.aliceApiService.LoadVideoDY(n):f.aliceApiService.LoadVideoTT(n),{data:r}=await o;return r};return(0,g.jsxs)("div",{ref:d,children:[!n&&(0,g.jsx)(w,{useNewShow:o}),(0,g.jsx)(y.SearchVideoBox,{videos:l,onLoadVideo:s,inView:c,onTrackEvent:(e,i)=>{var n,o;if(!a)return;let l=(0,j.getBotIdByConversationId)(a.conversation_id||""),d={...i,message_id:null==a?void 0:a.message_id,conversation_id:null==a?void 0:a.conversation_id,bot_id:l,chat_type:null==r?void 0:r.chatType,reply_id:null==a?void 0:a.reply_id,module_position:"within_text",card_count:t.length,card_type:"video",search_id:null==a?void 0:null===(n=a.local_info)||void 0===n?void 0:n.logId,req_id:null==a?void 0:null===(o=a.local_info)||void 0===o?void 0:o.logId,host_enter_from:"flow_click_recommend_video_card"};(0,C.trackEvent)(e,d)},type:i,useNewShow:o})]})}var M=a(305852),N=a(350121),V=a(436114);let I=((i={}).Weather="weather",i.Stock="stock",i.ExchangeRate="exchange_rate",i.Hanzi="hanzi",i.Calendar="calendar",i.GaokaoYifenyiduan="gaokao_yifenyiduan",i.GaokaoControlscore="gaokao_controlscore",i.GaokaoProvincescore="gaokao_provincescore_new",i),L=()=>(0,g.jsx)("div",{children:"[\u6682\u4E0D\u652F\u6301\u8BE5\u5361\u7247]"}),P=h.lazy(()=>Promise.all([a.e("18748"),a.e("47768"),a.e("24340"),a.e("21555")]).then(a.bind(a,327356)).then(e=>({default:e.ExchangeRateCard}))),E=h.lazy(()=>Promise.all([a.e("87330"),a.e("26127"),a.e("52731")]).then(a.bind(a,544620)).then(e=>({default:e.StockCard}))),D=h.lazy(()=>Promise.all([a.e("26127"),a.e("20038")]).then(a.bind(a,70251)).then(e=>({default:e.WeatherCard}))),A=e=>{let{data:t,cardType:a,trackEvent:i}=e;switch(a){case I.Weather:return(0,g.jsx)(D,{data:t,onTrackEvent:i});case I.Stock:return(0,g.jsx)(E,{data:t,onTrackEvent:i});case I.ExchangeRate:return(0,g.jsx)(P,{data:t,onTrackEvent:i});default:return(0,g.jsx)(L,{})}},B=[I.Calendar,I.Hanzi,I.GaokaoYifenyiduan,I.GaokaoControlscore,I.GaokaoProvincescore];function G(e){let{data:t,cardType:a,isOnlyAladdinCard:i=!1}=e;return B.includes(a)&&!i?null:(0,g.jsx)(A,{data:t,cardType:a,trackEvent:V.default})}var O=a(629006);let R=[I.Calendar,I.Hanzi,I.GaokaoYifenyiduan,I.GaokaoControlscore,I.GaokaoProvincescore];function z(e){let{data:t,cardType:a,message:i}=e,n=(0,b.useChatSlice)("chatViewCoreStore").currentChatViewConfig,o=(0,O.isOnlyAladdinCardMessage)(i),r=i.conversation_id||"";return R.includes(a)&&!o?null:(0,g.jsx)(A,{data:t,cardType:a,trackEvent:(e,t)=>{let l=(0,j.getBotIdByConversationId)(r),d={...t,message_id:null==i?void 0:i.message_id,conversation_id:r,bot_id:l,chat_type:null==n?void 0:n.chatType,reply_id:null==i?void 0:i.reply_id,card_code:a,with_text:!o};(0,C.trackEvent)(e,d)}})}let W=(e,t,a)=>a.map(a=>{var i,o,r,l,d;let{data:c}=a;return""===e&&c?{...a,data:{...c,index:null!==(o=t[null!==(i=c.pos)&&void 0!==i?i:0])&&void 0!==o?o:-1}}:{...a,data:{...c,index:-1===c.pos?c.pos:(0,n.default)(t[null!==(r=c.pos)&&void 0!==r?r:0])||t[null!==(l=c.pos)&&void 0!==l?l:0]>e.length?e.length:t[null!==(d=c.pos)&&void 0!==d?d:0]}}}),U=e=>{let{message:t,metaInfos:a,messageText:i,viewOnly:n,renderHocMap:_,options:h,useNewVideoUI:f=!1}=e,S=a.filter(v.isEmbeddedMultimediaMetaInfo),b=S.map(e=>[e.data.pos,e.data.pos]).flat(2).filter(e=>void 0!==e&&-1!==e).map(e=>Number(e)),j=u.utf8.posCalcRange(i,b),C=W(i,j,S),T=(0,o.default)(C,e=>e.data.index),w=[],{isFinishedMessage:V=!0,hideVideoGroupHeader:I=!1}=null!=h?h:{},L=[];for(let[e,a]of(0,r.default)(T)){let o=Number(e);if(o<0){if(!V)continue;o=i.length}for(let r of(0,l.default)(a)){let{data:{insert_text:a=""}}=r,l=new DOMParser().parseFromString(a,"text/html"),u=l.querySelector("data-block")||l.querySelector("data-inline"),v=null==u?void 0:u.getAttribute("type");if(v===m.MdDataSlotType.ImageGroup){let{images:e=[],is_placeholder:a,is_empty_search:i}=(0,p.parseJSON)(null==u?void 0:u.getAttribute("value"),{});if(a)continue;let r=!!(a&&!i),l=!!i,d=e||r||l;(d||n)&&(L=[...L,...null!=e?e:[]]),w.push({range:o,render:()=>(0,g.jsx)(g.Fragment,{children:n?(0,g.jsx)(M.ImageBoxPure,{images:e,imagesList:L,imagesOptions:{isPosIndexZero:0===o}}):d&&(0,g.jsx)(N.ImageBox,{images:e,imagesList:L,message:t,imagesOptions:{isSearchingImage:r,isEmptySearch:l,isPosIndexZero:0===o}})})})}if(v===m.MdDataSlotType.VideoGroup||v===m.MdDataSlotType.VideoGroupScrollable){let{videos:a}=(0,p.parseJSON)(null==u?void 0:u.getAttribute("value"),{}),i=!!a;w.push({range:o,...-1===Number(e)?{type:"block"}:{},render:()=>{let e=()=>(0,g.jsx)(g.Fragment,{children:n?(0,g.jsx)(x,{videos:a,type:v===m.MdDataSlotType.VideoGroupScrollable?y.SearchVideoBoxType.List:void 0}):i&&(0,g.jsx)(k,{hideHeader:I,videos:a,message:t,useNewUIShow:f,type:v===m.MdDataSlotType.VideoGroupScrollable?y.SearchVideoBoxType.List:void 0})}),o=null==_?void 0:_.get(v);return o?o(e()):e()}})}if(v===m.MdDataSlotType.MindMap){let t=null==u?void 0:u.getAttribute("value");if(!t)continue;let a=JSON.parse(unescape(t));w.push({range:Number(e),type:"block",render:()=>{let e=()=>{let e=(0,c.useTranslateFn)();return(0,g.jsx)(s.LazyMindMap,{value:a.markdown_text,isDone:!0,t:(e,t)=>null!=t?t:"",handleRetry:()=>{},iconUrl:"",extName:e("brandName_doubao"),hideAction:!0,style:{pointerEvents:"none"},markmapOptions:{maxWidth:"100%"}})},t=null==_?void 0:_.get(v);return t?t(e()):e()}})}if(v===m.MdDataSlotType.LynxRuyi){let{data:e,ruyi_card_type:a}=(0,p.parseJSON)(null==u?void 0:u.getAttribute("value"),{}),r={};(0,d.default)(e)&&(r=(0,p.parseJSON)(e,{}));let{card_data:l}=null!=r?r:{},c=t&&!!l;w.push({range:o,type:"block",render:()=>(0,g.jsx)(g.Fragment,{children:n?(0,g.jsx)(G,{data:l,cardType:a,isOnlyAladdinCard:""===i||"\n"===i}):c&&(0,g.jsx)(z,{data:l,cardType:a,message:t})})})}}}return w}},878453:function(e,t,a){var i;a.d(t,{MdDataSlotType:function(){return n}});let n=((i={}).ImageGroup="image-group",i.VideoGroup="video-group",i.VideoGroupScrollable="video-group-scrollable",i.MindMap="mind-map",i.LynxRuyi="lynx_ruyi",i)},195624:function(e,t,a){a.d(t,{ReplaceableMetaSourceType:function(){return o},isBrandSuperscriptMetaInfo:function(){return d},isMemoryMetaInfo:function(){return c},isReplaceableMetaInfo:function(){return r},isSearchRefMetaInfo:function(){return l}});var i,n=a(458524);let o=((i={}).SearchCtrip="search_ctrip",i),r=e=>e.type===n.MetaType.Replaceable,l=e=>e.type===n.MetaType.WebDocReference,d=e=>e.type===n.MetaType.BrandSuperscript,c=e=>e.type===n.MetaType.CommonCard&&"memory"===e.data.card_type},241107:function(e,t,a){a.d(t,{batchConvertMetaInfoToUnionMetaInfo:function(){return l},convertMetaInfoToUnionMetaInfo:function(){return r},getReplaceTextGroups:function(){return d},isFPALink:function(){return c},isUnSupportedReplaceText:function(){return s}});var i=a(165482),n=a(712980),o=a(195624);let r=e=>e.type?{type:e.type,data:(0,i.parseJSON)(e.info,{})}:null,l=e=>e.map(r).filter(e=>!!e),d=e=>e.match(RegExp("\\[(?<title>.*)\\]\\((?<link>.*?)\\)"))||{},c=e=>{let t=(0,n.safeParseUrl)(e);return!!t&&!!t.searchParams.get("appletId")},s=(e,t)=>{let a=(0,n.safeParseUrl)(e);return!a||"sslocal:"===a.protocol&&t!==o.ReplaceableMetaSourceType.SearchCtrip||!!a.searchParams.get("appletId")&&!location.pathname.startsWith("/thread/")}}}]);
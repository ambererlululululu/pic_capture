"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["15699"],{949789:function(e,l,t){t.d(l,{default:function(){return r}}),t(713738);var i=t(430261),n=t(345660),r=(0,i.IconFactory)((0,n.jsx)(e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,n.jsx)("path",{fill:"currentColor",d:"M12.243 2c.39-.39 1.01-.448 1.451-.006l8.054 8.054c.382.382.439 1.01.003 1.445-.266.267-.915.471-1.417-.03l-1.199-1.192-3.2 3.2c-.096.095-.12.253-.12.383l-.442 6.304a.5.5 0 0 1-.149.36l-.569.567a1.005 1.005 0 0 1-1.422.01l-4.584-4.58-4.664 4.664a1 1 0 0 1-1.415 0l-.014-.015a1 1 0 0 1-.001-1.414l4.661-4.67-4.583-4.585a1 1 0 0 1 .002-1.43l.568-.567a.5.5 0 0 1 .358-.15l6.311-.434c.135 0 .306-.012.401-.107l3.201-3.2-1.194-1.199c-.38-.376-.415-1.03-.037-1.408"})}),{}))},612470:function(e,l,t){t.d(l,{SkillIcon:function(){return a}});var i=t(295779),n=t(713738),r=t(698392),o=t(689368),s=t(345660);let a=e=>{let{skill_type:l,colorful:t=!1,...a}=e,[c,u]=(0,n.useState)({});(0,n.useEffect)(()=>{let e;try{e=(0,r.getChatStore)("skillStore").subscribe(e=>e.skillMap,e=>{u(e)},{fireImmediately:!0})}catch(e){}return()=>{null==e||e()}},[]);let d=l?c[l]:void 0,{plugin:k}=(0,o.useSkillBarItemPlugin)(l),v=!!t&&(null==d?void 0:d.ColorfulIcon)||!!t&&(null==k?void 0:k.ColorfulIcon)||(null==d?void 0:d.Icon)||(null==k?void 0:k.icon)||i.default;return(0,s.jsx)(v,{...a})}},491649:function(e,l,t){t.d(l,{useSelectSkill:function(){return B},useChatSkillPopover:function(){return F}});var i=t(713738),n=t(695422),r=t(922851),o=t(698392),s=t(269249),a=t(971857),c=t(334312),u=t(604889),d=t(777422),k=t(198660),v=t(273637),p=t(178230),_=t(188355),h=t(949789),m=t(828438),g=t(756817),f=t(812650),S=t.n(f),y=t(689368),w=t(883393),b=t(915299),C=t(937627),x=t(398025),j=t(612470),I=t(44502),E=t(345660);let N=e=>{let{skill:l,isSelected:t,onClick:n,onShow:r,keydownDirection:o,"data-testid":s}=e,{ref:a,inView:c}=(0,m.useInView)({initialInView:!1,threshold:1}),u=(0,i.useRef)(null),d=(0,i.useCallback)(e=>{u.current=e,a(e)},[a]);return(0,i.useEffect)(()=>{if(t&&!c){var e,l,i,n;"ArrowDown"===o?null==u||null===(l=u.current)||void 0===l||null===(e=l.scrollIntoView)||void 0===e||e.call(l,{block:"end",inline:"nearest",behavior:"smooth"}):"ArrowUp"===o&&(null==u||null===(n=u.current)||void 0===n||null===(i=n.scrollIntoView)||void 0===i||i.call(n,{block:"start",inline:"nearest",behavior:"smooth"}))}},[t]),(0,i.useEffect)(()=>{c&&(null==r||r())},[c]),(0,E.jsx)("div",{ref:d,className:S()("skill-item-PCZiyN",{"skill-item-selected-fdA0Xt":t}),"data-testid":s,onClick:()=>null==n?void 0:n(),children:e.children},l.skill_type)},A=e=>{let{skill:l,keyword:t,isNarrowMode:i}=e;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(j.SkillIcon,{skill_type:l.skill_type,className:"skill-item-icon-PpROrZ"}),(0,E.jsx)("div",{className:"skill-item-name-FmLCcw",children:(0,E.jsx)(C.default,{sourceString:(i?l.show_name_short:l.show_name)||l.show_name,searchWords:t?[t]:[],highlightStyle:{color:"var(--s-color-text-primary, #000)",background:"transparent"}})}),(0,E.jsx)("div",{className:"skill-item-desc-MI7EMV",children:(0,E.jsx)(C.default,{sourceString:l.description,searchWords:t?[t]:[],highlightStyle:{fontWeight:"400",color:"var(--s-color-text-tertiary, rgba(0, 0, 0, 0.4))",background:"transparent"}})}),l.sticky&&(0,E.jsx)(h.default,{className:"p-2 !text-16 text-s-color-accents-blue"})]})},L=e=>{let{plugin:l}=(0,y.useSkillBarItemPlugin)(e.skill.skill_type),t=(0,E.jsx)(A,{...e}),n=(0,E.jsx)(N,{...e,onClick:()=>{var l;null===(l=e.onClick)||void 0===l||l.call(e,{})},children:t}),r=(null==l?void 0:l.Component)||(null==l?void 0:l.LiteComponent);return r?(0,E.jsx)(i.Suspense,{fallback:n,children:(0,E.jsx)(r,{skill:e.skill,from:e.from,onClick:e.pluginOnClick,renderContent:l=>{let{onClick:i,keepMorePopover:n}=l;return(0,E.jsx)(N,{...e,onClick:()=>{var l;null===(l=e.onClick)||void 0===l||l.call(e,{keepMorePopover:n,onlyReportEvent:!0}),null==i||i()},children:t})}})}):n},R=e=>{var l;let{width:t,from:o="more_skills",onSelectSkill:a,initialFocusRef:u,scene:k,trackParams:v,bottomSlot:p}=e,_=(0,I.useDisplaySkills)(),h="sm"===(0,w.useAppSizeType)(),m=(0,b.useTranslateFn)(),f=(0,s.useChatType)(),[y,C]=(0,i.useState)(""),j=(0,i.useRef)(""),N=(0,i.useRef)(!0),A=(0,i.useRef)(!1),R=(0,i.useRef)(!1),[T,D]=(0,i.useState)(""),B=(0,i.useMemo)(()=>{var e;return null!==(e=null==_?void 0:_.filter(e=>{var l,t;if(!y)return!0;let i=h?e.show_name_short:e.show_name,{description:n}=e;return(null==i?void 0:null===(l=i.toLocaleLowerCase())||void 0===l?void 0:l.includes(y.toLocaleLowerCase()))||(null==n?void 0:null===(t=n.toLocaleLowerCase())||void 0===t?void 0:t.includes(y.toLocaleLowerCase()))}))&&void 0!==e?e:[]},[_,y,h]),[F,P]=(0,i.useState)("skills_menu"===k?0:-1),V=(0,i.useRef)(null);(0,i.useEffect)(()=>((0,r.getChatService)("chatInputStoreService").then(e=>{null==e||e.updateSkillDropDownVisible(k)}),()=>{(0,r.getChatService)("chatInputStoreService").then(e=>{null==e||e.updateSkillDropDownVisible(void 0)})}),[]);let M=(0,i.useRef)({}),K=(e,l,t)=>{e&&!M.current[e]&&(M.current[e]=!0,(0,d.trackEvent)("chat_action_bar_show",{show_scene:"keyboard_at",show_position:"keyboard_at",position:l,...v,skill_name:(0,c.getSkillTeaNameByType)(e),is_top:t?"1":"0",skill_id:e.toString()}))},O=(0,i.useMemo)(()=>(0,g.default)(()=>(0,d.trackEvent)("input_bar_enter",{click_scene:"skills_search_bar",chat_type:f,...v}),1e3,{leading:!0,trailing:!1}),[v]);return(0,E.jsxs)("div",{className:"more-skills-content-container-G52xrE",style:{width:`${t}px`},onClick:()=>{var e;return null==u?void 0:null===(e=u.current)||void 0===e?void 0:e.focus()},"data-testid":"chat_input_more_skill_menu",children:[(0,E.jsx)("div",{className:"more-skill-input-TT1BkQ",children:(0,E.jsx)(x.default,{onFocus:O,onChange:e=>{j.current=e,""!==j.current&&(N.current=!1),!A.current&&(C(e),P(0))},onCompositionStart:()=>A.current=!0,onCompositionEnd:e=>(A.current=!1,C(e.currentTarget.value)),onKeyDown:e=>{"Enter"===e.key&&(R.current=A.current)},onKeyUp:e=>{switch(e.key){case"ArrowDown":D("ArrowDown"),P(e=>(e+1)%(null==B?void 0:B.length));break;case"ArrowUp":D("ArrowUp"),P(e=>(e-1+(null==B?void 0:B.length))%(null==B?void 0:B.length));break;case"Enter":if(!A.current&&F>-1&&(null==B?void 0:B[F])){var l;let e=null===(l=V.current)||void 0===l?void 0:l.children[F];(null==e?void 0:e.tagName.toLowerCase())==="div"&&e.click()}break;case"Escape":case"Tab":null==a||a();break;case"Backspace":if(N.current&&""===j.current){null==a||a();return}""===j.current&&(N.current=!0)}},ref:u,placeholder:m("search_skills_input_placeholder"),borderless:!0})}),(0,E.jsx)("div",{className:"py-8",children:(0,E.jsxs)("div",{ref:V,className:S()("skill-item-list-fgsVi_","flow-scrollbar"),"data-testid":"chat_footer_skill_bar",children:[(null==B?void 0:B.length)?null==B?void 0:null===(l=B.map)||void 0===l?void 0:l.call(B,(e,l)=>{var t;return(null==e?void 0:e.skill_type)?(0,E.jsx)(L,{skill:e,isSelected:l===F,keyword:y,isNarrowMode:h,keydownDirection:T,from:o,pluginOnClick:()=>null==a?void 0:a(e.skill_type,n.SkillFrom.KeyboardAt,{skipReport:!0},l,e.sticky),onClick:t=>null==a?void 0:a(e.skill_type,n.SkillFrom.KeyboardAt,t,l,e.sticky),onShow:()=>K(e.skill_type,l,e.sticky),"data-testid":`skill_bar_button_${e.skill_type}`},null!==(t=e.skill_type)&&void 0!==t?t:l):null}):(0,E.jsx)("div",{className:`
              flex items-center justify-center bg-s-color-bg-trans-primary p-10
              text-s-color-text-quaternary select-none
            `,children:m("search_skills_empty_info")}),null==p?void 0:p()]})})]})};var T=t(10597);let D=e=>e===n.SkillFrom.ClickSkill?"bottom_bar":e===n.SkillFrom.KeyboardAt?"keyboard_at":void 0,B=e=>{let{activeSkillType:l,trackParams:t}=e,i=(0,s.useChatId)(),{onClickGuestDisabled:n}=(0,T.useGuestInteract)({source:"unlog_click_skills",checkNewGuidanceAb:!0}),a=(0,v.default)(function(){let{skillType:e,skillFrom:i,sticky:n,recommendTag:o,showPosition:s,position:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=D(i);e?((0,d.trackEvent)("chat_action_bar_click",{is_recommended:(0,_.getTeaRecommendNameByTag)(o),show_scene:u,show_position:s,position:a,is_top:n?"1":"0",...t,skill_name:(0,c.getSkillTeaNameByType)(e),skill_id:e.toString()}),(0,r.getChatService)("chatInputStoreService").then(l=>{null==l||l.createSkillReportEvent({skillType:e,eventName:"skill_bar_open_input",meta:{skill_type:e,skill_type_str:(0,c.getSkillTypeStr)(e),skill_id:(0,c.getSkillTypeStr)(e),recommend_tag:o,click_scene:u,show_position:s,position:a}})})):(p.logger.persist.log({eventName:"skill_bar_button_click_close",meta:{skill_type:String(l),is_guest:!(0,k.getIsLoggedIn)(),recommend_tag:o,click_scene:u}}),(0,d.trackEvent)("skill_module_close",{show_scene:u,...t,skill_name:(0,c.getSkillTeaNameByType)(l),skill_id:null==l?void 0:l.toString()}))}),u=(0,v.default)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!await n())return;let{recommendTag:l,skillType:t,skillFrom:s,skipReport:c=!1}=e;c||a(e),(0,r.getChatService)("chatInputStoreService").then(e=>{null==e||e.updateSelectedRecommendSkill(l?{skill_type:t,tag:l}:void 0)}),t?(0,o.getChatSlice)("chatInputStore").updateActiveSkillTypeMap(null!=i?i:"",t,s):(0,o.getChatSlice)("chatInputStore").closeSkillPanel(null!=i?i:"")});return{onClickGuestDisabled:n,reportSelectSkill:a,selectSkill:u}},F=e=>{var l;let{selectSkill:t,reportSelectSkill:n,...r}=e,{chatInputRef:o}=(0,u.useChatRef)(),{chatId:c,chatType:d}=null!==(l=(0,s.useChatViewConfig)())&&void 0!==l?l:{},[k,v]=(0,i.useState)(!1),p=async function(){for(var e,l,i,n,r,s=arguments.length,a=Array(s),c=0;c<s;c++)a[c]=arguments[c];v(!1),await t(...a),(null===(l=o.current)||void 0===l?void 0:null===(e=l.getText)||void 0===e?void 0:e.call(l))==="@"&&(null===(r=o.current)||void 0===r||r.clear()),null==o||null===(n=o.current)||void 0===n||null===(i=n.focus)||void 0===i||i.call(n)},_=(0,a.useIsSamantha)(c||"",d),h=(e,l,t,i,r)=>{(null==t?void 0:t.onlyReportEvent)?n({skillType:e,skillFrom:l,showPosition:"keyboard_at",position:i,sticky:r}):p({skillType:e,skillFrom:l,showPosition:"keyboard_at",position:i,skipReport:null==t?void 0:t.skipReport}),(null==t?void 0:t.keepMorePopover)||v(!1)};return{moreVis:k,setMoreVis:v,enabled:_,popoverProps:{spacing:0,visible:k,onVisibleChange:v,content:e=>{let{initialFocusRef:l}=e;return(0,E.jsx)(R,{...r,initialFocusRef:l,onSelectSkill:h})},onClickOutSide:()=>p(),onEscKeyDown:()=>p(),trigger:"custom",position:"topLeft",style:{borderRadius:"16px",boxShadow:"0px 30px 100px 0px rgba(0, 0, 0, 0.15)"}}}}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["83632"],{268166:function(e,t,l){l.d(t,{default:function(){return o}}),l(713738);var i=l(430261),a=l(345660),o=(0,i.IconFactory)((0,a.jsx)(e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M13.5 17a2 2 0 0 0-1.082.318L8.5 19.837V17h-5V4h17v13zm7 2h-7l-5.46 3.51a1 1 0 0 1-1.54-.842V19h-3a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h17a2 2 0 0 1 2 2v13a2 2 0 0 1-2 2M13.721 7.206a.75.75 0 1 0-1.442-.412l-2 7a.75.75 0 1 0 1.442.412zm2.31.764a.75.75 0 1 0-1.061 1.06l1.47 1.47-1.47 1.47a.75.75 0 1 0 1.06 1.06l2-2a.75.75 0 0 0 0-1.06zm-7 0a.75.75 0 0 1 0 1.06L7.56 10.5l1.47 1.47a.75.75 0 1 1-1.061 1.06l-2-2a.75.75 0 0 1 0-1.06l2-2a.75.75 0 0 1 1.06 0",clipRule:"evenodd"})}),{}))},461420:function(e,t,l){l.d(t,{default:function(){return o}}),l(713738);var i=l(430261),a=l(345660),o=(0,i.IconFactory)((0,a.jsx)(e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12.009 1.5C6.198 1.5 1.5 6.192 1.5 11.997c0 4.64 3.01 8.568 7.186 9.958.522.105.713-.226.713-.504 0-.243-.017-1.077-.017-1.946-2.924.626-3.532-1.252-3.532-1.252-.47-1.216-1.166-1.529-1.166-1.529-.957-.643.07-.643.07-.643 1.06.07 1.618 1.078 1.618 1.078.939 1.598 2.453 1.147 3.062.869.087-.678.365-1.147.66-1.408-2.33-.244-4.784-1.147-4.784-5.18A4.1 4.1 0 0 1 6.39 8.626c-.104-.26-.47-1.338.104-2.78 0 0 .888-.278 2.888 1.077.857-.23 1.74-.346 2.628-.347.887 0 1.791.121 2.627.347 2-1.355 2.888-1.077 2.888-1.077.574 1.442.209 2.52.104 2.78.679.73 1.079 1.669 1.079 2.816 0 4.032-2.453 4.918-4.802 5.179.383.33.713.956.713 1.946 0 1.408-.017 2.538-.017 2.885 0 .278.192.609.713.504 4.176-1.39 7.186-5.318 7.186-9.958C22.517 6.192 17.802 1.5 12.009 1.5",clipRule:"evenodd"})}),{}))},204454:function(e,t,l){l.d(t,{isBetaEnv:function(){return i}});let i=!1},726393:function(e,t,l){l.d(t,{GithubLinkInputModal:function(){return C}});var i=l(461420),a=l(713738),o=l(812650),n=l.n(o),d=l(845647),r=l(746167),c=l(57392),s=l(666196),u=l(698392),p=l(212183),_=l(785926),h=l(230932),m=l(777422),g=l(710733),b=l(524129),f=l(682830),y=l(996776),v=l(559425);l(696067),l(680129);var k={"github-modal-wrapper":"github-modal-wrapper-sQ4sWN",githubModalWrapper:"github-modal-wrapper-sQ4sWN","github-modal-desc":"github-modal-desc-shAthV",githubModalDesc:"github-modal-desc-shAthV","github-modal-link-input-wrapper":"github-modal-link-input-wrapper-o9mXVt",githubModalLinkInputWrapper:"github-modal-link-input-wrapper-o9mXVt","github-modal-link-input":"github-modal-link-input-PtnZ54",githubModalLinkInput:"github-modal-link-input-PtnZ54","github-modal-link-input-error-tip":"github-modal-link-input-error-tip-jGw_X6",githubModalLinkInputErrorTip:"github-modal-link-input-error-tip-jGw_X6","github-modal-button":"github-modal-button-IbpULV",githubModalButton:"github-modal-button-IbpULV","github-modal-button-cancel":"github-modal-button-cancel-dqMiio",githubModalButtonCancel:"github-modal-button-cancel-dqMiio","github-modal-button-ok":"github-modal-button-ok-R7FZwC",githubModalButtonOk:"github-modal-button-ok-R7FZwC","github-modal-button-okdisable":"github-modal-button-okdisable-a2gK7D",githubModalButtonOkdisable:"github-modal-button-okdisable-a2gK7D","github-recommend-list":"github-recommend-list-AKH5qF",githubRecommendList:"github-recommend-list-AKH5qF","github-recommend-title":"github-recommend-title-z2vI4n",githubRecommendTitle:"github-recommend-title-z2vI4n","github-recommend-codebases":"github-recommend-codebases-yuQ3QY",githubRecommendCodebases:"github-recommend-codebases-yuQ3QY","github-recommend-codebase":"github-recommend-codebase-I1w_nT",githubRecommendCodebase:"github-recommend-codebase-I1w_nT","github-icon":"github-icon-ZLQoAO",githubIcon:"github-icon-ZLQoAO"},T=l(345660);function C(e){let{title:t,handleConfirm:l,handleCancel:o,t:C,validRemoteGithubUrl:w,recommendCodeBasePrompts:I,className:F,showRecommendCodebase:x=!1,extra:L}=e,N=(0,u.useChatSlice)("chatViewCoreStore").currentChatViewConfig,P=null==N?void 0:N.chatId,O=null==N?void 0:N.chatType,[S,A]=(0,a.useState)(""),[U,B]=(0,a.useState)(!1),[E,j]=(0,a.useState)(""),D=!!S&&!(0,f.isValidGithubUrl)(S),R=!!D||!!E,M={from:"click",conversationId:O===d.ChatType.NewThread?"":P,uploadFrom:r.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,botId:(0,p.getBotIdByConversationId)(P)||"",conversation_type:(0,_.conversationTypeByIdSelector)(h.useFeedStore.getState(),P)||1,skill_name:null,skill_id:"",chat_type:(O===d.ChatType.NewThread?"default_new":(0,p.getChatTypeForTea)("",P))||"other_default",upload_way:"add_link",upload_collection_way:"single",upload_type:"github",upload_from:r.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,upload_file_type:r.ChatTeaFileType.UPLOAD_FILE_TYPE_LINK,collection_name:"",collection_id:""};(0,a.useEffect)(()=>{(0,f.isCodeLink)(S)&&(0,m.trackEvent)("upload_status",{...M,meta_info:JSON.stringify({code_link:S}),success:"false",error_code:"unsupport_repotype"}),(0,f.isSSHLink)(S)&&(0,m.trackEvent)("upload_status",{...M,meta_info:JSON.stringify({code_link:S}),success:"false",error_code:"unsupport_repourl"})},[S]);let V=async function(e){try{B(!0);let{valid:t,errorMessage:l,metaInfo:i}=await w(e,!1);return t?j(void 0):((0,m.trackEvent)("upload_status",{...M,meta_info:JSON.stringify(i),success:"false",error_code:"unsupport_repoprivate"}),j(l)),{success:t,metaInfo:i}}finally{B(!1)}},z=n()([k["github-modal-button"],S?k["github-modal-button-ok"]:k["github-modal-button-okdisable"]]),W=n()([k["github-modal-button"],k["github-modal-button-cancel"]]),{sendMessage:G}=(0,s.useChatService)("chatMessageService"),K=(0,s.useChatService)("chatViewService"),Q=(0,s.useChatService)("chatTeaService"),q=async e=>{var t,l;let i;let{codebase_id:a,codebase_name:n,codebase_url:d,codebase_branch_name:r}=e,s=e.query||"",u={skill_id:b.SkillType.CodeAssistant.toString(),skill_type:b.SkillType.CodeAssistant};await (null==L?void 0:null===(t=L.onBeforeSendMessage)||void 0===t?void 0:t.call(L))!==!1&&(a&&(i=[{key:a,type:"link",identifier:a,localKey:a,name:n,url:d,extra:{repo_id:a,repo_name:n,ref:r}}]),G([{text:s,sendAttachments:i,reportParams:{scene:"sidebar_skill_click",sec_scene:"click_suggestedprompt_case",preset_prompt_type:"default_prompt",...null==L?void 0:L.reportParams},extraExt:{useSamanthaChat:"true",input_skill:JSON.stringify(u),send_from_skill_guidance_or_suggestion:"1"}}]),null==Q||Q.trackEvent("click_suggested_content",{...M,content_detail:e.item_type===g.CodeAssistantItemType.CodeBase?e.codebase_descirption:e.query,genre:e.item_type===g.CodeAssistantItemType.CodeBase?"github":"query"}),a&&i&&K.openCanvasPanel({messageId:"",conversationId:"",canvasLayoutState:c.CanvasLayoutState.CANVAS_ONLY,fileKey:a,attachments:[{key:a,type:"link",identifier:a,local_key:a,name:n,url:d,repo_id:a}],isCodeFile:!0,chatId:P,teaCtx:{skillType:b.SkillType.CodeAssistant}}),null==L||null===(l=L.sendGithubPopoverClickEvent)||void 0===l||l.call(L,"repo",e.codebase_descirption),o(!0))},H=(0,a.useCallback)(()=>{var e;o(!1),null==L||null===(e=L.sendGithubPopoverClickEvent)||void 0===e||e.call(L,"close")},[]),Z=(0,a.useCallback)(e=>{var t;o(e),null==L||null===(t=L.sendGithubPopoverClickEvent)||void 0===t||t.call(L,"cancel")},[]),J=(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("p",{className:n()(k["github-modal-desc"]),children:C("cici_web_ai_coding_repo_upload_explanation")}),(0,T.jsx)("div",{className:k["github-modal-link-input-wrapper"],children:(0,T.jsx)("input",{className:n()(k["github-modal-link-input"],R&&k.error),placeholder:C("cici_web_ai_coding_input_repo_link"),onChange:e=>{A(e.target.value)},autoFocus:!0})}),x&&(0,T.jsxs)("div",{className:k["github-recommend-list"],children:[(0,T.jsx)("span",{className:k["github-recommend-title"],children:C("web_ai_coding_repo_popup_repolist_title")}),(0,T.jsx)("div",{className:k["github-recommend-codebases"],children:null==I?void 0:I.map((e,t)=>(0,T.jsxs)("span",{className:k["github-recommend-codebase"],children:[(0,T.jsx)(i.default,{className:k["github-icon"]}),(0,T.jsx)("span",{onClick:()=>{null==q||q(e)},children:null==e?void 0:e.codebase_descirption})]}))})]}),R&&(0,T.jsx)("div",{className:k["github-modal-link-input-error-tip"],children:(0,T.jsx)("p",{children:E||C("cici_web_ai_coding_repo_limit")})})]});return(0,T.jsx)(y.default,{title:t||C("cici_web_ai_coding_repo_upload"),visible:!0,centered:!0,onCancel:H,maskClosable:!0,footer:(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(v.SamanthaButton,{className:W,type:"tertiary",onClick:()=>Z(!1),children:C("cancel")}),(0,T.jsx)(v.SamanthaButton,{type:"primary",loading:U,disabled:!S||D,className:z,style:{color:"fff"},onClick:async()=>{var e;let{success:t,metaInfo:i}=await V(S);t&&(l(S,JSON.stringify(i)),null==L||null===(e=L.sendGithubPopoverClickEvent)||void 0===e||e.call(L,"add_link"))},children:C("cici_web_ai_coding_add_repo_btn")})]}),okButtonProps:{loading:U,disabled:!S||D,className:z,style:{color:"fff"}},className:n()(k["github-modal-wrapper"],F),cancelButtonProps:{className:W},okText:C("cici_web_ai_coding_add_repo_btn"),children:J})}},236487:function(e,t,l){l.d(t,{useAddDir:function(){return _}});var i=l(746167),a=l(785926),o=l(230932),n=l(212183),d=l(334312),r=l(777422),c=l(915299),s=l(47563),u=l(720602),p=l(345660);let _=e=>{let{addDirAttachment:t,isNewThread:l,chatId:_,skillType:h,skillId:m,getPreGeneratedLocalMessageId:g,clearRefContent:b,setUploadedFileType:f,trackExtraParams:y}=e,v=(0,c.useTranslateFn)(),k=l?"":null!=_?_:"",T={conversation_id:k,conversation_type:(0,a.conversationTypeByIdSelector)(o.useFeedStore.getState(),k)||1,chat_type:(l?"default_new":(0,n.getChatTypeForTea)("",_))||"other_default",skill_name:h?(0,d.getSkillTeaNameByType)(h):"",skill_id:m,upload_way:"browse_folder",upload_collection_way:"multi",upload_type:"folder",upload_from:i.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,upload_file_type:i.ChatTeaFileType.UPLOAD_FILE_TYPE_FOLDER,...y};return{handleAddDir:async e=>{if(e.target.files){let a=Array.from(e.target.files),o=[],d=a[0].webkitRelativePath,c=null==d?void 0:d.split("/")[0];if(a.length>2e3){s.Toast.error(v("cici_web_ai_coding_directory_limit")),(0,r.trackEvent)("upload_status",{...T,collection_name:c,file_cnt:a.length,success:"false",error_code:"over_num"});return}let k=function(e){let t=0;for(let l of e)t=Math.max(t,l.webkitRelativePath.split("/").length);return t}(a);if(k>15){s.Toast.error(v("cici_web_ai_coding_directory_limit")),(0,r.trackEvent)("upload_status",{...T,collection_name:c,folder_level:k,success:"false",error_code:"over_level"});return}let C=a.reduce((e,t)=>e+t.size,0);if(C>0x2800000){s.Toast.error({content:(0,p.jsx)("div",{className:"text-left",children:v("cici_web_ai_coding_folder_size_limit")})}),(0,r.trackEvent)("upload_status",{...T,collection_name:c,size:C,folder_size:C,success:"false",error_code:"over_size"});return}if(a=a.filter(e=>0!==e.size||(o.push(e),!1)),o.length>0&&s.Toast.warning({content:(0,p.jsx)("div",{className:"text-left",children:1===o.length?v("cici_web_ai_coding_file_null_limit",{postProcess:"sprintf",sprintf:[o[0].name]}):v("cici_web_ai_coding_file_null_limit_mutiple",{postProcess:"sprintf",sprintf:[o[0].name,o.length]})})}),0===a.length){(0,r.trackEvent)("upload_status",{...T,collection_name:c,file_cnt:0,success:"false",error_code:"empty_folder"});return}await t({files:a,type:"directory",ctx:{conversationId:l?"":null!=_?_:"",chatType:(l?"default_new":(0,n.getChatTypeForTea)("",_))||"other_default",skillType:h,skillId:m,uploadId:await g(),uploadCollectionWay:"multi",uploadFrom:i.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,file_cnt:a.length,folder_size:C,folder_level:k,extraParams:{code_scene:(null==y?void 0:y.code_scene)||"chat",upload_file_type:"code_folder"}}}),null==f||f(u.EUploadType.DIR),null==b||b()}}}}},943550:function(e,t,l){l.d(t,{useAddFiles:function(){return u}});var i=l(845322),a=l(746167),o=l(230932),n=l(721118),d=l(785926),r=l(212183),c=l(334312),s=l(720602);let u=e=>{let{attachmentStates:t,addAttachment:l,isNewThread:u,chatId:p,conversationId:_,skillType:h,skillId:m,getPreGeneratedLocalMessageId:g,clearRefContent:b,setUploadedFileType:f,trackExtraParams:y}=e,v=(0,i.useFilterValidUploadCodeFiles)(),k=(0,o.useFeedStore)(n.mainConvBotIdSelector),T={conversation_id:u?"":null!=p?p:"",conversation_type:(0,d.conversationTypeByIdSelector)(o.useFeedStore.getState(),_)||1,chat_type:(u?"default_new":(0,r.getChatTypeForTea)("",p))||"other_default",skill_name:h?(0,c.getSkillTeaNameByType)(h):"",skill_id:m,uploadWay:"browse_folder",upload_type:"file",upload_token_length:"",upload_from:a.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,click_from:"click",botId:(0,r.getBotIdByConversationId)(_)||k||"",...y};return{handleAddFiles:async e=>{if(e.target.files){let{files:i}=e.target,o=Array.from(i),{filterFileList:n,abort:d}=await v({fileList:o,attachmentStates:t,toastImmediately:!0,trackParams:T});if(!d){for(let e of n)await l({file:e,type:"file",ctx:{conversationId:u?"":null!=p?p:"",chatType:(u?"default_new":(0,r.getChatTypeForTea)("",p))||"other_default",skillType:h||0,skillId:m||"",uploadFrom:a.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,botId:(0,r.getBotIdByConversationId)(_)||k||"",uploadWay:"browse_folder",from:"click",uploadCollectionWay:i.length+t.length>1?"multi":"single",uploadId:await g(),extraParams:{code_scene:(null==y?void 0:y.code_scene)||"chat",upload_file_type:"code_file"}}}),null==f||f(s.EUploadType.FILE);null==b||b()}}}}}},573461:function(e,t,l){l.d(t,{useAddGithub:function(){return n}});var i=l(746167),a=l(212183),o=l(720602);let n=e=>{let{addGitHubLink:t,isNewThread:l,chatId:n,conversationId:d,skillType:r,skillId:c,getPreGeneratedLocalMessageId:s,clearRefContent:u,setUploadedFileType:p,trackExtraParams:_}=e;return{handleAddGithubLink:async(e,h)=>{await t({url:e,ctx:{conversationId:l?"":null!=n?n:"",chatType:(l?"default_new":(0,a.getChatTypeForTea)("",n))||"other_default",skillType:r||0,skillId:c||"",uploadFrom:i.ChatTeaUploadFrom.UPLOAD_FROM_PULL_CODE,botId:(0,a.getBotIdByConversationId)(d)||"",uploadWay:"add_link",from:"click",uploadCollectionWay:"single",uploadId:await s(),metaInfo:h,extraParams:{code_scene:(null==_?void 0:_.code_scene)||"chat",upload_file_type:"github_link"}}}),null==u||u(),null==p||p(o.EUploadType.REPO)}}}},720602:function(e,t,l){var i;l.d(t,{EUploadType:function(){return a}});let a=((i={}).FILE="FILE",i.DIR="DIR",i.REPO="REPO",i)},118098:function(e,t,l){l.d(t,{UploadButton:function(){return _}});var i=l(713738),a=l(436114),o=l(812650),n=l.n(o),d=l(986443),r=l(837921),c=l(214902),s={"chat-input-icon":"chat-input-icon-btdgGw","chat-input-icon__disabled":"chat-input-icon__disabled-_Zf5gP","chat-input-icon-area":"chat-input-icon-area-MpWPWn",popover:"popover-NoVv7e"},u=l(345660);let p=e=>{let{disabled:t=!1,onClick:l,popoverContent:i,toolTip:o,isOverflow:p,isToolButtonSmall:_,borderlessTheme:h=!0,disableFocusListener:m=!1,renderIcon:g,className:b,popoverProps:f,renderCustomButton:y}=e,v="function"==typeof y,k=h?(0,u.jsx)("div",{className:n()(s["chat-input-icon"],{[s["chat-input-icon__disabled"]]:t},b),onClick:t||v?a.default:l,children:(0,u.jsx)("div",{"data-testid":"upload_file_button",className:s["chat-input-icon-area"],children:g()})}):(0,u.jsx)(d.ToolButtonUI,{isOverflow:p,small:_,renderIcon:g,buttonProps:{disabled:t,"data-testid":"upload_file_button"},onMouseUp:t||v?a.default:l});return v?(0,u.jsx)(u.Fragment,{children:y({onClick:l,originButton:k})}):i?(0,u.jsx)(r.default,{className:s.popover,clickToHide:!0,content:i,trigger:"click",position:"topLeft",...f,children:k}):o&&!t?(0,u.jsx)(c.SamanthaTooltip,{content:o,position:"top",disableFocusListener:m,children:k}):k},_=(0,i.forwardRef)(function(e,t){let{accept:l="",multiple:a=!1,onFileChange:o,onOpenFileDialogInterceptor:n,...d}=e,{popoverContent:r,onClick:c}=d,s=(0,i.useRef)(null),_=async e=>{!1!==await (null==n?void 0:n())&&s.current&&(null==c||c(e),s.current.value="",s.current.click())};return(0,i.useImperativeHandle)(t,()=>({click:()=>_()})),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(p,{...d,onClick:e=>{!r&&(_(),null==e||e.stopPropagation())}}),(0,u.jsx)("input",{ref:s,"data-testid":"upload-file-input",className:"hidden",multiple:a,type:"file",accept:l,onChange:o})]})})}}]);
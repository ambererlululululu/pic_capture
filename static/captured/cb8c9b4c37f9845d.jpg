"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["3987"],{362330:function(e,t,l){l.d(t,{ChatInputEventBus:function(){return n}});class n{on(e,t){var l;this.listeners[e]||(this.listeners[e]=[]),t&&(null===(l=this.listeners[e])||void 0===l||l.push(t))}off(e,t){var l,n;if(!this.listeners[e])return;let i=null===(l=this.listeners[e])||void 0===l?void 0:l.filter(e=>e!==t);this.listeners[e]=[],i&&(null===(n=this.listeners[e])||void 0===n||n.push(...i))}get(e){return this.listeners[e]||[]}constructor(){var e,t,l;t=void 0,(e="symbol"==typeof(l=function(e,t){if("object"!=typeof e||!e)return e;var l=e[Symbol.toPrimitive];if(void 0!==l){var n=l.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e="listeners","string"))?l:l+"")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,this.listeners={}}}},741991:function(e,t,l){l.d(t,{UploadConsumer:function(){return o},UploadProvider:function(){return i}});let n=(0,l(713738).createContext)({supportedFileTypes:[]}),i=n.Provider,o=n.Consumer},527992:function(e,t,l){l.d(t,{GenericFileUploadButton:function(){return V}});var n=l(713738),i=l(453157),o=l(214071),a=l(42869),r=l(698392),s=l(783147),u=l(242315),d=l(761835),c=l(971857),p=l(198660),h=l(273637),v=l(671940),f=l(812650),_=l.n(f),m=l(86091),C=l(300841),g=l(10597),b=l(212183),k=l(604889),S=l(204454),I=l(18244),x=l(777422),y=l(915299),T=l(949932),B=l(741991),w=l(424785),j=l(345660);let E=e=>{let{onClickClose:t,onClickUpload:l}=e,n=(0,y.useTranslateFn)(),i=(0,h.default)(()=>{(0,x.trackEvent)("pin_button_popup_click",{button_name:n("skill_copliotreading_2M_acknowledge")}),null==t||t()}),o=(0,h.default)(()=>{(0,x.trackEvent)("pin_button_popup_click",{button_name:n("skill_copliotreading_2M_upload_now")}),null==l||l()});return(0,j.jsxs)("div",{className:"wrapper-b9mtcp",children:[(0,j.jsx)("div",{className:"title-ZWJkxX",children:n("skill_copliotreading_3M_promotion_title")}),(0,j.jsx)("div",{className:"desc-VPHJfr",children:n("skill_copliotreading_3M_promotion_content")}),(0,j.jsxs)("div",{className:"buttonGroup-XKqjmt",children:[(0,j.jsx)(w.default,{className:"cancelButton-v2lCcD",onClick:i,children:n("skill_copliotreading_2M_acknowledge")}),(0,j.jsx)(w.default,{theme:"solid",type:"tertiary",className:"uploadButton-Kb1n50",onClick:o,children:n("skill_copliotreading_2M_upload_now")})]})]})};var U=l(118098),F=l(547338);let L=e=>{let{disabled:t,onSubmitFiles:l,ultraLongTextGuideCanActive:o,hideUltraLongTextGuide:a,enableCodeSkillRelate:u,onFileChange:f,renderCustomButton:w,reportParams:L,...M}=e,A=(0,y.useTranslateFn)(),{chatInputRef:N}=(0,k.useChatRef)(),{chatId:P,chatType:D}=(0,r.useChatSlice)("chatViewCoreStore",e=>{var t,l;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(l=e.currentChatViewConfig)||void 0===l?void 0:l.chatType}},i.shallow),G=(0,r.useChatSlice)("chatInputStore",e=>e.activeSkillTypeMap[null!=P?P:""]),V=(0,b.getBotIdByConversationId)(P),O=(0,F.useUploadSupportedFileTypesInSamantha)(u),R=(0,p.useIsLoggedIn)(),K=(0,s.useBotSendFileEnabled)(null!=P?P:"",D),W=(0,c.useIsSamantha)(P||"",D),{uploadFileAllowedTypes:$,enabledSendMultiFileMessage:H,enableImageVlm:J,uploadMultiEntityConf:{maxFileCount:X,maxImageCount:q}}=(0,d.useAttachmentUploadConfig)(),Z=H||S.isBetaEnv,z=W&&Z||(0,C.isLongCtxBot)(V)?X:1,Q=(0,n.useMemo)(()=>W?O:(0,C.isLongCtxBot)(V)?T.SupportedFileExtsInLongCtxBot:$,[W,O,V,$]),Y=Q.filter(e=>!!e).map(e=>`.${e}`).join(", "),{supportedCodeFileTypesInFree:ee}=(0,I.useSupportCommonCodeTypes)(),et=(0,n.useMemo)(()=>u?ee.join(","):"",[ee,u]),el=(0,n.useMemo)(()=>J&&q?A("multiimage_exceed_limit",{postProcess:"sprintf",sprintf:[q]}):null,[J,q]),en=(e,t)=>{let n="dataTransfer"in e?e.dataTransfer.files:e.target.files;n&&0!==n.length&&l([...n],t)},{onClickGuestDisabled:ei}=(0,g.useGuestInteract)({source:"unlog_click_upload",checkNewGuidanceAb:!0}),eo=!!R&&t,ea=(0,n.useRef)(null),er=(0,h.default)(()=>{var e;null==a||a(),null===(e=ea.current)||void 0===e||e.click()}),es=(0,h.default)(e=>{e?(0,x.trackEvent)("pin_button_popup_show"):null==a||a()}),eu=(0,n.useMemo)(()=>o?{popoverContent:(0,j.jsx)(E,{onClickClose:a,onClickUpload:er}),popoverProps:{showArrow:!0,style:{padding:0},onVisibleChange:es}}:{},[o]);return(0,j.jsxs)(B.UploadProvider,{value:{uploadButtonControllerRef:ea,supportedFileTypes:Q},children:[K&&(0,j.jsx)(U.UploadButton,{ref:ea,...eu,...M,toolTip:(0,j.jsxs)("ul",{className:"m-0 p-0 pl-18 text-11 leading-14",children:[(0,j.jsx)("li",{children:A("multifiles_exceed_limit",{postProcess:"sprintf",sprintf:[z]})}),el,(0,j.jsx)("li",{children:A("multifiles_file_type",{postProcess:"sprintf",sprintf:[Q.filter(e=>!ee.includes(e)).join("\u3001")]})}),u&&(0,j.jsx)("li",{children:`\u{4EE3}\u{7801}\u{6587}\u{4EF6}\u{FF1A}${ee.slice(0,4).join("\u3001")}\u{7B49}\u{7C7B}\u{578B}`})]}),renderIcon:function(){let{className:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,j.jsx)(v.default,{className:_()("block",e)})},accept:`${Y},${et}`,multiple:z>1,onOpenFileDialogInterceptor:ei,disabled:eo,onClick:async()=>{var e;(0,x.trackEvent)("pin_button_click",{upload_id:await (0,d.getPreGeneratedLocalMessageIdWithDefault)({chatId:null!=P?P:"",skillType:G}),button_name:"upload_file",click_from:"chat_enter_bar",...L}),(0,x.trackEvent)("click_upload_file_entrance",{bot_id:(0,b.getBotIdByConversationId)(P),current_page:"chat"}),null===(e=N.current)||void 0===e||e.blur()},onFileChange:e=>{null==f||f(),en(e,{from:"click",uploadWay:"browse_folder"})},renderCustomButton:w}),!eo&&(0,j.jsx)(m.UploadDropArea,{onDrop:e=>{null==f||f(),en(e,{from:"drag",uploadWay:"drag_drop"})},maxFileCount:z})]})};var M=l(513033),A=l(163603),N=l(968086),P=l(910214),D=l(231149);let G=e=>{var t,l,i,o;let{isLoggedIn:a}=e,[r,s]=(0,n.useState)(!1),u=null!==(o=null===(i=(0,N.usePrefetchUserSetting)())||void 0===i?void 0:null===(l=i.data)||void 0===l?void 0:null===(t=l.ai_reader)||void 0===t?void 0:t.enable_ult)&&void 0!==o&&o;return(0,D.default)(async()=>{if(a){var e;let{data:t}=await P.samanthaApiService.GetUnreadNoticeInfo();s(0===Number(null!==(e=null==t?void 0:t.ultra_long_text_notice_time)&&void 0!==e?e:-1))}},{cacheKey:"useUltraLongTextGuide"}),{ultraLongTextGuideCanActive:r&&u,hideUltraLongTextGuide:(0,n.useCallback)(()=>{s(!1),P.samanthaApiService.MarkUltraLongTextRead()},[])}},V=e=>{let{className:t,enableUpload:l,onAfterSendMessage:v,disabled:f,onFileChange:_,isToolButtonSmall:m,isOverflow:C,renderCustomButton:g,reportParams:b}=e,{uploadFiles:k}=(0,A.useInputUploadFiles)({enableUpload:l,onAfterSendMessage:v}),{ultraLongTextGuideCanActive:S,hideUltraLongTextGuide:I}=G({isLoggedIn:(0,p.useIsLoggedIn)()}),{chatId:x,chatType:y,isImmersiveMode:T}=(0,r.useChatSlice)("chatViewCoreStore",e=>{var t,l,n;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(l=e.currentChatViewConfig)||void 0===l?void 0:l.chatType,isImmersiveMode:null===(n=e.currentChatViewConfig)||void 0===n?void 0:n.isImmersiveMode}},i.shallow),B=(0,r.useChatSlice)("chatInputStore",e=>e.activeSkillTypeMap[null!=x?x:""]),w=(0,c.useIsSamantha)(x||"",y),{isNewChatInputInChat:E}=(0,u.useNewChatInputAb)({chatId:x,chatType:y}),U=(0,r.useChatSlice)("deepThinkingControlStore",e=>e.enableDeepThinkingSwitch&&!B&&!T&&w),F=(0,s.useEnableCodeSkillRelate)({chatId:x,chatType:y,skillType:B,exemptFromCodingReverse:!0}),N=(0,A.useCheckIsSupportedFileType)(),P=(0,d.useAttachmentStates)({chatId:null!=x?x:"",skillType:B}),{addLink:D}=(0,d.useAttachmentActions)({chatId:null!=x?x:"",skillType:B}),V=(0,a.useSuperTaskStore)(e=>e.isSuperTaskEnableByConvId(x)&&!B&&!T&&w),O=(0,h.default)((e,t)=>{let{isValidLink:l,event:n,trimText:i,files:a}=t;!V&&w&&l&&0===P.length&&(n.preventDefault(),D({url:i}));let r=[...a].filter(e=>{var t;return null===(t=null==N?void 0:N(e))||void 0===t||t});(0,o.default)(r)||i||(n.preventDefault(),k([...r],{from:"paste",uploadWay:"paste"}))});return(0,n.useEffect)(()=>(M.fileUploadButtonEventBus.on("onPaste",O),()=>{M.fileUploadButtonEventBus.off("onPaste",O)}),[]),(0,j.jsx)(L,{className:t,onSubmitFiles:k,isToolButtonSmall:m,isOverflow:C,disabled:f,ultraLongTextGuideCanActive:S,hideUltraLongTextGuide:I,enableCodeSkillRelate:F,onFileChange:_,renderCustomButton:g,reportParams:b,borderlessTheme:!E&&!U})}},513033:function(e,t,l){l.d(t,{fileUploadButtonEventBus:function(){return n}});let n=new(l(362330)).ChatInputEventBus}}]);
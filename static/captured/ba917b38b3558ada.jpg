"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["9539"],{10042:function(e,t,a){a.d(t,{compressor:function(){return d},getImageSizeLimit:function(){return n}});var l=a(441259),o=a(643404),i=a(856392);let n=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,l.isAppleWebkit)()||e?0x1e00000:0xa00000},r=e=>`${Number(e/1048576).toFixed(3)} MB`,u={maxSizeMB:10,maxWidthOrHeight:2560,useWebWorker:!0},d=async(e,t,n)=>{var d,s;let c=(0,i.createReportEvent)({eventName:"uploader_compress_image"});if(!(null==e?void 0:null===(d=e.type)||void 0===d?void 0:d.includes("image/gif"))&&((null==e?void 0:null===(s=e.type)||void 0===s?void 0:s.includes("image/svg"))||e.size.valueOf()<(null!=n?n:0xa00000)||(0,l.isAppleWebkit)()))return c.success({meta:{skip:1,type:e.type}}),e;try{let{default:l}=await (0,o.retryLoad)(()=>a.e("9598").then(a.bind(a,883230))),i=await l(e,{...u,...t});return c.success({meta:{skip:0,type:e.type,before_size:r(e.size),after_size:r(i.size)}}),i}catch(t){return c.error({reason:"uploader_compress_image_failed",error:t,meta:{type:e.type}}),e}}},563143:function(e,t,a){a.d(t,{fileIsImage:function(){return l},getQuoteData:function(){return o}});let l=e=>{var t;return!!e&&e instanceof Blob&&(null===(t=e.type)||void 0===t?void 0:t.startsWith("image"))},o=e=>({is_quote:+!!e,quote_type:e?"attachment"===e.type?"file":"url":void 0,collection_id:(null==e?void 0:e.type)==="attachment"?null==e?void 0:e.fileKey:(null==e?void 0:e.type)==="link"?null==e?void 0:e.link:void 0})},986443:function(e,t,a){a.d(t,{ToolButtonUI:function(){return d}});var l=a(713738),o=a(812650),i=a.n(o),n=a(559425),r={button:"button-VMDZon",overflow:"overflow-jQwWSh",active:"active-yFXB5l",small:"small-lWyHoI"},u=a(345660);let d=(0,l.forwardRef)(function(e,t){let{className:a,renderIcon:l,title:o,small:d,isOverflow:s,active:c,renderExtra:p,buttonProps:h,onMouseUp:m,onMouseEnter:v,...f}=e,y=null==l?void 0:l({className:d?"!text-14 p-2":"!text-16"}),_=c&&!(null==h?void 0:h.disabled);return(0,u.jsx)(n.SamanthaButton,{ref:t,"data-checked":_,...f,type:s?"quartary":"tertiary",icon:y,size:d?"small":"medium",onMouseUp:m,onMouseEnter:v,...h,className:i()(a,r.button,s&&r.overflow,_&&r.active,d&&r.small,null==h?void 0:h.className),children:(o||p)&&(0,u.jsxs)("div",{className:i()("flex items-center",s&&!d&&"ml-8"),children:[o,null==p?void 0:p()]})})})},163603:function(e,t,a){a.d(t,{useCheckIsSupportedFileType:function(){return N},useInputUploadFiles:function(){return M}});var l=a(713738),o=a(453157),i=a(544044),n=a(746167),r=a(845647),u=a(666196),d=a(698392),s=a(783147),c=a(300841),p=a(761835),h=a(23226),m=a(971857),v=a(721118),f=a(230932),y=a(785926),_=a(212183),g=a(604889),C=a(563143),I=a(631122),T=a(204454),w=a(10042),S=a(915299),F=a(949932),k=a(78346),B=a(296493),A=a(845322),U=a(547338);let b=(e,t)=>{let a=(0,m.useBotConfigByConversationId)(e,t),o=(0,m.useIsSamantha)(e,t),i=(0,l.useMemo)(()=>null==a?void 0:a.some(e=>"disable_function"===e.conf_group_key&&"disable_attachment_area"===e.conf_key&&"1"===e.conf_value),[a]);return!!o||!i},N=()=>{let{chatId:e,chatType:t}=(0,d.useChatSlice)("chatViewCoreStore",e=>{var t,a;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(a=e.currentChatViewConfig)||void 0===a?void 0:a.chatType}},o.shallow),a=(0,m.useIsSamantha)(null!=e?e:"",t),i=(0,d.useChatSlice)("chatInputStore",t=>e?t.activeSkillTypeMap[e]:void 0),n=(0,s.useEnableCodeSkillRelate)({chatId:e,chatType:t,skillType:i}),{uploadFileAllowedTypes:r}=(0,p.useAttachmentUploadConfig)(),u=(0,U.useUploadSupportedFileTypesInSamantha)(n);return(0,l.useCallback)(e=>{let t=(0,F.getFileExt)(e.name);return(a?u:r).includes(t)},[a,r])},O=e=>{let{beforeUpload:t}=null!=e?e:{},{chatId:a,chatType:l}=(0,d.useChatSlice)("chatViewCoreStore",e=>{var t,a;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(a=e.currentChatViewConfig)||void 0===a?void 0:a.chatType}},o.shallow),u=(0,m.useIsSamantha)(null!=a?a:"",l),{chatInputRef:c}=(0,g.useChatRef)(),I=()=>{(0,k.sleep)(50).then(()=>{var e,t;null===(t=c.current)||void 0===t||null===(e=t.attachmentAreaScrollToBottom)||void 0===e||e.call(t)})},T=(0,d.useChatSlice)("chatInputStore",e=>a?e.activeSkillTypeMap[a]:void 0),w=(0,p.useAttachmentStates)({chatId:null!=a?a:"",skillType:T}),{addAttachment:S,getPreGeneratedLocalMessageId:F}=(0,p.useAttachmentActions)({chatId:null!=a?a:"",skillType:T}),B=(0,h.useEnableSkillGuidance)(),U=B?n.ChatTeaUploadFrom.UPLOAD_FROM_READ_SUMMARIZE_MODULE:n.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,b=B?"pdf_read_detailpage_upload":void 0,N=(0,s.useEnableCodeSkillRelate)({chatId:a,chatType:l,skillType:T,exemptFromCodingReverse:!0}),O=(0,A.useFilterValidUploadFilesInSamanthaBot)(N,!0),L=async(e,o)=>{let n=(0,v.mainConvBotIdSelector)(f.useFeedStore.getState())||await new Promise(e=>{let t=f.useFeedStore.subscribe(v.mainConvBotIdSelector,a=>a&&(e(a),t()))}),u={conversation_id:a,conversation_type:(0,y.conversationTypeByIdSelector)(f.useFeedStore.getState(),a)||1,chat_type:l,skill_name:null==T?void 0:T.toString(),skill_id:null==T?void 0:T.toString(),upload_id:await (null==F?void 0:F()),duration:"0",upload_way:o.uploadWay,upload_collection_way:e.length+w.length>1?"multi":"single",collection_id:(0,i.default)(),upload_token_length:"",upload_from:U,click_scene:b},d=await O(e,w,{trackParams:u});if(t)try{if(!await t(e))return!1}catch(e){return!1}return d.forEach(async t=>{var i;let u=null!==(i=await (null==F?void 0:F()))&&void 0!==i?i:"";await S({file:t,type:(0,C.fileIsImage)(t)?"image":"file",ctx:{conversationId:l===r.ChatType.NewThread?"":null!=a?a:"",chatType:(l===r.ChatType.NewThread?"default_new":(0,_.getChatTypeForTea)("",a))||"other_default",skillType:T||0,skillId:String(T||""),uploadFrom:U,clickScene:b,botId:(0,_.getBotIdByConversationId)(a)||n||"",uploadWay:o.uploadWay,from:o.from,uploadCollectionWay:e.length+w.length>1?"multi":"single",uploadId:u}})}),I(),!1},M=async function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];if(u)return L(...t)};return{rawUploadFiles:L,uploadFiles:M}},L=e=>{var t,a;let l=(0,S.useTranslateFn)(),{sendMessage:i}=(0,u.useChatService)("chatMessageService"),{chatInputRef:h}=(0,g.useChatRef)(),y=()=>{(0,k.sleep)(50).then(()=>{var e,t;return null===(t=h.current)||void 0===t?void 0:null===(e=t.attachmentAreaScrollToBottom)||void 0===e?void 0:e.call(t)})},{chatId:A,chatType:U}=(0,d.useChatSlice)("chatViewCoreStore",e=>{var t,a;return{chatId:null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId,chatType:null===(a=e.currentChatViewConfig)||void 0===a?void 0:a.chatType}},o.shallow),N=(0,m.useIsSamantha)(null!=A?A:"",U),L=(0,_.getBotIdByConversationId)(A),M=(0,d.useChatSlice)("chatInputStore",e=>A?e.activeSkillTypeMap[A]:void 0),W=(0,p.useAttachmentStates)({chatId:null!=A?A:"",skillType:M}),{addAttachment:x,getPreGeneratedLocalMessageId:D,clearAllAttachments:E,updatePreGeneratedLocalMessageId:P}=(0,p.useAttachmentActions)({chatId:null!=A?A:"",skillType:M}),z=(0,I.useToast)(),R=U===r.ChatType.NewThread&&null!==(a=null===(t=(0,v.mainConversationLinkSelector)(f.useFeedStore.getState()))||void 0===t?void 0:t.conversationId)&&void 0!==a?a:A,{uploadFileMaxSize:V,uploadFileAllowedTypes:G,enabledSendMultiFileMessage:H,uploadMultiEntityConf:{maxFileSize:j}}=(0,p.useAttachmentUploadConfig)(),q=H||T.isBetaEnv,K=N&&q?j:Number(V),Q=(0,s.useBotSendImageEnabled)(null!=A?A:"",U),Z=(0,s.useBotSendFileEnabled)(null!=A?A:"",U),X=b(null!=A?A:"",U),$=e=>{let t=(0,F.getFileExt)(e.name);return G.includes(t)},{uploadFiles:J}=O();return{uploadFiles:async(t,a)=>{if((0,c.isLongCtxBot)(L))return J(t,a);if(!Q&&!Z)return z.error("Can not upload."),!1;if(t.length>1)return z.error(l("multiple_files_not_supported")),!1;if((0,C.fileIsImage)(t[0])){let o=t[0];if(Q){let u=await (0,w.compressor)(o);u.size>(0,w.getImageSizeLimit)()?z.error(l("image_oversize")):X?(await E({}),await P(),await x({file:u,type:"image",ctx:{conversationId:U===r.ChatType.NewThread?"":null!=R?R:"",chatType:(U===r.ChatType.NewThread?"default_new":(0,_.getChatTypeForTea)("",R))||"other_default",skillType:0,skillId:"",uploadFrom:n.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,botId:(0,_.getBotIdByConversationId)(R)||"",from:a.from,uploadCollectionWay:t.length+W.length>1?"multi":"single",uploadId:await D(),uploadWay:a.uploadWay}}),y()):(await i([{image:o,preGeneratedLocalMessageId:await D(),reportParams:{from:a.from,scene:"album"}}]),await (null==e?void 0:e()))}else Z?$(o)?o.size>K?z.error(l("file_size_over_limit",{postProcess:"sprintf",sprintf:[o.name,(0,B.convertBytes)(K)]})):X?(await E({}),await P(),await x({file:o,type:"file",ctx:{conversationId:U===r.ChatType.NewThread?"":null!=R?R:"",chatType:(U===r.ChatType.NewThread?"default_new":(0,_.getChatTypeForTea)("",R))||"other_default",skillType:0,skillId:"",uploadFrom:n.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,botId:(0,_.getBotIdByConversationId)(R)||"",from:a.from,uploadCollectionWay:t.length+W.length>1?"multi":"single",uploadId:await D(),uploadWay:a.uploadWay}}),y()):(await i([{file:o,preGeneratedLocalMessageId:await D(),reportParams:{scene:"file",from:a.from}}]),await (null==e?void 0:e())):z.error(l("file_not_supported")):z.error("Can not upload.");return!1}{let o=t[0];return $(o)?Z?X?(await x({file:o,type:"file",ctx:{conversationId:U===r.ChatType.NewThread?"":null!=R?R:"",chatType:(U===r.ChatType.NewThread?"default_new":(0,_.getChatTypeForTea)("",R))||"other_default",skillType:0,skillId:"",uploadFrom:n.ChatTeaUploadFrom.UPLOAD_FROM_UPLOAD_PINBUTTON,botId:(0,_.getBotIdByConversationId)(R)||"",from:a.from,uploadCollectionWay:t.length+W.length>1?"multi":"single",uploadId:await D(),uploadWay:a.uploadWay}}),y()):(await i([{file:o,preGeneratedLocalMessageId:await D(),reportParams:{scene:"file",from:a.from}}]),await (null==e?void 0:e())):z.error("Can not upload."):z.error(l("file_not_supported")),!1}}}},M=function(){let{enableUpload:e=!0,onAfterSendMessage:t,beforeUpload:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{uploadFiles:l}=O({beforeUpload:a}),{uploadFiles:o}=L(t);return{uploadFiles:async(t,a)=>{if(!e||await l(t,a)===!1||await o(t,a)===!1)return}}}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["33382"],{631150:function(e,t,s){s.d(t,{Av:function(){return S},Do:function(){return p},GI:function(){return d},Ji:function(){return f},NN:function(){return E},bc:function(){return v},qo:function(){return h},sT:function(){return m},sd:function(){return A},ve:function(){return g},zf:function(){return M}});var i=s(511451),n=s(477041),a=s(524518),r=s(607278),l=s(444614),o=s(828652),_=s(223638),c=s.n(_),u=s(19755);let d=e=>(0,i.Z)(e)&&e.every(n.Z),g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{timeout:s}=t,i=new Promise((t,s)=>{c()(e,e=>{e?s(e):t()})});(0,a.Z)(s)?await Promise.race([i,(0,u.GR)(s)]):await i},E=e=>(0,r.Z)(e)?e():e,S=e=>!(0,l.Z)(e),v=e=>{if(e<0)return"0B";let t=Math.floor(e);return t<1024?`${t}B`:t<1048576?`${Math.round(t/1024)}KB`:t<0x40000000?`${Math.round(t/1048576)}MB`:`${Math.round(t/0x40000000)}GB`},m=e=>{let t=Number(e);if(!isNaN(t))return t},M=e=>{if((0,n.Z)(e))return e},f=e=>{if((0,o.Z)(e))return e},p=(e,t)=>{for(let s of e){let e=t(s);if(!1!==e)return[s,e]}},h=e=>(0,l.Z)(e)?[]:(0,i.Z)(e)?e:[e],A=(e,t)=>null==e?void 0:e[t]},915234:function(e,t,s){s.d(t,{v:function(){return r}});var i=s(177056),n=s(210230);function a(e,t,s){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{setCommonContextParams(e){this.params.common=e}updateCommonContextParamsIfExist(e){this.params.common&&(this.params.common={...this.params.common,...(0,i.Z)(e,n.Z)})}mergeMessageParamsRecord(e,t){var s,i;let n={...null!==(i=null===(s=this.params.slardar)||void 0===s?void 0:s[e])&&void 0!==i?i:{}};if(!t)return n;for(let e of Object.keys(t))void 0===n[e]?n[e]=t[e]:n[e]={...n[e],...t[e]};return n}setSlardarContextParams(e){var t,s,i,n,a;let{send_message:r,receive_message:l,is_nova:o,suggest_success:_,use_deep_think:c,suggest_length:u,suggest_error:d}=e;this.params.slardar={...this.params.slardar,send_message:this.mergeMessageParamsRecord("send_message",r),receive_message:this.mergeMessageParamsRecord("receive_message",l),is_nova:null!=o?o:null===(t=this.params.slardar)||void 0===t?void 0:t.is_nova,use_deep_think:null!=c?c:null===(s=this.params.slardar)||void 0===s?void 0:s.use_deep_think,suggest_success:null!=_?_:null===(i=this.params.slardar)||void 0===i?void 0:i.suggest_success,suggest_length:null!=u?u:null===(n=this.params.slardar)||void 0===n?void 0:n.suggest_length,suggest_error:null!=d?d:null===(a=this.params.slardar)||void 0===a?void 0:a.suggest_error}}constructor({params:e={}}={}){a(this,"params",void 0),a(this,"state",{session:"",message:""}),a(this,"records",void 0),this.params=e,this.records={beforeMessageSending:{count:0},onMessageSendingStart:{count:0},onMessageSendingEnd:{count:0},onBatchMessageReceivingStart:{count:0},onMessageReceivingStart:{count:0},onMessageReceivingUpdate:{},onMessageReceivingEnd:{count:0},onBatchMessageReceivingEnd:{count:0},onSuggestReceivingStart:{count:0},onSuggestReceivingUpdate:{count:0},onSuggestReceivingEnd:{count:0},onMessageSessionEnd:{count:0}}}}},154760:function(e,t,s){s.d(t,{V:function(){return i}});var i={GENERIC_START_PAGE_NEW_CONVERSATION:"generic_start_page_new_conversation",CLICK_GUIDANCE_NEW_CONVERSATION:"guidance_new_conversation",SKILL_START_PAGE_NEW_CONVERSATION:"skill_start_page_new_conversation",CLICK_SKILL_GUIDANCE_NEW_CONVERSATION:"click_skill_guidance_new_conversation",SUGGEST:"suggest",DOC_COPILOT:"doc_copilot",DEFAULT:"normal_conversation"}},181171:function(e,t,s){s.d(t,{m:function(){return i}});let i=e=>{var t;return(null==e?void 0:null===(t=e._meta)||void 0===t?void 0:t.logId)||""}},995129:function(e,t,s){s.d(t,{s:function(){return a}});var i=s(51679),n=s(967037);let a=async e=>{let t=(0,n.zQ)({eventName:"get_doc_pdf_key"});try{var s,a,r,l;let n=await i.mH.GetDocumentInfo({uris:[e]}),o=null===(a=n.data)||void 0===a?void 0:null===(s=a.infos)||void 0===s?void 0:s[e].redirect_pdf;if((null==o?void 0:o.can_redirect)&&(null==o?void 0:null===(r=o.pdf)||void 0===r?void 0:r.key))return t.addDurationPoint("success"),t.success(),null==o?void 0:null===(l=o.pdf)||void 0===l?void 0:l.key;t.error({reason:"get_doc_pdf_key_empty"})}catch(e){t.error({error:e instanceof Error?e:Error(String(e)),reason:"get_doc_pdf_key_failed"})}}},589944:function(e,t,s){s.d(t,{$:function(){return l}});var i=s(715982);let n=(e,t)=>{let{configContainer:s}=(0,i.EN)();!s.isBound(e)&&s.bind(e,t)},a=e=>{let{configContainer:t}=(0,i.EN)();if(t.isBound(e))return t.get(e)},r=e=>{let{resourceStore:t}=(0,i.EN)();return t.getState()[e]},l=e=>{let t=a(e);if(t)return t;{let t=r(e),s=null==t?void 0:t.load();if(s instanceof Promise)throw Error(`get config ${e} fail, it is async config`);return n(e,s),a(e)}}},586811:function(e,t,s){s.d(t,{Bk:function(){return p},JM:function(){return _},NW:function(){return d},PD:function(){return c},cG:function(){return m},dX:function(){return T},gI:function(){return v},gv:function(){return M},gw:function(){return L},n:function(){return f},op:function(){return S},qC:function(){return I},tt:function(){return A},v7:function(){return h},wA:function(){return E},yj:function(){return u},yz:function(){return g}});var i=s(118200),n=s(210230),a=s(861431),r=s(669384),l=s(910157),o=s(186491);let _=e=>{let t=(0,i.Z)(e,["has_err"]);return t?{error_details:{has_error:!0,error_code:Number(t),error_message:"Server Error",locale:""}}:{}},c=e=>{let t=T(e);return{skill:{skill_type:t.skill_type,skill_type_no_default:t.skill_type?t.skill_type:null,skill_id:`${t.skill_type}`,skill_id_no_default:t.skill_type?`${t.skill_type}`:null}}},u=e=>(null==e?void 0:e.need_reference)==="0"?{need_reference:!1}:{},d=e=>(0,l.R)((0,i.Z)(e,["search_action_bar_config"]),{}),g=e=>(0,i.Z)(e,["only_alt_card"])?{only_alt_card:"1"}:{},E=e=>!!(0,i.Z)(e,["think_broken"]),S=e=>(null==e?void 0:e.pdf_hover_position)?{hover_position:null==e?void 0:e.pdf_hover_position}:{},v=e=>(null==e?void 0:e.generate_mind_map)==="1"?{generate_mind_map:!0}:{},m=e=>(null==e?void 0:e.immersive_reading_files)?{immersive_files:null==e?void 0:e.immersive_reading_files}:{},M=e=>{var t;let s=null===(t=(0,l.R)((0,i.Z)(e,["samantha_context"]),{}))||void 0===t?void 0:t.query_context;return(null==s?void 0:s.finished_image_token)?{finished_image:s}:{}},f=e=>{var t;let s=null===(t=(0,l.R)((0,i.Z)(e,["input_skill"]),void 0))||void 0===t?void 0:t.variables;return(0,n.Z)(s)?{}:s},p=e=>{var t;let s=(0,a.Z)((0,l.R)((0,i.Z)(e,["input_skill"]),void 0),["variables","show_variables","ext_info"]);return(0,n.Z)(null==s?void 0:null===(t=s.variables)||void 0===t?void 0:t.target_lang)?{}:s},h=e=>{let{template_key:t,variables:s}=(0,a.Z)((0,l.R)((0,i.Z)(e,["input_skill"]),void 0),["variables","template_key","skill_type"])||{};return t||(null==s?void 0:s.reference_text)?{prompt_tpl:{...(0,n.Z)(t)?{}:{tpl_key:t},...(0,n.Z)(null==s?void 0:s.reference_text)?{}:{reference_text:null==s?void 0:s.reference_text}}}:{}},A=e=>{var t;let s=null===(t=(0,l.R)((0,i.Z)(e,["samantha_context"]),{}))||void 0===t?void 0:t.query_context;return(null==s?void 0:s.edit_image_url)?{edit_image:s}:{}};function T(e){if(null==e?void 0:e.input_skill){let t=null==e?void 0:e.input_skill;return(0,l.R)(t,{skill_id:String(r.W.SkillFreeChat),skill_type:r.W.SkillFreeChat})}if(null==e?void 0:e.input_content_type){let t=o.b[Number(null==e?void 0:e.input_content_type)];return{skill_id:String(t),skill_type:Number(t)}}return{skill_id:String(r.W.SkillFreeChat),skill_type:r.W.SkillFreeChat}}function L(e){let t=null==e?void 0:e.input_skill,s=(0,l.R)(t,{});return s.skill_type?s:null}function I(e){let{skill_id_no_default:t,skill_type_no_default:s}=(null==e?void 0:e.skill)||{};return t&&s?{skill_id:t,skill_type:s}:null}},852076:function(e,t,s){s.d(t,{i:function(){return i}});function i(e){if(!e.length)return{contentBlocksTree:void 0,contentBlockNodes:void 0};let t={block_type:0,id:"0",is_finish:!0,children:[]},s={},i={};return e.forEach(e=>{var t;let i=null!==(t=e.parent_id)&&void 0!==t?t:"0";!e.is_deleted&&(s[i]||(s[i]=[]),s[i].push({...e,children:[]}))}),t.children=function e(t){var n;return(null===(n=s[t])||void 0===n?void 0:n.map(t=>{let s=t.id,n={...t,children:e(t.id)};return i[s]=n,n}))||[]}("0"),{contentBlocksTree:t,contentBlockNodes:i}}},186491:function(e,t,s){s.d(t,{b:function(){return a},y:function(){return n}});var i=s(669384);let n={[i.W.SkillImageGen]:i.zc.SamanthaImageInput,[i.W.SkillMusicGen]:i.zc.SamanthaMusicGenInput,[i.W.SkillSearch]:i.zc.SamanthaSearchInput,[i.W.SkillRead]:i.zc.SamanthaReadInput,[i.W.SkillWebpage]:i.zc.SamanthaWebpageInput,[i.W.SkillTranslate]:i.zc.SamanthaTranslate,[i.W.SkillDeepSearch]:i.zc.SamanthaDeepSearchInput,[i.W.SkillFreeChat]:i.zc.SamanthaText,[i.W.SkillCodeAssistant]:i.zc.SamanthaCodeAssistantInput,[i.W.SkillWrite]:i.zc.SamanthaWriteInput,[i.W.SkillVideoGeneration]:i.zc.SamanthaVideoGenerationInput,[i.W.SkillType_AiPPT]:i.zc.SamanthaAiPPTInput,[i.W.SkillCodeInterpreter]:i.zc.SamanthaCodeInterpreterInput,[i.W.SkillEdu]:i.zc.SamanthaEduInput,[i.W.SkillAiPodcast]:i.zc.SamanthaAiPodcastInput,[i.W.DesExtChatSkillPlaceholder]:i.zc.SamanthaText,[i.W.DesExtSkillTranslate]:i.zc.SamanthaText,[i.W.DesExtSkillSummaryHighlight]:i.zc.SamanthaText,[i.W.DesExtSkillExplain]:i.zc.SamanthaText,[i.W.DesExtSkillDesExtSearchCard]:i.zc.SamanthaText,[i.W.DesExtSkillLinkPreview]:i.zc.SamanthaText,[i.W.DesExtSkillDesExtSuggest]:i.zc.SamanthaText,[i.W.DesExtSkillVideoSummary]:i.zc.SamanthaText,[i.W.DesExtSkillOneLevelVideoSummary]:i.zc.SamanthaText,[i.W.DesExtSkillRewriteWithTone]:i.zc.SamanthaText,[i.W.DesExtSkillCustomSkill]:i.zc.SamanthaText,[i.W.DesExtSkillSearchMindNote]:i.zc.SamanthaText,[i.W.DesExtSkillTextToMindNote]:i.zc.SamanthaText,[i.W.DesExtSkillBilingualSentence]:i.zc.SamanthaText,[i.W.DesExtSkillAITitle]:i.zc.SamanthaText,[i.W.DesExtPodcastTranscript]:i.zc.SamanthaText,[i.W.DesExtSkillWebsiteDetail]:i.zc.SamanthaText,[i.W.DesExtSkillSummary]:i.zc.SamanthaText,[i.W.DesExtSkillMultiWebsites]:i.zc.SamanthaText,[i.W.DesExtSkillAIToolSummary]:i.zc.SamanthaText,[i.W.DesExtSkillReferenceAsk]:i.zc.SamanthaText,[i.W.DesExtSkillMindMap]:i.zc.SamanthaText,[i.W.DesExtSkillSimplifiedRead]:i.zc.SamanthaText,[i.W.DesExtSkillGrammar]:i.zc.SamanthaText,[i.W.DesExtSkillReply]:i.zc.SamanthaText,[i.W.DesExtSkillSuperTask]:i.zc.SamanthaDesExtSupertask,[i.W.SkillTypeMediaUnderstandingByAsr]:i.zc.SamanthaMediaUnderstandingByAsrInput,[i.W.SkillSearchEngine]:i.zc.SamanthaSearchEngineInput,[i.W.DesExtSkillVideoListSummary]:i.zc.SamanthaText,[i.W.DesExtSkillCommentAnalyze]:i.zc.SamanthaText,[i.W.DesExtSkillVideoDeepAnalyze]:i.zc.SamanthaText,[i.W.DesExtSkillTopicTrendAnalyze]:i.zc.SamanthaText,[i.W.DesExtSkillPageTranslate]:i.zc.SamanthaText,[i.W.SkillDeepResearch]:i.zc.SamanthaDeepResearchInput,[i.W.DesExtSkillSharedAppAssistant]:i.zc.SamanthaText,[i.W.DesExtSkillGrammarCorrection]:i.zc.SamanthaText,[i.W.DesExtSkillPodcastReading]:i.zc.SamanthaText,[i.W.DesExtSkillMeetingSummary]:i.zc.SamanthaText,[i.W.DesExtSkillEncyclopedia]:i.zc.SamanthaText,[i.W.DesExtSkillMindMapGenerate]:i.zc.SamanthaText,[i.W.SkillUserCustomSkill]:i.zc.SamanthaText},a={[i.zc.SamanthaSearchInput]:i.W.SkillSearch,[i.zc.SamanthaDeepSearchInput]:i.W.SkillDeepSearch,[i.zc.SamanthaImageInput]:i.W.SkillImageGen,[i.zc.SamanthaMusicGenInput]:i.W.SkillMusicGen,[i.zc.SamanthaReadInput]:i.W.SkillRead,[i.zc.SamanthaWebpageInput]:i.W.SkillWebpage,[i.zc.SamanthaTranslate]:i.W.SkillTranslate,[i.zc.SamanthaText]:i.W.SkillFreeChat,[i.zc.SamanthaCodeAssistantInput]:i.W.SkillCodeAssistant,[i.zc.SamanthaVideoGenerationInput]:i.W.SkillVideoGeneration,[i.zc.SamanthaWriteInput]:i.W.SkillWrite,[i.zc.SamanthaAiPPTInput]:i.W.SkillType_AiPPT,[i.zc.SamanthaEduInput]:i.W.SkillEdu,[i.zc.SamanthaCodeInterpreterInput]:i.W.SkillCodeInterpreter,[i.zc.SamanthaDesExtSupertask]:i.W.DesExtSkillSuperTask,[i.zc.SamanthaMediaUnderstandingByAsrInput]:i.W.SkillTypeMediaUnderstandingByAsr,[i.zc.SamanthaDeepResearchInput]:i.W.SkillDeepResearch,[i.zc.SamanthaSearchEngineInput]:i.W.SkillSearchEngine}},314752:function(e,t,s){var i,n,a,r;s.d(t,{Lu:function(){return c},Pi:function(){return _},o6:function(){return o},qw:function(){return l}});let l=((i={})[i.Init=0]="Init",i[i.MessageSessionStart=1]="MessageSessionStart",i[i.MessageSendingStart=2]="MessageSendingStart",i[i.BatchMessageReceivingStart=3]="BatchMessageReceivingStart",i[i.SuggestionReceivingStart=4]="SuggestionReceivingStart",i[i.MessageSessionEnd=5]="MessageSessionEnd",i),o=((n={})[n.Init=0]="Init",n[n.MessageReceivingStart=1]="MessageReceivingStart",n[n.MessageReceivingEnd=2]="MessageReceivingEnd",n),_=((a={})[a.StartMessageSession=0]="StartMessageSession",a[a.StartMessageSending=1]="StartMessageSending",a[a.SuccessMessageSending=2]="SuccessMessageSending",a[a.BreakMessageSending=3]="BreakMessageSending",a[a.ErrorMessageSending=4]="ErrorMessageSending",a[a.TimeoutMessageSending=5]="TimeoutMessageSending",a[a.BreakMessageReceiving=6]="BreakMessageReceiving",a[a.ErrorMessageReceiving=7]="ErrorMessageReceiving",a[a.TimeoutMessageReceiving=8]="TimeoutMessageReceiving",a[a.StartSuggestionReceiving=9]="StartSuggestionReceiving",a[a.EndMessageSession=10]="EndMessageSession",a),c=((r={})[r.StartMessageReceiving=0]="StartMessageReceiving",r[r.EndMessageReceiving=1]="EndMessageReceiving",r)},377940:function(e,t,s){s.d(t,{C2:function(){return i},H_:function(){return M},LY:function(){return r},Ov:function(){return v},RA:function(){return E},Uf:function(){return d},Ux:function(){return p},Zq:function(){return l},au:function(){return u},b3:function(){return a},e2:function(){return S},mF:function(){return m},mk:function(){return c},nS:function(){return _},oh:function(){return n},ol:function(){return f},r4:function(){return o},vC:function(){return g}});let i={default:"default",defaultNew:"default_new",otherDefault:"other_default",selfCreated:"self_created",othersCreated:"others_created"},n={SEC_SCENE_CLICK_SUGGESTEDPROMPT_CASE:"click_suggestedprompt_case",SEC_SCENE_INPUT:"input",SEC_SCENE_KEYBOARD:"keyboard",SEC_SCENE_RESEND:"resend",SEC_SCENE_SUGGESTED_PROMPTS:"suggested_prompts",SEC_SCENE_ONBOARDING_SUGGESTION:"onboarding_suggestion",SEC_SCENE_CHAT_ACTION_BAR_COMPOSE:"chat_action_bar_compose",SEC_SCENE_CHAT_ACTION_BAR_SUMMARIZE_WEBPAGE:"chat_action_bar_summarize_webpage",SEC_SCENE_CHAT_ACTION_BAR_CHAT_WITH_PDF:"chat_action_bar_chat_with_pdf",SEC_SCENE_CHAT_ACTION_BAR_IMAGE_CREATION:"chat_action_bar_image_creation",SEC_SCENE_WEB_ONBOARDING_GREETING_SEARCH:"web_onboarding_greeting_search",SEC_SCENE_WEB_GREETING_SEARCHANDASK_SKILL:"web_greeting_searchandask_skill",SEC_SCENE_WEB_GREETING_WRITE_SKILL:"web_greeting_write_skill",SEC_SCENE_WEB_GREETING_IMAGE_SKILL:"web_greeting_image_skill",SEC_SCENE_WEB_GREETING_CHATWITHPDF_SKILL:"web_greeting_chatwithpdf_skill",SEC_SCENE_WEB_GREETING_READ_PDF:"web_greeting_read_pdf",SEC_SCENE_WEB_GREETING_READ:"web_greeting_read",SEC_SCENE_WEB_GREETING_CREATE:"web_greeting_create",SEC_SCENE_CHAT_ACTION_BAR_READ_SUMMARIZE:"chat_action_bar_read_summarize",SEC_SCENE_CHAT_ACTION_BAR_SEARCH:"chat_action_bar_search"},a={SCENE_DIRECT_ENTER:"direct_enter",SCENE_TEXT_SELECT_ASK_DOUBAO:"text_select_ask_doubao",SCENE_CHAT_ACTION_BAR:"chat_action_bar",SCENE_DEFAULT_NO_SKILL:"default_no_skill",SCENE_GENERATE_PPT:"generate_ppt",SCENE_ONBOARDING_SUGGESTED_PROMPT:"onboarding_suggested_prompt",SCENE_AI_SPACE:"ai_space",SCENE_CANVAS_SELECTION_SEARCH:"canvas_selection_search",SCENE_CANVAS_SELECTION_TRANSLATE:"canvas_selection_translate",SCENE_CANVAS_SELECTION_EXPLAIN:"canvas_selection_explain",SCENE_CANVAS_SELECTION_ASK_DOUBAO:"canvas_selection_ask_doubao",SCENE_KEYBOARD:"keyboard",SCENE_CANVAS_FUNCTION_TRANSLATE:"canvas_function_translate",SCENE_CANVAS_SELECTION:"canvas_selection",SCENE_CANVAS_INSERT_PARAGRAPH:"canvas_insert_paragraph",SCENE_CANVAS_SELECTION_BAR:"canvas_selection_bar",SCENE_CANVAS_TOOL_LIST:"canvas_tool_list",SCENE_CANVAS_EDIT_IMAGE_SEND_MESSAGE:"canvas_edit_image_send_message",SCENE_EDIT_IMAGE_SEND_MESSAGE:"edit_image_send_message",SCENE_CHAT_ACTION_BAR_LANDING:"chat_action_bar_landing",SCENE_SIDEBAR_SKILL_CLICK:"sidebar_skill_click",SCENE_SPEAK:"speak",SCENE_SUGGESTED_PROMPT:"suggested_prompt",SCENE_CHAT_ACTION_BAR_DISCOVER:"chat_action_bar_discover",SCENE_RESEND:"resend",SCENE_SUGGESTED_PROMPTS:"suggested_prompts",SCENE_ONBOARDING_SUGGESTION:"onboarding_suggestion",SCENE_WEB_ONBOARDING_GREETING:"web_onboarding_greeting",SCENE_INPUT_SUG_PROMPTS:"input_sug_prompts",SCENE_EDIT:"edit",SCENE_ALBUM:"album",SCENE_SHOOT:"shoot",SCENE_FILE:"file",SCENE_KEYBOARD_UNLOG:"keyboard_unlog",SCENE_CALL:"call",SCENE_ONBOARDING_WELCOME_BACK:"onboarding_welcome_back",SCENE_ONBOARDING_FIRST_MET:"onboarding_first_met",SCENE_ASK_GPT4:"ask_gpt4",SCENE_SEARCH_WEB:"search_web",SCENE_CHANGE_USER_NICKNAME:"change_user_nickname",DOC_CARD_BOTTOM_CHAT_ENTRY:"doc_card_bottom_chat_entry",PROFESSIONAL_WRITING:"professional_writing",OUTSIDE:"outside",WEB_TOOL_SIDEBAR:"web_tool_sidebar",WEB_TOOL_BOX:"web_tool_box",IMAGE_ASK_DOUBAO:"image_ask_doubao",TEXT_SELECTION_BAR:"text_selection_bar",HIGHLIGHT_IN_SIDERBAR_CHAT:"highlight_in_siderbar_chat",CHAT_ENTER_BAR_SCREENSHOT:"chat_enter_bar_screenshot",WEBPAGE_SIDEBAR_LINK:"webpage_sidebar_link",MIND_MAP:"mind_map",TEXT_INPUT_BOX:"text_input_box",SIDEBAR_ACTION_POPOVER:"sidebar_action_popover",DESKTOP_SUMMARY_SUGGESTED_PROMPTS:"desktop_summary_suggested_prompts",ADDRESS_TOOL:"address_tool",HIGHLIGHT_SEARCH_RESULT_TOOL:"highlight_search_result_tool",REGENERATE:"regenerate",EXERCISE_SKILL_INPUT:"exercise_skill_input",NEW_USER_TASK:"new_user_task",WRITE_CREATE_DOC_BY_MESSAGE_ACTION_BUTTON:"write_create_doc_by_message_action_button",FLOW_PDF_PAGE:"flow_pdf_page",PDF_IMMERSIVE_READING:"pdf_immersive_reading",MESSAGE_FROM_QUERY:"message_from_query"},r={MESSAGE_TYPE_FILE:"file",MESSAGE_TYPE_TEXT:"text",MESSAGE_TYPE_PIC:"pic",MESSAGE_TYPE_MUSIC:"music",MESSAGE_TYPE_MAP:"map",MESSAGE_TYPE_VIDEO:"video",MESSAGE_TYPE_LYNX:"lynx",MESSAGE_TYPE_SEARCH_CARD:"search_card",MESSAGE_TYPE_LYRICS_TO_SONG_LYRIC:"lyrics_to_song_lyric",MESSAGE_TYPE_LYRICS_TO_SONG_MUSIC:"lyrics_to_song_music",MESSAGE_TYPE_VIDEO_GENERATION:"video_generation"},l={SkillFreeChat:"0",SkillWrite:"2",SkillImageGen:"3",SkillSearch:"4",SkillTranslate:"5",SkillRead:"6",SkillWebpage:"7",SkillDeepSearch:"8",SkillMusicGen:"9",SkillAcademicSearch:"10",SkillEdu:"11",SkillReadMultiWebsites:"12",SkillCodeInterpreter:"13",SkillReferenceAsk:"14",SkillCodeAssistant:"16",SkillVideoGeneration:"17",SkillAiPPT:"18",SkillMediaUnderstandingByAsr:"19",DesExtChatSkillPlaceholder:"100",DesExtSkillTranslate:"101",DesExtSkillSummaryHighlight:"102",DesExtSkillExplain:"103",DesExtSkillDesExtSearchCard:"104",DesExtSkillLinkPreview:"105",DesExtSkillDesExtSuggest:"106",DesExtSkillVideoSummary:"108",DesExtSkillOneLevelVideoSummary:"109",DesExtSkillRewriteWithTone:"110",DesExtSkillCustomSkill:"111",DesExtSkillSearchMindNote:"112",DesExtSkillTextToMindNote:"113",DesExtSkillBilingualSentence:"114",DesExtSkillAITitle:"115",DesExtPodcastTranscript:"116",DesExtSkillWebsiteDetail:"117",DesExtSkillSummary:"118"},o={SKILL_NAME_IMAGE_GENERATION:"image_generation",SKILL_NAME_AI_PPT:"ai_ppt",SKILL_NAME_VIDEO_GENERATION:"video_generation",SKILL_NAME_SEARCH:"search",SKILL_NAME_DEEP_SEARCH:"deep_search",SKILL_NAME_WRITING_ASSISTANT:"writing_assistant",SKILL_NAME_READ_PDF:"read_pdf",SKILL_NAME_MUSIC_GENERATION:"music_generation",SKILL_NAME_IMAGES_GENERATION:"images_generation",SKILL_NAME_CODING:"coding_assistant",SKILL_NAME_TRANSLATE:"translate",SKILL_NAME_CHAT_WITH_PDF:"chat_with_pdf",SKILL_NAME_SUMMARIZE_WEBPAGE:"summarize_webpage",SKILL_NAME_MORE:"more",SKILL_NAME_COMPOSE:"compose",SKILL_NAME_READ_SUMMARIZE:"read_summarize",SKILL_NAME_IMAGE_CREATION:"image_creation",SKILL_NAME_READ_WEBPAGE:"read_url",SKILL_NAME_ACADEMIC_SEARCH:"academic_search",SKILL_NAME_CODE_INTERPRETER:"code_interpreter",SKILL_NAME_EXERCISE_ASSISTANT:"exercise_assistant",SKILL_NAME_READ_MULTIPLE_URL:"read_multi_url",SKILL_NAME_REFERENCE_ACK:"reference_ack",SKILL_NAME_VOICE_CALL:"voice_call",SKILL_NAME_DEEP_RESEARCH:"deep_research",SKILL_NAME_PODCAST:"podcast",SKILL_CUSTOM_SKILL:"custom_skill",SKILL_SHARED_APP_ASSISTANT:"share_app",SKILL_NAME_MEETING_RECORD:"meeting_record",SKILL_NAME_SUPER_TASK:"super_task"},_={RESULT_ACK_TIMEOUT:"ack_timeout",RESULT_PROMPT_TIMEOUT:"prompt_timeout",RESULT_PROMPT_EMPTY:"prompt_empty",RESULT_STREAM_ERROR:"stream_error",RESULT_STREAM_TIMEOUT:"stream_timeout",SHARK:"shark"},c={SUCCESS:1,FAIL:0},u={CURRENT_PAGE_CHAT:"chat",CURRENT_PAGE_WEB_OTHERPAGE:"web_otherpage",CURRENT_PAGE_CODE_ASSISTANT_DETAIL_PAGE:"code_assistant_detail_page",CURRENT_PAGE_SEARCH_DETAILPAGE:"search_detailpage",CURRENT_PAGE_VIDEO_DETAILPAGE:"video_detailpage",CURRENT_PAGE_IMAGE_EDIT:"image_edit",CURRENT_PAGE_COLLECT_DETAIL_PAGE:"collect_detail_page",CURRENT_PAGE_AI_READ_OLYMPIC:"ai_read_olympic",CURRENT_PAGE_WRITING_STATION:"writing_station",CURRENT_PAGE_IMAGE_DETAILPAGE:"image_detailpage",CURRENT_PAGE_WRITE_DETAILPAGE:"write_detailpage",CURRENT_PAGE_PDF_READ_DETAILPAGE:"pdf_read_detailpage",CURRENT_PAGE_IMMERSIVE_READ_SIDEBAR:"immersive_read_sidebar",CURRENT_PAGE_BOT_LIST_DISCOVER_SEARCH:"bot_list_discover_search",CURRENT_PAGE_CODE_LANDING_PAGE:"code_landingpage",CURRENT_PAGE_CODE_CHAT:"code_chat",CURRENT_PAGE_CODE_APPS:"code_apps",CURRENT_PAGE_CODE_HISTORY:"code_history"},d={PREVIOUS_PAGE_AI_SPACE:"ai_space",PREVIOUS_PAGE_AI_SPACE_SHARE_PAGE:"ai_space_share_page",PREVIOUS_PAGE_CHAT:"chat",PREVIOUS_PAGE_IMAGE_DETAILPAGE:"image_detailpage",PREVIOUS_PAGE_COLLECTLIST_PAGE:"collectlist_page",PREVIOUS_PAGE_STUDENT_STIMULATION:"student_stimulation",PREVIOUS_PAGE_RECENT_UPDATE_DETAILPAGE:"recent_update_detailpage",PREVIOUS_PAGE_SHARE_DESTINATION_PAGE:"share_destination_page",PREVIOUS_PAGE_IMAGE_EDIT:"image_edit",PREVIOUS_PAGE_COPILOT:"copilot",PREVIOUS_PAGE_SEARCH_DETAILPAGE:"search_detailpage",PREVIOUS_PAGE_WRITE_DETAILPAGE:"write_detailpage",PREVIOUS_PAGE_PDF_READ_DETAILPAGE:"pdf_read_detailpage",PREVIOUS_PAGE_WEB_READ_DETAILPAGE:"web_read_detailpage",PREVIOUS_PAGE_TRANSLATE_DETAILPAGE:"translate_detailpage",PREVIOUS_PAGE_MUSIC_GENERATION_DETAILPAGE:"music_generation_detailpage",PREVIOUS_PAGE_CHAT_LIST:"chat_list",PREVIOUS_PAGE_BOT_SETTING:"bot_setting",PREVIOUS_PAGE_NEW_CHAT_SETTING:"new_chat_setting",PREVIOUS_PAGE_BOT_LIST_DISCOVER:"bot_list_discover",PREVIOUS_PAGE_BOT_LIST_DISCOVER_SEARCH:"bot_list_discover_search",PREVIOUS_PAGE_BOT_LIST_PROFILE:"bot_list_profile",PREVIOUS_PAGE_BOT_LIST_OTHERS:"bot_list_others",PREVIOUS_PAGE_OTHER:"other",PREVIOUS_PAGE_SEO_FEED_UNLOG:"seo_feed_unlog",PREVIOUS_PAGE_SEO_FEED_DETAIL_UNLOG:"seo_feed_detail_unlog",PREVIOUS_PAGE_CHAT_LIST_UNLOG:"chat_list_unlog",PREVIOUS_PAGE_BOT_LIST_DISCOVER_UNLOG:"bot_list_discover_unlog",PREVIOUS_PAGE_BOT_LIST_DISCOVER_SEARCH_UNLOG:"bot_list_discover_search_unlog"},g={IS_QUOTE_1:1,IS_QUOTE_0:0},E={RECOMMEND_FROM_BOT_LIST_DISCOVER:"bot_list_discover",RECOMMEND_FROM_CHATLIST_BOARD:"chatlist_board",RECOMMEND_FROM_BOT_LIST_DISCOVER_IMMERSIVE:"bot_list_discover_immersive",RECOMMEND_FROM_CHAT_LIST_IMMERSIVE:"chat_list_immersive",RECOMMEND_FROM_CHATLIST_BOARD_IMMERSIVE:"chatlist_board_immersive",RECOMMEND_FROM_BOT_LIST_DISCOVER_SEARCH_IMMERSIVE:"bot_list_discover_search_immersive",RECOMMEND_FROM_BOT_LIST_OTHERS_IMMERSIVE:"bot_list_others_immersive",RECOMMEND_FROM_BOT_LIST_PROFILE_IMMERSIVE:"bot_list_profile_immersive"},S={DEFAULT_PROMPT_TYPE_MIND_MAP:"mind_map",DEFAULT_PROMPT_TYPE_SUMMARY:"summarize",DEFAULT_PROMPT_TYPE_HIGHLIGHT:"highlight",DEFAULT_PROMPT_TYPE_DEFAULT_PROMPT:"default_prompt",DEFAULT_PROMPT_TYPE_GENERATE_MIND_MAP:"generate_mind_map",DEFAULT_PROMPT_TYPE_CI:"ci",DEFAULT_PROMPT_TYPE_MAKE_A_QUIZ:"make_a_quiz",DEFAULT_PROMPT_TYPE_IMAGE_SUMMARY:"image_summary",DEFAULT_PROMPT_TYPE_IMAGE_READ_TEXT:"image_read_text",DEFAULT_PROMPT_TYPE_IMAGE_VLM_SUMMARY:"image_vlm_summary",DEFAULT_PROMPT_TYPE_DATA_ANALYSIS_SUMMARY:"data_analysis_summary",DEFAULT_PROMPT_TYPE_DATA_ANALYSIS_THREE_CHARTS:"data_analysis_three_charts",DEFAULT_PROMPT_TYPE_LINK_SUMMARY:"link_summary",DEFAULT_PROMPT_TYPE_LINK_MAIN_CONTENT:"link_main_content"},v={PROMPT_TYPE_DEFAULT_PROMPT:"default_prompt",PROMPT_TYPE_CUSTOMIZED_PROMPT:"customized_prompt"},m={WHETHER_USE_DEEP_THINKING_AUTO:"auto",WHETHER_USE_DEEP_THINKING_YES:"yes",WHETHER_USE_DEEP_THINKING_NO:"no",WHETHER_USE_DEEP_THINKING_NO_ENTRANCE:"no_entrance"},M={GUIDANCE_PAGE_CLICK:"guidance_page_click",SKILL_GUIDANCE_PAGE_CLICK:"skill_guidance_page_click",SKILL_GUIDANCE_PAGE:"skill_guidance_page",GUIDANCE_PAGE:"guidance_page",SUGGEST:"suggest",DOC_COPILOT:"doc_copilot"},f={UPLOAD_FILE_TYPE_IMAGE:"Image",UPLOAD_FILE_TYPE_PDF:"PDF",UPLOAD_FILE_TYPE_XLSX:"Spreadsheet",UPLOAD_FILE_TYPE_DOCX:"Document",UPLOAD_FILE_TYPE_PPTX:"PPT",UPLOAD_FILE_TYPE_CSV:"CSV",UPLOAD_FILE_TYPE_TXT:"Txt",UPLOAD_FILE_TYPE_FILE:"File",UPLOAD_FILE_TYPE_MOBI:"Mobi",UPLOAD_FILE_TYPE_EPUB:"Epub",UPLOAD_FILE_TYPE_MARKDOWN:"Markdown",UPLOAD_FILE_TYPE_FOLDER:"Folder",UPLOAD_FILE_TYPE_LINK:"Link",UPLOAD_FILE_TYPE_VIDEO:"Video",UPLOAD_FILE_TYPE_AUDIO:"Audio",UPLOAD_FILE_TYPE_UNKNOWN:"Unknown",UPLOAD_FILE_TYPE_TEXT:"Text",UPLOAD_FILE_TYPE_DIRECTORY:"Directory",UPLOAD_FILE_TYPE_VLM_IMAGE:"VlmImage",UPLOAD_FILE_TYPE_RESOURCE_CONTENT:"ResourceContent"},p={UPLOAD_AI_CODE_TEMPLATE:"ai_code_template",UPLOAD_FROM_PLUS_BUTTON:"plus_button",UPLOAD_FROM_READ_SUMMARIZE_MODULE:"read_summarize_module",UPLOAD_FROM_UPLOAD_PINBUTTON:"upload_pinbutton",UPLOAD_FROM_DRIVE:"upload_from_drive",UPLOAD_FROM_PULL_CODE:"pull_code",UPLOAD_FROM_IMAGE_EDIT:"image_edit",UPLOAD_FROM_IMAGE_REFERENCE:"image_reference",UPLOAD_FROM_CI_UPLOAD:"CI_upload",UPLOAD_FROM_PODCAST:"podcast"}},443032:function(e,t,s){s.d(t,{P:function(){return l},Y:function(){return o}});var i=s(644367),n=s(252528),a=s(78570),r=s(363998);let l=(e,t,s,i)=>{o(e.getSessionLifeCycleContext(t,s),i)},o=(e,t)=>{let s=(0,r.h)(e);!(0,n.u)(s)&&((0,n.i)(s,"onMessageSessionEnd"),i.k.persist.success({eventName:"on_message_session_end",meta:a.P.onMessageSessionEnd(s,t)}))}},302282:function(e,t,s){s.d(t,{C:function(){return n}});var i=s(644367);let n=e=>{var t,s;i.k.persist.success({eventName:"on_message_session_start",meta:{chat_session_scene:null===(t=e.slardar)||void 0===t?void 0:t.chat_session_scene,chat_session_id:null===(s=e.slardar)||void 0===s?void 0:s.chat_session_id}})}},252528:function(e,t,s){s.d(t,{i:function(){return a},u:function(){return n}});var i=s(644367);let n=e=>{var t,s;return(null==e?void 0:null===(s=e.records)||void 0===s?void 0:null===(t=s.onMessageSessionEnd)||void 0===t?void 0:t.count)===1&&(i.k.persist.info("message session end, skip report log"),!0)},a=(e,t)=>{if(!e||!t)return;let s=e.records[t];(null==s?void 0:s.count)!==void 0&&(s.count+=1),(null==s?void 0:s.timestamp)===void 0&&(s.timestamp=performance.now())}},363998:function(e,t,s){s.d(t,{S:function(){return n},h:function(){return a}});var i=s(314752);let n=e=>e.get("chatTeaTraceEvent"),a=e=>{let t=e.get("chatEventContext");return t&&(t.state={session:i.qw[e.current_session_state],message:i.o6[e.current_single_receiving_message_state]}),t}},78570:function(e,t,s){s.d(t,{J:function(){return l},P:function(){return d}});var i=s(644367);let n=e=>{var t,s,i,n;return(null===(t=e.error_details)||void 0===t?void 0:t.error_code)!==void 0?String(e.error_details.error_code):(null===(s=e.final_status)||void 0===s?void 0:s.message)==="Broken"?"broken":(null===(i=e.final_status)||void 0===i?void 0:i.message)==="Timeout"?"timeout":(null===(n=e.final_status)||void 0===n?void 0:n.message)==="Error"?"unexpected_error":""},a=e=>{var t,s,i;return(null===(t=e.error_details)||void 0===t?void 0:t.error_code)!==void 0?String(e.error_details.error_code):(null===(s=e.final_status)||void 0===s?void 0:s.message)==="Broken"?"broken":(null===(i=e.final_status)||void 0===i?void 0:i.message)==="Error"?"unexpected_error":""},r=e=>{var t,s,i,n,a,r;return(null==e?void 0:null===(t=e.error_details)||void 0===t?void 0:t.error_code)!==void 0?String(e.error_details.error_code):(null==e?void 0:null===(s=e.final_status)||void 0===s?void 0:s.session)==="Broken"?"broken":(null==e?void 0:null===(i=e.final_status)||void 0===i?void 0:i.session)==="Timeout"?"timeout":(null==e?void 0:null===(n=e.final_status)||void 0===n?void 0:n.session)==="Error"?"unexpected_error":(null==e?void 0:null===(a=e.final_status)||void 0===a?void 0:a.session)==="ExpectError"?"expect_error":(null==e?void 0:null===(r=e.final_status)||void 0===r?void 0:r.session)==="PanicError"?"panic_error":""},l={beforeMessageSending(e){var t,s;let i={is_nova:(null===(t=e.local)||void 0===t?void 0:t.isNova)?"1":"0",use_deep_think:null===(s=e.ext)||void 0===s?void 0:s.use_deep_think,send_message:{}};return e.local_message_id&&i.send_message&&(i.send_message[e.local_message_id]={local_message_id:e.local_message_id}),i},onMessageSendingStart(e){let t={send_message:{}};if(e.local_message_id&&t.send_message){var s,i;t.send_message[e.local_message_id]={local_message_id:e.local_message_id,content_type:null!==(i=null==e?void 0:null===(s=e.ext)||void 0===s?void 0:s.input_content_type)&&void 0!==i?i:void 0}}return t},onMessageSendingEnd(e){let t={send_message:{}};if(e.local_message_id&&t.send_message){var s,i,a,r,l;t.send_message[e.local_message_id]={local_message_id:e.local_message_id,message_id:e.message_id,inner_log_id:null!==(l=null===(s=e.ext)||void 0===s?void 0:s.inner_log_id)&&void 0!==l?l:null===(i=e.ext)||void 0===i?void 0:i.log_id,log_id:null===(a=e.local_info)||void 0===a?void 0:a.log_id,success:(null===(r=e.final_status)||void 0===r?void 0:r.message)==="Success"?"1":"0",err:n(e),content_type:String(e.content_type)}}return t},onMessageReceivingUpdate(e){let t={receive_message:{}};if(e.message_id&&t.receive_message){var s,i,n,a,r;t.receive_message[e.message_id]={local_message_id:null!==(a=e.local_message_id)&&void 0!==a?a:"",message_id:e.message_id,inner_log_id:null!==(r=null===(s=e.ext)||void 0===s?void 0:s.inner_log_id)&&void 0!==r?r:null===(i=e.ext)||void 0===i?void 0:i.log_id,log_id:null===(n=e.local_info)||void 0===n?void 0:n.log_id,content_type:String(e.content_type)}}return t},onMessageReceivingEnd(e){let t={receive_message:{}};if(e.message_id&&t.receive_message){var s,i,a,r,l,o;t.receive_message[e.message_id]={local_message_id:null!==(l=e.local_message_id)&&void 0!==l?l:"",message_id:e.message_id,inner_log_id:null!==(o=null===(s=e.ext)||void 0===s?void 0:s.inner_log_id)&&void 0!==o?o:null===(i=e.ext)||void 0===i?void 0:i.log_id,log_id:null===(a=e.local_info)||void 0===a?void 0:a.log_id,success:(null===(r=e.final_status)||void 0===r?void 0:r.message)==="Success"?"1":"0",content_type:String(e.content_type),err:n(e)}}return t},onSuggestReceivingStart:()=>({suggest_success:"0"}),onSuggestReceivingEnd(e){var t,s;let i=(null===(t=e.content_obj)||void 0===t?void 0:t.suggest)||(null===(s=e.content_obj)||void 0===s?void 0:s.suggestions),n=Array.isArray(i)?null==i?void 0:i.length:0;return{suggest_success:n>0?"1":"0",suggest_length:n,suggest_error:a(e)}}},o=(e,t)=>{var s,n,a,r;if(!(null==e?void 0:null===(s=e.params)||void 0===s?void 0:s.common))return i.k.persist.error({error:Error("chat-trace: common parmams is not set")}),{conversation_id:"",local_conversation_id:"",skill_id:"",conversation_type:""};let{params:l}=e,{slardar:o}=l,_={...e.params.common,use_deep_think:null==o?void 0:o.use_deep_think,is_nova:null==o?void 0:o.is_nova,chat_session_scene:null==o?void 0:o.chat_session_scene,chat_session_id:null==o?void 0:o.chat_session_id,chat_scene:null==o?void 0:o.chat_scene},c=Object.keys(null!==(a=null==o?void 0:o.send_message)&&void 0!==a?a:{})[0];if(!c)return _;let{message_id:u,success:d,err:g,local_message_id:E,log_id:S,inner_log_id:v,content_type:m}=null!==(r=null==o?void 0:null===(n=o.send_message)||void 0===n?void 0:n[c])&&void 0!==r?r:{};return _.send_message_id=null!=u?u:"",_.send_local_message_id=null!=E?E:"",_.send_success=null!=d?d:void 0,_.send_err=null!=g?g:void 0,_.send_log_id=S,_.send_inner_log_id=v,_.send_content_type=m,_.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,_},_=(e,t)=>{var s,a,r,l,_,c,u,d,g,E;let S={...o(e)};if(!e)return i.k.persist.error({error:Error("chat-trace: chatEventContext is undefined")}),S;let{params:v,records:m}=e,M=m.onMessageReceivingUpdate[(null==t?void 0:t.message_id)||""],f=(null!==(l=null==M?void 0:M.timestamp_list)&&void 0!==l?l:[]).map((e,t)=>0===t?0:e-M.timestamp_list[t-1]).slice(1),p=null===(a=v.slardar)||void 0===a?void 0:null===(s=a.receive_message)||void 0===s?void 0:s[(null==t?void 0:t.message_id)||""];if(S.receive_message_id=null!==(_=null==p?void 0:p.message_id)&&void 0!==_?_:"",S.receive_local_message_id=null!==(c=null==p?void 0:p.local_message_id)&&void 0!==c?c:"",S.receive_success=null!==(u=null==p?void 0:p.success)&&void 0!==u?u:"0",S.receive_err=null!==(d=null==p?void 0:p.err)&&void 0!==d?d:t?n(t):"unknown",S.receive_log_id=null==p?void 0:p.log_id,S.receive_inner_log_id=null==p?void 0:p.inner_log_id,S.receive_content_type=null!==(g=null==p?void 0:p.content_type)&&void 0!==g?g:void 0,S.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,S.receive_stuck_1000_duration=f.filter(e=>e>1e3&&e<=3e3).reduce((e,t)=>e+t,0),S.receive_stuck_3000_duration=f.filter(e=>e>3e3).reduce((e,t)=>e+t,0),S.receive_full_duration=f.reduce((e,t)=>e+t,0),S.receive_full_duration&&(S.receive_stuck_3000_percentage=S.receive_stuck_3000_duration/S.receive_full_duration,S.receive_stuck_1000_percentage=S.receive_stuck_1000_duration/S.receive_full_duration),null==M?void 0:null===(r=M.think_reason_timestamp_list)||void 0===r?void 0:r.length){let e=(null!==(E=null==M?void 0:M.think_reason_timestamp_list)&&void 0!==E?E:[]).map((e,t)=>0===t?0:e-M.think_reason_timestamp_list[t-1]).slice(1);S.receive_think_reason_full_duration=e.reduce((e,t)=>e+t,0)}return S},c=(e,t)=>{var s,n;let a={...o(e,t),..._(e,t)};if(!e)return i.k.persist.error({error:Error("chat-trace: chatEventContext is undefined")}),a;let{params:r}=e,l=Object.values(null!==(n=null===(s=r.slardar)||void 0===s?void 0:s.receive_message)&&void 0!==n?n:{});return a.session_success=l.length>0&&l.every(e=>"1"===e.success)?"1":"0",a.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,a},u=(e,t)=>{var s,n,a;let r={...c(e,t)};if(!e)return i.k.persist.error({error:Error("chat-trace: chatEventContext is undefined")}),r;let{params:l}=e;return r.suggest_success=null===(s=l.slardar)||void 0===s?void 0:s.suggest_success,r.suggest_length=null===(n=l.slardar)||void 0===n?void 0:n.suggest_length,r.suggest_error=null===(a=l.slardar)||void 0===a?void 0:a.suggest_error,r.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,r},d={beforeMessageSending:o,onMessageSendingStart:o,onMessageSendingEnd:o,onThinkingMessageUpdate:o,onBatchMessageReceivingStart:o,onMessageReceivingStart:o,onMessageReceivingUpdate:(e,t)=>{var s,n,a;let r={...o(e)};if(!e)return i.k.persist.error({error:Error("chat-trace: chatEventContext is undefined")}),r;let{params:l}=e,_=null===(n=l.slardar)||void 0===n?void 0:null===(s=n.receive_message)||void 0===s?void 0:s[(null==t?void 0:t.message_id)||""];_&&(r.receive_message_id=_.message_id,r.receive_local_message_id=_.local_message_id,r.receive_log_id=_.log_id,r.receive_inner_log_id=_.inner_log_id,r.receive_content_type=null!==(a=_.content_type)&&void 0!==a?a:void 0);let{records:c}=e;return r.event_count_err=["beforeMessageSending","onMessageSendingStart","onMessageSendingEnd","onBatchMessageReceivingStart","onMessageReceivingStart"].map(e=>{let t=c[e];return"onMessageReceivingStart"===e?t.count>0?"":e:1===t.count?"":e}).filter(e=>""!==e).join(","),r.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,r},onMessageReceivingEnd:_,onBatchMessageReceivingEnd:c,onSuggestReceivingStart:o,onSuggestReceivingEnd:u,onMessageSessionEnd:(e,t)=>{let s={...u(e,t)};if(!e)return i.k.persist.error({error:Error("chat-trace: chatEventContext is undefined")}),s;let{records:n}=e;s.session_err=r(t);let a="expect_error"===s.session_err||"broken"===s.session_err?[]:"1"!==s.send_success?["beforeMessageSending","onMessageSendingStart","onMessageSendingEnd","onMessageSessionEnd"]:["beforeMessageSending","onMessageSendingStart","onMessageSendingEnd","onBatchMessageReceivingStart","onMessageReceivingStart","onMessageReceivingEnd","onBatchMessageReceivingEnd","onMessageSessionEnd"];return s.event_count_err=a.map(e=>{let t=n[e];return"onMessageReceivingStart"===e||"onMessageReceivingEnd"===e?t.count>0?"":e:1===t.count?"":e}).filter(e=>""!==e).join(","),s.lifecycle_state=`session: ${e.state.session}, message:${e.state.message}`,s}}},886421:function(e,t,s){s.d(t,{SR:function(){return o},lC:function(){return l},nD:function(){return _},yT:function(){return c}});var i=s(792288),n=s(468494),a=s(886520),r=s(976927);let l=e=>(0,i.Bu)(n.useFeedStore.getState(),e),o=(e,t)=>(0,i.Kn)(n.useFeedStore.getState(),e,t),_=e=>{var t;let s=r.feedServiceContainer.get("chatBotService");return null==s?void 0:null===(t=s.getBotIdToLocalConversationMap())||void 0===t?void 0:t[e]},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;return(0,a.l)(n.useFeedStore.getState(),e,t,s,i)}},67939:function(e,t,s){s.d(t,{n:function(){return a},q:function(){return r}});var i=s(792288),n=s(468494);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,i.QW)(n.useFeedStore.getState(),e,t)},r=e=>(0,i.px)(n.useFeedStore.getState(),e)},886520:function(e,t,s){s.d(t,{l:function(){return o}});var i=s(377940),n=s(322639),a=s(792288),r=s(976927);let l=(e,t)=>{if(t)return t===e;let s=r.feedServiceContainer.get("chatConfigService");return(null==s?void 0:s.userId)===e},o=(e,t,s,r,o)=>{var _,c;let{conversation:u,botInfo:d}=(0,a.Bu)(e,s);if((0,n.kJ)(u)||(0,n.x9)(o))return i.C2.default;if((0,n.p5)(u)||(0,n.qU)(o))return i.C2.defaultNew;if(l((null==u?void 0:null===(_=u.bot_creator_info)||void 0===_?void 0:_.creator_id)||"",t)||l((null==r?void 0:null===(c=r.creator_info)||void 0===c?void 0:c.creator_id)||"",t))return i.C2.selfCreated;if((0,n.Mh)(null==u?void 0:u.bot_type)||(0,n.Mh)(null==d?void 0:d.bot_type)||(0,n.Mh)(null==r?void 0:r.bot_type))return i.C2.othersCreated;if((0,n.ar)(null==u?void 0:u.bot_type)||(0,n.ar)(null==d?void 0:d.bot_type)||(0,n.ar)(null==r?void 0:r.bot_type))return i.C2.otherDefault;else if((0,n.el)(null==d?void 0:d.bot_type)||(0,n.el)(null==r?void 0:r.bot_type))return i.C2.default;else return""}},941236:function(e,t,s){s.d(t,{E:function(){return a}});var i=s(530836),n=s(63746);function a(e,t){let s=i.useMessageStore.getState(),a=s.messageLinkMap[e];if(!a)return[];let r=a.slice(Math.max(0,a.length-t)),l=(0,n.Wi)((0,n.xg)(s,e));return r.map(l).filter(Boolean)}},166766:function(e,t,s){s.d(t,{p:function(){return L}});var i=s(917157),n=s(644367),a=s(151558),r=s(742470),l=s(372296),o=s(603184);let _=async e=>{let{display_content:t="",msg_id:s="",conversation_id:i=""}=e,n=(0,l.A)({cmd:a.SK.UPDATE_MSG_CONTENT,uplink_body:{update_msg_content_uplink_body:{message_id:s,display_content:t,conversation_id:i,conversation_type:r.i1.ONE_TO_BOT_CHAT}}}),{status_code:_,status_desc:c}=await (0,o.imGatewayClient)({url:"/im/message/update_content",method:"POST",data:n});return{code:_,msg:c}},c=async e=>{let{message_id:t="",reply_id:s=""}=e,i=(0,l.A)({cmd:a.SK.SWITCH_REGENERATE_MSG,uplink_body:{switch_regenerate_msg_uplink_body:{message_id:t,reply_id:s}}}),{status_code:n,status_desc:r}=await (0,o.imGatewayClient)({url:"/im/message/switch_regenerate",method:"POST",data:i});return{code:n,msg:r}};var u=s(420262);let d=(e,t)=>{if(null==e?void 0:e.length){let s=e.filter(e=>e.status===r.rJ.MessageStatus_REGEN_ROOT)[0];if(s)return Object.values(null!=t?t:{}).filter(e=>e.regen_root_id===s.message_id).map(e=>{let t=s.regen_msg_list.some(t=>t.is_visible&&t.msg_id_list.includes(e.message_id));return{...e,status:t?r.rJ.MessageStatus_AVAILABLE:r.rJ.MessageStatus_INVISIBLE,ext:e.ext?{...e.ext,regen_active:t?"1":"0"}:{}}})}return[]},g=async e=>{let{conversation_id:t="",cursor:s,batch_size:i,bot_id:n,message_index_list:_,is_reverse:c,v2_api_ext:g={}}=e,E=(0,l.A)({cmd:a.SK.PULL_SINGLE_CHAIN,uplink_body:{pull_singe_chain_uplink_body:{conversation_id:t,anchor_index:Number(null!=s?s:0),conversation_type:r.i1.ONE_TO_BOT_CHAT,direction:!1!==c?r.Tk.OLDER:r.Tk.NEWER,limit:Number(null!=i?i:50),ext:g,filter:{index_list:(null!=_?_:[]).map(e=>Number(e)),bot_id:n}}}}),{status_code:S,status_desc:v,downlink_body:m}=await (0,o.imGatewayClient)({url:"/im/chain/single",method:"POST",data:E}),{pull_singe_chain_downlink_body:M}=null!=m?m:{},{messages:f=[],has_more:p,regen_messages:h={}}=null!=M?M:{},A=d(f,h);for(let e=0;e<f.length;e++){let t=f[e];if(t.status===r.rJ.MessageStatus_REGEN_ROOT){var T;f[e]=null!==(T=Object.values(null!=h?h:{}).find(e=>e.regen_root_id===t.message_id&&t.regen_msg_list.some(t=>t.is_visible&&t.msg_id_list.includes(e.message_id))))&&void 0!==T?T:t,f[e].status=r.rJ.MessageStatus_AVAILABLE}}let L=f.concat(A.filter(e=>e.status===r.rJ.MessageStatus_INVISIBLE)),I=A.map(e=>({...e,status:r.rJ.MessageStatus_AVAILABLE}));return{code:S,msg:v,data:{has_more:p,message_list:L.map(u.C),regen_list:I.map(u.C)}}},E=async()=>{let e=(0,l.A)({cmd:a.SK.CHECK_MESSAGE_SEND_RATE_LIMIT,uplink_body:{check_message_send_rate_limit_uplink_body:{}}}),{status_code:t,status_desc:s,downlink_body:i}=await (0,o.imGatewayClient)({url:"/im/message/send_rate_limit",method:"POST",data:e});return{code:t,msg:s,data:null==i?void 0:i.check_message_send_rate_limit_downlink_body}},S=async e=>{var t;let{conversation_id:s="",message_id:i="",feedbackDetail:n,feedbackSource:_}=e,c=(0,l.A)({cmd:a.SK.FEEDBACK_MSG,uplink_body:{feedback_msg_uplink_body:{conversation_id:s,message_id:i,conversation_type:r.i1.ONE_TO_BOT_CHAT,feedback_source:void 0===_?r.P7.User:_,feedback_type:null==n?void 0:n.feedback_type,feedback_detail_types:null!==(t=null==n?void 0:n.feedback_detail_types)&&void 0!==t?t:[]}}}),{status_code:u,status_desc:d}=await (0,o.imGatewayClient)({url:"/im/message/feedback_msg",method:"POST",data:c});return{code:u,msg:d}},v=async e=>{let{conversation_id:t="",message_id:s="",regen_message_ids:i=[]}=e,n=i.length>0?i:[s],_=(0,l.A)({cmd:a.SK.BATCH_UPDATE_MSG_STATUS,uplink_body:{batch_update_msg_status_uplink_body:{conversation_id:t,conversation_type:r.i1.ONE_TO_BOT_CHAT,message_body_list:n.map(e=>({message_id:e,status:r.rJ.MessageStatus_DELETED,local_message_id:""}))}}}),{status_code:c,status_desc:u}=await (0,o.imGatewayClient)({url:"/im/message/batch_update_status",method:"POST",data:_});return{code:c,msg:u}},m=async e=>{var t,s,i,n,_,c,d;let{request_list:g}=e,E=(0,l.A)({cmd:a.SK.BATCH_PULL_SINGLE_CHAIN,uplink_body:{batch_pull_singe_chain_uplink_body:{conversation_type:r.i1.ONE_TO_BOT_CHAT,direction:r.Tk.FROM_LATEST,limit:1,params:null!==(s=null==g?void 0:null===(t=g.map(e=>{var t;return{conversation_id:null!==(t=e.conversation_id)&&void 0!==t?t:""}}))||void 0===t?void 0:t.filter(e=>!!e.conversation_id))&&void 0!==s?s:[],evaluate_ab_params:"",evaluate_common_params:"",ext:{}}}}),{status_code:S,status_desc:v,downlink_body:m}=await (0,o.imGatewayClient)({url:"/im/chain/batch_single",method:"POST",data:E}),{batch_pull_singe_chain_downlink_body:M}=null!=m?m:{},{message_map:f,retry_list:p}=null!=M?M:{},h=Object.keys(null!=f?f:{}),A={},T={};for(let e of h)A[e]=null!==(c=null==f?void 0:null===(n=f[e])||void 0===n?void 0:null===(i=n.messages)||void 0===i?void 0:i.map(u.C))&&void 0!==c?c:[],T[e]=Object.values(null!==(d=null==f?void 0:null===(_=f[e])||void 0===_?void 0:_.regen_messages)&&void 0!==d?d:{}).map(u.C);return{code:S,msg:v,data:{retry_list:p,message_map:A,regen_map:T}}};function M(e,t,s){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class f{constructor(){M(this,"rateLimit",()=>E()),M(this,"getMessageList",async e=>{var t,s;let i=await g(e);return(null===(s=i.data)||void 0===s?void 0:null===(t=s.message_list)||void 0===t?void 0:t.length)||n.k.persist.info({eventName:"IM_chain_single_empty",meta:{conversation_id:e.conversation_id,cursor:e.cursor,batch_size:e.batch_size}}),i}),M(this,"getMessageListByIndexList",e=>g(e)),M(this,"getLatestMessageList",e=>m(e)),M(this,"deleteMessage",e=>v(e)),M(this,"regenSwitch",e=>c(e)),M(this,"feedback",e=>S(e)),M(this,"updateContent",e=>_(e))}}var p=s(51679);function h(e,t,s){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class A{constructor(){h(this,"rateLimit",async()=>await p.kz.CheckMessageSendRateLimit()),h(this,"getMessageList",async e=>await p.kz.MessageList(e)),h(this,"getMessageListByIndexList",async e=>await p.kz.GetMessageListByIndexList(e)),h(this,"getLatestMessageList",async e=>await p.kz.LatestMessageList(e)),h(this,"deleteMessage",async e=>await p.kz.MessageReport({...e,action:"delete"})),h(this,"regenSwitch",async e=>await p.kz.MessageReport({...e,action:"regen_switch"})),h(this,"feedback",async e=>await p.kz.MessageReport({...e,action:"feedback"})),h(this,"updateContent",async e=>await p.kz.UpdateMsgContent(e))}}let T=async()=>await (0,i.j)()?new f:new A,L=async()=>T()},969537:function(e,t,s){s.d(t,{Kr:function(){return K},ox:function(){return V},Ee:function(){return x},vw:function(){return G},il:function(){return J},zo:function(){return N},MV:function(){return y},uH:function(){return R},ZL:function(){return $},Ch:function(){return I},wJ:function(){return z},cV:function(){return Y},UQ:function(){return Q},hV:function(){return Z},pe:function(){return P},bu:function(){return C},Pw:function(){return j},uM:function(){return X},BF:function(){return b},PL:function(){return U}});var i=s(81192),n=s(314752),a=s(302282),r=s(443032),l=s(915234),o=s(154760),_=s(148824),c=s(228535),u=s(589944),d=s(666396),g=s(644367),E=s(298113),S=s(511451),v=s(828652),m=s(633906),M=s(607278),f=s(126628),p=s(708481),h=s(623666);let A=e=>{let{sessionLifeCycleMachineAction:t,singleRecevingMessageMachineAction:s,lifeCycleEventNames:i,lifeCycleGuard:n=e=>!0,idleExecuteSessionLifeCycleNextAction:a,idleExecuteSessionLifeCycleNextActionIntervalGetter:r}=e;return async(e,l,o)=>new Promise((_,u)=>{E.t.pushQueue(e,l,async()=>{let d=E.t.getSessionLifeCycleMachineState(e,l),A=(0,S.Z)(o)?"":(0,c.Yns)(o)?"":o.message_id||"",T=A?E.t.getSingleRecevingMessageLifeCycleMachineState(e,l,A):void 0,L=E.t.getSessionLifeCycleContext(e,l,A),I=n(e,l,o,d,T);if(!I)return _(o);(0,v.Z)(I)||(o=I),E.t.clearSessionLifeCycleIdleNextAction(e,l,d);let R=(await (0,f.Je)()).map(e=>{var t,s;if((0,S.Z)(o)){if(null===(t=e.matchPluginWithPayload)||void 0===t?void 0:t.call(e,o))return e.pluginIdentifier}else if(null===(s=e.matchPlugin)||void 0===s?void 0:s.call(e,o))return e.pluginIdentifier}).filter(m.Z),C=(await Promise.all(R.map(e=>(0,p.o6)(e)))).filter(e=>!!e),y=o;for(let e of i)for(let t of C){let s=t[e],i=(e,t)=>t,n=(0,M.Z)(s)?s:i;try{y=await n(L,y)}catch(t){if(g.k.persist.error({error:t,message:`message lifecycle [${e}] execute failed, reason:${t.message}`}),(0,h.TH)(t)||(0,h.i8)(t))return u(t)}}E.t.nextSessionLifeCycleMachineState(e,l,t),A&&E.t.nextSingleReceivingMessageLifeCycleMachineState(e,l,A,s),a&&r&&E.t.idleExecuteSessionLifeCycleNextAction(e,l,()=>a(e,l,o),r()),_(y)})})},T=(e,t)=>(s,i,a,l)=>l===t||(g.k.persist.info({message:`execute ${e} action failed,session_machine_state invalid, current state: ${n.qw[l]}, report message session end`}),(0,r.P)(E.t,s,i,a),!1),L=(e,t)=>(s,i)=>s===e&&i===t,I=A({lifeCycleEventNames:["processMessageBefore"]}),R=A({lifeCycleEventNames:["onProcessMessageEnd"]}),C=A({sessionLifeCycleMachineAction:n.Pi.StartMessageSession,lifeCycleEventNames:["onMessageSessionStart"],lifeCycleGuard:(e,t,s,i)=>(E.t.createLifeCycleSessionStore(e,t),!0)}),y=A({sessionLifeCycleMachineAction:n.Pi.StartMessageSession,lifeCycleEventNames:["onMessageSessionStart"],lifeCycleGuard:(e,t,s,i)=>(E.t.createLifeCycleSessionStore(e,t),E.t.forceUpdateSessionLifeCycleMachine(e,t,n.qw.BatchMessageReceivingStart),!0)}),P=A({lifeCycleEventNames:["beforeMessageSending"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.MessageSessionStart}),k=A({sessionLifeCycleMachineAction:n.Pi.TimeoutMessageSending,lifeCycleEventNames:["onMessageSendingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,a)=>{if(!T("timeout_message_sending",n.qw.MessageSendingStart)(e,t,s,a))return!1;{let e=(0,i.Z)(s);return e.final_status={message:"Timeout",session:"Timeout"},e}}}),N=A({sessionLifeCycleMachineAction:n.Pi.StartMessageSending,lifeCycleEventNames:["onMessageSendingStart"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.MessageSessionStart,idleExecuteSessionLifeCycleNextAction:k,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{sendMessageStartTimeout:e=d.OY}=(0,u.$)("chatMessageConfig")||{};return e}}),O=A({sessionLifeCycleMachineAction:n.Pi.TimeoutMessageReceiving,lifeCycleEventNames:["onBatchMessageReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,a)=>{if(!T("timeout_batch_message_receiving",n.qw.BatchMessageReceivingStart)(e,t,s,a))return!1;{let e=(0,i.Z)(s);return e.final_status={message:"Timeout",session:"Timeout"},e}}}),D=A({singleRecevingMessageMachineAction:n.Lu.EndMessageReceiving,sessionLifeCycleMachineAction:n.Pi.TimeoutMessageReceiving,lifeCycleEventNames:["onMessageReceivingEnd","onBatchMessageReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,a)=>{if(!T("timeout_batch_message_receiving",n.qw.BatchMessageReceivingStart)(e,t,s,a))return!1;{let e=(0,i.Z)(s);return e.final_status={message:"Timeout",session:"Timeout"},e}}}),x=A({sessionLifeCycleMachineAction:n.Pi.SuccessMessageSending,lifeCycleEventNames:["onMessageSendingEnd","onBatchMessageReceivingStart"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.MessageSendingStart,idleExecuteSessionLifeCycleNextAction:O,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveMessageStartTimeout:e=d.Gr}=(0,u.$)("chatMessageConfig")||{};return e}}),b=A({sessionLifeCycleMachineAction:n.Pi.BreakMessageSending,lifeCycleEventNames:["onMessageSendingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("break_message_sending",n.qw.MessageSendingStart)(e,t,s,i)}),G=A({sessionLifeCycleMachineAction:n.Pi.ErrorMessageSending,lifeCycleEventNames:["onMessageSendingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("error_message_sending",n.qw.MessageSendingStart)(e,t,s,i)}),U=A({lifeCycleEventNames:["onThinkingMessageUpdate"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.BatchMessageReceivingStart,idleExecuteSessionLifeCycleNextAction:D,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveStreamPackageUpdateTimeout:e=d.Gv}=(0,u.$)("chatMessageConfig")||{};return e}}),w=A({singleRecevingMessageMachineAction:n.Lu.StartMessageReceiving,lifeCycleEventNames:["onMessageReceivingStart"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.Init)(i,a),idleExecuteSessionLifeCycleNextAction:D,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveMessageStartTimeout:e=d.Gr}=(0,u.$)("chatMessageConfig")||{};return e}}),B=A({lifeCycleEventNames:["onMessageReceivingUpdate"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.MessageReceivingStart)(i,a),idleExecuteSessionLifeCycleNextAction:D,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveStreamPackageUpdateTimeout:e=d.Gv}=(0,u.$)("chatMessageConfig")||{};return e}}),W=A({lifeCycleEventNames:["onMessageReceivingUpdate"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.MessageReceivingStart)(i,a),idleExecuteSessionLifeCycleNextAction:D,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveStreamPackageUpdateTimeoutForAsyncTask:e=d.q3}=(0,u.$)("chatMessageConfig")||{};return e}}),F=A({singleRecevingMessageMachineAction:n.Lu.EndMessageReceiving,lifeCycleEventNames:["onMessageReceivingEnd"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.MessageReceivingStart)(i,a)}),H=A({singleRecevingMessageMachineAction:n.Lu.EndMessageReceiving,lifeCycleEventNames:["onMessageReceivingEnd"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.MessageReceivingStart)(i,a)}),z=A({singleRecevingMessageMachineAction:n.Lu.EndMessageReceiving,lifeCycleEventNames:["onMessageReceivingEnd"],lifeCycleGuard:(e,t,s,i,a)=>L(n.qw.BatchMessageReceivingStart,n.o6.MessageReceivingStart)(i,a)}),Z=A({sessionLifeCycleMachineAction:n.Pi.EndMessageSession,lifeCycleEventNames:["onBatchMessageReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("end_message_receiving",n.qw.BatchMessageReceivingStart)(e,t,s,i)}),K=A({sessionLifeCycleMachineAction:n.Pi.ErrorMessageReceiving,lifeCycleEventNames:["onBatchMessageReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("error_message_receiving",n.qw.BatchMessageReceivingStart)(e,t,s,i)}),V=A({sessionLifeCycleMachineAction:n.Pi.BreakMessageReceiving,lifeCycleEventNames:["onBatchMessageReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("break_message_receiving",n.qw.BatchMessageReceivingStart)(e,t,s,i)}),Y=A({lifeCycleEventNames:["onSuggestReceivingUpdate"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.SuggestionReceivingStart}),q=A({sessionLifeCycleMachineAction:n.Pi.EndMessageSession,lifeCycleEventNames:["onSuggestReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,a)=>{if(!T("end_message_session",n.qw.SuggestionReceivingStart)(e,t,s,a))return!1;{let e=(0,i.Z)(s);return e.final_status={message:"Success",suggest:"Timeout",session:"Timeout"},e}}}),j=A({sessionLifeCycleMachineAction:n.Pi.EndMessageSession,lifeCycleEventNames:["onSuggestReceivingEnd","onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>T("end_message_session",n.qw.SuggestionReceivingStart)(e,t,s,i)}),$=A({sessionLifeCycleMachineAction:n.Pi.StartSuggestionReceiving,lifeCycleEventNames:["onBatchMessageReceivingEnd","onSuggestReceivingStart"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.BatchMessageReceivingStart,idleExecuteSessionLifeCycleNextAction:q,idleExecuteSessionLifeCycleNextActionIntervalGetter:()=>{let{receiveSuggestStartTimeout:e=d.UD}=(0,u.$)("chatMessageConfig")||{};return e}}),X=A({sessionLifeCycleMachineAction:n.Pi.EndMessageSession,lifeCycleEventNames:["onMessageSessionEnd"],lifeCycleGuard:(e,t,s,i)=>i===n.qw.MessageSessionStart}),J=(e,t,s)=>{if(!s.message_id)return;let i=(0,_.zu)(s),n=(0,c.FFC)(s),a=(0,c.vlk)(s),r=(0,_.Wj)(s);w(e,t,s),r?W(e,t,s):B(e,t,s),n?z(e,t,s):a?H(e,t,s):i&&F(e,t,s)},Q=(e,t)=>{let s=E.t.getSessionIdBySentMessageId(e,t);E.t.getSessionLifeCycleContext(e,s,"").set("chatEventContext",new l.v({params:{slardar:{chat_session_scene:"resume_task",chat_session_id:s,chat_scene:o.V.DEFAULT}}})),(0,a.C)({slardar:{chat_session_scene:"resume_task",chat_session_id:s}}),y(e,s,{is_delta:!1})}},298113:function(e,t,s){s.d(t,{t:function(){return E}});var i=s(577518),n=s(107526),a=s(508830),r=s(314752);let l={[r.qw.Init]:{[r.Pi.StartMessageSession]:r.qw.MessageSessionStart},[r.qw.MessageSessionStart]:{[r.Pi.StartMessageSending]:r.qw.MessageSendingStart,[r.Pi.BreakMessageSending]:r.qw.MessageSessionEnd},[r.qw.MessageSendingStart]:{[r.Pi.BreakMessageSending]:r.qw.MessageSessionEnd,[r.Pi.SuccessMessageSending]:r.qw.BatchMessageReceivingStart,[r.Pi.ErrorMessageSending]:r.qw.MessageSessionEnd,[r.Pi.TimeoutMessageSending]:r.qw.MessageSessionEnd},[r.qw.BatchMessageReceivingStart]:{[r.Pi.StartSuggestionReceiving]:r.qw.SuggestionReceivingStart,[r.Pi.BreakMessageReceiving]:r.qw.MessageSessionEnd,[r.Pi.EndMessageSession]:r.qw.MessageSessionEnd,[r.Pi.ErrorMessageReceiving]:r.qw.MessageSessionEnd,[r.Pi.TimeoutMessageReceiving]:r.qw.MessageSessionEnd},[r.qw.SuggestionReceivingStart]:{[r.Pi.EndMessageSession]:r.qw.MessageSessionEnd},[r.qw.MessageSessionEnd]:{}},o={[r.o6.Init]:{[r.Lu.StartMessageReceiving]:r.o6.MessageReceivingStart},[r.o6.MessageReceivingStart]:{[r.Lu.EndMessageReceiving]:r.o6.MessageReceivingEnd},[r.o6.MessageReceivingEnd]:{}};class _{setState(e){this.state=e}getState(){return this.state}resetState(){this.state=this.initState}nextState(e){let t=this.actionMap[this.state][e];void 0!==t&&(this.state=t)}constructor(e,t){var s,i,n;this.initState=e,this.actionMap=t,i=void 0,(s="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(s="state","string"))?n:n+"")in this?Object.defineProperty(this,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[s]=i,this.state=e}}class c extends _{constructor(e=r.qw.Init,t=l){super(e,t),this.initState=e,this.actionMap=t}}class u extends _{constructor(e=r.o6.Init,t=o){super(e,t),this.initState=e,this.actionMap=t}}function d(e,t,s){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function g(){return{context:{},sessionMachine:new c,timers:{},queue:new n.Z({concurrency:1}),singleReceivingMessageMachine:{}}}let E=new class{_initSessionStoreIfNeed(e,t){return this.store[e]?this.store[e][t]||(this.store[e][t]=g()):this.store[e]={[t]:g()},this.store[e][t]}_initSessionStoreForce(e,t){return this.store[e]?(this._clearEffect(this.store[e][t]),this.store[e][t]=g()):this.store[e]={[t]:g()},this.store[e][t]}_clearEffect(e){var t;let s=null==e?void 0:e.timers;null===(t=(0,a.Z)(s))||void 0===t||t.forEach(e=>{clearTimeout(e)});let i=null==e?void 0:e.queue;null==i||i.clear()}_getSessionLifeCycleContext(e,t){return this._initSessionStoreIfNeed(e,t),{ctx:this.store[e][t].context}}_getSessionLifeCycleIdleNextActionTimer(e,t){return this._initSessionStoreIfNeed(e,t),{timers:this.store[e][t].timers}}_createSessionIdWithSentMessageIdIfNeed(e,t){if(this.sessionIdMap[e]||(this.sessionIdMap[e]={}),!this.sessionIdMap[e][t]){let s=(0,i.Z)();this.sessionIdMap[e][t]=s}return this.sessionIdMap[e][t]}getSessionIdBySentMessageId(e,t){return this._createSessionIdWithSentMessageIdIfNeed(e,t)}copySessionIdWithSentMessageId(e,t,s){return this.sessionIdMap[e]||(this.sessionIdMap[e]={}),this.sessionIdMap[e][s]=this.sessionIdMap[e][t],this.sessionIdMap[e][s]}createLifeCycleSessionStore(e,t){return this._initSessionStoreForce(e,t)}getSessionLifeCycleContext(e,t,s){let{ctx:i}=this._getSessionLifeCycleContext(e,t);return{current_session_state:this._getSessionLifeCycleMachine(e,t).getState(),current_single_receiving_message_state:this._getSingleRecevingMessageLifeCycleMachine(e,t,s||"").getState(),get:e=>null==i?void 0:i[e],set:(e,t)=>(i[e]=t,i[e])}}_getAllSingleRecevingMessageLifeCycleMachine(e,t){return this._initSessionStoreIfNeed(e,t),{state:this.store[e][t].singleReceivingMessageMachine,resetState:()=>{this.store[e][t].singleReceivingMessageMachine={}}}}_getSessionLifeCycleMachine(e,t){return this._initSessionStoreIfNeed(e,t),this.store[e][t].sessionMachine}_getSingleRecevingMessageLifeCycleMachine(e,t,s){var i;return this._initSessionStoreIfNeed(e,t),(null===(i=this.store[e][t].singleReceivingMessageMachine)||void 0===i?void 0:i[s])||(this.store[e][t].singleReceivingMessageMachine[s]=new u),this.store[e][t].singleReceivingMessageMachine[s]}nextSessionLifeCycleMachineState(e,t,s){let i=this._getSessionLifeCycleMachine(e,t);void 0!==s&&i.nextState(s)}nextSingleReceivingMessageLifeCycleMachineState(e,t,s,i){let n=this._getSingleRecevingMessageLifeCycleMachine(e,t,s);void 0!==i&&n.nextState(i)}getSessionLifeCycleMachineState(e,t){return this._getSessionLifeCycleMachine(e,t).getState()}forceUpdateSessionLifeCycleMachine(e,t,s){return this._getSessionLifeCycleMachine(e,t).setState(s)}getSingleRecevingMessageLifeCycleMachineState(e,t,s){return this._getSingleRecevingMessageLifeCycleMachine(e,t,s).getState()}pushQueue(e,t,s){this._initSessionStoreIfNeed(e,t),this.store[e][t].queue.add(s)}idleExecuteSessionLifeCycleNextAction(e,t,s,i){let n=this.getSessionLifeCycleMachineState(e,t);this.clearSessionLifeCycleIdleNextAction(e,t,n),this.store[e][t].timers[n]=setTimeout(s,i)}clearSessionLifeCycleIdleNextAction(e,t,s){let{timers:i}=this._getSessionLifeCycleIdleNextActionTimer(e,t);i[s]&&(clearTimeout(i[s]),i[s]=void 0)}moveAllSessionLifeCycle(e,t){this.store[t]=this.store[e],this.sessionIdMap[t]=this.sessionIdMap[e]}constructor(){d(this,"store",{}),d(this,"sessionIdMap",{})}}},789691:function(e,t,s){s.d(t,{s:function(){return a},z:function(){return n}});var i=s(577518);let n=()=>(0,i.Z)(),a=()=>(0,i.Z)()},530836:function(e,t,s){s.r(t),s.d(t,{createStore:function(){return l},initMessageStore:function(){return _},useMessageStore:function(){return o}});var i=s(613993),n=s(231462),a=s(561200),r=s(341662);let l=e=>{let{prefix:t,isEnableDebug:s,reduxDevToolsSnapshot:l}=e;return((0,a.vI)(),s&&l)?(0,n.Ue)()((0,i.mW)((0,i.XR)(r.SF),{name:`${t}chat-message-store`})):(0,n.Ue)()((0,i.XR)(r.SF))},o=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let{_useMessageStore:i}=o.prototype;if(i)return i(...t);throw Error("useMessageStore is not initialized")};function _(e){let{_useMessageStore:t}=o.prototype||{};if(!t){let t=l({...e});Object.setPrototypeOf(o.prototype,t),Object.defineProperties(o,{...Object.getOwnPropertyDescriptors(t)}),o.prototype._useMessageStore=t}}},90566:function(e,t,s){s.d(t,{H:function(){return i}});let i={messageMap:{},localMessageMap:{},messageLinkMap:{},messageListStatusMap:{},regenerateMessageMap:{},searchResultIsFinishedMap:{},sendMessagePromiseTasks:{},lastMessageMap:{},rateLimitConfig:{isLimited:!1,limitExpired:void 0,limitTips:""},musicAutoPlay:!1}},777433:function(e,t,s){s.d(t,{pC:function(){return U},cS:function(){return B},km:function(){return O},FL:function(){return w},NE:function(){return W},Tt:function(){return D},yk:function(){return G},$j:function(){return x}});var i=s(563323),n=s(327386),a=s(177056),r=s(210230),l=s(871987),o=s(814986),_=s(444614),c=s(511451),u=s(561200),d=s(81307),g=s(983184),E=s(145625),S=s(900730),v=s(148824),m=s(15348),M=s(708481),f=s(93708),p=s(589944),h=s(666396),A=s(181171),T=s(455746),L=s(644367),I=s(90566),R=s(436462),C=s(63746),y=s(386870),P=s(789691),k=s(969537),N=s(166766);function O(e,t){let{draftLocalMessageMap:s,draftMessageMap:n,draftMessageLinks:a}=e,{isLocalMessage:r,messageId:l}=t;return r?delete s[l]:delete n[l],(0,i.Z)(a,e=>e.messageId===l)}function D(e,t){let{isLocalMessage:s,messageId:i}=t,{draftLocalMessageMap:n,draftMessageMap:a}=e;s&&n[i]?n[i].status=T.PushMessageStatus.InVisible:a[i]&&(a[i].status=T.PushMessageStatus.InVisible)}function x(e){let t=O(e,{isLocalMessage:!0,messageId:(0,S.J)(h.YR)});t>-1&&e.draftMessageLinks.splice(t,1)}let b=(e,t)=>{var s,i,l;let o={...e.ext,...t.ext},_=null===(s=e.local)||void 0===s?void 0:s.localKey;return{...(0,n.Z)(e,["local","local_message_id"]),...(0,a.Z)((0,n.Z)(t,["skill"]),r.Z),ext:o,local_info:{...e.local_info,...t.local_info,local_key:_,from:(null===(i=t.local_info)||void 0===i?void 0:i.from)||(null===(l=e.local_info)||void 0===l?void 0:l.from)||d.Fz.Unknown}}};function G(e){let{draft:t,localMessage:s,message:i}=e,{message_id:n}=i,{local_message_id:a}=s;if(!n||!a){L.k.console.warning("skip replaceLocalMessageWithRemoteMessage: invalid remote/local message");return}t.draftMessageMap[n]=b(s,i);let r=O(t,{isLocalMessage:!0,messageId:a});if(r>-1){var l,o;let e=t.draftMessageLinks[r];return null===(l=t.draftMessageLinks.splice(r,1,{isLocalMessage:!1,messageId:n,messageKey:null!==(o=e.messageKey)&&void 0!==o?o:(0,P.s)()}))||void 0===l?void 0:l[0]}L.k.persist.warning({message:"not found local message to replace",meta:{localMessageId:a}})}let U=(e,t)=>({...I.H,fetchMessageList:async e=>{let{conversationId:t,cursor:s,size:i,v2ApiExt:n}=e;if(s<=0||i<=0||!t||"0"===t){L.k.console.warning({message:"fetchUpdateMessageList: invalid cursor input",meta:{conversationId:t,cursor:s}});return}try{let e=await (await (0,N.p)()).getMessageList({conversation_id:t,cursor:s,batch_size:i,v2_api_ext:n}),{data:r}=e,o={from:d.Fz.Api,logId:(0,A.m)(e)},_=(await Promise.all(((null==r?void 0:r.message_list)||[]).reverse().map(async e=>await (0,y.m)(e,{local_info:o})))).map(e=>({...e,is_delta:!1})),c=_.filter(e=>!!(0,v.bf)(e)||!!(0,v.zu)(e)),u=(0,l.Z)(_,e=>{var t;return(null==e?void 0:null===(t=e.async_task)||void 0===t?void 0:t.status)===g.l.AsyncTaskStatusProcessing});if((0,m.D)("chatInputStoreService").then(e=>{var s;return null==e?void 0:e.updateSendMessageStatus(t,(null==u?void 0:null===(s=u.async_task)||void 0===s?void 0:s.status)===g.l.AsyncTaskStatusProcessing?E.M.Receiving:E.M.Default)}),u){var a;(null==u?void 0:null===(a=u.async_task)||void 0===a?void 0:a.id)&&(0,M.cf)("SamanthaChat").then(async e=>{var t,s,i,n,a;let r=(null===(t=u.async_task)||void 0===t?void 0:t.id)||"",l=(await (0,f.TB)("samanthaChatProtocolStore")).getState().samanthaChatAsyncTaskMap[r],o=(null==l?void 0:null===(s=l.message)||void 0===s?void 0:s.conversation_id)||"",_=(null==l?void 0:null===(i=l.message)||void 0===i?void 0:i.reply_id)||"";(0,k.UQ)(o,_),l?null==e||null===(n=e.resumeAsyncTask)||void 0===n||n.call(e,[l]):null==e||null===(a=e.createAsyncTask)||void 0===a||a.call(e,u,r)})}return{hasMore:!!(null==r?void 0:r.has_more),messages:c,messageLinks:c.map(e=>({messageId:e.message_id||"",isLocalMessage:!1})),regenerateList:(await Promise.all(((null==r?void 0:r.regen_list)||[]).reverse().map(async e=>await (0,y.m)(e,{local_info:o})))).map(e=>({...e,is_delta:!1}))}}catch(e){throw e instanceof Error&&L.k.persist.error({message:"fetchUpdateMessageList failed",error:e}),e}},fetchEnoughMessageList:async e=>{let{conversationId:s,cursor:i,size:n,v2ApiExt:a}=e,r=[],l=0,o=i,_=!0,c=!1;for(;_;){let e=await t().fetchMessageList({conversationId:s,cursor:o,size:n,v2ApiExt:a});if(r.push(e),_=!1,!e){c=!1;return}if(e.messages.length===n){let t=e.messages.filter(v.Z_).length;(l+=t)<h.xK&&(L.k.persist.warning({message:"fetchEnoughMessageList: auto load more",meta:{fetchSize:e.messages.length,currentFetchAvailableMessageSize:t,fetchAvailableSize:l}}),o-=n,_=!0)}_&&r.length>=5&&(_=!1,L.k.persist.warning({message:"fetchEnoughMessageList: break by maxTry",meta:{fetchAvailableSize:l}})),c=e.hasMore}return 1===r.length?r[0]:r.reduceRight((e,t)=>(t&&(e.messageLinks=e.messageLinks.concat(t.messageLinks),e.messages=e.messages.concat(t.messages),e.regenerateList=e.regenerateList.concat(t.regenerateList)),e),{messages:[],messageLinks:[],regenerateList:[],hasMore:c})},logicalDeleteMessage:e=>{let{conversationId:s,messageLink:i,deleteReply:n=!1}=e;t().createUpdateMessageList(s)(e=>{if(D(e,i),n){let t=(0,R.$n)({replyId:i.messageId,messageLinks:e.draftMessageLinks,getMessage:(0,C.Wi)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap})});(null==t?void 0:t.length)&&t.forEach(t=>D(e,t))}})},clearConversationMessages:t=>{e((0,u.Uy)(e=>{e.messageMap[t]&&delete e.messageMap[t],e.localMessageMap[t]&&delete e.localMessageMap[t],e.regenerateMessageMap[t]&&delete e.regenerateMessageMap[t],e.messageLinkMap[t]&&delete e.messageLinkMap[t],e.messageListStatusMap[t]&&delete e.messageListStatusMap[t]}))},updateMessageList:async s=>{let{conversationId:i,immerUpdate:n}=s,a=(0,u.P2)(t());a.messageMap[i]||(a.messageMap[i]={}),a.localMessageMap[i]||(a.localMessageMap[i]={}),a.regenerateMessageMap[i]||(a.regenerateMessageMap[i]={messageMap:{}}),a.messageListStatusMap[i]||(a.messageListStatusMap[i]={hasMore:!1,lastCursor:0,inIniting:!1,inLoadingMore:!1}),Array.isArray(a.messageLinkMap[i])||(a.messageLinkMap[i]=[]);let r=function(e,t){let{regenerateMessageMap:s,messageMap:i,messageLinkMap:n,messageListStatusMap:a}=t;return{overrideMessages:t=>{Array.isArray(t)&&t.forEach(t=>{t.message_id&&(i[e][t.message_id]=t)})},overrideMessageLinks:t=>{n[e]=t},overrideRegenerateMessagesAndUpdateLink:t=>{if((0,c.Z)(t)&&(null==t?void 0:t.length)){if(s[e]){var i,n;let a=Object.values(s[e].messageMap);(null===(i=t[0])||void 0===i?void 0:i.reply_id)!==(null===(n=a[0])||void 0===n?void 0:n.reply_id)&&(s[e]={messageMap:{}})}else s[e]={messageMap:{}};t.forEach(t=>{let{message_id:i}=t;i&&(s[e].messageMap[i]=t)})}},resetMessageLink:(t,s)=>{var i,a,r,l;let o=null!==(r=null===(a=n[e])||void 0===a?void 0:null===(i=a.findIndex)||void 0===i?void 0:i.call(a,e=>t===e.messageId))&&void 0!==r?r:-1;if(~o){let t=n[e][o];null===(l=n[e])||void 0===l||l.splice(o,1,{...t,...s})}},setMessageStatus:t=>{a[e]=t}}}(i,a);await n({draftMessageMap:a.messageMap[i],draftLocalMessageMap:a.localMessageMap[i],draftMessageLinks:a.messageLinkMap[i],draftMessageListStatus:a.messageListStatusMap[i],draftRegenerateMessageMap:a.regenerateMessageMap[i]},r);let l=[];(0,u._x)(a,e=>l.push(...e));try{e((0,u.QE)(t(),l))}catch(e){L.k.console.log(e)}},createUpdateMessageList:e=>s=>t().updateMessageList({conversationId:e,immerUpdate:s}),hasSendMessageTask:e=>!!e.local_message_id&&!!t().sendMessagePromiseTasks[e.local_message_id],addSendMessageTask(t){let{local_message_id:s}=t;if(!s)return;let{sendMessageStartTimeout:i=h.OY}=(0,p.$)("chatMessageConfig")||{};e((0,u.Uy)(e=>{e.sendMessagePromiseTasks[s]={local_message_id:s,finish:o.Z,expired:Date.now()+i}}))},isSendMessageExpired(e){var s;let i=e.local_message_id;if(!i)return!1;let n=null===(s=t().sendMessagePromiseTasks[i])||void 0===s?void 0:s.expired;return!(0,_.Z)(n)&&Date.now()-n>0},updateSendMessageTaskFinishFn(s,i){let n=s.local_message_id;if(!n)return;let a=()=>{i(),e((0,u.Uy)(e=>{delete e.sendMessagePromiseTasks[n]}))};t().sendMessagePromiseTasks[n]&&e((0,u.Uy)(e=>{e.sendMessagePromiseTasks[n].finish=a}))},finishSendMessageTask(e){var s;e&&(null===(s=t().sendMessagePromiseTasks[e])||void 0===s||s.finish())},updateRateLimitConfig:t=>e(()=>({rateLimitConfig:t})),setMusicAutoPlay:t=>{e(()=>({musicAutoPlay:t}))}});function w(e,t){let s=e.draftLocalMessageMap[t];if(null==s?void 0:s.local_message_id){var i;let t=O(e,{isLocalMessage:!0,messageId:s.local_message_id});return{message:s,messageLink:null===(i=e.draftMessageLinks.splice(t,1))||void 0===i?void 0:i[0]}}}function B(e,t){if(!t)return;let s=(0,C.Wi)({localMessageMap:e.draftLocalMessageMap,messageMap:e.draftMessageMap});(0,R.$n)({messageLinks:e.draftMessageLinks,getMessage:s,replyId:t}).forEach(t=>{O(e,{isLocalMessage:!0,messageId:t.messageId});let s=e.draftMessageLinks.findIndex(e=>e.messageId===t.messageId);-1!==s&&e.draftMessageLinks.splice(s,1)})}function W(e,t){if(!t)return;let{draftLocalMessageMap:s}=e;Object.entries(s).forEach(s=>{let[i,n]=s;n.reply_id===t&&O(e,{isLocalMessage:!0,messageId:i})})}},341662:function(e,t,s){let i,n;s.d(t,{Xm:function(){return ei},SF:function(){return en}});var a=s(210230),r=s(622551),l=s(211959),o=s(342617),_=s(445863),c=s(963729),u=s(561200),d=s(81307),g=s(900730),E=s(148824),S=s(414817),v=s(666396),m=s(455746),M=s(19755),f=s(644367),p=s(631150);let h={suggestMessageMap:{}},A=(e,t)=>({...h,clearSuggestMessage:t=>{e((0,u.Uy)(e=>{e.suggestMessageMap[t]&&delete e.suggestMessageMap[t]}))},updateSuggestMessage:(t,s)=>{e(e=>{let i=s(e.suggestMessageMap[t]),n={...e.suggestMessageMap};return i?n[t]=i:delete n[t],{suggestMessageMap:n}})},updateSuggestMessageWithRemote:(e,s)=>{t().updateSuggestMessage(e,t=>{try{var i;if(!(null==s?void 0:s.reply_id))return t;let e=JSON.parse((null===(i=s.ext)||void 0===i?void 0:i.sp)||"[]");return{replyId:s.reply_id,loading:!1,failed:!1,expired:void 0,suggests:(0,p.GI)(e)?e.filter(e=>!!e):[]}}catch(i){return f.k.persist.warning({message:"load remote sp fail",meta:{conversationId:e,message_id:null==s?void 0:s.message_id,reply_id:null==s?void 0:s.reply_id}}),t}})}});var T=s(51679);let L="data is empty",I={sourceShareCreatorInfoMap:{}},R=(e,t)=>({...I,fetchSourceShareCreatorInfo(s){let{creatorId:i}=s,n=(t().sourceShareCreatorInfoMap[i]||Promise.resolve()).then(e=>{if(!(null==e?void 0:e.nickname))throw Error(L);return e}).catch(e=>(e.message!==L&&f.k.console.error({message:"failed to fetch share section divider creator profile",error:e}),T.UZ.ProfileOverview({visit_id:i}).then(e=>{var t,s,i,n;return{nickname:null===(s=e.data)||void 0===s?void 0:null===(t=s.profile_brief)||void 0===t?void 0:t.nickname,image:null===(n=e.data)||void 0===n?void 0:null===(i=n.profile_brief)||void 0===i?void 0:i.image}})));return e((0,u.Uy)(e=>{let{sourceShareCreatorInfoMap:t}=e;t[i]=n})),n}});var C=s(524518);let y={messageShowErrorHasReportedMap:{}},P=(e,t)=>({...y,checkMessageShowErrorHasReported:e=>{let{messageId:s}=e;return!!s&&(0,C.Z)(t().messageShowErrorHasReportedMap[s])},updateMessageShowErrorHasReported:s=>{let{messageId:i}=s;if(!i)return;let n=Date.now();e({messageShowErrorHasReportedMap:{...t().messageShowErrorHasReportedMap,[i]:n}})}});var k=s(777433),N=s(164303),O=s(166766);let D={messageFeedbackMap:{}},x=e=>({...D,async updateMessageFeedback(t){let{conversationId:s,messageId:i,detail:n,reportEvent:a}=t;try{await (await (0,O.p)()).feedback({message_id:i,feedbackDetail:n}),e((0,u.Uy)(e=>{let{messageFeedbackMap:t}=e;t[s]||(t[s]={}),t[s][i]||(t[s][i]={}),(0,N.Z)(t[s][i],n)})),null==a||a.success()}catch(e){e instanceof Error&&(null==a||a.error({reason:"message report failed",error:e}))}},updateMessageFeedbackStore(t){let{conversationId:s,messageId:i,detail:n}=t;e((0,u.Uy)(e=>{let{messageFeedbackMap:t}=e;t[s]||(t[s]={}),t[s][i]||(t[s][i]={}),(0,N.Z)(t[s][i],n)}))}});var b=s(90566),G=s(995129),U=s(967037);function w(e,t,s){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class B{add(e){this.queue.includes(e)||this.queue.push(e),this.queue.length>=this.QUEUE_MAX_LENGTH?(this.run(),this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)):this.timeoutId||(this.timeoutId=setTimeout(()=>this.run(),this.TIMEOUT))}async get(e){if(await this.hangPromise,this.promise){var t;let{data:s}=await this.promise;return null==s?void 0:null===(t=s.preview_images)||void 0===t?void 0:t[e]}}run(){var e;this.sended=!0,this.promise=T.mH.PDFPreview({uris:this.queue}),null===(e=this.hangResolver)||void 0===e||e.call(this)}constructor(){w(this,"TIMEOUT",300),w(this,"QUEUE_MAX_LENGTH",5),w(this,"queue",[]),w(this,"timeoutId",null),w(this,"promise",null),w(this,"hangResolver",null),w(this,"hangPromise",new Promise(e=>this.hangResolver=e)),w(this,"sended",!1)}}let W=(i=new B,async e=>(i.sended&&(i=new B),i.add(e),await i.get(e)));class F{add(e){this.queue.includes(e)||this.queue.push(e),this.queue.length>=this.QUEUE_MAX_LENGTH?(this.run(),this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null)):this.timeoutId||(this.timeoutId=setTimeout(()=>this.run(),this.TIMEOUT))}async get(e){if(await this.hangPromise,this.promise){var t;let{data:s}=await this.promise;return null==s?void 0:null===(t=s.results)||void 0===t?void 0:t.find(t=>t.url===e)}}run(){var e;this.sended=!0,this.promise=T.mH.SniffLink({links:this.queue,with_link_meta:!0}),null===(e=this.hangResolver)||void 0===e||e.call(this)}constructor(){w(this,"TIMEOUT",300),w(this,"QUEUE_MAX_LENGTH",5),w(this,"queue",[]),w(this,"timeoutId",null),w(this,"promise",null),w(this,"hangResolver",null),w(this,"hangPromise",new Promise(e=>this.hangResolver=e)),w(this,"sended",!1)}}let H=(n=new F,async e=>{n.sended&&(n=new F),n.add(e);let t=await n.get(e);return null==t?void 0:t.link_meta}),z={pdfPreviewMap:{},linkPreviewMap:{}},Z=(e,t)=>({...z,async updatePdfPreview(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!s)return null;let n=t().pdfPreviewMap[s];if((null==n?void 0:n.timestamp)&&Date.now()-n.timestamp<31536e6)return n;let{fileType:a}=i,r=(0,U.zQ)({eventName:"get_pdf_preview",meta:{file_type:a}});try{let t=s;if("Document"===a){let e=await (0,G.s)(t);e&&(t=e)}let i=await W(t);if(!i)return r.error({reason:"image_url_empty",error:Error("image_url_empty")}),null;{let t={imageUrl:i,timestamp:Date.now()};return e((0,u.Uy)(e=>{let{pdfPreviewMap:i}=e;i[s]=t})),r.addDurationPoint("success"),r.success(),t}}catch(e){return r.error({reason:"get_pdf_preview_failed",error:e instanceof Error?e:Error(String(e))}),null}},async updateLinkPreview(s){if(!s)return null;let i=t().linkPreviewMap[s];if(i)return i;let n=(0,U.zQ)({eventName:"get_url_preview",meta:{url:s}});try{let t=await H(s);if(t)return e((0,u.Uy)(e=>{let{linkPreviewMap:i}=e;i[s]=t})),n.addDurationPoint("success"),n.success(),t;return n.error({reason:"url_preview_empty",error:Error("url_preview_empty")}),null}catch(e){return n.error({reason:"get_url_preview_failed",error:e instanceof Error?e:Error(String(e))}),null}}});var K=s(63746),V=s(563323),Y=s(31497),q=s(627426),j=s(334578);let $=(e,t,s)=>e.filter(i=>{if(i.isLocalMessage){let n=s(i);if(~(0,V.Z)(e,e=>{if(e===i)return!1;let s=t(e),a=!e.isLocalMessage;return!!(a&&s&&((null==s?void 0:s.message_id)===(null==n?void 0:n.message_id)||(null==s?void 0:s.local_message_id)===(null==n?void 0:n.local_message_id))||a&&(null==n?void 0:n.reply_id)&&(0,E.SJ)(n)&&(null==s?void 0:s.reply_id)===n.reply_id&&(0,E.Z_)(s))}))return!1}return!0}),X=(e,t,s,i)=>{let n=(0,l.Z)([...e,...t],e=>e.messageId);n.forEach(e=>{let s=t.find(t=>t.messageId===e.messageId);(null==s?void 0:s.messageKey)&&(e.messageKey=s.messageKey)});let a=$(n,s,i);return(0,j.X)(a,s),a},J=(e,t)=>{let s=(0,Y.Z)(t,"messageId");return e.map(e=>(0,q.Z)(e,s[e.messageId]))};var Q=s(297562),ee=s(436462),et=s(744947),es=s(386870);let ei={...b.H,...h,...D,...I},en=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];let[i,n]=t,p=async e=>{var t;let{conversationId:s,messageIndex:i,range:a,isGuest:r,hasPreprocessTask:l,createByLocalConversationId:o,v2ApiExt:_}=e,c=v.oz,u=null!==(t=await n().fetchMergeMessageList({conversationId:s,cursor:i,size:c,range:a,isGuest:r,hasPreprocessTask:l,createByLocalConversationId:o,v2ApiExt:_}))&&void 0!==t?t:[];return 0===u.length&&f.k.persist.warning({message:"initMessageList empty",meta:{messageIndex:i}}),n().refreshSuggestMessage({conversationId:s}),u};return{...A(...t),...(0,k.pC)(...t),...x(...t),...Z(...t),...R(...t),...P(...t),fetchMergeMessageList:async e=>{let{conversationId:t,cursor:s,size:i,actionName:a="fetchMergeMessageList",range:r,isGuest:l,hasPreprocessTask:o,createByLocalConversationId:_,v2ApiExt:c}=e,u=n().createUpdateMessageList(t);if(i<=0){f.k.persist.warning(`skip ${a}: invalid size`);return}let d={conversationId:t,cursor:s,size:i,v2ApiExt:c};try{let e=await n().fetchEnoughMessageList(d);if(!e||!l&&e.messageLinks.length<0)return;return u((t,s)=>{let{draftMessageLinks:i,draftMessageMap:n,draftLocalMessageMap:l}=t,c=(0,K.Wi)({localMessageMap:l,messageMap:n}),u=(0,K.JG)({localMessageMap:l});s.overrideMessages(e.messages);let g=X(_?J(e.messageLinks,i):e.messageLinks,i,c,u);g=g.filter(e=>{if(e.isLocalMessage){let t=c(e);if(!(null==t?void 0:t.message_id)&&(null==t?void 0:t.user_type)===m.UserType.Human&&(0,S.K)(t)&&t.local.localKey)return o(t.local.localKey)}return!0}),s.overrideMessageLinks(g);let E=(0,K.FD)({messageLinks:g,getMessage:c,hasMore:e.hasMore,range:r});s.setMessageStatus(E),s.overrideRegenerateMessagesAndUpdateLink(e.regenerateList),f.k.console.info({message:`${a} finish`,meta:{messages:e.messages,status:E,requestPayload:d}})}),e.messageLinks}catch(e){throw e instanceof Error&&f.k.persist.error({message:`${a} failed`,error:e,meta:{request:d}}),e}},initMessageList:async e=>{let{messageCursor:t,messageIndex:s,conversationId:i,isGuest:a}=e,r=n().createUpdateMessageList(i),l=n().messageLinkMap[i];Array.isArray(l)&&0!==l.length||r(e=>{let{draftMessageListStatus:t}=e;t.inIniting=!0});try{if(1===t&&0===s)for(let t=0;t<5;t++){let s=500*2**t;try{let t=await p({...e,messageCursor:1,messageIndex:1});if(!a&&!(null==t?void 0:t.length))throw Error("Empty MessageList when invoke _initMessageList");return t}catch(e){if(4===t)throw e;await (0,M.GR)(s)}}else{if(!(s<=0)&&(!t||!(s<t)))return await p(e);f.k.persist.warning({message:"skip initMessageList",meta:{messageCursor:t,messageIndex:s}});return}}catch(e){f.k.persist.error({eventName:"init_message_list_error",error:e})}finally{r(e=>{let{draftMessageListStatus:t}=e;t.inIniting=!1})}},refreshSuggestMessage(e){let{conversationId:t}=e,{lastAvailableMessage:s}=(0,et.ce)(n(),t);s&&n().updateSuggestMessageWithRemote(t,s)},loadMoreMessageList:async(e,t,s)=>{let r=n().messageListStatusMap[e];if(!r||r.lastCursor<=0){f.k.persist.warning("skip loadMoreMessageList: invalid status");return}let l=v.oz;i((0,u.Uy)(t=>{t.messageListStatusMap[e].inLoadingMore=!0}));let o=await n().fetchMergeMessageList({conversationId:e,cursor:r.lastCursor-1,size:l,isGuest:t,hasPreprocessTask:s});return i((0,u.Uy)(t=>{t.messageListStatusMap[e].inLoadingMore=!1})),(0,a.Z)(o)&&f.k.persist.warning({message:"skip loadMoreMessageList: invalid api response",meta:{}}),o},initOnboarding:e=>{let{conversationId:t}=e;n().updateMessageList({conversationId:t,immerUpdate:e=>{(0,k.$j)(e);let s=(0,g.J)(v.YR);e.draftLocalMessageMap[s]=(0,Q.W)({localMessageStatus:d.JR.ReceivingFirstPackage,message:{is_delta:!1,conversation_id:t,local_message_id:s,reply_id:v.YR,conversation_type:d.VI.Bot,user_type:m.UserType.Bot,ext:{onboarding:"1"}},failedExpired:Date.now()+v.xt,messageLinks:e.draftMessageLinks,isRegenerate:!1}),e.draftMessageLinks.push({isLocalMessage:!0,messageId:s})}})},cancelOnboarding:e=>{let{conversationId:t}=e;n().updateMessageList({conversationId:t,immerUpdate:e=>{(0,k.$j)(e)}})},checkExistRemoteMessage:e=>{let{conversationId:t,messageId:s}=e,i=(0,K.Wi)({localMessageMap:n().localMessageMap[t],messageMap:n().messageMap[t]}),a=n().messageLinkMap[t];return!!(0,ee.RA)({messageLinks:a,replyId:s,getMessage:i})},fetchLastMessages:async e=>{let{conversationIds:t,retryCount:s=2}=e;try{let{data:{message_map:e={},regen_map:i={},retry_list:a=null}={}}=await (await (0,O.p)()).getLatestMessageList({request_list:t.map(e=>({conversation_id:e}))}),u=(0,r.Z)(e,i,(e,t)=>(0,l.Z)(e,t,e=>e.message_id)),g=await Promise.all((0,o.Z)((0,_.Z)(u),async e=>{let t=(0,c.Z)(u[e],e=>e.index),s=t?await (0,es.m)(t,{local_info:{from:d.Fz.Api}}):null,i=s&&(0,E.Z_)(s)?{...s,is_delta:!1}:void 0;return[e,i]})),S=Object.fromEntries(g);if((null==a?void 0:a.length)&&s>0){let e=await n().fetchLastMessages({conversationIds:a.map(String),retryCount:s-1});Object.assign(S,e||{})}return S}catch(e){f.k.persist.error({message:"get latest messages failed",error:e});return}},updateLastMessageMap:async e=>{let{conversationIds:t}=e,s=await n().fetchLastMessages({conversationIds:t,retryCount:2});s&&i((0,u.Uy)(e=>{e.lastMessageMap=s}))}}}},744947:function(e,t,s){s.d(t,{C7:function(){return I},Hd:function(){return T},JZ:function(){return y},Jp:function(){return A},K9:function(){return S},LF:function(){return f},M_:function(){return h},PJ:function(){return D},PP:function(){return k},PT:function(){return N},Rm:function(){return C},Sm:function(){return L},Sv:function(){return v},W0:function(){return E},Wz:function(){return R},_H:function(){return P},ap:function(){return b},bS:function(){return M},ce:function(){return g},eH:function(){return x},sf:function(){return p},y_:function(){return m}});var i=s(567336),n=s(508830),a=s(81307),r=s(228535),l=s(148824),o=s(234761),_=s(468494),c=s(666396),u=s(63746),d=s(436462);let g=(e,t)=>{let s=e.messageLinkMap[t]?E(e,t,e.messageLinkMap[t]):void 0;return{lastAvailableMessage:s?S(e,t,s):void 0,lastAvailableMessageLink:s}},E=(e,t,s)=>{for(let i=s.length-1;i>=0;i--){let n=s[i],a=s[i-1],o=S(e,t,n),_=S(e,t,a);if((0,r.KQr)(o)&&(0,r.KQr)(_))return(0,r.v08)(o)?a:n;if((0,l.Z_)(o))return n}},S=(e,t,s)=>(0,u.Wi)((0,u.xg)(e,t))(s),v=(e,t)=>{let{message:s}=m(e,t,e=>{let{getMessage:t}=e,s=t();return!(0,r.BOt)(s)&&!(0,l.zu)(s)&&!(0,r.vlk)(s)});return s},m=(e,t,s)=>{let i=(0,u.Wi)((0,u.xg)(e,t)),n=e.messageLinkMap[t],a=(0,d.vn)(n||[],e=>s({messageLink:e,getMessage:()=>i(e)}));return{messageLink:a,message:a?i(a):void 0}},M=(e,t,s)=>{let i=(0,d.RA)({messageLinks:e.messageLinkMap[t],replyId:s,getMessage:(0,u.Wi)((0,u.xg)(e,t))});return i?S(e,t,i):void 0},f=(e,t,s)=>{var i;return(null===(i=e.localMessageMap[t])||void 0===i?void 0:i[s])||{}},p=(e,t,s)=>{let i=e.messageMap[t],n=i[s];if(!n)return[];let a=n.reply_id&&"0"!==n.reply_id?n.reply_id:s,r=i[null!=a?a:""],l=Object.keys(i).filter(e=>{var t;return(null===(t=i[e])||void 0===t?void 0:t.reply_id)===a}).map(e=>Number(i[e].index));return[...r?[Number(r.index)]:[],...l]},h=(e,t)=>{let s=e.messageLinkMap[t],i=(0,u.Wi)({localMessageMap:e.localMessageMap[t],messageMap:e.messageMap[t]}),n=(0,d.vn)(s,e=>{let t=i(e);return!!t&&(0,l.Z_)(t)&&!!t.reply_id&&!(0,r.Yns)(t)});return n?i(n):void 0},A=(e,t,s)=>{let{messageLinks:i,resolveConversationId:n}=I(e,t),a=E(e,n,i);return s===(null==a?void 0:a.messageId)},T=(e,t)=>e.messageLinkMap[t]||[],L=(e,t)=>e.messageListStatusMap[t]||{},I=(e,t)=>{let s=L(e,t),i=T(e,t),n=(0,o.jo)(_.useFeedStore.getState(),t);return(null==n?void 0:n.conversation_type)===a.VI.Coco&&0===i.length?{status:L(e,c.M0),messageLinks:T(e,c.M0),resolveConversationId:c.M0}:{status:s,messageLinks:i,resolveConversationId:t}},R=(e,t,s)=>{let{messageLink:i}=m(e,t,e=>{let{getMessage:t}=e,s=t();return(0,r.Yns)(s)&&(0,l.Z_)(s)});return s===(null==i?void 0:i.messageId)},C=(e,t)=>{if(!(null==t?void 0:t.reply_id)||!(null==t?void 0:t.message_action_bar)||(0,r.Yns)(t))return[];let s=t.reply_id,i=t.conversation_id||"",n=e.messageLinkMap[i],a=(0,u.Wi)({messageMap:e.messageMap[i],localMessageMap:e.localMessageMap[i]});return(0,d.$n)({messageLinks:n,replyId:s,getMessage:a}).map(e=>a(e)).filter(e=>(null==e?void 0:e.stream_id)===t.stream_id)},y=(e,t,s)=>{var i;let n=P(e,t);return n?Math.max(n,(null!==(i=null==s?void 0:s.badge_count)&&void 0!==i?i:null==s?void 0:s.message_index)||0):(null==s?void 0:s.badge_count)||0},P=(e,t)=>{let s=e.messageLinkMap[t],i=(0,d.Pw)(s);if(!i)return 0;let n=S(e,t,i);return n?Number(n.index||0):0},k=(e,t,s)=>{let{message:i}=m(e,t,e=>{let{messageLink:t}=e;return t.messageId===s});return i},N=(e,t,s)=>{var i;let n=null===(i=e.messageLinkMap[t])||void 0===i?void 0:i.find(i=>{var n;return(null===(n=(i.isLocalMessage?e.localMessageMap:e.messageMap)[t][i.messageId])||void 0===n?void 0:n.reply_id)===s});if(n)return S(e,t,n)},O=(e,t,s)=>{var i;return null===(i=e.messageLinkMap[t])||void 0===i?void 0:i.find(e=>e.messageId===s)},D=(e,t,s)=>{let i=O(e,t,s);if(i)return S(e,t,i)},x=(e,t)=>{if(!(0,i.Z)(e.messageMap,t))return!0;{let s=e.messageMap[t];return!!(0,n.Z)(s).every(e=>(0,r.qF)(e))}},b=(e,t)=>{let s=t.reply_id;if(!t.is_regen||!s||(0,r.Yns)(t))return[];let i=t.conversation_id||"",n=e.messageLinkMap[i],a=(0,u.Wi)({messageMap:e.messageMap[i],localMessageMap:e.localMessageMap[i]});return(0,d.$n)({messageLinks:n,replyId:s,getMessage:a}).map(e=>a(e)).filter(e=>(null==e?void 0:e.stream_id)===t.stream_id||!(null==e?void 0:e.stream_id)&&!t.stream_id)}},436462:function(e,t,s){s.d(t,{$n:function(){return _},MF:function(){return u},Pw:function(){return o},RA:function(){return c},vn:function(){return l}});var i=s(260325),n=s(713273),a=s(228535),r=s(941236);let l=(e,t)=>(0,i.Z)(e||[],e=>t(e)),o=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return l(e,e=>{var s;return!e.isLocalMessage&&!!e.messageId&&(null===(s=null==t?void 0:t(e))||void 0===s||s)})},_=e=>{let{messageLinks:t=[],replyId:s,getMessage:i}=e;return(0,n.Z)(t,e=>{var t;return(null===(t=i(e))||void 0===t?void 0:t.reply_id)===s})},c=e=>{let{messageLinks:t=[],replyId:s,getMessage:i}=e;return l(t,e=>{var t;return(null===(t=i(e))||void 0===t?void 0:t.reply_id)===s})};function u(e){let t=(0,r.E)(e,10);for(let e=t.length-1;e>0;e--){var s;let i=t[e];if(!(0,a.Q5B)(i))continue;let n=[i];for(;e>0&&(0,a.Q5B)(t[e-1])&&t[e-1].reply_id&&t[e-1].reply_id===(null===(s=t[e])||void 0===s?void 0:s.reply_id);)n.unshift(t[e-1]),e--;return n}}},63746:function(e,t,s){s.d(t,{FD:function(){return i},JG:function(){return l},UQ:function(){return r},Wi:function(){return a},r7:function(){return o},xg:function(){return n}});let i=e=>{var t;let{messageLinks:s,getMessage:i,hasMore:n,range:a}=e,r=Number(null===(t=i(s[0]))||void 0===t?void 0:t.index)||0;return{hasMore:r>((null==a?void 0:a.start)||0)||n,lastCursor:r,inIniting:!1,inLoadingMore:!1}},n=(e,t)=>({messageMap:e.messageMap[t],localMessageMap:e.localMessageMap[t],messageLinks:e.messageLinkMap[t],messageListStatus:e.messageListStatusMap[t]}),a=e=>t=>{var s,i;if(!t)return;let{isLocalMessage:n,messageId:a}=t;return n?null===(s=e.localMessageMap)||void 0===s?void 0:s[a]:null===(i=e.messageMap)||void 0===i?void 0:i[a]},r=e=>t=>{var s;if(!t)return;let{isLocalMessage:i,messageId:n}=t;return i?void 0:null===(s=e.messageMap)||void 0===s?void 0:s[n]},l=e=>t=>{var s;if(!t)return;let{isLocalMessage:i,messageId:n}=t;return i?null===(s=e.localMessageMap)||void 0===s?void 0:s[n]:void 0},o=function(e,t){var s,i;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub",a="sub"===n?"localThread_":"localMainThread_";return t?null==e?void 0:null===(s=e.startsWith)||void 0===s?void 0:s.call(e,`${a}${t}_`):null==e?void 0:null===(i=e.startsWith)||void 0===i?void 0:i.call(e,a)}},297562:function(e,t,s){s.d(t,{W:function(){return a}});var i=s(455746),n=s(436462);let a=e=>{var t;let{prevMessageId:s,message:a,messageLinks:r,localMessageStatus:l,failedExpired:o,isRegenerate:_,localKey:c,enterFrom:u,isReady:d,botType:g,samanthaChatStage:E,isNova:S}=e;return{...a,message_type:i.MessageType.Message,create_time:Date.now(),status:a.status||i.PushMessageStatus.Available,local:{samanthaChatStage:E,localKey:c,prevRemoteMessageId:s||(null===(t=(0,n.Pw)(r))||void 0===t?void 0:t.messageId)||"",status:l,failed:!1,isRetried:!1,failedExpired:o,isRegenerate:_,enterFrom:u,isReady:d,botType:g,isNova:S}}}},334578:function(e,t,s){s.d(t,{X:function(){return r},Z:function(){return a}});var i=s(414817),n=s(920679);function a(e,t){return(Number(null==e?void 0:e.index)||0)-(Number(null==t?void 0:t.index)||0)}let r=(e,t)=>{e.sort((e,s)=>{if(!e.isLocalMessage&&!s.isLocalMessage)return a(t(e),t(s));if(e.isLocalMessage&&s.isLocalMessage){var r,l;return r=t(e),l=t(s),((0,n.v)(Number(null==r?void 0:r.create_time))||0)-((0,n.v)(Number(null==l?void 0:l.create_time))||0)}if(e.isLocalMessage&&!s.isLocalMessage||!e.isLocalMessage&&s.isLocalMessage){let n=e.isLocalMessage&&!s.isLocalMessage,r=s.isLocalMessage&&!e.isLocalMessage,l=n?t(e):t(s),o=r?t(e):t(s);if(l&&"index"in l)return n?a(l,o):a(o,l);let _=l&&(0,i.H)(l)&&l.local.prevRemoteMessageId?t({messageId:l.local.prevRemoteMessageId,isLocalMessage:!1}):void 0;return _===o?n?1:-1:n?a(_,o):a(o,_)}return 0})}},920679:function(e,t,s){s.d(t,{v:function(){return i}});function i(e){let t=Date.now();if(e%10**(t.toString().length-1)!==e)return e;{let s=1e3*e;return s<t?s:e}}},386870:function(e,t,s){s.d(t,{m:function(){return E}});var i=s(118200),n=s(164303),a=s(327386),r=s(228535),l=s(852076),o=s(586811),_=s(126628),c=s(708481),u=s(67939),d=s(886421),g=s(910157);let E=async(e,t)=>{var s,E,S,v,m;let M={...e,local_info:null==t?void 0:t.local_info,content_obj:(0,g.R)(e.content,void 0)},f=(0,i.Z)(e,["ext","has_err"])?"Error":(0,r.bKk)(e)?"Success":void 0;if((0,n.Z)(M,{conversation_type:(null==t?void 0:t.conversation_type)||(0,u.n)(e.conversation_id)||(0,u.n)(e.local_conversation_id,!0),bot_id:e.bot_id||(0,d.SR)(e.conversation_id)||(0,d.SR)(e.local_conversation_id,!0),is_finish:!!(0,r.bKk)(e),is_regen:"1"===(0,i.Z)(e,["ext","regen"]),regen_active:"1"===(0,i.Z)(e,["ext","regen_active"]),has_suggest:"1"===(0,i.Z)(e,["ext","has_suggest"]),...(0,o.JM)(e.ext),...(0,o.PD)(e.ext),security_archive_state:(0,i.Z)(e,["ext","archive_state"]),stream_id:Number(null!==(E=(0,i.Z)(e,["ext","crowd_test_msg_index"]))&&void 0!==E?E:"0"),ext:e.ext,verbose:{seed_intention:{detail:(0,i.Z)(e,["ext","llm_intention_detail"])||"",intention:(0,i.Z)(e,["ext","llm_intention"])||"",is_deep_think:(0,i.Z)(e,["ext","is_deep_think"])||"",seed_agent_name:(0,i.Z)(e,["ext","seed_agent_name"])||"",intention_detail_dict:(0,i.Z)(e,["ext","intention_detail_dict"])||"",query_difficulty:(0,i.Z)(e,["ext","query_difficulty"])||""},deep_research:{deep_research_id:(0,i.Z)(e,["ext","deep_research_id"]),deep_research_stage:Number(null!==(S=(0,i.Z)(e,["ext","deep_research_stage"]))&&void 0!==S?S:"0")},super_task:{supertask_id:(0,i.Z)(e,["ext","supertask_id"]),supertask_stage:Number(null!==(v=(0,i.Z)(e,["ext","supertask_stage"]))&&void 0!==v?v:"0"),supertask_task_type:(0,i.Z)(e,["ext","supertask_task_type"])},extra:{risk_tips:(0,i.Z)(e,["ext","risk_tips"])||(0,i.Z)(e,["ext","extra","risk_tips"])}},final_status:{message:f,session:f}}),e.content_block){let t=e.content_block.map(e=>({is_delta:!1,is_finish:!0,block_type:e.block_type,id:e.block_id||"",parent_id:e.parent_block_id||(0,i.Z)(e,"parent_id")||"0",content_obj:"object"==typeof e.content?Object.values(e.content).find(e=>null!=e):"string"==typeof e.content?(0,g.R)(e.content,void 0):void 0,meta_infos:(null==e?void 0:e.meta_infos)||(0,i.Z)(e,"meta_info")||[],is_deleted:!1}));M.content_blocks=t;let{contentBlocksTree:s,contentBlockNodes:n}=(0,l.i)(t);M.content_blocks_tree=s,M.content_block_nodes=n}if(null===(s=e.ext)||void 0===s?void 0:s.async_task){let t=(0,g.R)((0,i.Z)(e,["ext","async_task"]),{});M.async_task=t}let p=await (0,_.In)();if(p){let s=null===(m=p.find(e=>{var t;return null===(t=e.matchPluginForAliceChatMessageToMessage)||void 0===t?void 0:t.call(e,M)}))||void 0===m?void 0:m.pluginIdentifier,i=await (0,c.pB)(s);if(null==i?void 0:i.aliceChatMessageToMessage)return i.aliceChatMessageToMessage(M,e,null==t?void 0:t.local_info)}return(0,a.Z)(M,"content","content_block")}},623666:function(e,t,s){s.d(t,{RB:function(){return l},TH:function(){return a},i8:function(){return r},nc:function(){return n}});class i extends Error{constructor(e){super(e),this.name="LifecyclePanicError"}}class n extends Error{constructor(e){super(e),this.name="LifeCycleExpectError"}}let a=e=>e instanceof i,r=e=>e instanceof i,l=e=>r(e)?"ExpectError":a(e)?"PanicError":"Error"}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["58671"],{128614:function(e,i,t){t.d(i,{useImagePreview:function(){return S}});var o=t(713738),a=t(430261),l=t(345660),r=(0,a.IconFactory)((0,l.jsx)(e=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:22,height:22,fill:"none",viewBox:"0 0 22 22",...e,children:(0,l.jsx)("path",{fill:"#fff",d:"M10.992 4.35q.348 0 .564.224.224.216.224.572v7.596l-.074 1.66 2.224-2.424 1.685-1.66a.8.8 0 0 1 .25-.166.8.8 0 0 1 .315-.067q.33 0 .54.225a.74.74 0 0 1 .215.547.7.7 0 0 1-.066.3 1 1 0 0 1-.191.281l-5.097 5.08a.8.8 0 0 1-.274.191.77.77 0 0 1-.63 0 .9.9 0 0 1-.275-.19l-5.096-5.08a1.2 1.2 0 0 1-.191-.283.7.7 0 0 1-.067-.299q0-.33.216-.547a.73.73 0 0 1 .548-.225q.158 0 .307.067.15.058.257.166l1.686 1.66 2.216 2.432-.075-1.668V5.146q0-.356.224-.572a.77.77 0 0 1 .565-.224M5.746 16.76H16.23q.331 0 .547.223a.74.74 0 0 1 .216.548.78.78 0 0 1-.216.565.73.73 0 0 1-.547.224H5.746a.72.72 0 0 1-.54-.224.78.78 0 0 1-.216-.565q0-.332.216-.548a.72.72 0 0 1 .54-.224"})}),{})),n=(0,a.IconFactory)((0,l.jsx)(e=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:22,height:22,fill:"none",viewBox:"0 0 22 22",...e,children:(0,l.jsx)("path",{fill:"#fff",d:"M3.289 9.878q0-1.311.49-2.457a6.2 6.2 0 0 1 1.36-2.017 6.4 6.4 0 0 1 2.018-1.362 6.1 6.1 0 0 1 2.457-.498q1.32 0 2.465.498 1.146.49 2.017 1.362a6.2 6.2 0 0 1 1.361 2.017q.49 1.146.49 2.457 0 1.046-.323 2a6.1 6.1 0 0 1-.914 1.727l3.71 3.719q.142.158.217.348.075.192.074.39 0 .307-.132.54a.95.95 0 0 1-.366.374 1 1 0 0 1-.53.14 1.2 1.2 0 0 1-.408-.074.9.9 0 0 1-.348-.216l-3.736-3.744a6.4 6.4 0 0 1-1.668.83q-.905.3-1.91.3a6.2 6.2 0 0 1-2.456-.49A6.4 6.4 0 0 1 5.14 14.36a6.4 6.4 0 0 1-1.362-2.017 6.2 6.2 0 0 1-.49-2.465m1.51 0q0 .996.374 1.876A4.9 4.9 0 0 0 6.21 13.29q.665.656 1.536 1.029a4.7 4.7 0 0 0 1.868.373 4.7 4.7 0 0 0 1.867-.373 4.8 4.8 0 0 0 1.536-1.03 4.75 4.75 0 0 0 1.411-3.412q0-.995-.373-1.867a4.7 4.7 0 0 0-1.038-1.535 4.7 4.7 0 0 0-1.536-1.038 4.7 4.7 0 0 0-1.867-.374 4.7 4.7 0 0 0-1.868.374A4.9 4.9 0 0 0 6.21 6.475q-.663.656-1.037 1.535a4.7 4.7 0 0 0-.374 1.868m2.798.598a.595.595 0 0 1-.424-1.013.58.58 0 0 1 .424-.183h4.042q.249 0 .424.183a.595.595 0 0 1-.423 1.013z"})}),{})),d=(0,a.IconFactory)((0,l.jsx)(e=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:22,height:22,fill:"none",viewBox:"0 0 22 22",...e,children:(0,l.jsx)("path",{fill:"#fff",d:"M3.289 9.878q0-1.311.49-2.457a6.2 6.2 0 0 1 1.36-2.017 6.4 6.4 0 0 1 2.018-1.362 6.1 6.1 0 0 1 2.457-.498q1.32 0 2.465.498 1.146.49 2.017 1.362a6.2 6.2 0 0 1 1.361 2.017q.49 1.146.49 2.457 0 1.046-.323 2a6.1 6.1 0 0 1-.914 1.727l3.71 3.719q.142.158.217.348.075.192.074.39 0 .307-.132.54a.95.95 0 0 1-.366.374 1 1 0 0 1-.53.14 1.2 1.2 0 0 1-.408-.074.9.9 0 0 1-.348-.216l-3.736-3.744a6.4 6.4 0 0 1-1.668.83q-.905.3-1.91.3a6.2 6.2 0 0 1-2.456-.49A6.4 6.4 0 0 1 5.14 14.36a6.4 6.4 0 0 1-1.362-2.017 6.2 6.2 0 0 1-.49-2.465m1.51 0q0 .996.374 1.876A4.9 4.9 0 0 0 6.21 13.29q.665.656 1.536 1.029a4.7 4.7 0 0 0 1.868.373 4.7 4.7 0 0 0 1.867-.373 4.8 4.8 0 0 0 1.536-1.03 4.75 4.75 0 0 0 1.411-3.412q0-.995-.373-1.867a4.7 4.7 0 0 0-1.038-1.535 4.7 4.7 0 0 0-1.536-1.038 4.7 4.7 0 0 0-1.867-.374 4.7 4.7 0 0 0-1.868.374A4.9 4.9 0 0 0 6.21 6.475q-.663.656-1.037 1.535a4.7 4.7 0 0 0-.374 1.868m2.2 0q0-.249.174-.423a.58.58 0 0 1 .424-.175h1.42V7.86q0-.248.173-.423a.57.57 0 0 1 .432-.182q.249 0 .415.183a.58.58 0 0 1 .174.423v1.42h1.428q.249 0 .424.174a.58.58 0 0 1 .174.423.58.58 0 0 1-.175.423.58.58 0 0 1-.423.175h-1.428v1.427a.58.58 0 0 1-.174.424.56.56 0 0 1-.415.166.6.6 0 0 1-.432-.166.58.58 0 0 1-.174-.424v-1.427h-1.42a.58.58 0 0 1-.423-.175A.58.58 0 0 1 7 9.878"})}),{})),u=t(557298),s=t(214071),c=t(344417),v=t(539404),m=t.n(v),_=t(101874),p=t(845647),g=t(698392),h=t(777422),w=t(366119),f=t(411216),b=t(424785),k=t(978529),N={"icon-wrapper":"icon-wrapper-y1bfNR",iconWrapper:"icon-wrapper-y1bfNR","button-icon":"button-icon-nW5W0R",buttonIcon:"button-icon-nW5W0R","zoom-wrapper":"zoom-wrapper-kMR5vl",zoomWrapper:"zoom-wrapper-kMR5vl",divider:"divider-yfXOZu"};let q=e=>i=>!!i&&[i.image_thumb,i.image_thumb_ori,i.image_thumb_raw,i.image_ori,i.image_raw,i.image_ori_raw,i.preview_img,i.image_preview].some(i=>(null==i?void 0:i.url)===e),x=e=>{let{image_preview:i,preview_img:t}=e||{};return(null==i?void 0:i.url)?i:t},y=e=>{let{onZoomOut:i,onZoomIn:t,onDownload:o,disableDownload:a}=e;return(0,l.jsxs)("div",{className:N["zoom-wrapper"],children:[(0,l.jsx)(b.default,{className:N["button-icon"],icon:(0,l.jsx)(n,{className:N["icon-wrapper"]}),type:"tertiary",onClick:()=>{null==i||i()}}),(0,l.jsx)(b.default,{className:N["button-icon"],icon:(0,l.jsx)(d,{className:N["icon-wrapper"]}),type:"tertiary",onClick:()=>{null==t||t()}}),!!o&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(k.default,{layout:"vertical",className:N.divider}),(0,l.jsx)(b.default,{className:N["button-icon"],icon:(0,l.jsx)(r,{className:N["icon-wrapper"]}),type:"tertiary",onClick:o,disabled:a})]})]})},R=e=>{var i;let t=e.split("?")[0],o=t.substring(t.lastIndexOf(".")+1);null===(i=m().saveAs)||void 0===i||i.call(m(),e,`${new Date().getTime()}.${o}`)},S=function(e,i,t){let{conversationId:a,messageId:r,botId:n,chatType:d,conversationType:v,skillId:m}=e,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{reportImageShow:k=!0}=b,[S,$]=(0,o.useState)([]),[W,C]=(0,o.useState)(),E=(0,o.useRef)(null),j=(0,o.useRef)(0),F=(0,o.useMemo)(()=>S.map(e=>{var t,o,a;let l=null==i?void 0:i.find(q(e));return(null===(t=x(l))||void 0===t?void 0:t.url)||(null==l?void 0:null===(o=l.image_thumb)||void 0===o?void 0:o.url)||(null==l?void 0:null===(a=l.image_ori)||void 0===a?void 0:a.url)||e}),[S,i]),{run:M}=(0,w.default)(()=>{if(!(0,s.default)(i)){var e,o;(0,h.trackEvent)("pinch",{pic_id:null===(e=i[Number(W)])||void 0===e?void 0:e.key,bot_id:n,enter_picture_method:t===_.ContentSource.NotMessage?"template_detail":"chat",message_id:r,conversation_id:a,request_id:null===(o=i[j.current])||void 0===o?void 0:o.request_id})}},{trailing:!0,leading:!1,wait:1e3});(0,o.useEffect)(()=>{(0,c.default)(W)&&(E.current=Date.now())},[(0,c.default)(W)]);let T=(0,o.useCallback)(e=>{if(!e){if(!(0,s.default)(i)){var t,o;(0,h.trackEvent)("leave_picture_detail",{pic_id:String(null===(t=i[Number(W)])||void 0===t?void 0:t.key),bot_id:n,message_id:r,conversation_id:a,request_id:null===(o=i[j.current])||void 0===o?void 0:o.request_id,duration:E.current?Date.now()-E.current:void 0})}C(void 0)}},[C,W]),I=e=>{"ArrowLeft"===e.code&&Number(W)-1>=0&&S[Number(W)-1]&&(C(Number(W)-1),Z("left",Number(W)-1)),"ArrowRight"===e.code&&Number(W)+1<S.length&&S[Number(W)+1]&&(C(Number(W)+1),Z("right",Number(W)+1))},Z=(e,o)=>{if(!(0,s.default)(i)){var l;(0,h.trackEvent)("slide",{status:e,pic_id:i[o].key,bot_id:n,enter_picture_method:t===_.ContentSource.NotMessage?"template_detail":"chat",message_id:r,request_id:null===(l=i[o])||void 0===l?void 0:l.request_id,conversation_id:a})}};(0,o.useEffect)(()=>(window.addEventListener("keydown",I),()=>{window.removeEventListener("keydown",I)}),[W,S]);let A=(0,o.useCallback)(e=>{var o,d,u;let{disableDownload:c,onZoomIn:v,onZoomOut:p}=e;return(0,l.jsx)(y,{onZoomIn:v,onZoomOut:p,onDownload:(u=(null===(d=i[Number(W)])||void 0===d?void 0:null===(o=d.image_ori)||void 0===o?void 0:o.url)||S[Number(W)],c?()=>void 0:()=>{if(!(0,s.default)(i)){var e,o;(0,h.trackEvent)("picture_download",{pic_id:String(null===(e=i[Number(W)])||void 0===e?void 0:e.key),bot_id:n,click_method:"detail_click",enter_picture_method:t===_.ContentSource.NotMessage?"template_detail":"chat",message_id:r,conversation_id:a,enter_from:S[j.current],request_id:null===(o=i[j.current])||void 0===o?void 0:o.request_id})}(0,h.trackEvent)("download",{conversation_id:a,bot_id:n,skill_id:m,message_id:r,content_type:"image",click_form:"image_full_screen"}),R(u)}),disableDownload:c})},[W,S]);return{imageEventCallbacks:{onImageRender:e=>{var o,l,u,c,m,w,f,b;if(t===_.ContentSource.NotMessage)return;let N=null==i?void 0:i.findIndex(q(e)),x=(null===(l=i[N])||void 0===l?void 0:null===(o=l.image_thumb)||void 0===o?void 0:o.url)||(null===(c=i[N])||void 0===c?void 0:null===(u=c.image_ori)||void 0===u?void 0:u.url)||e;!(0,s.default)(i)&&k&&(0,h.trackEvent)("picture_message_show",{bot_id:n,pic_id:null===(m=i[N])||void 0===m?void 0:m.key,conversation_id:a,message_id:r,request_id:null===(w=i[N])||void 0===w?void 0:w.request_id,original_content_source:t,chatType:((null===(b=(0,g.getChatSlice)("chatViewCoreStore"))||void 0===b?void 0:null===(f=b.currentChatViewConfig)||void 0===f?void 0:f.chatType)===p.ChatType.NewThread?"default_new":d)||"other_default",conversation_type:v},{key:`${r}`}),$(e=>e.length<4?[...e,x]:e)},onImageClick:(e,o)=>{var l,u,c,m,w,f,b,k,N,x;let y=null==i?void 0:i.findIndex(q(o)),R=(null===(u=i[y])||void 0===u?void 0:null===(l=u.image_thumb)||void 0===l?void 0:l.url)||(null===(m=i[y])||void 0===m?void 0:null===(c=m.image_ori)||void 0===c?void 0:c.url)||o;j.current=y,(0,h.trackEvent)("enter_picture_detail",{pic_position:String(y+1),pic_id:String(null===(w=i[y])||void 0===w?void 0:w.key),bot_id:n,message_id:r,enter_from:t===_.ContentSource.NotMessage?"template_detail":"chat",conversation_id:a,request_id:null===(f=i[y])||void 0===f?void 0:f.request_id}),t===_.ContentSource.NotMessage?(C(y),$(null==i?void 0:i.map(e=>{var i,t;return(null===(i=e.image_thumb)||void 0===i?void 0:i.url)||(null===(t=e.image_ori)||void 0===t?void 0:t.url)||""}))):($(e=>e.includes(R)?(C(e.indexOf(R)),e):(C(e.length),[...e,R])),(0,s.default)(i)||(0,h.trackEvent)("picture_message_click",{pic_position:String(y+1),pic_id:null===(b=i[y])||void 0===b?void 0:b.key,bot_id:n,message_id:r,conversation_id:a,request_id:null===(k=i[y])||void 0===k?void 0:k.request_id,is_onboarding:0,chatType:((null===(x=(0,g.getChatSlice)("chatViewCoreStore"))||void 0===x?void 0:null===(N=x.currentChatViewConfig)||void 0===N?void 0:N.chatType)===p.ChatType.NewThread?"default_new":d)||"other_default",conversation_type:v})),e.stopPropagation(),e.preventDefault()}},renderImagePreview:()=>S.length&&(0,c.default)(W)?(0,l.jsx)(f.default,{onZoomIn:M,onZoomOut:M,zoomStep:.2,className:N["chat-image-preview"],previewCls:"flow-image-preview",renderPreviewMenu:A,src:(0,u.filterUrlModule)(F,null,{logType:"js.href/src",reportOnly:"false",blackConfig:"{}",configMode:"merge",isCloseSSRReport:!1,bid:"flow_web",region:"cn",urlLimit:"-1",htmlLimit:"-1",isSaveValidUrl:!1,isRuntimeLog:!1,isDOMParser:!0,escapeRule:"escape-report",reportUrl:"https://mon.zijieapi.com/monitor_browser/collect/batch/security/?bid=flow_web",scmBranch:"release_train_samantha_2025-10-14_552097",scmName:"$20xN*Rt%j$P$E5h$jBsMldr-z$N$mx0%m5aWldFcH$aRmhO%FE9PQ",scmVersion:"1.0.5.6233",webpackPluginVersion:"3.4.5",filename:"$ERJNWQy%kRP$EJo$jJSc1kyaz$hb%l5T$hkaF-zaHNXRE5D-%dSSFozWmpNMHBx$ERKT2RscEhWWFZa-m13d1dsZFJk$0l6%201T%1scHpZak5qZ*xwd*$IWmtl$E$6$2xkSmRHSlhPWFZpTTBwc1kw-zRkb%5I%m1waE1rWn$Xb*hOZ*xSR$N-%lJNamw1$2xNNWFtRkhSakJNTWs1dldWaFJkRmx0%m5w-$$6bHpZ$mRKZEZreWFHa*tRekZxWWpJe*RHSXlOSFpqTTBwc$RESk9kb%pZ%W5aaWJWWjFaR%01-0dKWFJtNWF$ek-zWTIx$01tRlhWak5NTW14M$drZFdORXh1$W5wbFIwWj$Xak5XZWc9PQ"}),visible:(0,c.default)(W),onVisibleChange:T,currentIndex:W,onChange:C,onPrev:e=>Z("left",e),onNext:e=>Z("right",e)}):null}}}}]);
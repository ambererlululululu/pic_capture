"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["34812"],{563143:function(e,t,a){a.d(t,{fileIsImage:function(){return n},getQuoteData:function(){return l}});let n=e=>{var t;return!!e&&e instanceof Blob&&(null===(t=e.type)||void 0===t?void 0:t.startsWith("image"))},l=e=>({is_quote:+!!e,quote_type:e?"attachment"===e.type?"file":"url":void 0,collection_id:(null==e?void 0:e.type)==="attachment"?null==e?void 0:e.fileKey:(null==e?void 0:e.type)==="link"?null==e?void 0:e.link:void 0})},899941:function(e,t,a){a.d(t,{useImageDownloadStore:function(){return s}});var n=a(952259),l=a(321647),i=a(746479);let r={batchDownloadSelected:!1,isAllSelectChecked:!1,selectedImageUrlWithMessageList:[]},s=(0,l.create)()((0,n.subscribeWithSelector)((e,t)=>({...r,onUpdateBatchDownloadSelected:t=>{e((0,i.produce)(e=>{e.batchDownloadSelected=t}))},onUpdateAllSelectChecked:t=>{e((0,i.produce)(e=>{e.isAllSelectChecked=t}))},toggleImageUrl:(a,n)=>{let l=t().selectedImageUrlWithMessageList;e({selectedImageUrlWithMessageList:l.map(e=>e.url).includes(a)?l.filter(e=>e.url!==a):[...l,{url:a,message:n}]})},clearSelectedImageUrl:()=>{e((0,i.produce)(e=>{e.selectedImageUrlWithMessageList=[]}))},checkAllImage:t=>{e((0,i.produce)(e=>{e.selectedImageUrlWithMessageList=t}))}})))},935854:function(e,t,a){a.d(t,{ChatFooterDisclaimer:function(){return i}});var n=a(915299),l=a(345660);let i=e=>{let{customText:t}=e;return(0,n.useTranslateFn)(),(0,l.jsx)("div",{className:"h-12"})}},724e3:function(e,t,a){a.d(t,{ChatFooterFoundation:function(){return p}}),a(713738);var n=a(865607),l=a(899941),i=a(752673),r=a(698392),s=a(516655),o=a(689368),u=a(426156);let c=()=>({voiceConversationId:"",voiceCallStartTime:0});var d=a(345660);let p=e=>{let{ChatInputSlot:t,chatId:a,chatType:p,chatKey:h,renderFallback:m}=e,g=(0,r.useChatSlice)("chatGuidanceStore",e=>({activeSkillType:e.activeSkillIdentifier}),n.shallow),f=(0,l.useImageDownloadStore)(e=>e.batchDownloadSelected),S={chatId:a,chatType:p,chatKey:h,guidance:g,share:(0,i.useThreadShareStore)(e=>({isSelectMode:e.isSelectMode,scene:e.scene}),n.shallow),voiceCall:c(),batchDownload:{isBatchDownloadMode:null!=f&&f}},{matcher:v}=(0,s.useChatFooterPluginMatcher)(),k=null==v?void 0:v.map(e=>e(S)).find(e=>void 0!==e),{plugin:I}=(0,o.useChatFooterPlugin)(k);return(0,d.jsx)(u.ErrorBoundary,{errorBoundaryName:"chat_input_error",fallback:null,children:I?(0,d.jsx)(I.Content,{...S,ChatInputSlot:t}):(0,d.jsx)(d.Fragment,{children:null==m?void 0:m()})})}},273643:function(e,t,a){a.d(t,{ChatFooter:function(){return u},ChatFooterDisclaimer:function(){return o.ChatFooterDisclaimer}});var n=a(915299),l=a(724e3),i=a(771106),r=a(229788),s=a(345660),o=a(935854);let u=e=>(0,s.jsx)(l.ChatFooterFoundation,{renderFallback:()=>(0,s.jsx)(c,{}),...e}),c=()=>{let e=(0,n.useTranslateFn)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.ChatFooterUI,{children:(0,s.jsx)(i.ChatInputSkeletonUI,{placeholder:e("default_input_placeholder")})}),(0,s.jsx)("div",{className:"h-12"})]})}},367612:function(e,t,a){a.d(t,{makeCompositeMessagePayloadWithImages:function(){return j.makeCompositeMessagePayloadWithImages},useInputPluginProps:function(){return N.useInputPluginProps},useInputReportParams:function(){return b.useInputReportParams},tryPopPreGeneratedId:function(){return j.tryPopPreGeneratedId},makeFileMessagePayload:function(){return j.makeFileMessagePayload},useTrackOnBeforeSubmit:function(){return x.useTrackOnBeforeSubmit},makeTextMessagePayload:function(){return j.makeTextMessagePayload},makeImageMessagePayload:function(){return j.makeImageMessagePayload},ChatInput:function(){return F},makeRemoteFileMessagePayload:function(){return j.makeRemoteFileMessagePayload},makeCompositeMessagePayloadWithFiles:function(){return j.makeCompositeMessagePayloadWithFiles},useInputTrackParams:function(){return b.useInputTrackParams},makeNestedMessagePayload:function(){return j.makeNestedMessagePayload},makePayloadAttachment:function(){return j.makePayloadAttachment}});var n=a(713738),l=a(865607),i=a(812650),r=a.n(i),s=a(444463),o=a(970377),u=a(698392),c=a(922851),d=a(689368),p=a(481219),h=a(23226),m=a(971857),g=a(212183),f=a(230932),S=a(781313),v=a(524129),k=a(297547),I=a(857200),y=a(644143),_=a(242315),C=a(653322),P=a(255507),b=a(100651),x=a(111329),N=a(415592),T={"guidance-input":"guidance-input-yVXP1I"},M=a(345660),j=a(178935);let F=e=>{let{chatId:t,chatType:a,className:i,disabled:r,reportParams:s,placeholder:d,enableArouseMoreSkill:C=!0,enableUpload:T=!0,enableUserUpload:j=!0,forceUseChatInputPlugin:F=!1,specificSkillID:A}=e,{isDisabled:L}=(0,o.useConversationDisabled)(),B=r||L,[U,G]=(0,u.useChatSlice)("chatInputStore",e=>[e.activeSkillTypeMap[t],e.skillMap],l.shallow),E=C&&U?{...null==G?void 0:G[U],skill_type:U}:A?null==G?void 0:G[A]:void 0,R=(0,m.useIsSamantha)(t,a),W=(0,g.getChatTypeForTea)("",t),{reportParams:O}=(0,b.useInputReportParams)({chatId:t,chatType:a,activeSkill:E}),H={botType:W,...s,...O},{trackParams:K}=(0,b.useInputTrackParams)({chatId:t,chatType:a,activeSkill:E});(0,I.useOnSwitchConversation)(e=>{(0,u.getChatSlice)("chatInputStore").closeSkillPanel(e),(0,c.getChatService)("chatInputStoreService").then(e=>{null==e||e.resetSkillReportEvent()}),(0,p.resetInputEditorValue)()}),(0,n.useEffect)(()=>{let e=f.useFeedStore.subscribe(e=>e.lastSectionIdMap[t],()=>{!(0,S.isLocalConversation)(t)&&(0,c.getChatService)("refContentStoreService").then(e=>{null==e||e.clearRefContents(t,{retainDisableRef:!0})})});return()=>{e()}},[t]);let q=(0,x.useTrackOnBeforeSubmit)({activeSkillType:null==E?void 0:E.skill_type,reportParams:H}),{isToolButtonSmall:z,inputWidthDivRef:Q}=(0,y.useIsToolButtonSmall)(),V=(0,h.useGuidanceActiveSkillIdentifier)(),X=[v.SkillType.ReadPDF,v.SkillType.CodeInterpreter].includes(V),Z=(0,k.default)(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return B?Promise.resolve(!1):q(...t)}),{isNewChatInput:$,loading:J}=(0,_.useNewChatInputAb)(),Y=$&&R&&!F&&!V,ee=(0,N.useInputPluginProps)({chatId:t,chatType:a,disabled:B,trackParams:K,skill:null!=E?E:{},reportParams:H,onBeforeSubmit:Z,isToolButtonSmall:z}),et=(0,n.useMemo)(()=>({...ee,enableArouseMoreSkill:C,placeholder:d,enableUpload:T,enableUserUpload:j,className:i}),[ee,C,d,T,j,i]);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)("div",{ref:Q,className:"h-0 w-full"}),(0,M.jsx)("div",{className:"w-full","data-testid":"chat_input","data-onboarding-id":"chat_input",children:J&&!F?(0,M.jsx)(P.LazyChatInputContentFallback,{className:i}):Y?(0,M.jsx)(D,{forceUseGenericInput:X,activeSkill:E,...et}):(0,M.jsx)(w,{forceUseGenericInput:X,activeSkill:E,...et})})]})},w=(0,n.memo)(function(e){let{activeSkill:t,forceUseGenericInput:a,...n}=e,{plugin:l,loading:i}=(0,d.useDeprecatedInputPlugin)(a?"generic":(null==t?void 0:t.skill_type)||"generic"),r=i||!l;return((0,C.useEmitInputInit)(r),r||!a&&(null==l?void 0:l.skillType)!==(null==t?void 0:t.skill_type))?(0,M.jsx)(P.LazyChatInputContentFallback,{className:n.className}):(0,M.jsx)(M.Fragment,{children:null==l?void 0:l.render(n)})}),D=(0,n.memo)(function(e){let{activeSkill:t,forceUseGenericInput:a,...n}=e,{plugin:l,loading:i}=(0,d.useGuidanceInputPlugin)(a?"generic":(null==t?void 0:t.skill_type)||"generic"),o=i||!l;return((0,C.useEmitInputInit)(o),o)?(0,M.jsx)(s.GuidanceInputSkeleton,{className:r()(n.className,T["guidance-input"])}):(0,M.jsx)(l.Content,{...n,className:r()(n.className,T["guidance-input"]),exitSkillButtonTheme:"borderless"})})},415592:function(e,t,a){a.d(t,{useInputPluginProps:function(){return C}});var n=a(756817),l=a(913821),i=a(695422),r=a(666196),s=a(922851),o=a(698392),u=a(23226),c=a(334312),d=a(563143),p=a(777422),h=a(915299),m=a(352490),g=a(198660),f=a(273637),S=a(460821),v=a(178230),k=a(44502),I=a(10597),y=a(124267);let _=()=>Promise.resolve(!0),C=e=>{var t;let{chatId:a,chatType:C,disabled:P,trackParams:b,skill:x,reportParams:N,onBeforeSubmit:T=_}=e,M=(0,f.default)(T),j=x.skill_type,F={skill_type:j,skill_type_str:(0,c.getSkillTypeStr)(j),skill_id:j?j.toString():null,...N},w=(0,h.useTranslateFn)(),D=(0,k.useActiveSkillType)(a),A=(0,u.useEnableSkillGuidance)(),L=(0,r.useChatService)("chatConfigService"),B=(0,r.useChatService)("chatInputService"),U=(0,g.useIsLoggedIn)(),{enableSkillPin:G=!0}=null!==(t=null==L?void 0:L.featureGating)&&void 0!==t?t:{},{onBeforeSendMessage:E}=(0,I.useGuestInputInteract)({source:j?`send_message_${j}`:"send_message",eventName:"chat_input_guest_login",meta:{...F},chatId:a,chatType:C,checkNewGuidanceAb:!0,activeSkillType:D}),R=async e=>{await (0,y.emitKeyDown)(e)},W=async e=>{let{files:t}=e.clipboardData,a=e.clipboardData.getData("text"),n=a.trim(),l=(0,m.getHyperLinkNodes)(n),i=1===l.length&&l[0].type===m.HyperNodeType.link;await (0,y.emitPaste)({event:e,trimText:n,text:a,files:t,isValidLink:i})},O=(0,f.default)(()=>{(0,s.getChatService)("refContentStoreService").then(e=>{null==e||e.clearRefContents(a,{retainDisableRef:!0})})}),H=(0,f.default)(async function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!await (null==M?void 0:M({reportParams:F}))||!await E({checkNewGuidanceAb:t.checkNewGuidanceAb}))return!1;let a=await (0,y.emitBeforeSendMessage)();return("boolean"!=typeof a||!!a)&&((null===(e=t.clearRefContent)||void 0===e||e)&&O(),!0)}),K=(0,f.default)(async e=>{let{exitSkill:t=!1}=e||{};await (0,y.emitMessageSendingEnd)(),(0,s.getChatService)("chatInputStoreService").then(e=>{D&&!A&&G&&U&&(null==e||e.pinSkill(D)),t?(0,o.getChatSlice)("chatInputStore").closeSkillPanel(a):D&&(0,o.getChatSlice)("chatInputStore").updateActiveSkillTypeMap(a,D,i.SkillFrom.AfterSkill),v.logger.persist.info({eventName:"skill_input_send_keep_input",meta:{...F,keep_input:t?"0":"1"}}),null==e||e.updateSelectedRecommendSkill(),null==e||e.updateSendMessageStatus(a,i.ChatInputSendMessageStatus.Sending)}),B.getAsrService().then(e=>{null==e||e.stopAsr()})}),q=(0,f.default)((0,n.default)(e=>{(0,p.trackEvent)("input_bar_enter",{click_scene:"skills_search_bar",...b,...(0,d.getQuoteData)(e)})},1e3)),z=(0,f.default)(e=>(0,p.trackEvent)("input_bar_edit",{action:"cancel_quote",...b,...(0,d.getQuoteData)(e)}));return(0,S.useCompareMemo)({...e,chatId:a,chatType:C,disabled:P,sendMessageHoverText:w("send_button_hover_text"),trackParams:b,onKeyDown:R,onPaste:W,onBeforeSendMessage:H,onAfterSendMessage:K,debouncedReportFocus:q,removeRefContentEvent:z,reportParams:F},l.default)}},111329:function(e,t,a){a.d(t,{useTrackOnBeforeSubmit:function(){return r}});var n=a(334312),l=a(297547),i=a(178230);let r=e=>{let{activeSkillType:t,reportParams:a}=e,r=(0,l.default)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;i.logger.persist.info({eventName:"chat_input_send_start",meta:{...t?{skill_type:t,skill_type_str:(0,n.getSkillTypeStr)(t),skill_id:(0,n.getSkillTypeStr)(t)}:{skill_type_str:(0,n.getSkillTypeStr)(),skill_id:(0,n.getSkillTypeStr)()},...e}})});return function(){let{reportParams:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r(e),Promise.resolve(!0)}}},229788:function(e,t,a){a.d(t,{ChatFooterUI:function(){return s}});var n=a(812650),l=a.n(n),i=a(337524),r=a(345660);let s=e=>{let{className:t,children:a,samanthaLayoutProps:n}=e;return(0,r.jsx)(i.SamanthaLayout.MaxWidthLayout,{...n,children:(0,r.jsx)("div",{className:l()("footer-Vgmfgx",t),children:a})})}},255507:function(e,t,a){a.d(t,{LazyChatInputContentFallback:function(){return h}});var n=a(812650),l=a.n(n),i=a(845647),r=a(269249),s=a(915299),o=a(198660),u=a(369682),c=a(771106),d={"center-input":"center-input-pEkMZT"},p=a(345660);function h(){let{className:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,s.useTranslateFn)(),a=(0,r.useChatType)(),n=(0,o.useIsGuest)(),h=!(0,u.isStorageLogined)(),m=n||h;return(0,p.jsx)(c.ChatInputSkeletonUI,{className:l()(e,m&&a===i.ChatType.NewThread&&d["center-input"]),placeholder:t(m?"homepage_centered_input_placeholder":"default_input_placeholder")})}},444463:function(e,t,a){a.d(t,{GuidanceInputSkeleton:function(){return u}});var n=a(342857),l=a(812650),i=a.n(l),r=a(616339),s={"send-button":"send-button-O3Xfjy",small:"small-a3NA4B",icon:"icon-r423h2"},o=a(345660);let u=e=>{let{small:t,className:a}=e;return(0,o.jsx)("div",{className:i()(r.default["input-content-container"],a),children:(0,o.jsx)("div",{className:i()(r.default.container,"guidance-input-skeleton-container"),children:(0,o.jsxs)("div",{className:r.default["editor-container"],children:[(0,o.jsx)("div",{className:r.default.editor}),(0,o.jsxs)("div",{className:r.default["bottom-wrapper"],children:[(0,o.jsx)("div",{className:r.default["left-tools-wrapper"]}),(0,o.jsx)("div",{className:r.default["tools-placeholder"]}),(0,o.jsx)("div",{className:r.default["right-tools-wrapper"],children:(0,o.jsx)("div",{className:i()(s["send-button"],t&&s.small),children:(0,o.jsx)(n.default,{className:s.icon})})})]})]})})})}}}]);
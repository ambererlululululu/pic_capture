"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["84163"],{657539:function(e,t){t.default={"left-side-width":"left-side-width-AfVGh0",leftSideWidth:"left-side-width-AfVGh0","left-side-width--variable":"left-side-width--variable-d7Z6GU",leftSideWidthVariable:"left-side-width--variable-d7Z6GU","right-side-width":"right-side-width-trpnpP",rightSideWidth:"right-side-width-trpnpP","right-side-width--compact":"right-side-width--compact-MkDLSw",rightSideWidthCompact:"right-side-width--compact-MkDLSw","right-side-width--narrow":"right-side-width--narrow-ydoPs7",rightSideWidthNarrow:"right-side-width--narrow-ydoPs7"}},356621:function(e,t,i){i.d(t,{MaxWidthLayoutProvider:function(){return n},useMaxWidthLayoutContext:function(){return l}});var r=i(713738);let a=(0,r.createContext)({leftVisible:!1,rightVisible:!1,contentVisible:!1,rightWidth:0,leftWidth:0,transition:!1,deprecatedMaxWidthLayoutStyle:!1}),n=a.Provider,l=()=>(0,r.useContext)(a)},620411:function(e,t,i){i.d(t,{CENTER_CONTENT_MAX_WIDTH:function(){return r}});let r=848},337524:function(e,t,i){i.d(t,{CENTER_CONTENT_MAX_WIDTH:function(){return d.CENTER_CONTENT_MAX_WIDTH},SamanthaLayoutStyles:function(){return c.default},SamanthaLayout:function(){return h}});var r=i(713738),a=i(344417),n=i(812650),l=i.n(n),o=i(356621),d=i(620411),s=i(345660);let u=(0,r.forwardRef)(function(e,t){let{children:i,paddingWrapperClassName:r,containerClassName:n,className:u,centerContentMaxWidthDelta:c=0,customStyle:h,...v}=e,{className:f,leftVisible:p,rightVisible:S,rightWidth:C,leftWidth:g,transition:m,deprecatedMaxWidthLayoutStyle:y=!1}=(0,o.useMaxWidthLayoutContext)();return(0,s.jsx)("div",{className:l()(n,"container-arOxqB","chrome70-container",r,f,{"transition-e0IYaD":m},{"deprecated-RMtz1c":y}),style:{...S&&""===C?{}:{"--right-side-width":S?(0,a.default)(C)?`${C}px`:C:"0px"},...p&&""===g?{}:{"--left-side-width":p?(0,a.default)(g)?`${g}px`:g:"0px"},"--center-content-max-width":`${d.CENTER_CONTENT_MAX_WIDTH+c}px`,...h},children:(0,s.jsx)("div",{ref:t,className:l()("inner-FyM8gE",u),...v,children:i})})});u.MaxWidthLayoutProvider=o.MaxWidthLayoutProvider;var c=i(657539);let h={MaxWidthLayout:u}},870693:function(e,t,i){i.d(t,{retryLoad:function(){return r}});let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((a,n)=>{e().then(a).catch(l=>{setTimeout(()=>{if(1===t){n(l);return}r(e,t-1,i).then(a,n)},i)})})}},912161:function(e,t,i){i.d(t,{DisabledTag:function(){return r},WritingSkillTemplateType:function(){return n}});let r=((a={}).Reviewing="reviewing",a.Ban="ban",a.Delete="delete",a.Private="private",a.Rollback="rollback",a);var a,n={Compose:"compose",Reply:"reply"}},204454:function(e,t,i){i.d(t,{isBetaEnv:function(){return r}});let r=!1},379520:function(e,t,i){i.d(t,{DefaultChatInputService:function(){return a}});var r=i(154635);class a{focusOnEditor(){r.defaultChatInputController.focusOnInput()}updateEditorValue(){}clearEditorValue(){}}},91482:function(e,t,i){i.d(t,{useDisabledInputTipsData:function(){return h},DisabledInputTips:function(){return v},DisabledInputTipsGlueComposer:function(){return c}});var r=i(970377),a=i(971857),n=i(912161),l=i(773289),o=i(198660),d=i(6917),s={"disabled-tips":"disabled-tips-WksGmv"},u=i(345660);let c=e=>function(t){let{chatId:i,chatType:r}=t,{isDisabled:a,disabledText:n}=e({chatId:i,chatType:r});return a?(0,u.jsx)("div",{className:s["disabled-tips"],children:n}):null},h=e=>{let{chatId:t}=e,i=(0,a.useConversation)(t),s=(null==i?void 0:i.bot_id)||t,u=d.chatInputServiceContainer.get("chatBotService"),c=(null==u?void 0:u.useBotInfoHook(s))||{},h=(0,o.useIsLoggedIn)(),v=(0,r.useConversationDisabled)();return(()=>{let e=(null==c?void 0:c.bot_mode)===l.BotMode.subject;return!!h&&c.disabled_tag!==n.DisabledTag.Ban&&(c.disabled_tag!==n.DisabledTag.Rollback||!e)})()?v:{isDisabled:!1}},v=c(h)},882949:function(e,t,i){i.d(t,{BaseChatFooter:function(){return h}});var r=i(386827),a=i(865607),n=i(666196),l=i(698392),o=i(516655),d=i(689368),s=i(229788),u=i(91482),c=i(345660);let h=e=>{var t;let{chatId:i,chatType:h,ChatInputSlot:v,...f}=e,{isExpand:p,inputPortalTarget:S}=(0,l.useChatSlice)("chatViewCanvasStore",e=>({isExpand:e.isExpand,inputPortalTarget:e.inputPortalTarget}),a.shallow),C=()=>(0,c.jsx)(u.DisabledInputTips,{chatId:i,chatType:h}),g=()=>v&&(p&&S?(0,r.createPortal)((0,c.jsx)(v,{chatId:i,chatType:h}),S):(0,c.jsx)(v,{chatId:i,chatType:h})),m=(0,l.useChatSlice)("chatViewCoreStore",e=>e.currentChatViewConfig,a.shallow),y=(0,n.useChatService)("chatViewService"),x=(0,l.useChatSlice)("chatViewCanvasStore",e=>e.canvasContent),w={chatView:{isImmersiveMode:null!==(t=null==m?void 0:m.isImmersiveMode)&&void 0!==t?t:!!y.exactImmersiveMode},chatCanvas:{...x}},{matcher:I}=(0,o.useSkillBarPluginMatcher)(),b=null==I?void 0:I.map(e=>e(w)).find(e=>void 0!==e),{plugin:T,loading:M}=(0,d.useSkillBarPlugin)(b),D=()=>!T||M?null:(0,c.jsx)(T.Content,{chatId:i,chatType:h}),{matcher:E}=(0,o.useChatFooterDisclaimerPluginMatcher)(),W=null==E?void 0:E.map(e=>e()).find(e=>void 0!==e),{plugin:_,loading:L}=(0,d.useChatFooterDisclaimerPlugin)(W),P=()=>!_||L?(0,c.jsx)("div",{className:"h-12"}):(0,c.jsx)(_.Content,{});return(0,c.jsxs)(s.ChatFooterUI,{...f,children:[null==C?void 0:C(),null==D?void 0:D(),null==g?void 0:g(),null==P?void 0:P()]})}},229788:function(e,t,i){i.d(t,{ChatFooterUI:function(){return o}});var r=i(812650),a=i.n(r),n=i(337524),l=i(345660);let o=e=>{let{className:t,children:i,samanthaLayoutProps:r}=e;return(0,l.jsx)(n.SamanthaLayout.MaxWidthLayout,{...r,children:(0,l.jsx)("div",{className:a()("footer-Vgmfgx",t),children:i})})}},6917:function(e,t,i){i.r(t),i.d(t,{ChatInputService:function(){return b},chatInputServiceContainer:function(){return T},createChatInputService:function(){return M}});var r=i(386827),a=i(713738),n=i(395847),l=i(217957),o=i(251913),d=i(430896),s=i(698392),u=i(689368),c=i(922851),h=i(389174),v=i(721118),f=i(230932),p=i(204454),S=i(915299),C=i(201272),g=i(870693),m=i(124267),y=i(379520),x=i(345660);function w(e,t,i){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:r+"")in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}let I=(0,a.lazy)(()=>(0,g.retryLoad)(()=>i.e("70468").then(i.bind(i,757231)).then(e=>({default:e.TextareaWidthMeasure}))));class b{async getAsrService(){if(!this.asrService){let{ChatAsrService:e}=await (0,g.retryLoad)(()=>Promise.all([i.e("42530"),i.e("78568"),i.e("38227")]).then(i.bind(i,982732)));this.asrService=new e(this.asrServiceInitParams)}return this.asrService}async getDirectoryService(){if(!this.directoryService){let{createMarsCodeDirectoryService:e}=await (0,g.retryLoad)(()=>Promise.all([i.e("42530"),i.e("78568"),i.e("38227")]).then(i.bind(i,977624)));this.directoryService=e()}return this.directoryService}get currentChatId(){var e,t;return null===(t=(0,s.getChatSlice)("chatViewCoreStore"))||void 0===t?void 0:null===(e=t.currentChatViewConfig)||void 0===e?void 0:e.chatId}initEventBinding(){C.DeprecatedFlowEvent.on("app.init",this.onAppInit)}unbindEvent(){C.DeprecatedFlowEvent.off("app.init",this.onAppInit)}async getCurrentService(){let{currentChatId:e}=this;if(!e)return null;let t=(0,s.getChatStore)("chatInputStore").getState().activeSkillTypeMap[e],i=t?(0,s.getChatStore)("chatInputStore").getState().skillMap[t]:void 0;if((0,l.default)(i))return this.defaultChatInputService;let r=null==i?void 0:i.skill_type,a=await (0,u.getDeprecatedInputPlugin)(r);return(null==a?void 0:a.service)||null}initTextAreaWidthMeasurer(){if(this.textareaContainerDom)return;let e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.width="100%",e.style.opacity="0",(0,n.createRoot)(e).render((0,x.jsx)(I,{ref:this.textareaWidthMeasureRef})),document.body.appendChild(e),this.textareaContainerDom=e}destroyTextAreaWidthMeasurer(){var e;this.textareaContainerDom&&(r.unmountComponentAtNode(this.textareaContainerDom),null===(e=this.textareaContainerDom.parentNode)||void 0===e||e.removeChild(this.textareaContainerDom))}measureTextWidthInTextarea(e){var t,i;return null===(t=this.textareaWidthMeasureRef.current)||void 0===t||t.setText(e),null===(i=this.textareaWidthMeasureRef.current)||void 0===i?void 0:i.getTextWidth()}checkMaxFileCount(){var e,t,r,a,n;let l=this.currentChatId;if(!l)return!0;let{attachmentUploadConfig:{uploadMultiEntityConf:{maxFileCount:o},enabledSendMultiFileMessage:d}}=(0,s.getChatSlice)("attachmentUploadStore"),u=d||p.isBetaEnv,c=(0,h.isSamantha)((0,v.conversationSelector)(f.useFeedStore.getState(),l),null===(t=(0,s.getChatSlice)("chatViewCoreStore"))||void 0===t?void 0:null===(e=t.currentChatViewConfig)||void 0===e?void 0:e.chatType)&&u?o:1;return!((null!==(n=null===(a=(0,s.getChatSlice)("attachmentsStore").attachmentsMap)||void 0===a?void 0:null===(r=a[l])||void 0===r?void 0:r._default)&&void 0!==n?n:[]).length>=c)||((0,g.retryLoad)(()=>Promise.all([i.e("15390"),i.e("23426"),i.e("71331"),i.e("18748"),i.e("64404"),i.e("81070"),i.e("29114"),i.e("99898"),i.e("76778"),i.e("29843"),i.e("65823"),i.e("26112"),i.e("65229"),i.e("95630"),i.e("36710")]).then(i.bind(i,219170)).then(e=>e.SamanthaToast)).then(e=>e.error((0,S.getUnreactiveTranslate)("file_token_limit",{postProcess:"sprintf",sprintf:["\u8C46\u5305",c.toString()]}))),!1)}async addAttachment(e){let t=this.currentChatId;if(!t||!this.checkMaxFileCount())return;let i=await (0,c.getChatService)("attachmentsStoreService");return null==i?void 0:i.addAttachment({chatId:t,...e})}async addLink(e){let t=this.currentChatId;if(!t||!this.checkMaxFileCount())return;let i=await (0,c.getChatService)("attachmentsStoreService");return null==i?void 0:i.addLink({chatId:t,...e})}async replaceLink(e){let t=this.currentChatId;if(!t)return;let i=await (0,c.getChatService)("attachmentsStoreService");return null==i?void 0:i.replaceLink({chatId:t,...e})}async clearAttachments(){let e=await (0,c.getChatService)("attachmentsStoreService");null==e||e.clearAllAttachments();let t=this.currentChatId;if(!t)return;let i=await (0,c.getChatService)("attachmentUploadStoreService");return null==i?void 0:i.updatePreGeneratedLocalMessageId({chatId:t})}constructor({asrServiceInitParams:e}={}){w(this,"ctx",void 0),w(this,"defaultChatInputService",new y.DefaultChatInputService),w(this,"textareaContainerDom",null),w(this,"textareaWidthMeasureRef",(0,a.createRef)()),w(this,"asrService",null),w(this,"asrServiceInitParams",void 0),w(this,"directoryService",null),w(this,"destroy",()=>{var e;this.unbindEvent(),this.destroyTextAreaWidthMeasurer(),null===(e=this.asrService)||void 0===e||e.destroy(),this.asrService=null}),w(this,"focusOnEditor",async()=>{var e;let t=await this.getCurrentService();null==t||null===(e=t.focusOnEditor)||void 0===e||e.call(t)}),w(this,"updateEditorValue",async e=>{var t;let i=await this.getCurrentService();null==i||null===(t=i.updateEditorValue)||void 0===t||t.call(i,e)}),w(this,"clearEditorValue",()=>{this.updateEditorValue("")}),w(this,"getSkillService",async e=>{let t=await (0,u.getDeprecatedInputPlugin)(e);return(null==t?void 0:t.service)||null}),w(this,"onAppInit",(0,o.default)(()=>{this.initTextAreaWidthMeasurer()})),w(this,"emitBeforeBreakMessage",m.emitBeforeBreakMessage),this.asrServiceInitParams=e,this.initEventBinding()}}let T=(0,d.createServiceContainer)(),M=e=>(T.service||(T.service=new b(e)),T.service)}}]);
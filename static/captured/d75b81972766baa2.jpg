"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["56116"],{248965:function(e,t,n){n.d(t,{default:function(){return s}}),n(713738);var i=n(430261),r=n(345660),s=(0,i.IconFactory)((0,r.jsx)(e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 2.5A2.5 2.5 0 0 1 14.5 5v6a2.5 2.5 0 0 1-5 0V5A2.5 2.5 0 0 1 12 2.5M7.5 5a4.5 4.5 0 0 1 9 0v6a4.5 4.5 0 1 1-9 0zm-2 4a1 1 0 0 0-2 0v2c0 4.213 3.26 7.928 7.5 8.44V21H7.3a1 1 0 1 0 0 2h9.4a1 1 0 1 0 0-2H13v-1.56c4.24-.512 7.5-4.227 7.5-8.44V9a1 1 0 1 0-2 0v2c0 3.46-2.915 6.5-6.5 6.5S5.5 14.46 5.5 11z",clipRule:"evenodd"})}),{}))},39014:function(e,t,n){n.d(t,{AsrStatus:function(){return i}});var i={INIT:"init",LOADING:"loading",RECORDING:"recording",PAUSED:"paused",DESTROYED:"destroyed"}},237600:function(e,t,n){n.d(t,{useGenericAsrBtnStore:function(){return Y},GenericAsrBtn:function(){return M}});var i=n(713738),r=n(321647),s=n(218679),a=n(4137),o=n(217957),l=n(468804),u=n(248965),c=n(812650),d=n.n(c),p=n(643404),_=n(345660);function g(){return n.e("44232").then(n.bind(n,160396))}let v=i.lazy(()=>(0,p.retryLoadWithFallBack)({fn:g})),m=e=>(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)(_.Fragment,{}),children:(0,_.jsx)(v,{...e})}),f=e=>{let{disabled:t=!1,...n}=e;return(0,_.jsx)("div",{...n,className:d()("dot-flashing-qoXs0R",{"disabled-zgnOCP":t})})};var h=e=>{let{fontSize:t=14,className:n=""}=e;return(0,_.jsx)("div",{className:d()("wrapper-gzamoT",n),style:{height:`${1.6*t}px`},children:(0,_.jsx)(f,{})})},A=n(39014);let S=i.lazy(()=>(0,p.retryLoadWithFallBack)({fn:async()=>{let{MicPermissionCard:e}=await n.e("80234").then(n.bind(n,164469));return{default:e}}})),b=e=>(0,_.jsx)(i.Suspense,{fallback:(0,_.jsx)(_.Fragment,{}),children:(0,_.jsx)(S,{...e})});var N=n(915299),x=n(525029),C=n(214902),j=n(613917),k=n(124193),D=n(597873),E=n(351415),w=n(666196),y=n(922851),R=n(631122),I=n(831566),O=n(777422),T=n(198660),B=n(273637),L=n(366119),P=n(178230);let U=(0,E.default)(P.logger.persist.log.bind(P.logger.persist),1e3),G={wait:500,leading:!0,trailing:!1},F=(e,t)=>{let{onAsrResultChange:n,onAsrStatusChange:r,onStartAsr:s,onStopAsr:a}=e,o=(0,N.useTranslateFn)(),l=(0,w.useChatService)("chatInputService"),u=(0,T.useIsGuest)(),c=(0,R.useToast)(),d=(0,i.useCallback)(()=>{P.logger.persist.log({eventName:"asr_permission_denied"}),S(!0)},[]),p=(0,i.useCallback)(()=>{P.logger.persist.log({eventName:"asr_websocket_timeout"}),c.warning(o("voice_input_time_limitation_toast"))},[]),[_,v]=(0,i.useState)(A.AsrStatus.INIT),[m,f]=(0,i.useState)(0),[h,S]=(0,i.useState)(!1),b=(0,i.useRef)(),x=(0,i.useRef)(),C=(0,i.useRef)(),E=(0,i.useMemo)(()=>({voice_input_no_permission_alert_header:o("voice_input_no_permission_alert_header"),voice_input_no_permission_alert_description:o("voice_input_no_permission_alert_description",{brandname:o("brandName_doubao")}),voice_input_no_permission_alert_btn_ok:o("voice_input_no_permission_alert_btn_ok"),voice_input_no_permission_alert_guide:o("voice_input_no_permission_alert_guide")}),[o]);(0,i.useEffect)(()=>()=>{M()},[]),(0,i.useImperativeHandle)(t,()=>({startAsr:Y,stopAsr:M}));let F=async()=>{let e=await l.getAsrService();e&&(x.current=e.result$.pipe((0,j.skip)(1)).pipe((0,k.distinctUntilChanged)()).pipe((0,D.filter)(e=>!!e)).subscribe(e=>{U({eventName:"asr_result_change",meta:{result_length:e.length}}),null==n||n(e)}),b.current=e.status$.pipe((0,j.skip)(1)).pipe((0,k.distinctUntilChanged)()).subscribe(e=>{P.logger.persist.log({eventName:"asr_status_change",meta:{status:e}}),null==r||r(e),v(e)}),C.current=e.volume$.pipe((0,j.skip)(1)).pipe((0,k.distinctUntilChanged)()).subscribe(e=>{f(e)}),e.on("permission.denied",d),e.on("websocket.timeout",p))},z=async()=>{var e,t,n;let i=await l.getAsrService();i&&(null===(e=b.current)||void 0===e||e.unsubscribe(),null===(t=x.current)||void 0===t||t.unsubscribe(),null===(n=C.current)||void 0===n||n.unsubscribe(),i.off("permission.denied",d),i.off("websocket.timeout",p))},H=()=>_===A.AsrStatus.RECORDING||_===A.AsrStatus.PAUSED||_===A.AsrStatus.LOADING,Y=async()=>{v(A.AsrStatus.LOADING);let e=await l.getAsrService();e&&(P.logger.persist.log({eventName:"asr_start"}),(0,O.trackEvent)("message_editing",{edit_method:"audio"}),g(),null==s||s(),F(),e.startAsr())},M=(0,B.default)(async()=>{if(!H())return;let e=await l.getAsrService();e&&(P.logger.persist.log({eventName:"asr_stop"}),(0,O.trackEvent)("message_editing_end",{edit_method:"audio"}),null==a||a(),e.stopAsr(),z(),v(A.AsrStatus.DESTROYED))}),{run:$}=(0,L.default)(()=>{if(P.logger.persist.log({eventName:"asr_button_click",meta:{isLogin:+!u}}),u){(0,y.getChatService)("chatNavigateService").then(e=>null==e?void 0:e.navigateToLoginPage("unlog_click_voice")),I.DeprecatedChatEvent.emit("chat.guest.login",{source:"unlog_click_voice"});return}H()?M():Y()},G);return{asrStatus:_,volume:m,tipCardVisible:h,tipCardProps:{i18nConfig:E,onClickCloseBtn:()=>S(!1),onClickConfirmBtn:()=>S(!1)},isAsrRecordingOrLoading:H,handleClickAsrBtn:$}};var z={container:"container-YxRp9m","mic-container":"mic-container-cr1fU5",active:"active-D3Aw1Z","asr-animate":"asr-animate-CBqFNU","icon-mic":"icon-mic-S8J9fm","icon-loading":"icon-loading-U0lghY"};let H=(0,i.forwardRef)(function(e,t){let{className:n,renderCustomMicPermissionCard:i,getPopupContainer:r,...s}=e,a=(0,N.useTranslateFn)(),{isAsrRecordingOrLoading:o,handleClickAsrBtn:l,asrStatus:c,volume:p,tipCardVisible:g,tipCardProps:v}=F(s,t),f=(0,_.jsxs)("div",{"data-testid":"asr_btn",className:d()(z["mic-container"],{[z.active]:o()},"cursor-pointer"),onClick:l,children:[(c===A.AsrStatus.RECORDING||c===A.AsrStatus.PAUSED)&&(0,_.jsx)(m,{count:4,volume:p||0,className:z["asr-animate"]}),(c===A.AsrStatus.DESTROYED||c===A.AsrStatus.INIT)&&(0,_.jsx)(u.default,{className:z["icon-mic"]}),c===A.AsrStatus.LOADING&&(0,_.jsx)(h,{className:d()(z["icon-loading"])})]});return(0,_.jsx)("div",{className:d()(z.container,n),onClick:e=>e.stopPropagation(),children:g?(0,_.jsx)(x.SamanthaPopover,{position:"topRight",trigger:"custom",visible:g,content:(0,_.jsx)(_.Fragment,{children:i?i(v):(0,_.jsx)(b,{...v})}),getPopupContainer:r,children:f}):(0,_.jsx)(C.SamanthaTooltip,{content:(0,_.jsx)("div",{className:"text-11 leading-14",children:a(o()?"voice_input_tooltip_stop":"voice_input_tooltip_start")}),children:f})})}),Y=(0,r.create)()(()=>({hasUsedAsr:!1,asrBtnController:null})),M=e=>{let{className:t,getValue:n,onUpdateValue:r,renderCustomMicPermissionCard:u}=e,c=(0,i.useRef)();return(0,_.jsx)(H,{ref:e=>{Y.setState({asrBtnController:e})},className:t,onStartAsr:()=>{let e=null==n?void 0:n();((0,s.default)(e)||!(0,a.default)(e))&&(c.current=e),Y.setState({hasUsedAsr:!0})},onAsrResultChange:e=>{let t=null==n?void 0:n();if((0,s.default)(t)&&((0,s.default)(c.current)||(0,o.default)(c.current)))null==r||r((c.current||"")+e);else if(!(0,s.default)(t)&&!(0,s.default)(c.current)){var i;let t={data:[...(null===(i=c.current)||void 0===i?void 0:i.data)||[],{type:l.EditorBlockType.Text,text:e}]};null==r||r(t)}},renderCustomMicPermissionCard:u})}},39813:function(e,t,n){n.r(t),n.d(t,{AsrToolButtonPlugin:function(){return r}});var i=n(237600);class r{constructor(){var e,t,n;e="Content",t=i.GenericAsrBtn,(e="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string"))?n:n+"")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}}}}]);
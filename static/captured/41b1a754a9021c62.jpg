"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["14163"],{573966:function(e,t,n){n.d(t,{useEstablished:function(){return i}});var l=n(713738);let i=e=>{let t=(0,l.useRef)(e);return t.current=t.current||e,t.current}},921013:function(e,t,n){n.d(t,{useReplacementArtifactElements:function(){return h}});var l=n(713738),i=n(458524),a=n(559891),o=n(643404),s=n(637319),r=n(83990);let d=e=>{let{replyId:t,conversationId:n}=e,i=(0,l.useMemo)(()=>t&&n?(0,s.getMessageByIdSelector)(r.useMessageStore.getState(),n,t):null,[t,n]),a=(0,l.useMemo)(()=>{var e,t,n;return!!i&&!!((null===(e=i.content_obj)||void 0===e?void 0:e.link_model)||(null===(t=i.attachments)||void 0===t?void 0:t.length)||(null===(n=i.references)||void 0===n?void 0:n.filter(e=>!!(e.key||e.identifier)).length))},[i]);return{replyMessage:i,messageHasAttachments:a}};var u=n(884962),v=n(777210),c=n(722038),_=n(345660);let g=e=>{let{meta:t,conversationId:n,message:i,replyMessage:a}=e,{openFileByKey:o,openRepo:s}=(0,u.useOpenCodeCanvas)(),r=v.messageServiceContainer.get("chatTeaService"),d=(0,l.useMemo)(()=>{var e,t,n,l,i,o,s;if(null==a?void 0:null===(e=a.content_obj)||void 0===e?void 0:e.link_model){let e=null===(l=a.content_obj)||void 0===l?void 0:l.link_model;return[{type:"link",name:(null===(i=e.extra)||void 0===i?void 0:i.repo_name)||e.url,url:e.url,key:(null===(o=e.extra)||void 0===o?void 0:o.repo_id)||"",repo_id:(null===(s=e.extra)||void 0===s?void 0:s.repo_id)||"",file_parse_state:c.ParseState.ParseState_Success}]}return(null==a?void 0:null===(t=a.attachments)||void 0===t?void 0:t.length)?null==a?void 0:a.attachments:(null==a?void 0:null===(n=a.references)||void 0===n?void 0:n.length)?(null==a?void 0:a.references.filter(e=>!!(e.key||e.url))).map(e=>"link"===e.type?{type:e.type,key:e.identifier,url:e.url,name:e.url,repo_id:e.identifier,file_parse_state:c.ParseState.ParseState_Success}:e):[]},[a]),g=(0,l.useCallback)((e,t)=>{var l;if(!a||!t||!i||!d||0===d.length)return;let s=d.find(t=>t.name===e.name);s&&o(s.key,{messageId:i.message_id,conversationId:n,attachments:d.map(e=>({key:e.key,name:e.name,type:"file"})),activePath:e.path},{messageId:null==i?void 0:i.message_id,skillType:null==a?void 0:null===(l=a.skill)||void 0===l?void 0:l.skill_type_no_default},t)},[i,a,d]),p=(0,l.useCallback)((e,t)=>{var l,r;if(a&&t&&i){if(1===d.length&&"link"===d[0].type){s({id:d[0].repo_id,name:d[0].name,url:d[0].url,activePath:e.path},{messageId:null==i?void 0:i.message_id,skillType:null==a?void 0:null===(r=a.skill)||void 0===r?void 0:r.skill_type_no_default},t);return}o(d[0].key,{messageId:i.message_id,conversationId:n,attachments:d.map(e=>({key:e.key,name:e.name,type:"directory"})),activePath:e.path},{messageId:null==i?void 0:i.message_id,skillType:null==a?void 0:null===(l=a.skill)||void 0===l?void 0:l.skill_type_no_default},t)}},[a,n,i,d]),m=(0,l.useCallback)((e,t)=>{var l,a;let o=!1;2===e.type?(o=!0,g(e,null==t?void 0:null===(l=t.getBoundingClientRect)||void 0===l?void 0:l.call(t))):(1===e.type||3===e.type)&&(o=!0,p(e,null==t?void 0:null===(a=t.getBoundingClientRect)||void 0===a?void 0:a.call(t))),o&&(null==r||r.trackEvent("code_file_click",{current_page:"chat",conversation_id:n,bot_id:null==i?void 0:i.bot_id,message_id:null==i?void 0:i.message_id,link_detail:e.path}))},[p,g,n,i]);return(0,_.jsx)("span",{className:"code-file-path-iIAQg1",onClick:e=>m(t,e.currentTarget),children:t.name})};var p=n(648121),m=n(375881);let f=(0,a.withSuspense)(l.lazy(()=>(0,o.retryLoadWithFallBack)({fn:async()=>{let{CodeArtifactCard:e}=await Promise.all([n.e("75996"),n.e("260"),n.e("48776")]).then(n.bind(n,989725));return{default:e}}}))),h=e=>{var t;let{message:n,isShareOrCollectionMessage:l,onClick:a,enableOpenCanvas:o=!0,loadingIconClassName:s,metaInfos:r,enableCodePathElements:u=!0}=e,v=(0,m.getCodeArtifactListDataByMessage)(n),c=null==n?void 0:n.conversation_id,{messageHasAttachments:h,replyMessage:y}=d({replyId:null!==(t=null==n?void 0:n.reply_id)&&void 0!==t?t:"",conversationId:c});if(!n)return[];if(!l&&c&&h&&(null==r?void 0:r.length)&&u&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>e.type===i.MetaType.CodeAssistantFilePath)}(r)){let e=new Map;return r.forEach(t=>{let{start_position:n,end_position:l,path:i,name:a}=t.data,o=`${n}-${l}-${i}-${a}`;e.has(o)||e.set(o,t)}),Array.from(e.values()).map(e=>{let t=e.data;return{range:[t.start_position,t.end_position+1],render:()=>(0,_.jsx)(g,{meta:t,conversationId:c,message:n,replyMessage:y})}})}return(null==v?void 0:v.length)?(0,p.groupByArtifactKey)(v).map((e,t)=>{var i,r;let{offset:d={start:0},identifier:u,artifactId:v,artifactKey:c}=null!==(i=null==e?void 0:e[0])&&void 0!==i?i:{},{start:g=0}=d,p=null!==(r=null!=v?v:u)&&void 0!==r?r:"";return{range:g,render:()=>(0,_.jsx)(f,{message:n,artifactId:p,artifactKey:c,artifactMeta:e,autoOpen:0===t,isShareOrCollectionMessage:l,enableOpenCanvas:o,onClick:a,loadingIconClassName:s},null!=c?c:t)}}):[]}},74977:function(e,t,n){n.d(t,{BaseTextMessageBox:function(){return k},TextMessageBox:function(){return C}});var l=n(713738),i=n(744322),a=n(296557),o=n(629006),s=n(674157),r=n(456712),d=n(540498),u=n(777210),v=n(637319),c=n(83990),_=n(212183),g=n(588426),p=n(334312),m=n(921013),f=n(648121),h=n(375881),y=n(345660);let k=e=>{var t,n,k,C,S,A,I,T;let{inView:x,message:B,onClick:L,enableOpenCanvas:M,enableCodePathElements:b=!0,customRenderOptions:E,loadingIconClassName:j}=e,F=(0,l.useRef)(null),N=u.messageServiceContainer.get("chatTeaService"),{showRun:P}=(0,a.useShowRun)(),O=(0,h.getCodeArtifactListDataByMessage)(B),R=(0,l.useMemo)(()=>(null==O?void 0:O.length)&&B?(0,f.groupByArtifactKey)(O):[],[null==O?void 0:O.length,B]);(0,l.useEffect)(()=>{var e,t;null===(t=F.current)||void 0===t||null===(e=t.flushSmoothCursor)||void 0===e||e.call(t)},[null==R?void 0:R.length]);let w=(0,o.isTextMessageWithDeepThiking)(B)&&!(null==B?void 0:B.think_reason_is_hide),V=(0,o.isBrokenMessage)(B),D=(0,s.isMessageFinished)(B),K=(0,r.getDeepThinkStatusFromExt)(null==B?void 0:B.ext),G=!!(null==B?void 0:null===(t=B.content_obj)||void 0===t?void 0:t.think)&&!!(null==B?void 0:null===(n=B.content_obj)||void 0===n?void 0:n.text)&&!K||D,{isLoadingInThinking:Y,loadingTitle:$}=(0,l.useMemo)(()=>{var e,t,n;let l=!1,i="",{text:a=""}=null!==(n=null==B?void 0:null===(e=B.loading_state)||void 0===e?void 0:e.current_state)&&void 0!==n?n:{};return{isLoadingInThinking:l=null!=B&&null!==(t=B.loading_state)&&void 0!==t&&!!t.in_loading&&!K&&!V,loadingTitle:a}},[null==B?void 0:null===(k=B.loading_state)||void 0===k?void 0:k.current_state,K]),U=!!(null==B?void 0:null===(C=B.content_obj)||void 0===C?void 0:C.text)||!!(null==O?void 0:O.length);return(0,y.jsxs)(y.Fragment,{children:[w&&(0,y.jsx)(i.DeepThinkingContent,{meta:null==B?void 0:B.meta_infos,isThinkingFinished:G,isThinkingBroken:K,thinkExpandStatus:!0,content:(null==B?void 0:null===(S=B.content_obj)||void 0===S?void 0:S.think)||"",onTrackEvent:(e,t)=>{var n,l,i;if(!(null==B?void 0:B.conversation_id))return;let a=(0,v.getMessageSelector)(c.useMessageStore.getState(),null==B?void 0:B.conversation_id,{isLocalMessage:!1,messageId:null!==(i=null==B?void 0:B.reply_id)&&void 0!==i?i:""});null==N||N.trackEvent(e,{bot_id:null==B?void 0:B.bot_id,message_id:String(null==B?void 0:B.message_id),chat_type:(0,_.getChatTypeForTea)("",null==B?void 0:B.conversation_id),conversation_id:null==B?void 0:B.conversation_id,conversation_type:(0,g.getConversationTypeById)(null==B?void 0:B.conversation_id),skill_id:null==a?void 0:null===(n=a.skill)||void 0===n?void 0:n.skill_id_no_default,skill_name:(0,p.getSkillTeaNameByType)(null==a?void 0:null===(l=a.skill)||void 0===l?void 0:l.skill_type_no_default),...t})},options:{isInSearchLoading:Y,loadingTitle:$},messageId:null==B?void 0:B.message_id,botId:null==B?void 0:B.bot_id,skillType:null==B?void 0:null===(A=B.skill)||void 0===A?void 0:A.skill_type_no_default,skillId:null==B?void 0:null===(I=B.skill)||void 0===I?void 0:I.skill_id_no_default,conversationId:null==B?void 0:B.conversation_id,messageText:(null==B?void 0:null===(T=B.content_obj)||void 0===T?void 0:T.text)||""}),U&&(0,y.jsx)(d.MessageTextContent,{ref:F,inView:x,message:B,messageBlockText:void 0,messageBlockTextFinish:void 0,messageBlockTextBroken:void 0,customRenderOptions:{customSlotsProps:{CodeBlock:{showRun:P}},useCustomReplacementElements:e=>(0,m.useReplacementArtifactElements)({message:B,onClick:L,enableOpenCanvas:M,loadingIconClassName:j,metaInfos:null==e?void 0:e.metaInfos,enableCodePathElements:b}),...E}})]})},C=e=>(0,y.jsx)(k,{...e})},648121:function(e,t,n){n.d(t,{groupByArtifactKey:function(){return l}});function l(e){let t=new Map;return e.forEach(e=>{let{artifactKey:n=""}=e;if(t.has(n)){var l;null===(l=t.get(n))||void 0===l||l.push(e)}else t.set(n,[e])}),Array.from(t.values())}},884962:function(e,t,n){n.d(t,{useOpenCodeCanvas:function(){return s}});var l=n(713738),i=n(57392),a=n(666196),o=n(698392);let s=()=>{let e=(0,o.useChatSlice)("chatViewCoreStore",e=>{var t;return(null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId)||""}),t=(0,a.useChatService)("chatViewService"),n=(0,l.useRef)(0);return{openFileByKey:(l,a,o,s)=>{let{attachments:r=[],messageId:d="",conversationId:u="",activePath:v}=a||{};t.openCanvasPanel({messageId:d,conversationId:u,canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY,fileKey:l,attachments:r,isCodeFile:!0,activePath:v,canvasVersion:n.current,chatId:e,teaCtx:o},s),n.current+=1},openCodeContent:(n,l,a,o,s)=>{let{messageId:r="",conversationId:d="",autoRun:u,autoQuote:v=!0}=a||{};t.openCanvasPanel({messageId:r,conversationId:d,canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY,fileKey:"",attachments:[],modelGenContent:{code:n,language:l},isCodeFile:!0,chatId:e,autoQuote:v,teaCtx:o,autoRun:u},s)},openRepo:(l,a,o)=>{let{id:s,name:r,url:d,activePath:u}=l||{};t.openCanvasPanel({messageId:"",conversationId:"",canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY,fileKey:s,canvasVersion:n.current,activePath:u,attachments:[{key:s,type:"link",identifier:s,local_key:s,name:r,url:d,repo_id:s}],isCodeFile:!0,chatId:e,teaCtx:a},o),n.current+=1},openArtifact:(e,n,l,a,o,s)=>{let{messageId:r="",conversationId:d="",isAutoOpen:u}=a||{},{version:v}=l||{};t.openCanvasPanel({conversationId:d,messageId:r,artifactId:e,artifactKey:n,defaultArtifacts:void 0,isCodeFile:!0,canvasLayoutState:i.CanvasLayoutState.CANVAS_ONLY,chatId:d,version:v,isAutoOpen:u,artifactMeta:l,teaCtx:o},s,u)}}}},296557:function(e,t,n){n.d(t,{PREVIEWABLE_LANGUAGES:function(){return d},useShowRun:function(){return u}});var l=n(713738),i=n(102249),a=n(992847);let o=["python","c","cpp","java"],s=["javascript","go"],r=["rust","php","csharp","bash","r","typescript"],d=["html"],u=()=>{let e=(0,i.useFGValue)("coding_sandbox_run_multi_lang_new",{source:a.FGBuiltinNames.tea,defaultValue:!1});return{showRun:(0,l.useCallback)(t=>t?d.includes(t)?"preview":o.includes(t)||s.includes(t)||e&&r.includes(t)?"run":null:null,[e])}}}}]);
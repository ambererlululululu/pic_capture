"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["64824"],{755804:function(t,e,r){r.r(e),r.d(e,{ChatInputStoreService:function(){return M}});var a=r(695422),s=r(698392),i=r(831566),l=r(217957),n=r(229079),o=r(339902),c=r(746479),S=r(910214),u=r(856392);let h=t=>{(0,s.getChatStore)("chatInputStore").setState({recommendSkills:t})},p=t=>{let{recommendSkills:e}=(0,s.getChatSlice)("chatInputStore");if(!e||0===e.length)return!1;let r=null==e?void 0:e[0];return!!r&&r.skill_type===t},d=t=>{if(p(t)){var e;let t=[...null!==(e=(0,s.getChatSlice)("chatInputStore").recommendSkills)&&void 0!==e?e:[]];t.shift(),(0,s.getChatStore)("chatInputStore").setState({recommendSkills:t})}},v=t=>{(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(e=>{e.skillConfig={...e.skillConfig,...t}}))},g=t=>{var e;let{skillType:r,eventName:a,...i}=t;return(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(t=>{var e,s;null===(s=t.skillReportEvents[r])||void 0===s||null===(e=s[a])||void 0===e||e.cancel(),t.skillReportEvents[r]={[a]:(0,u.createReportEvent)({eventName:a,...i,once:!0})}})),null===(e=(0,s.getChatSlice)("chatInputStore").skillReportEvents[r])||void 0===e?void 0:e[a]},k=t=>{var e;let{skillType:r,eventName:a}=t;return null===(e=(0,s.getChatSlice)("chatInputStore").skillReportEvents[r])||void 0===e?void 0:e[a]},f=()=>{(0,s.getChatStore)("chatInputStore").setState({skillReportEvents:{}})},_=(t,e)=>{(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(r=>{r.sendMessageStatusMap[t]=e}))},C=t=>(0,s.getChatStore)("chatInputStore").setState({skill_drop_down_visible:t}),m=(t,e)=>{(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(r=>{let a=r.sendMessageStatusMap[t];!(0,l.default)(a)&&(r.sendMessageStatusMap[e]=a,setTimeout(()=>{(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(e=>{delete e.sendMessageStatusMap[t]}))},3e4))}))},E=(t,e)=>{(0,s.getChatStore)("chatInputStore").setState((0,c.produce)(r=>{r.userPreferences[t]=e}))},I=async t=>{let{inputSkills:e}=(0,s.getChatSlice)("chatInputStore");if(!e)return;let r=e.find(e=>e.skill_type===t),a=e.findIndex(e=>e.skill_type===t);if(!r||r.sticky)return;let i=(0,u.createReportEvent)({eventName:"pin_skill_order",meta:{skill_type:t}}),l=(0,n.default)((0,s.getChatSlice)("launcherRawSettingStore"),"settingData.ab_config.ab_results.trim_landing_page_skills")?-1:(0,o.default)(e,t=>!!t.sticky),c=[...e];c.splice(a,1),c.splice(l+1,0,r);try{await S.samanthaApiService.UpdateSkillsOrder({input_skill:c,latest_used_skill:t}),(0,s.getChatStore)("chatInputStore").setState({inputSkills:c}),(0,s.getChatStore)("skillStore").setState({inputSkills:c}),d(t),i.addDurationPoint("success"),i.success()}catch(t){i.error({error:t instanceof Error?t:Error(String(t)),reason:"update_skills_order_error"})}},y=async t=>{if(p(t)){let e=(0,u.createReportEvent)({eventName:"close_recommend_skill",meta:{skill_type:t}});try{await S.samanthaApiService.DisableRecommendSkill({skill_type:t}),d(t),e.addDurationPoint("success"),e.success()}catch(t){e.error({error:t instanceof Error?t:Error(String(t)),reason:"close_recommend_skill_error"})}}},R=t=>{(0,s.getChatStore)("chatInputStore").setState({selectedRecommendSkill:t})};var b=r(246903);function D(t,e,r){var a;return(e="symbol"==typeof(a=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,e||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"))?a:a+"")in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class M{initEventBinding(){i.DeprecatedChatEvent.on("chat.service.resetAll",this.resetStore),i.DeprecatedChatEvent.on("chat.localBreak",this.onLocalBreak)}unbindEvent(){i.DeprecatedChatEvent.off("chat.service.resetAll",this.resetStore),i.DeprecatedChatEvent.off("chat.localBreak",this.onLocalBreak)}constructor(){D(this,"updateSkillConfig",v),D(this,"createSkillReportEvent",g),D(this,"getSkillReportEvent",k),D(this,"resetSkillReportEvent",f),D(this,"updateUserPreferences",E),D(this,"updateSendMessageStatus",_),D(this,"updateSkillDropDownVisible",C),D(this,"moveSendMessageStatus",m),D(this,"pinSkill",I),D(this,"updateRecommendSkills",h),D(this,"disableRecommendSkill",y),D(this,"updateSelectedRecommendSkill",R),D(this,"destroy",()=>{this.unbindEvent()}),D(this,"resetStore",()=>{(0,s.getChatStore)("chatInputStore").setState(b.defaultChatInputStore)}),D(this,"onLocalBreak",()=>{var t;let e=null===(t=(0,s.getChatSlice)("chatViewCoreStore").currentChatViewConfig)||void 0===t?void 0:t.chatId;e&&(0,s.getChatSlice)("chatInputStore").sendMessageStatusMap[e]===a.ChatInputSendMessageStatus.Receiving&&this.updateSendMessageStatus(e,a.ChatInputSendMessageStatus.Default)}),this.initEventBinding()}}}}]);
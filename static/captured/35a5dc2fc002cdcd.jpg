"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["33697"],{783477:function(t,e,o){o.r(e),o.d(e,{createBotStore:function(){return h},initBotStore:function(){return D},getDefaultBotState:function(){return L},useBotInfo:function(){return m},useBotStore:function(){return S},getRequestIdByBotId:function(){return M},useGuestBotStore:function(){return T}});var i=o(865607),r=o(952259),s=o(321647),a=o(204418),n=o(907929),d=o(874578),l=o(554450),c=o(746479),u=o(773289),p=o(910214),g=o(178230);let f={botMap:{},botIdToLocalConversationMap:{},botIdToRequestIdMap:{}},B=(t,e)=>({...f,updateBot:e=>{let{bot_id:o,id:i}=e,r=o||i;if(!r){g.logger.persist.warning({message:"invalid botInfo to update",meta:{botInfo:e}});return}t((0,c.produce)(t=>{t.botMap[r]={...t.botMap[r]||{},...e}}))},overrideBots:e=>{e.length&&t((0,c.produce)(t=>{e.forEach(e=>{let{bot_id:o,id:i}=e,r=o||i;r&&(t.botMap[r]={...t.botMap[r]||{},...e})})}))},setLocalConversationIdForBot:e=>{let{botId:o,localConversationId:i}=e;t((0,c.produce)(t=>{t.botIdToLocalConversationMap[o]=i}))},clearConversationIdForBot:e=>{let{botId:o}=e;t((0,c.produce)(t=>{if(!o)return;let e=t.botMap[o];e&&(e.conversation_id="",e.has_conversation=!1)}))},fetchToUpdateBot:async e=>{var o;let{botId:i}=e,{data:r}=await p.botApiService.RecommendBots({bot_ids:[i]}),s=(null==r?void 0:null===(o=r.bot_list)||void 0===o?void 0:o.length)?null==r?void 0:r.bot_list:[];return t((0,c.produce)(t=>{var e;(null==r?void 0:null===(e=r.bot_list)||void 0===e?void 0:e.length)&&(t.botMap[i]=null==s?void 0:s[0])})),null==s?void 0:s[0]},getBot:t=>e().botMap[t],getBotIdFromLocalConversation:t=>{let{botIdToLocalConversationMap:o}=e();for(let e in o)if(o[e]===t)return e},getBotIdToLocalConversationMap:()=>e().botIdToLocalConversationMap,getBotIdToRequestIdMap:()=>e().botIdToRequestIdMap}),b=[],v=(b=[{apiTagID:102,newTagID:252},{apiTagID:104,newTagID:253},{apiTagID:103,newTagID:254},{apiTagID:228,newTagID:228},{apiTagID:105,newTagID:255}])[0].newTagID,L=()=>({discoveryBotCachedList:{},discoveryBotLinks:[],discoveryBotListStatus:{loading:!1,failed:!1,count:0,hasMore:!0,tagList:[],selectedTagId:-1,error:void 0},choicenessBotLinks:[],choicenessBotListStatus:{loading:!1,failed:!1,count:0,hasMore:!0},profileBotLinks:[],profileBotListStatus:{loading:!1,failed:!1,count:0,hasMore:!0,last_index:"0"},profileBotCount:0}),_=L(),I=function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];let[i,r]=e;return{..._,...B(...e),initRecommendBotList:t=>{let{size:e,recommendType:o,tagId:i,isSidebarRecommend:s}=t;r().loadRecommendBotList({index:1,size:e,recommendType:o,tagId:i,isSidebarRecommend:s})},loadRecommendBotList:async t=>{let{index:e,size:o,recommendType:s,tagId:l,isSidebarRecommend:f=!1}=t,B=f?1:b.map(t=>t.newTagID).includes(l)?l:v,L=s===u.BotRecommendType.Discovery,_=L?"discoveryBotListStatus":"choicenessBotListStatus",I=L?"discoveryBotLinks":"choicenessBotLinks",h=1===e,S=r()[I];h&&L&&i((0,c.produce)(t=>{var e;let o=null!==(e=t.discoveryBotCachedList[null!=B?B:""])&&void 0!==e?e:[];t.discoveryBotLinks=o,t.discoveryBotListStatus.count=o.length})),i((0,c.produce)(t=>{let e=t[_];L?Object.assign(e,{loading:!0,selectedTagId:B||t.discoveryBotListStatus.selectedTagId}):Object.assign(e,{loading:!0})}));try{let t={recommend_type:s,page_index:e,page_size:o};B&&(t.tag_id=B);let{data:l}=await p.botApiService.RecommendBots(t),{bot_list:u=[],has_more:g=!1,tag_list:f=[],selected_tag_id:v,trace_map:T}=l||{},D=r().discoveryBotListStatus.selectedTagId;if(v&&-1!==D&&v!==D)return;let{request_id:m}=T||{},M=(0,a.default)((0,n.default)(u||[],"bot_id"),t=>({botID:t.bot_id||""})),w=y(h?[]:S,M);i((0,c.produce)(t=>{if(L){var e;let o=null!==(e=t.discoveryBotListStatus.tagList)&&void 0!==e?e:[],i=f.reduce((t,e)=>(e.tag_id&&(t[e.tag_id]=e),t),{}),r=b.reduce((t,e)=>{let o=i[e.apiTagID];return o&&t.push({...o,tag_id:e.newTagID}),t},[]),s=r.every((t,e)=>{var i;return t.tag_id===(null===(i=o[e])||void 0===i?void 0:i.tag_id)}),a=t.discoveryBotListStatus.selectedTagId,n={loading:!1,failed:!1,count:w.length,hasMore:g,tagList:s?o:r,selectedTagId:-1===a?v:a};null==u||u.map(e=>{e.bot_id&&(t.botIdToRequestIdMap[e.bot_id]=m)}),Object.assign(t[_],n)}else Object.assign(t[_],{loading:!1,failed:!1,count:w.length,hasMore:g});t[I]=w,"discoveryBotLinks"===I&&B&&(t.discoveryBotCachedList[B]=w),t.botMap=(0,d.default)(u||[],(t,e)=>(e.bot_id&&(t[e.bot_id]=e),t),{...t.botMap})}))}catch(t){i((0,c.produce)(e=>{Object.assign(e[_],{failed:!0,loading:!1,error:t})})),t instanceof Error&&g.logger.persist.error({message:`loadBotList failed size:${o} index:${e}, type: ${s}`,error:t})}},initProfileBotList(t){let{size:e,visit_id:o}=t;r().loadProfileBotList({index:"0",size:e,visit_id:o})},async loadProfileBotList(t){let{index:e,size:o,visit_id:s}=t,{profileBotLinks:l}=r(),u="0"===e;i((0,c.produce)(t=>{t.profileBotListStatus.loading=!0}));try{let{data:t}=await p.profileApiService.ProfileBotList({index:e,limit:o,visit_id:s}),{profile_bot_list:r=[],has_more:g=!1,last_index:f,total:B}=t||{},b=(r||[]).map(t=>{var e;return{...t,icon_url:null===(e=t.icon_image)||void 0===e?void 0:e.tiny_url}}),v=(0,a.default)((0,n.default)(b||[],"bot_id"),t=>({botID:t.bot_id||""})),L=y(u?[]:l,v);i((0,c.produce)(t=>{Object.assign(t.profileBotListStatus,{loading:!1,failed:!1,count:L.length,hasMore:g,last_index:f}),t.profileBotLinks=L,t.profileBotCount=Number(B),t.botMap=(0,d.default)(b||[],(t,e)=>(e.bot_id&&(t[e.bot_id]=e),t),{...t.botMap})}))}catch(t){throw i((0,c.produce)(t=>{Object.assign(t.profileBotListStatus,{failed:!0,loading:!1})})),t instanceof Error&&g.logger.persist.error({message:`loadBotList failed size:${o} index:${e}, type: profileBotLinks`,error:t}),t}},resetProfileBotListStatus(){i((0,c.produce)(t=>{Object.assign(t.profileBotListStatus,_.profileBotListStatus)}))},deleteBotInChoicenessBotLinks(t){i((0,c.produce)(e=>{e.choicenessBotLinks=e.choicenessBotLinks.filter(e=>e.botID!==t)}))},resetDiscoverBotListSelectedTagId(){i((0,c.produce)(t=>{t.discoveryBotListStatus.selectedTagId=-1}))}}},y=(t,e)=>(0,l.default)(t.concat(e),"botID"),h=(t,e)=>e?(0,s.create)()((0,r.devtools)((0,r.subscribeWithSelector)(I),{name:t})):(0,s.create)()((0,r.subscribeWithSelector)(I)),S=function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];let{_useBotStore:i}=S.prototype;if(i)return i(...e);throw Error("useBotStore is not initialized")},T=function(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];let{_useGuestBotStore:i}=T.prototype;if(i)return i(...e);throw Error("useBotStore is not initialized")};function D(t){let{_useBotStore:e}=S.prototype||{},{_useGuestBotStore:o}=T.prototype||{};if(!e){let e=h("flow-web-bot-store",t);Object.setPrototypeOf(S.prototype,e),Object.defineProperties(S,{...Object.getOwnPropertyDescriptors(e)}),S.prototype._useBotStore=e}if(!o){let e=h("flow-web-guest-bot-store",t);Object.setPrototypeOf(T.prototype,e),Object.defineProperties(T,{...Object.getOwnPropertyDescriptors(e)}),T.prototype._useGuestBotStore=e}}let m=t=>{let e=S(e=>t?e.botMap[t]:void 0,i.shallow),o=T(e=>t?e.botMap[t]:void 0,i.shallow);return e||o},M=t=>S.getState().botIdToRequestIdMap[t||""]}}]);
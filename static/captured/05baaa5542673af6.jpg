"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["24872"],{72516:function(e,r,t){t.d(r,{genUserDefaultProfile:function(){return g},getProfileInfo:function(){return S},resetProfile:function(){return P},resetUserInfos:function(){return E},updateUserInfo:function(){return v},updateUserInfoLoaded:function(){return y},updateUserProfile:function(){return m}});var o=t(4137),i=t(910214),n=t(769783),a=t(177048),u=t(643404),s=t(47563),l=t(856392),f=t(178230),c=t(797840),d=t(369269),_=t(886941),p=t(193907);let v=e=>{var r;return((0,_.updateWorkspaceParams)({type:null!==(r=e.passport_enterprise_user_type)&&void 0!==r?r:p.PassportEnterpriseUserTypeEnum.Normal}),c.useFlowAccountStore.setState({userInfo:e,userInfoLoaded:!0}),null==e?void 0:e.user_id_str)?S(e.user_id_str):Promise.reject(Error("user_id_str is empty"))},y=()=>{c.useFlowAccountStore.setState({userInfoLoaded:!0})},S=async(e,r)=>{if(!e)return Promise.reject(Error("user_id_str is empty"));let t=(0,l.createReportEvent)({eventName:"get_profile_info",meta:{user_id:e}});try{let{data:r}=await i.profileApiService.ProfileInfo({visit_id:e});if(r){var o;return c.useFlowAccountStore.setState({userProfile:{...null==r?void 0:r.profile_brief,loaded:!0,botCount:Number(null==r?void 0:null===(o=r.profile_bot_info)||void 0===o?void 0:o.total)||0}}),t.success(),null==r?void 0:r.profile_brief}t.error({reason:"no data"})}catch(o){if((0,n.isApiError)(o)&&o.errorOption.code===a.ErrorCodes.USER_NOT_EXISTED.toString()){if(f.logger.persist.info({eventName:"gen_user_profile_for_user_stay_on_chat_page",meta:{user_id:e}}),r)throw Error("get profile only get");0!==await m({entity_id:e,avatar_url:"",nickname:"",user_name:""})&&(c.useFlowAccountStore.setState({userProfile:{loaded:!0}}),t.error({reason:"with update fail",error:o}))}else t.error({reason:"unhandle catch",error:o instanceof Error?o:Error(String(o))})}},m=async e=>{let r=(0,l.createReportEvent)({eventName:"update_user_profile",meta:{user_id:e.entity_id}});try{r.addDurationPoint("start");let{code:t,msg:o,data:n}=await i.profileApiService.UpdateProfile(e);if(0===t&&(null==n?void 0:n.entity_id))return r.addDurationPoint("success"),r.success(),await S(null==n?void 0:n.entity_id),0;return o&&s.SamanthaToast.error(o),0===t?-1001:Number(t)}catch(t){if(r.error({reason:"update_user_profile_failed",error:t instanceof Error?t:Error(String(t))}),(0,n.isApiError)(t)&&(e.nickname||!e.entity_id))return t.errorOption.message&&s.SamanthaToast.error(t.errorOption.message),(0,o.default)(t.errorOption.code)?-1002:parseInt(t.errorOption.code,10);try{let t=await (0,u.retryAsync)(()=>S(e.entity_id,!0),3,e=>800*e,(e,t)=>{r.updateMeta({retry:t,[`retry${t}`]:e})});if(null==t?void 0:t.entity_id)return r.updateMeta({retrySuccess:1}),0;throw Error("retry not entity_id")}catch(e){r.updateMeta({retrySuccess:0,retryFail:e})}return -1003}},E=()=>{c.useFlowAccountStore.setState({userInfo:d.defaultFlowAccountStore.userInfo,userProfile:d.defaultFlowAccountStore.userProfile})},P=()=>{c.useFlowAccountStore.setState({userProfile:d.defaultFlowAccountStore.userProfile})},g=async e=>{try{var r,t;let o=await Promise.all([i.profileApiService.UpdateProfile({entity_id:e,avatar_url:"",nickname:"",user_name:""}),i.profileApiService.UserHitProfileRegister()]);return(null==o?void 0:null===(t=o[1])||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:r.profile_enable)||!1}catch(e){return f.logger.persist.error({eventName:"gen_user_default_profile_error",message:"[genUserDefaultProfile] genUserDefaultProfile failed",error:e instanceof Error?e:Error(String(e))}),!1}}},873318:function(e,r,t){t.r(r);var o=t(173772);r.default=()=>((0,o.useInitWorkspaceInfo)(),null)},121821:function(e,r,t){var o=(0,t(935752).default)(function(e,r,t){e[+!t].push(r)},function(){return[[],[]]});r.default=o}}]);
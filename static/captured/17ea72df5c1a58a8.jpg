"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["53756"],{802370:function(e,t,s){s.d(t,{useFeedbackStatus:function(){return k},useMessage:function(){return y},useLoadMore:function(){return E},useMessageLinksWithStatus:function(){return S},useHasLastMessageNotFinished:function(){return A},useSuggestMessage:function(){return T},useActiveRegenerateMessage:function(){return b},useClearContext:function(){return I},isLastMessageNotFinished:function(){return w},useLastMessage:function(){return F},useLocalMessageMap:function(){return C},useMessageLinks:function(){return h},useMessageMap:function(){return L}});var i=s(713738),n=s(865607),a=s(40680),o=s(913821),l=s(217957),r=s(674157),u=s(629006),g=s(230932),d=s(722038),c=s(366119),v=s(680982),_=s(83990);let p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.shallow,s=function(){for(var s=arguments.length,i=Array(s),n=0;n<s;n++)i[n]=arguments[n];return(0,_.useMessageStore)(t=>e(t,...i),t)};return s.raw=e,s};var M=s(637319),m=s(752544),f=s(630768);let h=p(M.messageLinkSelector);p(M.messageListStatusSelector);let S=p(M.messageLinksWithStatusSelector),k=(e,t)=>{let{updateMessageFeedbackStore:s}=_.useMessageStore.getState(),{liked:n,disliked:r,detail:u,remoteFeedbackType:g,localFeedbackType:c}=(0,_.useMessageStore)(s=>{var i,n;let{feedback:o}=null!==(n=(0,M.getMessageSelector)(s,e,{isLocalMessage:!1,messageId:t}))&&void 0!==n?n:{},l=null===(i=s.messageFeedbackMap[e])||void 0===i?void 0:i[t],r=(0,a.default)({...l},{feedback_type:o});return{liked:r.feedback_type===d.FeedbackType.Like,disliked:r.feedback_type===d.FeedbackType.Unlike,detail:r,remoteFeedbackType:o,localFeedbackType:null==l?void 0:l.feedback_type}},o.default);return(0,i.useEffect)(()=>{(0,l.default)(g)||c===g||s({conversationId:e,messageId:t,detail:{feedback_type:g}})},[g]),{liked:n,disliked:r,detail:u}},L=p((e,t)=>e.messageMap[t]||{}),C=p((e,t)=>e.localMessageMap[t]||{}),y=p((e,t,s)=>{var i;if(s)return null===(i=(s.isLocalMessage?e.localMessageMap:e.messageMap)[t])||void 0===i?void 0:i[s.messageId]});p((e,t,s)=>{let i=(0,m.createGetMessage)((0,m.getMessageState)(e,t)),n=[];for(let e of s){let t=i(e);t&&n.push(t)}return n}),p((e,t,s)=>{var i;return s?null===(i=e.localMessageMap[t])||void 0===i?void 0:i[s]:void 0});let b=p((e,t)=>{var s,i;let n=t.conversation_id||"",{regenerateMessageMap:{[n]:a},messageLinkMap:{[n]:o},messageMap:{[n]:l}}=e,g=(()=>{if(!(null==t?void 0:t.reply_id)||!(0,r.isRegenerateMessage)(t))return;let s=(0,m.createGetMessage)({localMessageMap:e.localMessageMap[n],messageMap:e.messageMap[n]});return(0,u.isImageMessage)(t)?(0,f.findAllMessageLinkByMatchEqualId)({messageLinks:o,replyId:t.reply_id,getMessage:s}):null==o?void 0:o.filter(e=>{var i;return(null===(i=s(e))||void 0===i?void 0:i.reply_id)===t.reply_id})})(),d=null==t?void 0:t.reply_id,c=t.message_id||"";return{activeRegenerateMessage:(null==g?void 0:g.length)?null==a?void 0:null===(s=a.messageMap)||void 0===s?void 0:s[c]:void 0,regenerateActiveIndex:null==g?void 0:g.findIndex(e=>{let{messageId:s}=e;return s===t.message_id}),isRegenerateTail:(null==g?void 0:null===(i=g[g.length-1])||void 0===i?void 0:i.messageId)===t.message_id,regenerateMessageLinks:g,replyFromMessage:d&&(null==l?void 0:l[d])||void 0}}),T=p((e,t,s)=>{let i=e.suggestMessageMap[t];return(null==i?void 0:i.replyId)===s?i:void 0}),I=()=>(0,g.useFeedStore)(e=>t=>{(0,v.handleLocalBreak)(_.useMessageStore,t||""),e.clearContext(t)},n.shallow),F=p((e,t)=>e.lastMessageMap[t]),w=(e,t)=>{try{let s=e.messageLinkMap[t],i=s[s.length-1];if(!i)return!0;let n=e.messageMap[t][i.messageId];if(!n)return!0;return!(0,r.isMessageFinished)(n)}catch(e){return!0}},A=p(w),E=(e,t)=>{let{hasPreprocessTask:s,isLoggedIn:n}=t,{loadMoreMessageList:a}=_.useMessageStore.getState(),o=(0,i.useCallback)(()=>{var t;(null===(t=_.useMessageStore.getState().messageListStatusMap[e])||void 0===t?void 0:t.hasMore)&&a(e,!n,s)},[e,s,n]),{run:l}=(0,c.default)(o,{trailing:!1,leading:!0,wait:2e3});return{loadMore:l}}},349456:function(e,t,s){s.d(t,{isAtLastSection:function(){return n}});var i=s(230932);let n=e=>{var t;return(null===(t=i.useFeedStore.getState())||void 0===t?void 0:t.lastSectionIdMap[e.conversation_id||""])===e.section_id}},984124:function(e,t,s){s.d(t,{extractTeaCollectionIdFromMessage:function(){return i}});let i=e=>{var t,s,i,n;let a=[];return(null==e?void 0:null===(t=e.attachments)||void 0===t?void 0:t.length)?a=(null==e?void 0:null===(i=e.attachments)||void 0===i?void 0:i.map(e=>e.key))||[]:(null==e?void 0:null===(s=e.references)||void 0===s?void 0:s.length)&&(a=(null==e?void 0:null===(n=e.references)||void 0===n?void 0:n.map(e=>e.key))||[]),{collection_id:a.length?1===a.length?a[0]:JSON.stringify(a):void 0}}},23923:function(e,t,s){s.d(t,{useSuggestMessageListComponentHook:function(){return b},useSuggestTimeoutReport:function(){return T}});var i=s(713738),n=s(159738),a=s(845647),o=s(629006),l=s(674157),r=s(802370),u=s(349456),g=s(637319),d=s(83990),c=s(970377),v=s(461141),_=s(556946),p=s(269249),M=s(645298),m=s(198660),f=s(165482),h=s(178230),S=s(946985),k=s(345660);let L=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.ChatType.Conversation,{loading:s,failed:i,suggests:o}=(0,r.useSuggestMessage)(e.conversation_id||"",null==e?void 0:e.reply_id)||{};if((0,n.default)([a.ChatType.Bot,a.ChatType.ProfileBot,a.ChatType.CollectionLocalConversation],t)){var l;return{failed:!1,loading:!1,suggests:(0,f.parseJSON)(null==e?void 0:null===(l=e.ext)||void 0===l?void 0:l.sp,void 0)}}return{failed:i,loading:s,suggests:o,isRegen:!1}},C=e=>{let t=(0,p.useChatViewConfig)(),{loading:s=!1,suggests:i}=L(e,null==t?void 0:t.chatType);return i?{suggestListComponentNode:(0,k.jsx)(S.SuggestListWrapper,{message:e,suggests:i,loading:s},e.conversation_id),suggestLoading:s,suggestsLength:i.length}:null},y=e=>{var t,s;let i=null===(t=e.content_blocks_tree)||void 0===t?void 0:t.children,{contentBlockRenderConfigs:n}=(0,_.useChatReceiveSuggestContentBlockPluginWithContentBlocks)(i),{block:a,PluginContentRender:o,pluginIdentifier:l,duplicateIdentifierList:r}=n[0]||{},u=null==a?void 0:null===(s=a.content_obj)||void 0===s?void 0:s.suggestions;return u?{suggestListComponentNode:(0,k.jsx)(o,{pluginIdentifier:l,message:e,contentBlock:a,duplicateIdentifierList:r},e.conversation_id),suggestLoading:!1,suggestsLength:u.length}:null},b=e=>{let{message:t}=e,s=(0,u.isAtLastSection)(t),i=(0,g.isLastAvailableMessage)(d.useMessageStore.getState(),t.conversation_id||"",t.message_id||""),n=(0,o.isPluginAuthMessage)(t),a=(0,l.isMessageFinished)(t),r=(0,m.useIsLoggedIn)(),{isDisabled:v}=(0,c.useConversationDisabled)(),_=(0,o.isMessageHasSuggest)(t),p=y(t),M=C(t);return _&&s&&i&&!n&&a&&(!r||!v)?p||M:null},T=(e,t,s)=>{let n=(0,i.useRef)(null);(0,i.useEffect)(()=>{if(!e||t>0){n.current&&clearTimeout(n.current);return}let{receiveSuggestStartTimeout:i=M.defaultReceiveSuggestStartTimeout}=(0,v.getChatConfig)("chatMessageConfig")||{};return n.current=setTimeout(()=>{h.logger.persist.info({eventName:"suggest_list_timeout",meta:{message_id:null==s?void 0:s.message_id,conversation_id:null==s?void 0:s.conversation_id}})},i),()=>{n.current&&clearTimeout(n.current)}},[e,t])}},946985:function(e,t,s){s.d(t,{SuggestListWrapper:function(){return h}});var i=s(713738),n=s(214071),a=s(845647),o=s(984124),l=s(637319),r=s(83990),u=s(777210),g=s(922851),d=s(516655),c=s(689368),v=s(269249),_=s(831566),p=s(777422),M=s(198660),m=s(23923),f=s(345660);let h=e=>{let{message:t,suggests:s,loading:h,className:S}=e,k=(0,v.useChatViewConfig)(),L=(0,l.getMessageSelector)(r.useMessageStore.getState(),(null==t?void 0:t.conversation_id)||"",{messageId:(null==t?void 0:t.reply_id)||"",isLocalMessage:!1}),C=()=>{let e=u.messageServiceContainer.get("chatConfigService"),{loginSource:i}=(null==e?void 0:e.chatReportParams)||{};(0,p.trackEvent)("show_suggested_prompt",{bot_id:null==t?void 0:t.bot_id,message_id:null==t?void 0:t.message_id,conversation_id:null==t?void 0:t.conversation_id,prompt_cnt:s.length,suggested_type:"suggested_prompt",collection_id:(0,o.extractTeaCollectionIdFromMessage)(L).collection_id,...i?{previous_page:i}:{},web_show_method:"enter_chat",click_from:"direct"},{key:`${null==t?void 0:t.message_id}`}),s.forEach((e,s)=>{(0,p.trackEvent)("show_suggested_prompt_single_question",{bot_id:null==t?void 0:t.bot_id,message_id:null==t?void 0:t.message_id,conversation_id:null==t?void 0:t.conversation_id,prompt_position:s+1,collection_id:(0,o.extractTeaCollectionIdFromMessage)(L).collection_id,...i?{previous_page:i}:{},web_show_method:"enter_chat",click_from:"direct"},{key:`${null==t?void 0:t.message_id}_${s}`,duration:300})})};(0,m.useSuggestTimeoutReport)(h,s.length,t),(0,i.useEffect)(()=>{(0,n.default)(s)||3!==s.length||C()},[s.length,null==t?void 0:t.reply_id]);let{matcher:y}=(0,d.useChatReceiveMessageSuggestPluginMatcher)(),{pluginIdentifier:b}=(null==y?void 0:y.find(e=>e.matchPlugin(t)))||{},{plugin:{Content:T}={}}=(0,c.useChatReceiveMessageSuggestPlugin)(b),I=(0,i.useMemo)(()=>s.length?[...s.map(e=>({value:e,label:e}))]:[],[s]);return T?(0,f.jsx)(T,{onTrackClickEvent:(e,s)=>{let i=(0,M.getIsLoggedIn)(),n=u.messageServiceContainer.get("chatConfigService"),{loginSource:d}=(null==n?void 0:n.chatReportParams)||{},c=(0,l.getMessageSelector)(r.useMessageStore.getState(),(null==t?void 0:t.conversation_id)||"",{messageId:(null==t?void 0:t.reply_id)||"",isLocalMessage:!1});if((0,p.trackEvent)("click_suggested_prompt",{bot_id:null==t?void 0:t.bot_id,message_id:null==t?void 0:t.message_id,click_position:s+1,conversation_id:null==t?void 0:t.conversation_id,suggested_type:"suggested_prompt",collection_id:(0,o.extractTeaCollectionIdFromMessage)(c).collection_id,...d?{previous_page:d}:{},web_show_method:"enter_chat",click_from:"direct"}),!i&&(null==k?void 0:k.chatType)===a.ChatType.Bot)return(0,g.getChatService)("chatNavigateService").then(e=>null==e?void 0:e.navigateToLoginPage("unlog_click_bot_onboarding")),_.DeprecatedChatEvent.emit("chat.guest.login",{bot:!0,source:"unlog_click_bot_onboarding"})},loading:h,message:t,suggests:I,className:S}):null}}}]);
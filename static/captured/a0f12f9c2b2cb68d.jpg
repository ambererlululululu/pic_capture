"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["64282"],{573966:function(e,a,i){i.d(a,{useEstablished:function(){return r}});var t=i(713738);let r=e=>{let a=(0,t.useRef)(e);return a.current=a.current||e,a.current}},442571:function(e,a,i){i.d(a,{isAttachmentNameReviewNotCompliant:function(){return s},isAttachmentParseFailed:function(){return l},isBotChat:function(){return o},isCocoBotType:function(){return c}});var t=i(845647),r=i(722038),n=i(773289);let o=e=>!!e&&[t.ChatType.Bot,t.ChatType.ProfileBot].includes(e);function l(e){return e===r.ParseState.ParseState_Failed}function s(e){return e===r.ReviewState.ReviewState_NotCompliant}let c=e=>e===n.BotType.Coco||e===n.BotType.CocoWeb},563953:function(e,a,i){i.d(a,{useCurrentChatBotId:function(){return o}});var t=i(442571),r=i(698392),n=i(212183);let o=()=>{var e;let{chatId:a,chatType:i}=null!==(e=(0,r.useChatSlice)("chatViewCoreStore").currentChatViewConfig)&&void 0!==e?e:{chatId:void 0,chatType:void 0};return(0,t.isBotChat)(i)?a:(0,n.getBotIdByConversationId)(a,!0)}},755317:function(e,a,i){i.d(a,{SimpleSearchResultContent:function(){return O}});var t=i(713738),r=i(865607),n=i(913821),o=i(750874),l=i(930750),s=i(226982),c=i(629006),d=i(674157),u=i(540498),h=i(563953),v=i(459046),S=i(119570),g=i(777210),p=i(83990),f=i(637319),m=i(698392),_=i(212183),C=i(588426),y=i(883393),T=i(334312),I=i(458524),x=i(165482),w=i(178230),A=i(598001),b=i(369105),k=i(674476),M=i(218164),B=i(78158),R=i(716919),E=i(345660);let D=[s.ContentType.SamanthaSearchCard,I.ContentType.Widget],L=e=>{var a,i,n,s;let{inView:d,searchType:h,message:g,isTextMessageFinished:p,searchReferenceData:f,enableOpenCanvas:_=!0,onTrackEvent:C,searchTagMeta:T,onReportMessageShowError:x}=e;if(!g)return null;let A=(0,c.isSearchErrorMessage)(g),[b,D]=(0,k.useSearchSkillStore)(e=>[e.canvasStatus,e.thirdPageSidePanel],r.shallow),{userSeleteStatus:L=!1}=null!=b?b:{},P=(0,t.useRef)(null),O=(0,c.isTextMessageWithDeepThiking)(g),N=!!(null==g?void 0:null===(a=g.content_obj)||void 0===a?void 0:a.text)||(0,c.isOnlyAladdinCardTextMessage)(g),W=!(null==g?void 0:null===(i=g.content_obj)||void 0===i?void 0:i.text)&&(0,c.isOnlyAladdinCardTextMessage)(g),j=(0,c.isDeepSearchMessage)(g)||(0,c.isAcademicSearchMessage)(g),F=(null==f?void 0:f.copilot)?f:null==f?void 0:f.search_result,{searchReferenceInAll:q}=(0,t.useMemo)(()=>{let{sources:e}=(0,o.getReferenceSources)(F,[]);return{searchReferenceInAll:e}},[f]),[V,U,H]=(0,m.useChatSlice)("chatViewCanvasStore",e=>[e.isExpand,e.matchedCanvasPluginIdentifier,e.messageId],r.shallow),J=O&&!(null==g?void 0:g.think_reason_is_hide),{onOpenSearchCanvas:G}=(0,l.useOpenSearchCanvas)({searchType:h,messageReplyId:null==g?void 0:g.reply_id,conversationId:null==g?void 0:g.conversation_id,isAutoOpen:L,isInSearch:!p,referenceInAll:q,referenceInUsed:[],useDeepThinking:O,isAutoOpenCanvasInNarrow:!0,onTrackEvent:C}),K=(0,y.useAppSizeType)({sm:400,md:800}),z="md"!==K&&"sm"!==K&&_&&"write-artifact-preview"!==U&&!(D.visible&&(null===(n=D.webviewInfo)||void 0===n?void 0:n.autoOpen));(0,t.useEffect)(()=>{O||(()=>{try{if(q&&q.length>0&&!p&&V&&z&&"receive-search-result-canvas"===U&&H!==(null==g?void 0:g.reply_id)){var e;G(),null==P||null===(e=P.current)||void 0===e||e.updateRedNoteStatus()}}catch(e){w.logger.persist.warning({eventName:"get_search_sider_status_error"})}})()},[q]);let Q=(0,t.useRef)(null);(0,S.useReportOnMessageShowError)({inView:d,reportOnInView:!0,enable:N,getElement:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.getRootElement()},checkMessageShowError:e=>(0,v.checkImagesShowError)({...e,hasImage:(0,c.isSimpleSearchImageWithTextMessage)(g),defaultNaturalHeight:192,defaultNaturalWidth:256}),onError:e=>null==x?void 0:x({...e,from:"search_receive_images"})});let X=(0,c.isSimpleSearchVideoWithTextMessage)(g),Y=null==g?void 0:null===(s=g.meta_infos)||void 0===s?void 0:s.some(e=>e.type===I.MetaType.WebDocReference);return(0,S.useReportOnMessageShowError)({enable:N,getElement:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.getRootElement()},checkMessageShowError:e=>{let{element:a,onError:i}=e;if(X){let e=!1,t=a.querySelectorAll("[data-testid=video-box-bg-image]");0===t.length?null==i||i({reason:"search_video_render_error"}):(t.forEach(a=>{let i=a.getAttribute("data-complete"),t=a.getAttribute("data-natural-width"),r=a.getAttribute("data-natural-height");"true"===i&&t&&Number(t)&&r&&Number(r)&&(e=!0)}),e||null==i||i({reason:"search_all_video_bg_image_load_error"}))}Y&&0===a.querySelectorAll("[data-testid=ref_content_circle]").length&&(null==i||i({reason:"search_ref_content_render_error"}))},onError:e=>null==x?void 0:x({...e,from:"search_receive_videos"})}),(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(B.SearchDeepThinkContent,{message:g,hidden:!J,searchType:h,onTrackEvent:C,searchReferenceData:f}),N&&(0,E.jsx)(u.MessageTextContent,{ref:Q,inView:d,message:g,messageBlockText:void 0,messageBlockTextBroken:void 0,messageBlockTextFinish:void 0,customRenderOptions:{enableCustomIndicator:j,...W?{overrideTextContent:""}:{}}}),(0,E.jsx)(M.SimpleSearchBottomContent,{ref:P,searchType:h,searchTagMeta:T,conversationId:g.conversation_id||"",searchReferenceData:f,enableOpenCanvas:_,onTrackEvent:C,message:g}),A&&(0,E.jsx)(R.SearchErrorContentUI,{message:g})]})},P=e=>{var a,i,t,r,o,l,s;let{message:c}=e,u=g.messageServiceContainer.get("chatTeaService"),S=(0,h.useCurrentChatBotId)(),{searchReferenceData:m,searchType:y,isTextMessageFinished:I,meta:w}=null!==(o=(0,p.useMessageStore)(e=>{var a,i,t,r,n;let o;let l=(0,f.findLastMessageByReplyIdSelector)(e,c.conversation_id||"",(null==c?void 0:c.reply_id)||""),s=(0,d.isMessageFinished)(c),u=(null==c?void 0:null===(a=c.content_obj)||void 0===a?void 0:a.search_references)||[],h={has_more:!1,query_params:{text_card:[{query:null!==(r=null==l?void 0:null===(i=l.content_obj)||void 0===i?void 0:i.text)&&void 0!==r?r:"",offset:0,search_type:"text_card",search_id:"",has_more:!0}]},queries:(null==c?void 0:null===(t=c.content_obj)||void 0===t?void 0:t.queries)||[],search_result:{text_card:{card_list:u.map(e=>e.text_card).filter(Boolean)},video_card:{card_list:u.map(e=>e.video_card).filter(Boolean)}},ext:{search_url_web:""}},v=A.SearchType.SimpleSearch;c&&(o=null===(n=(0,f.getSearchReplyMessagesSelector)(p.useMessageStore.getState(),c))||void 0===n?void 0:n.find(e=>(null==e?void 0:e.message_id)!==c.message_id&&!(0,d.isRegenerateMessage)(e)))&&(v=(0,b.getSearchType)(o));let{meta_infos:S=[]}=c||{};return{meta:S,message:c,searchType:v,isTextMessageFinished:s,searchReferenceData:(null==o?void 0:o.content_type)&&!D.includes(o.content_type)?o.content_obj:h}},n.default))&&void 0!==o?o:{},k=(0,x.parseJSON)(null!==(l=null==c?void 0:null===(a=c.ext)||void 0===a?void 0:a.search_tags)&&void 0!==l?l:"[]",[]),M=k.length?k:null!==(s=null==c?void 0:null===(i=c.content_obj)||void 0===i?void 0:i.tags)&&void 0!==s?s:[],B=null==m?void 0:null===(r=m.query_params)||void 0===r?void 0:null===(t=r.text_card)||void 0===t?void 0:t.map(e=>{var a;return null!==(a=e.query)&&void 0!==a?a:""}).filter(Boolean);return{meta:w,searchType:y,searchReferenceData:m,isTextMessageFinished:I,searchTagMeta:{tagList:M,queryTextList:B},botId:S,onTrackEvent:(e,a)=>{var i,t;let r=(0,f.findLastMessageByReplyIdSelector)(p.useMessageStore.getState(),c.conversation_id||"",c.reply_id||"");null==u||u.trackEvent(e,{bot_id:S,message_id:String(null==c?void 0:c.message_id),chat_type:(0,_.getChatTypeForTea)("",c.conversation_id||""),conversation_id:c.conversation_id||"",conversation_type:(0,C.getConversationTypeById)(c.conversation_id||""),skill_id:null==r?void 0:null===(i=r.skill)||void 0===i?void 0:i.skill_id_no_default,skill_name:(0,T.getSkillTeaNameByType)(null==r?void 0:null===(t=r.skill)||void 0===t?void 0:t.skill_type_no_default),search_type:y,...a})},onReportMessageShowError:e=>{let{reason:a}=e;(0,v.reportMessageShowError)({message:c,reason:a})}}};function O(e){let{inView:a,message:i,enableOpenCanvas:t=!0}=e;if(!i)return null;let{meta:r,searchType:n,searchReferenceData:o,isTextMessageFinished:l,searchTagMeta:s,onTrackEvent:c,onReportMessageShowError:d}=P({message:i});return(0,E.jsx)(L,{meta:r,inView:a,searchTagMeta:s,message:i,searchReferenceData:o,isTextMessageFinished:l,searchType:n,enableOpenCanvas:t,onTrackEvent:c,onReportMessageShowError:d})}},218164:function(e,a,i){i.d(a,{SimpleSearchBottomContent:function(){return v}});var t=i(713738),r=i(865607),n=i(47732),o=i(666196),l=i(674157),s=i(629006),c=i(805009);let d=()=>null;var u=i(674476),h=i(345660);let v=(0,t.forwardRef)(function(e,a){var i;let{searchType:v,conversationId:S,searchReferenceData:g,enableOpenCanvas:p=!0,onTrackEvent:f,message:m}=e,_=(0,o.useChatService)("chatViewService"),[C,y]=(0,u.useSearchSkillStore)(e=>[e.thirdPageSidePanel,e.updateThirdPageSidePanel],r.shallow),T=(0,l.isMessageFinished)(m),I=(0,s.isBrokenMessage)(m),x=(0,s.isTextMessageWithDeepThiking)(m),w=(null==g?void 0:g.copilot)?g:null==g?void 0:g.search_result,A=(0,c.checkIsAllowVersion)(),b=()=>{(null==C?void 0:C.visible)&&y({...C,visible:!1})};return(0,t.useImperativeHandle)(a,()=>({updateRedNoteStatus:b}),[]),(0,t.useEffect)(()=>{(null==C?void 0:C.visible)&&C.webviewInfo&&_.closeCanvasPanel()},[C]),(0,h.jsxs)("div",{children:[T&&!I&&(0,h.jsx)(n.SearchSiderBarBtn,{meta:null!==(i=null==m?void 0:m.meta_infos)&&void 0!==i?i:[],useDeepThinking:!!x,conversationId:S,messageReplyId:null==m?void 0:m.reply_id,enableOpenCanvas:p,onClick:e=>{u.useSearchSkillStore.getState().updateSearchCanvasStatus({status:e}),b()},onTrackEvent:f,referenceInAll:w,searchType:v}),A?(0,h.jsx)(d,{message:m}):null]})})},598001:function(e,a,i){var t;i.d(a,{SearchType:function(){return r}});let r=((t={}).AISearch="ai_search",t.DeepSearch="deep_search",t.AcademicSearch="academic_search",t.WritingOutlineSearch="writing_outline_search",t.ComplexSearch="complex_search",t.SimpleSearch="simple_search",t)},674476:function(e,a,i){i.d(a,{useSearchSkillStore:function(){return v}});var t,r=i(952259),n=i(321647),o=i(746479),l=i(524129),s=i(910214),c=i(643404),d=i(178230);let u=((t={}).SearchReference="search_reference",t.EngineSearch="engine_search",t),h={currentActiveSearchSkill:l.SkillType.Search,deepSearchConfigLoading:!1,isDeepSearchConfigInited:!1,deepSearchConfig:[],receiveFirstTextMessage:{},messageIdToSearchSiderBarWithConvId:{},canvasStatus:{userSeleteStatus:!1},aiSearchConfigLoading:!1,aiSearchConfig:[],isAISearchConfigInited:!1,academicSearchConfigLoading:!1,academicSearchConfig:{},isAcademicSearchConfigInited:!1,newsConfigs:{onBoardingNewsCardStatus:!1,newsTabs:void 0,subscribedTags:void 0},thirdPageSidePanel:{visible:!1,webviewInfo:{pageId:0}}},v=(0,n.create)()((0,r.subscribeWithSelector)((e,a)=>({...h,updateActiveSearchValue:a=>{e((0,o.produce)(e=>{e.currentActiveSearchSkill=a}))},updateReceiveFirstTextMessage:(a,i)=>{e((0,o.produce)(e=>{e.receiveFirstTextMessage[a]=i}))},getReceiveFirstTextMessageStatus:e=>{var i,t;return null!==(t=null===(i=a().receiveFirstTextMessage)||void 0===i?void 0:i[e])&&void 0!==t&&t},updateSearchSiderBarData:a=>{let{type:i,data:t,messageId:r,conversationId:n}=a;e((0,o.produce)(e=>{var a,o;e.messageIdToSearchSiderBarWithConvId[n]||(e.messageIdToSearchSiderBarWithConvId[n]={});let l=null!==(o=null===(a=e.messageIdToSearchSiderBarWithConvId[n])||void 0===a?void 0:a[r])&&void 0!==o?o:{},s=e.messageIdToSearchSiderBarWithConvId[n];i===u.SearchReference&&(e.messageIdToSearchSiderBarWithConvId={[n]:{...s,[r]:{...l,searchReferenceInUse:t}}})}))},updateSearchCanvasStatus:a=>{let{status:i}=a;e((0,o.produce)(e=>{e.canvasStatus={userSeleteStatus:i}}))},getSearchCanvasStatus:()=>a().canvasStatus,initDeepSearchConfigList:async()=>{try{if(a().isDeepSearchConfigInited)return;e((0,o.produce)(e=>{e.deepSearchConfigLoading=!0}));let{data:i}=await s.samanthaApiService.SkillPack({skill_type:l.SkillType.DeepSearch});e((0,o.produce)(e=>{var a,t,r,n;i&&(e.deepSearchConfigLoading=!1,e.isDeepSearchConfigInited=!0),(null==i?void 0:null===(t=i.deep_search)||void 0===t?void 0:null===(a=t.template)||void 0===a?void 0:a.items)&&(e.deepSearchConfig=null==i?void 0:null===(n=i.deep_search)||void 0===n?void 0:null===(r=n.template)||void 0===r?void 0:r.items)}))}catch(e){d.logger.persist.warning({eventName:"init_deep_search_list_error"})}},updateAISearchConfigLoadingStatus:function(){let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e((0,o.produce)(e=>{e.aiSearchConfigLoading=a}))},initAISearchConfigList:async function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{if(a().isAISearchConfigInited&&!i)return!0;e((0,o.produce)(e=>{e.aiSearchConfigLoading=!0}));let{data:t,code:r}=await (0,c.retryAsync)(()=>s.samanthaApiService.SkillPack({skill_type:l.SkillType.Search}),3,e=>1e3*e);if(e((0,o.produce)(e=>{var a,i,r,n,o,l,s,c,d,u,h,v;t&&(e.aiSearchConfigLoading=!1,e.isAISearchConfigInited=!0),(null==t?void 0:null===(i=t.search)||void 0===i?void 0:null===(a=i.template)||void 0===a?void 0:a.items)&&(e.aiSearchConfig=t.search.template.items),(null==t?void 0:null===(r=t.search)||void 0===r?void 0:r.meta)&&(e.newsConfigs={onBoardingNewsCardStatus:null!==(u=null==t?void 0:null===(o=t.search)||void 0===o?void 0:null===(n=o.meta)||void 0===n?void 0:n.open_onboarding)&&void 0!==u&&u,newsTabs:null!==(h=null==t?void 0:null===(s=t.search)||void 0===s?void 0:null===(l=s.meta)||void 0===l?void 0:l.news_tags)&&void 0!==h?h:[],subscribedTags:null!==(v=null==t?void 0:null===(d=t.search)||void 0===d?void 0:null===(c=d.meta)||void 0===c?void 0:c.subscribed_tags)&&void 0!==v?v:[]})})),0===r)return!0;return!1}catch(a){return d.logger.persist.warning({eventName:"init_ai_search_list_error"}),e((0,o.produce)(e=>{e.aiSearchConfigLoading=!1})),!1}},updateThirdPageSidePanel:a=>{e((0,o.produce)(e=>{e.thirdPageSidePanel=a}))},initAcademicSearchConfigList:async()=>{try{if(a().isAcademicSearchConfigInited)return;e((0,o.produce)(e=>{e.academicSearchConfigLoading=!0}));let{data:i}=await s.samanthaApiService.SkillPack({skill_type:l.SkillType.AcademicSearch});e((0,o.produce)(e=>{i&&(e.academicSearchConfigLoading=!1,e.isAcademicSearchConfigInited=!0),(null==i?void 0:i.academic_search)&&(e.academicSearchConfig=null==i?void 0:i.academic_search)}))}catch(e){d.logger.persist.warning({eventName:"init_academic_search_list_error"})}}})))},369105:function(e,a,i){i.d(a,{batchTransformAcademicSearchPreviewIndex:function(){return S},batchTransformAcademicSearchRefIndex:function(){return v},getSearchType:function(){return c},isAISearchGuidancePageShowSucc:function(){return l},isAcademicSearchGuidancePageShowSucc:function(){return s},isAcademicSearchPreviewMetaInfo:function(){return u},isAcademicSearchRefMetaInfo:function(){return d},judgmentArraysEquals:function(){return g}});var t=i(629006),r=i(458524),n=i(848095),o=i(598001);let l=()=>"undefined"!=typeof document&&!!document.querySelector('[data-testid="search-guidance-page-show"]'),s=()=>"undefined"!=typeof document&&!!document.querySelector('[data-testid="academic-guidance-page-show"]'),c=(e,a)=>{let i=(0,t.isDeepSearchLoading)(e)||(0,t.isDeepSearchMessage)(e),r=(0,t.isAcademicSearchLoading)(e)||a,n=(0,t.isWritingOutlineSearchLoading)(e)||(0,t.isWritingOutlineSearchMessage)(e),l=(0,t.isComplexSearchMessage)(e);return i?o.SearchType.DeepSearch:r?o.SearchType.AcademicSearch:n?o.SearchType.WritingOutlineSearch:l?o.SearchType.ComplexSearch:o.SearchType.AISearch},d=e=>e.type===r.MetaType.WebAcademicReference,u=e=>e.type===r.MetaType.WebAcademicPreview,h=e=>{var a,i,t,r,n;return(null==e?void 0:null===(a=e.paper)||void 0===a?void 0:a.title)?{...e,paper:{...e.paper,unique_id:e.paper.title.concat(null!==(n=null===(r=e.paper)||void 0===r?void 0:null===(t=r.authors)||void 0===t?void 0:null===(i=t[0])||void 0===i?void 0:i.name)&&void 0!==n?n:"")}}:e},v=(e,a,i)=>a.map(a=>{var t,r;let o=h(a.data);return{...a,data:{...o,index:(0,n.convertUnicodeIndexToStringIndex)(e,o.index),...i&&i.length>0?{paper:JSON.parse(null!==(r=null===(t=i.find(e=>e.index===o.citation_index))||void 0===t?void 0:t.info)&&void 0!==r?r:"{}")}:{}}}}),S=(e,a,i)=>a.map(a=>{var t,r;let o=h(a.data);return{...a,data:{...o,index:(0,n.convertUnicodeIndexToStringIndex)(e,o.index),...i&&i.length>0?{paper:JSON.parse(null!==(r=null===(t=i.find(e=>e.index===o.citation_index))||void 0===t?void 0:t.info)&&void 0!==r?r:"{}")}:{}}}}),g=(e,a)=>0===e.length&&0===a.length||e.length===a.length&&(e.forEach(e=>{let i=a.findIndex(a=>a===e);if(-1===i)return!1;a.splice(i,1)}),0===a.length)}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["78518"],{573966:function(e,t,n){n.d(t,{useEstablished:function(){return o}});var r=n(713738);let o=e=>{let t=(0,r.useRef)(e);return t.current=t.current||e,t.current}},119570:function(e,t,n){n.d(t,{useReportOnMessageShowError:function(){return i}});var r=n(713738),o=n(580622);let i=e=>{let{inView:t,reportOnInView:n,getElement:i,enable:l=!0,checkMessageShowError:a,onError:s}=e,u=(0,o.default)(l),d=(0,o.default)(a),c=(0,o.default)(s),v=(0,r.useRef)(t);v.current=v.current||t,(0,r.useLayoutEffect)(()=>()=>{var e,t;if(!u.current)return;let r=i();if(!r){null===(e=c.current)||void 0===e||e.call(c,{reason:"element_mount_error"});return}(v.current||!n)&&(null===(t=d.current)||void 0===t||t.call(d,{element:r,onError:c.current}))},[])}},442571:function(e,t,n){n.d(t,{isAttachmentNameReviewNotCompliant:function(){return s},isAttachmentParseFailed:function(){return a},isBotChat:function(){return l},isCocoBotType:function(){return u}});var r=n(845647),o=n(722038),i=n(773289);let l=e=>!!e&&[r.ChatType.Bot,r.ChatType.ProfileBot].includes(e);function a(e){return e===o.ParseState.ParseState_Failed}function s(e){return e===o.ReviewState.ReviewState_NotCompliant}let u=e=>e===i.BotType.Coco||e===i.BotType.CocoWeb},503124:function(e,t,n){n.d(t,{getArtifactDataByBlockMessage:function(){return u},getArtifactDataByMessage:function(){return s}});var r=n(217957),o=n(82760),i=n(68989),l=n(629006),a=n(848095);let s=e=>{var t,n,i,s,u,d;if(null==e?void 0:null===(t=e.content_blocks)||void 0===t?void 0:t.length){let t=e.content_blocks.find(e=>e.block_type===o.ContentType.BLOCK_ARTIFACT);if(!t)return;return{...null==t?void 0:t.content_obj,artifactId:null==t?void 0:null===(n=t.content_obj)||void 0===n?void 0:n.artifact_topic,artifactKey:null==t?void 0:null===(i=t.content_obj)||void 0===i?void 0:i.artifact_version_id,resourceId:null==t?void 0:null===(s=t.content_obj)||void 0===s?void 0:s.resource_id,resourceType:null==t?void 0:null===(u=t.content_obj)||void 0===u?void 0:u.resource_type,createTime:Number(null==e?void 0:e.create_time)>1e10?Math.floor(Number(null==e?void 0:e.create_time)/1e3):Number(null==e?void 0:e.create_time),isStreaming:!(null==e?void 0:e.is_finish)}}if(!(0,l.isWriteArtifactMessage)(e))return;let{artifact_meta:c,text:v=""}=null!==(d=e.content_obj)&&void 0!==d?d:{},{offset:_,title:f="",intention:g,identifier:h,meeting_minutes:m,artifact_id:p,artifact_key:y,create_time:k,resource_id:S,resource_type:T,resource_version:C}=null!=c?c:{},M=_&&!(0,r.default)(null==_?void 0:_.start)?(0,a.convertUnicodeIndexToStringIndex)(v,_.start):void 0,x=_&&!(0,r.default)(null==_?void 0:_.end)?(0,a.convertUnicodeIndexToStringIndex)(v,_.end):void 0;return{title:f,content:v.slice(M,x),isStreaming:!(null==_?void 0:_.end),offset:_&&{start:M,end:x},intention:g,identifier:h,artifactId:p,artifactKey:y,createTime:k,resourceId:S,resourceType:T,resourceVersion:C,meeting_minutes:m}},u=e=>{var t,n;if(!(0,l.isDeepResearchBlockMessage)(e))return;let r=null==e?void 0:null===(n=e.content_blocks)||void 0===n?void 0:null===(t=n.find(e=>e.block_type===o.ContentType.BLOCK_RESEARCH))||void 0===t?void 0:t.content_obj,{title:a,resource_id:s,artifact:u,status:d}=null!=r?r:{},{artifact_id:c,artifact_key:v,resource_id:_,resource_type:f}=null!=u?u:{};return{title:a,content:"",isStreaming:d===i.Status.PROCESSING,artifactId:c,artifactKey:v,resourceId:null!=_?_:s,resourceType:f}}},459046:function(e,t,n){n.d(t,{checkImagesShowError:function(){return l},reportMessageShowError:function(){return i}});var r=n(178230),o=n(83990);let i=e=>{var t,n,i,l,a,s;let{message:u,reason:d,error:c,from:v,meta:_}=e,f=null!=c?c:Error(d),g={success:"0",reason:d,content_type:String(null!==(i=null==u?void 0:u.content_type)&&void 0!==i?i:"unknown"),skill_id:String(null!==(l=null==u?void 0:null===(t=u.skill)||void 0===t?void 0:t.skill_id)&&void 0!==l?l:"generic"),message_from:null!==(a=null==u?void 0:null===(n=u.local_info)||void 0===n?void 0:n.from)&&void 0!==a?a:"unknown",user_type:String(null!==(s=null==u?void 0:u.user_type)&&void 0!==s?s:"unknown"),conversation_id:null==u?void 0:u.conversation_id,message_id:null==u?void 0:u.message_id,conversation_type:String(null==u?void 0:u.conversation_type),from:v||"unknown",..._},h=null==u?void 0:u.message_id;if(o.useMessageStore.getState().checkMessageShowErrorHasReported({messageId:h})){r.logger.console.error({eventName:"message_show_error_duplicate",error:f,meta:g});return}o.useMessageStore.getState().updateMessageShowErrorHasReported({messageId:h}),r.logger.persist.error({eventName:"message_show_error",error:f,meta:g})},l=e=>{let{element:t,hasImage:n=!1,defaultNaturalWidth:r=256,defaultNaturalHeight:o=192,onError:i}=e;if(n){let e=t.querySelectorAll("[data-testid=mdbox_image] picture");if(0===e.length)null==i||i({reason:"images_render_error"});else{let t=!1;e.forEach(e=>{let n=e.querySelector("img");(null==n?void 0:n.complete)&&n.naturalWidth&&n.naturalHeight&&(n.naturalWidth!==r||n.naturalHeight!==o)&&(t=!0)}),t||null==i||i({reason:"all_images_load_error"})}}}},563953:function(e,t,n){n.d(t,{useCurrentChatBotId:function(){return l}});var r=n(442571),o=n(698392),i=n(212183);let l=()=>{var e;let{chatId:t,chatType:n}=null!==(e=(0,o.useChatSlice)("chatViewCoreStore").currentChatViewConfig)&&void 0!==e?e:{chatId:void 0,chatType:void 0};return(0,r.isBotChat)(n)?t:(0,i.getBotIdByConversationId)(t,!0)}},600228:function(e,t,n){n.d(t,{checkCanvasDocCardShowError:function(){return c},getArtifactByMessage:function(){return s},isArtifactOpenedByMessageId:function(){return u},isCanvasNewContentMode:function(){return d}});var r=n(218679),o=n(629006),i=n(503124),l=n(698392),a=n(18905);let s=e=>{var t,n,r;if(!e||!(0,o.isWriteArtifactMessage)(e))return;let l=null===(t=e.content_obj)||void 0===t?void 0:t.artifact_meta;if((0,o.isSharedMessage)(e))return{...l,content:String(null==e?void 0:null===(n=e.content_obj)||void 0===n?void 0:n.text)};let{content:a}=null!==(r=(0,i.getArtifactDataByMessage)(e))&&void 0!==r?r:{};return{...l,content:a}},u=e=>{var t;let{conversationId:n,messageId:o}=e,{isExpand:i,canvasContent:s={}}=(0,l.getChatSlice)("chatViewCanvasStore"),{artifacts:u,artifactKey:d}=s;return!!(u&&d&&o&&(0,r.default)(d))&&i&&(null===(t=(0,a.getActiveTargetByArtifactKey)({conversationId:null!=n?n:"",artifacts:u,artifactKey:d}))||void 0===t?void 0:t.messageId)===o},d=()=>{let{canvasContent:e={}}=(0,l.getChatSlice)("chatViewCanvasStore"),{newContentMode:t,artifactId:n}=e;return!!t||"human-created"===n},c=e=>{let{hasCanvasDocCard:t,element:n,onError:r}=e;if(!t)return;if(0===n.querySelectorAll("[data-testid=control_bar_action_item]").length){null==r||r({reason:"doc_card_control_bar_error"});return}let o=n.querySelector("[data-testid=flow_doc_editor]");o?o.textContent?o instanceof HTMLDivElement&&!o.innerText&&(null==r||r({reason:"doc_card_inner_text_null"})):null==r||r({reason:"doc_card_text_content_null"}):null==r||r({reason:"doc_card_mount_error"})}},101744:function(e,t,n){n.d(t,{WriteDeepThink:function(){return g}});var r=n(713738),o=n(218679),i=n(750874),l=n(744322),a=n(629006),s=n(674157),u=n(456712),d=n(459046),c=n(119570),v=n(971210),_=n(459388),f=n(345660);let g=e=>{var t,n,g,h,m;let{hidden:p=!1,isShare:y,message:k}=e;if(!k)return null;let{message_id:S="",conversation_id:T="",reply_id:C="",bot_id:M=""}=k,x=!p&&!(null==k?void 0:k.think_reason_is_hide)&&((0,a.isTextMessageWithDeepThiking)(k)||(0,a.isWriteMessageWithDeepThinking)(k)),b=(0,a.isBrokenMessage)(k),E=(0,s.isMessageFinished)(k),{trackEvent:w}=(0,_.useThinkTrack)({message:k}),{meta_infos:B=[]}=k||{},{searchReferenceData:I}=null!==(m=(0,_.useReferenceData)({message:k}))&&void 0!==m?m:{},{searchReferenceData:D}=(0,_.useSimpleWriteContentDataPure)(k),R=y?null==D?void 0:D.search_result:null==I?void 0:I.search_result,A=(0,u.getDeepThinkStatusFromExt)(null==k?void 0:k.ext),j=null==k?void 0:null===(t=k.content_obj)||void 0===t?void 0:t.text,W=null==k?void 0:null===(n=k.content_obj)||void 0===n?void 0:n.think,O=(0,o.default)(j)?j:"",L=(0,o.default)(W)?W:"",N=(0,v.useComputeValue)(()=>{var e,t,n;let r=!1,o="",{text:i=""}=null!==(n=null==k?void 0:null===(e=k.loading_state)||void 0===e?void 0:e.current_state)&&void 0!==n?n:{};return{isInSearchLoading:r=null!=k&&null!==(t=k.loading_state)&&void 0!==t&&!!t.in_loading&&!A&&!b,loadingTitle:i}}),q=(0,r.useRef)(null);return((0,c.useReportOnMessageShowError)({enable:!!x,getElement:()=>q.current,checkMessageShowError:e=>(0,i.checkDeepThinkingShowError)(e),onError:e=>(0,d.reportMessageShowError)({...e,message:k,from:"write_receive_deep_thinking"})}),x)?(0,f.jsx)(l.DeepThinkingContent,{ref:q,meta:B,forceCloseCanvas:!0,isShare:y,searchType:"writing",content:L,botId:M,options:N,references:R,messageText:O,thinkExpandStatus:!0,onTrackEvent:w,conversationId:T,messageId:S,messageReplyId:C,isThinkingBroken:A,isThinkingFinished:!!L&&!!O&&!A||E,skillId:null==k?void 0:null===(g=k.skill)||void 0===g?void 0:g.skill_id_no_default,skillType:null==k?void 0:null===(h=k.skill)||void 0===h?void 0:h.skill_type_no_default}):null}},665027:function(e,t,n){n.d(t,{LazyCanvasDocXCard:function(){return d},useReplacementArtifactElements:function(){return c}});var r=n(713738),o=n(775012),i=n(503124),l=n(559891),a=n(643404),s=n(345660);let u=(0,l.withSuspense)(r.lazy(()=>(0,a.retryLoadWithFallBack)({fn:async()=>{let{CanvasDocCard:e}=await Promise.all([n.e("42431"),n.e("97688"),n.e("1102"),n.e("39174"),n.e("26829"),n.e("67885"),n.e("42530"),n.e("16262"),n.e("11675"),n.e("70269"),n.e("79817"),n.e("49789"),n.e("24901"),n.e("3881"),n.e("52791"),n.e("89990"),n.e("21769"),n.e("89986"),n.e("6180"),n.e("60216"),n.e("39322"),n.e("15832"),n.e("12869"),n.e("16564"),n.e("58192"),n.e("86703"),n.e("30113"),n.e("75996"),n.e("99023"),n.e("45994"),n.e("90943"),n.e("86660"),n.e("32096"),n.e("32055"),n.e("68823"),n.e("12225"),n.e("47076"),n.e("48251")]).then(n.bind(n,547706));return{default:e}}}))),d=(0,l.withSuspense)(r.lazy(()=>(0,a.retryLoadWithFallBack)({fn:async()=>{let{CanvasDocXCard:e}=await Promise.all([n.e("42530"),n.e("70269"),n.e("49789"),n.e("24901"),n.e("99811"),n.e("24357"),n.e("13065"),n.e("55498"),n.e("30113"),n.e("75996"),n.e("99023"),n.e("90943"),n.e("86660"),n.e("96910"),n.e("68823"),n.e("85056"),n.e("50487")]).then(n.bind(n,87310));return{default:e}}}))),c=e=>{let{message:t,autoOpenCanvas:n,onCollapse:l,options:a={}}=e,{isShare:c=!1,onOpenDoc:v}=a,_=(0,r.useMemo)(()=>(0,i.getArtifactDataByMessage)(t),[t]);if(!_)return[];let{offset:f,intention:g,identifier:h,artifactId:m,artifactKey:p,resourceType:y}=_,k=null!=m?m:h;if(!f||!t)return[];let{start:S,end:T}=f;return[{range:[null!=S?S:0,null!=T?T:1/0],type:"block",render:()=>y===o.ArtifactResourceType.CanvasPages?(0,s.jsx)(d,{message:t,artifact:_,autoOpenCanvas:n,shareMode:c,onCollapse:l,onOpenDoc:v}):"write"===g?(0,s.jsx)(u,{artifactId:null!=k?k:"",artifactKey:p,message:t,onCollapse:l,autoOpenCanvas:n,shareMode:c,onOpenDoc:v}):void 0}]}},925413:function(e,t,n){n.d(t,{TextMessageBox:function(){return y}});var r=n(713738),o=n(762707),i=n(629006),l=n(540498),a=n(459046),s=n(503124),u=n(119570),d=n(178230),c=n(665027),v=n(47732),_=n(674157),f=n(459388),g=n(345660);let h=e=>{var t,n,r,o;let{message:l,hidden:a=!1,isWithThink:s=!1,classname:u,enableOpenCanvas:d}=e,c=!s||!(null==l?void 0:l.think_reason_is_hide)&&((0,i.isTextMessageWithDeepThiking)(l)||(0,i.isWriteMessageWithDeepThinking)(l)),h=(0,_.isMessageFinished)(l),m=(0,i.isBrokenMessage)(l),{meta_infos:p=[]}=l||{},{searchReferenceData:y}=null!==(o=(0,f.useReferenceData)({message:l,conversationId:(null==l?void 0:l.conversation_id)||""}))&&void 0!==o?o:{},{trackEvent:k}=(0,f.useThinkTrack)({message:l});return!a&&h&&c&&!m?(0,g.jsx)(v.SearchSiderBarBtn,{classname:u,meta:p,query:(null==y?void 0:null===(r=y.query_params)||void 0===r?void 0:null===(n=r.text_card)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.query)||"",conversationId:(null==l?void 0:l.conversation_id)||"",messageReplyId:null==l?void 0:l.reply_id,onTrackEvent:k,referenceInAll:null==y?void 0:y.search_result,enableOpenCanvas:d,searchType:"writing"}):null};var m=n(101744),p=n(600228);let y=e=>{var t,n;let{message:v,inView:_,autoOpenCanvas:f,actionsModifier:y,onCollapse:k,customRenderOptions:S,showSimplifyCard:T,referenceCardParams:C,onOpenDoc:M}=e,x=(0,i.isWriteArtifactMessage)(v),b=null==v?void 0:null===(t=v.content_obj)||void 0===t?void 0:t.artifact_meta,E=!!(null==v?void 0:null===(n=v.content_obj)||void 0===n?void 0:n.text),w=(0,r.useRef)(null),B=(0,r.useMemo)(()=>(0,s.getArtifactDataByMessage)(v),[v]),{identifier:I,artifactId:D}=null!=B?B:{},R=null!=D?D:I;return(0,u.useReportOnMessageShowError)({inView:_,reportOnInView:!0,enable:!!E,getElement:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.getRootElement()},checkMessageShowError:e=>(0,p.checkCanvasDocCardShowError)({...e,hasCanvasDocCard:E&&!!R}),onError:e=>(0,a.reportMessageShowError)({...e,message:v,from:"write_receive_canvas_doc_card"})}),(0,r.useEffect)(()=>{d.logger.persist.log({eventName:"doc_text_message_mount",meta:{...(0,o.default)(b,["resource_type","artifact_key","resource_id"]),...(0,o.default)(v,"message_id")}})},[]),(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(m.WriteDeepThink,{message:v}),E&&(0,g.jsx)(l.MessageTextContent,{ref:w,inView:_,message:v,messageBlockText:void 0,messageBlockTextFinish:void 0,messageBlockTextBroken:void 0,customRenderOptions:{useCustomReplacementElements:()=>(0,c.useReplacementArtifactElements)({message:v,actionsModifier:y,autoOpenCanvas:f,onCollapse:k,options:{onOpenDoc:M,showSimplifyCard:T}}),...S}}),(0,g.jsx)(h,{isWithThink:!0,message:v,hidden:x&&!!b,...C})]})}},459388:function(e,t,n){n.d(t,{useReferenceData:function(){return T},useSimpleWriteContentDataPure:function(){return S},useThinkTrack:function(){return C}});var r=n(605173),o=n(293556),i=n(673446),l=n(218679),a=n(217957),s=n(907929),u=n(204418),d=n(229079),c=n(563953),v=n(83990),_=n(637319),f=n(777210),g=n(212183),h=n(588426),m=n(334312);let p=e=>(0,r.default)(e)&&(0,o.default)(e,e=>e.video_card||e.text_card),y=e=>(0,r.default)(e)&&(0,i.default)(e,e=>(0,l.default)(e)),k=e=>(0,r.default)(e)&&(0,i.default)(e,e=>!(0,a.default)(e)),S=e=>{var t;let n=null==e?void 0:null===(t=e.content_obj)||void 0===t?void 0:t.search_references,r=p(n)?n:[],o=(0,s.default)((0,u.default)(r,e=>e.text_card),e=>!(0,a.default)(e)),i=k(o)?o:[],l=(0,s.default)((0,u.default)(r,e=>e.video_card),e=>!(0,a.default)(e));return{searchReferenceData:{has_more:!1,query_params:{},search_result:{text_card:{card_list:i},video_card:{card_list:k(l)?l:[]}},ext:{search_url_web:""}},searchReferences:r}},T=e=>{let{message:t}=e;return(0,v.useMessageStore)(e=>{var n,r,o,i,c,v;let f=(0,_.getMessageByIdSelector)(e,(null==t?void 0:t.conversation_id)||"",null!==(v=null==t?void 0:t.reply_id)&&void 0!==v?v:""),g=(0,d.default)(t,"content_obj.search_card.search_references",[]),h=(null==t?void 0:null===(n=t.content_obj)||void 0===n?void 0:n.search_references)||g,m=p(h)?h:[],S=(0,l.default)(null==f?void 0:null===(r=f.content_obj)||void 0===r?void 0:r.text)?null==f?void 0:null===(o=f.content_obj)||void 0===o?void 0:o.text:"",T=y(null==t?void 0:null===(i=t.content_obj)||void 0===i?void 0:i.queries)?null==t?void 0:null===(c=t.content_obj)||void 0===c?void 0:c.queries:[],C=(0,s.default)((0,u.default)(m,e=>e.text_card),e=>!(0,a.default)(e)),M=k(C)?C:[],x=(0,s.default)((0,u.default)(m,e=>e.video_card),e=>!(0,a.default)(e));return{searchReferenceData:{has_more:!1,query_params:{text_card:[{query:S,offset:0,search_type:"text_card",search_id:"",has_more:!0}]},queries:T,search_result:{text_card:{card_list:M},video_card:{card_list:k(x)?x:[]}},ext:{search_url_web:""}}}})},C=e=>{let{message:t}=e,n=f.messageServiceContainer.get("chatTeaService"),r=(0,c.useCurrentChatBotId)();return{trackEvent:(e,o)=>{var i,l;if(!t)return;let{conversation_id:a="",reply_id:s="",message_id:u=""}=t,d=(0,_.getMessageSelector)(v.useMessageStore.getState(),a,{isLocalMessage:!1,messageId:s});null==n||n.trackEvent(e,{bot_id:r,message_id:String(u),chat_type:(0,g.getChatTypeForTea)("",a),conversation_id:a,conversation_type:(0,h.getConversationTypeById)(a),skill_id:null==d?void 0:null===(i=d.skill)||void 0===i?void 0:i.skill_id_no_default,skill_name:(0,m.getSkillTeaNameByType)(null==d?void 0:null===(l=d.skill)||void 0===l?void 0:l.skill_type_no_default),...o})}}}},910663:function(e,t,n){n.d(t,{ArtifactResourceType:function(){return o},ArtifactUnionResourceType:function(){return i}});var r=n(358730);let{ArtifactResourceType:o}=n(917756),{ArtifactResourceType:i}=r}}]);
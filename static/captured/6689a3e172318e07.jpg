"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["60437"],{870693:function(e,t,r){r.d(t,{retryLoad:function(){return i}});let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;return new Promise((n,a)=>{e().then(n).catch(o=>{setTimeout(()=>{if(1===t){a(o);return}i(e,t-1,r).then(n,a)},r)})})}},371241:function(e,t,r){function i(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,{ChatBotService:function(){return n},createChatBotService:function(){return a}});class n{init(e){let{useBotInfoHook:t,actions:r}=e;this._actions=r,this._useBotInfoHook=t}updateBot(e){var t;return null===(t=this._actions)||void 0===t?void 0:t.updateBot(e)}getBot(e){var t;return null===(t=this._actions)||void 0===t?void 0:t.getBot(e)}getBotIdFromLocalConversation(e){var t;return null===(t=this._actions)||void 0===t?void 0:t.getBotIdFromLocalConversation(e)}getBotIdToLocalConversationMap(){var e;return null===(e=this._actions)||void 0===e?void 0:e.getBotIdToLocalConversationMap()}getBotIdToRequestIdMap(){var e;return null===(e=this._actions)||void 0===e?void 0:e.getBotIdToRequestIdMap()}setLocalConversationIdForBot(e){var t;return null===(t=this._actions)||void 0===t?void 0:t.setLocalConversationIdForBot(e)}initRecommendBotList(e){var t;return null===(t=this._actions)||void 0===t?void 0:t.initRecommendBotList(e)}useBotInfoHook(e){var t;return null===(t=this._useBotInfoHook)||void 0===t?void 0:t.call(this,e)}constructor(){i(this,"ctx",void 0),i(this,"_actions",void 0),i(this,"_useBotInfoHook",void 0)}}let a=e=>{let t=new n;return t.init(e),t}},634046:function(e,t,r){r.r(t),r.d(t,{ChatInputCoreService:function(){return n},chatInputCoreServiceContainer:function(){return a},createChatInputCoreService:function(){return o}});var i=r(430896);class n{constructor(){var e,t,r;t=void 0,(e="symbol"==typeof(r=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e="ctx","string"))?r:r+"")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t}}let a=(0,i.createServiceContainer)(),o=()=>(a.service||(a.service=new n),a.service)},379520:function(e,t,r){r.d(t,{DefaultChatInputService:function(){return n}});var i=r(154635);class n{focusOnEditor(){i.defaultChatInputController.focusOnInput()}updateEditorValue(){}clearEditorValue(){}}},6917:function(e,t,r){r.r(t),r.d(t,{ChatInputService:function(){return w},chatInputServiceContainer:function(){return E},createChatInputService:function(){return x}});var i=r(386827),n=r(713738),a=r(395847),o=r(217957),c=r(251913),u=r(430896),l=r(698392),s=r(689368),d=r(922851),v=r(389174),h=r(721118),f=r(230932),S=r(204454),p=r(915299),g=r(201272),C=r(870693),m=r(124267),y=r(379520),I=r(345660);function _(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let b=(0,n.lazy)(()=>(0,C.retryLoad)(()=>r.e("70468").then(r.bind(r,757231)).then(e=>({default:e.TextareaWidthMeasure}))));class w{async getAsrService(){if(!this.asrService){let{ChatAsrService:e}=await (0,C.retryLoad)(()=>Promise.all([r.e("42530"),r.e("78568"),r.e("38227")]).then(r.bind(r,982732)));this.asrService=new e(this.asrServiceInitParams)}return this.asrService}async getDirectoryService(){if(!this.directoryService){let{createMarsCodeDirectoryService:e}=await (0,C.retryLoad)(()=>Promise.all([r.e("42530"),r.e("78568"),r.e("38227")]).then(r.bind(r,977624)));this.directoryService=e()}return this.directoryService}get currentChatId(){var e,t;return null===(t=(0,l.getChatSlice)("chatViewCoreStore"))||void 0===t?void 0:null===(e=t.currentChatViewConfig)||void 0===e?void 0:e.chatId}initEventBinding(){g.DeprecatedFlowEvent.on("app.init",this.onAppInit)}unbindEvent(){g.DeprecatedFlowEvent.off("app.init",this.onAppInit)}async getCurrentService(){let{currentChatId:e}=this;if(!e)return null;let t=(0,l.getChatStore)("chatInputStore").getState().activeSkillTypeMap[e],r=t?(0,l.getChatStore)("chatInputStore").getState().skillMap[t]:void 0;if((0,o.default)(r))return this.defaultChatInputService;let i=null==r?void 0:r.skill_type,n=await (0,s.getDeprecatedInputPlugin)(i);return(null==n?void 0:n.service)||null}initTextAreaWidthMeasurer(){if(this.textareaContainerDom)return;let e=document.createElement("div");e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.width="100%",e.style.opacity="0",(0,a.createRoot)(e).render((0,I.jsx)(b,{ref:this.textareaWidthMeasureRef})),document.body.appendChild(e),this.textareaContainerDom=e}destroyTextAreaWidthMeasurer(){var e;this.textareaContainerDom&&(i.unmountComponentAtNode(this.textareaContainerDom),null===(e=this.textareaContainerDom.parentNode)||void 0===e||e.removeChild(this.textareaContainerDom))}measureTextWidthInTextarea(e){var t,r;return null===(t=this.textareaWidthMeasureRef.current)||void 0===t||t.setText(e),null===(r=this.textareaWidthMeasureRef.current)||void 0===r?void 0:r.getTextWidth()}checkMaxFileCount(){var e,t,i,n,a;let o=this.currentChatId;if(!o)return!0;let{attachmentUploadConfig:{uploadMultiEntityConf:{maxFileCount:c},enabledSendMultiFileMessage:u}}=(0,l.getChatSlice)("attachmentUploadStore"),s=u||S.isBetaEnv,d=(0,v.isSamantha)((0,h.conversationSelector)(f.useFeedStore.getState(),o),null===(t=(0,l.getChatSlice)("chatViewCoreStore"))||void 0===t?void 0:null===(e=t.currentChatViewConfig)||void 0===e?void 0:e.chatType)&&s?c:1;return!((null!==(a=null===(n=(0,l.getChatSlice)("attachmentsStore").attachmentsMap)||void 0===n?void 0:null===(i=n[o])||void 0===i?void 0:i._default)&&void 0!==a?a:[]).length>=d)||((0,C.retryLoad)(()=>Promise.all([r.e("15390"),r.e("23426"),r.e("71331"),r.e("18748"),r.e("64404"),r.e("81070"),r.e("29114"),r.e("99898"),r.e("76778"),r.e("29843"),r.e("65823"),r.e("26112"),r.e("65229"),r.e("95630"),r.e("36710")]).then(r.bind(r,219170)).then(e=>e.SamanthaToast)).then(e=>e.error((0,p.getUnreactiveTranslate)("file_token_limit",{postProcess:"sprintf",sprintf:["\u8C46\u5305",d.toString()]}))),!1)}async addAttachment(e){let t=this.currentChatId;if(!t||!this.checkMaxFileCount())return;let r=await (0,d.getChatService)("attachmentsStoreService");return null==r?void 0:r.addAttachment({chatId:t,...e})}async addLink(e){let t=this.currentChatId;if(!t||!this.checkMaxFileCount())return;let r=await (0,d.getChatService)("attachmentsStoreService");return null==r?void 0:r.addLink({chatId:t,...e})}async replaceLink(e){let t=this.currentChatId;if(!t)return;let r=await (0,d.getChatService)("attachmentsStoreService");return null==r?void 0:r.replaceLink({chatId:t,...e})}async clearAttachments(){let e=await (0,d.getChatService)("attachmentsStoreService");null==e||e.clearAllAttachments();let t=this.currentChatId;if(!t)return;let r=await (0,d.getChatService)("attachmentUploadStoreService");return null==r?void 0:r.updatePreGeneratedLocalMessageId({chatId:t})}constructor({asrServiceInitParams:e}={}){_(this,"ctx",void 0),_(this,"defaultChatInputService",new y.DefaultChatInputService),_(this,"textareaContainerDom",null),_(this,"textareaWidthMeasureRef",(0,n.createRef)()),_(this,"asrService",null),_(this,"asrServiceInitParams",void 0),_(this,"directoryService",null),_(this,"destroy",()=>{var e;this.unbindEvent(),this.destroyTextAreaWidthMeasurer(),null===(e=this.asrService)||void 0===e||e.destroy(),this.asrService=null}),_(this,"focusOnEditor",async()=>{var e;let t=await this.getCurrentService();null==t||null===(e=t.focusOnEditor)||void 0===e||e.call(t)}),_(this,"updateEditorValue",async e=>{var t;let r=await this.getCurrentService();null==r||null===(t=r.updateEditorValue)||void 0===t||t.call(r,e)}),_(this,"clearEditorValue",()=>{this.updateEditorValue("")}),_(this,"getSkillService",async e=>{let t=await (0,s.getDeprecatedInputPlugin)(e);return(null==t?void 0:t.service)||null}),_(this,"onAppInit",(0,c.default)(()=>{this.initTextAreaWidthMeasurer()})),_(this,"emitBeforeBreakMessage",m.emitBeforeBreakMessage),this.asrServiceInitParams=e,this.initEventBinding()}}let E=(0,u.createServiceContainer)(),x=e=>(E.service||(E.service=new w(e)),E.service)},167655:function(e,t,r){r.d(t,{useChatServiceContextProviderValue:function(){return h}});var i=r(713738),n=r(579865),a=r(235267),o=r(186767),c=r(130800),u=r(371241),l=r(777210),s=r(634046),d=r(6917),v=r(884181);let h=e=>{let{teaServiceInitParams:t,configServiceInitParams:r,botServiceInitParams:h,chatBizPlugins:f,messageProtocolServiceInitOptions:S,asrServiceInitParams:p}=e(),[g]=(0,i.useState)(()=>{let e=(0,o.createChatTeaService)(t),i=(0,c.createChatConfigService)(r),g=(0,u.createChatBotService)(h),C=(0,l.createChatMessageService)({messageProtocolServiceOptions:S}),m=(0,v.createChatFeedService)(),y=(0,s.createChatInputCoreService)(),I={chatBotService:g,chatConfigService:i,chatTeaService:e,chatMessageService:C,chatFeedService:m,chatInputCoreService:y,chatInputService:(0,d.createChatInputService)({asrServiceInitParams:p}),chatViewService:(0,a.createChatViewService)({immersiveChatViews:(0,n.default)(f,e=>{var t;return(null===(t=e.chatView)||void 0===t?void 0:t.immersiveView)||[]}),canvasPlugins:(0,n.default)(f,e=>{var t;return(null===(t=e.chatView)||void 0===t?void 0:t.canvas)||[]})})};for(let e of Object.values(I))e.ctx=I;return I});return(0,i.useEffect)(()=>{S.config&&(g.chatMessageService.updateInitMessageProtocolServiceConfig(S),g.chatMessageService._appIsInitialed&&g.chatMessageService.tryInitMessageProtocolService())},[S.config]),g}},253800:function(e,t,r){r.d(t,{getCommonSocketParams:function(){return S}});var i=r(459271),n=r.n(i),a=r(510534),o=r(999634),c=r(53788),u=r(257029),l=r(761637),s=r(382938),d=r(102249),v=r(7625),h=r(992847),f=r(896855);function S(e){let{webId:t,uuid:r}=(0,u.getUuidAndWebIdFromTeaConfig)();return{"use-olympus-account":1,...function(e){let{device_platform:t,version_code:r,access_key:i,fpid:a,aid:o,ttwid:c}=e,u=window;if(u.byted_acrawler&&c){let e=n()(`device_platform=${t}&version_code=${r}&access_key=${i}&fpid=${a}&aid=${o}&ttwid=${c}`);return{"X-Bogus":u.byted_acrawler.frontierSign({"X-MS-STUB":e})["X-Bogus"],"X-MS-STUB":e,referer:document.referrer}}}({fpid:e.ws_product_id,access_key:e.ws_access_key,aid:e.ws_app_id,ttwid:e.ttwid,version_code:f.VERSION_CODE,device_platform:f.DEVICE_PLATFORM})||{},real_aid:(0,a.getAid)(!0),pkg_type:o.pkgType,version_code:f.VERSION_CODE,device_platform:f.DEVICE_PLATFORM,language:(0,l.getUnreactiveLanguage)(),samantha_web:1,web_id:t,tea_uuid:r,device_id:e.web_id&&"0"!==e.web_id?e.web_id:"",...(0,c.getWebTabId)("websocket"),...function(){if((0,s.isEnableDebug)()){let e=(0,d.getFGValue)(v.FGLocalDebugKeys.xTtEnv,{source:h.FGBuiltinNames.debugStorage});return e?{"x-use-ppe":1,"x-tt-env":String(e)}:{}}return{}}()}}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["9469"],{266669:function(e,r,t){t.r(r),t.d(r,{initDeepResearchStore:function(){return g},useDeepResearchStore:function(){return _}});var o=t(952259),a=t(321647),s=t(792433),c=t(191360),i=t(746479),d=t(910214),n=t(165482),l=t(178230);let u=()=>({isConfigInitialed:!1,isConfigLoading:!1,fetchConfigFailed:!1,sendDisabled:!1,blockIdToProcess:{},isProcessDataLoading:!1,blockIdToProcessHasInitialized:{},breakModalDestroyers:{},blockIdToConvIdWithAsyncState:{}}),p=(e,r)=>(0,s.default)(u(),{fetchDeepResearchProcessData:async t=>{var o;let{blockId:a,resourceId:s}=t;if(null===(o=r().blockIdToProcessHasInitialized)||void 0===o||!o[a])try{e((0,i.produce)(e=>{e.isProcessDataLoading=!0}));let{data:r}=await d.samanthaApiService.GetDeepResearchResource({resource_id:s}),{blocks:t=[]}=null!=r?r:{},o=t.map(e=>{var r;return{...e,content_obj:(0,n.parseJSON)(e.content,{}),id:null!==(r=null==e?void 0:e.block_id)&&void 0!==r?r:""}});e((0,i.produce)(e=>{e.blockIdToProcess[a]||(e.blockIdToProcess[a]=[]),e.blockIdToProcess[a]=o,e.isProcessDataLoading=!1,e.blockIdToProcessHasInitialized[a]=!0}))}catch(r){e((0,i.produce)(e=>{e.isProcessDataLoading=!1,e.blockIdToProcessHasInitialized[a]=!0})),l.logger.persist.warning({eventName:"fetch_DeepResearch_process_data_error"})}},updateDeepResearchProcessData(r){let{blockId:t,value:o}=r;e((0,i.produce)(e=>{e.blockIdToProcess[t]||(e.blockIdToProcess[t]=[]),e.blockIdToProcess[t]=o}))},updateBlockIdToConvId:t=>{let{blockId:o,convId:a,status:s}=t;e((0,i.produce)(e=>{var t,c;e.blockIdToConvIdWithAsyncState[o]||(e.blockIdToConvIdWithAsyncState[o]={}),e.blockIdToConvIdWithAsyncState[o]={convId:a,status:s};let i=null!==(t=r().blockIdToProcess)&&void 0!==t?t:{},d=null!==(c=e.blockIdToConvIdWithAsyncState)&&void 0!==c?c:{};Object.keys(i).forEach(r=>{var t,o;(null===(t=d[r])||void 0===t?void 0:t.convId)!==a&&(null===(o=d[r])||void 0===o?void 0:o.status)&&(delete e.blockIdToProcess[r],e.blockIdToProcessHasInitialized[r]=!1)})}))},updateSendDisabledState:r=>{e((0,i.produce)(e=>{e.sendDisabled=r}))},updateBreakModalDestroyers(r){e((0,i.produce)(e=>{e.breakModalDestroyers=r}))},addBreakModalDestroyer:(r,t)=>{e((0,i.produce)(e=>{e.breakModalDestroyers[r]=t}))},removeBreakModalDestroyer:r=>{e((0,i.produce)(e=>{delete e.breakModalDestroyers[r]}))}});var f=t(698392),h=t(643404),v=t(748645);let b=async e=>{var r;let{conversationId:t,artifactId:o}=e,{data:a}=await d.samanthaApiService.SearchArtifact({conversation_id:t,artifact_id:o}),s=null!==(r=null==a?void 0:a.artifacts)&&void 0!==r?r:[];return(0,v.default)(s,e=>e.version)},I=()=>({artifactMap:{}}),k=(e,r)=>(0,s.default)(I(),{fetchArtifactList:async r=>{let{conversationId:t,artifactId:o,hasAbort:a}=r;try{let r=await (0,h.retryWhen)({value:()=>b({conversationId:t,artifactId:o}),ifRetry:e=>!e.length,count:5});if(a)return;return e((0,i.produce)(e=>{let{artifactMap:a}=e;a[t]||(a[t]={}),a[t][o]=r})),r}catch(e){throw l.logger.persist.error({eventName:"search_artifact_error",error:e}),e}},async refreshArtifactList(){let{conversationId:e,canvasContent:t}=(0,f.getChatSlice)("chatViewCanvasStore"),o=null==t?void 0:t.artifactId;if(e&&o)return r().fetchArtifactList({conversationId:e,artifactId:o})}}),D=e=>{try{return{blockIdToProcess:e.blockIdToProcess}}catch(e){return l.logger.persist.error({message:"[@deep-research-store] persist state limit error",error:e instanceof Error?e:Error(String(e))}),{}}},y=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];return(0,s.default)(p(...r),k(...r))},P=e=>{let{isEnableDebug:r,reduxDevToolsSnapshot:t,merge:s,partialize:i,storage:d}=e,n=(0,c.createPersistOptions)({name:"deep-research-store",prefix:"samantha-web",storage:d,partialize:null!=i?i:D,version:1.5,merge:s}),l=(0,o.persist)((0,o.subscribeWithSelector)(y),n);return r&&t?(0,a.create)()((0,o.devtools)(l,{name:"samantha-web-deep-research-store"})):(0,a.create)()(l)},_=function(){for(var e=arguments.length,r=Array(e),t=0;t<e;t++)r[t]=arguments[t];let{_useDeepResearchStore:o}=_.prototype;if(o)return o(...r);throw Error("useDeepResearchStore is not initialized")};function g(e){let{_useDeepResearchStore:r}=_.prototype||{};if(!r){let r=P({...e});Object.setPrototypeOf(_.prototype,r),Object.defineProperties(_,{...Object.getOwnPropertyDescriptors(r)}),_.prototype._useDeepResearchStore=r}}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["74385"],{616339:function(e,t){t.default={container:"container-QrxCka","custom-area-wrapper":"custom-area-wrapper-e6UKsv",customAreaWrapper:"custom-area-wrapper-e6UKsv",placeholder:"placeholder-Kgrpqi","editor-container":"editor-container-yj5w_H",editorContainer:"editor-container-yj5w_H","editor-wrapper":"editor-wrapper-AdiwSu",editorWrapper:"editor-wrapper-AdiwSu","bottom-wrapper":"bottom-wrapper-PqK2vl",bottomWrapper:"bottom-wrapper-PqK2vl",editor:"editor-u_GcDR","left-tools-wrapper":"left-tools-wrapper-INTHKl",leftToolsWrapper:"left-tools-wrapper-INTHKl","right-tools-wrapper":"right-tools-wrapper-HlP9ga",rightToolsWrapper:"right-tools-wrapper-HlP9ga","tools-placeholder":"tools-placeholder-QV9wFb",toolsPlaceholder:"tools-placeholder-QV9wFb","input-content-container":"input-content-container-zs4WWA",inputContentContainer:"input-content-container-zs4WWA","input-popover":"input-popover-_eegNS",inputPopover:"input-popover-_eegNS","container-v2":"container-v2-DjA1C3",containerV2:"container-v2-DjA1C3"}},342857:function(e,t,n){n.d(t,{default:function(){return a}}),n(713738);var i=n(430261),r=n(345660),a=(0,i.IconFactory)((0,r.jsx)(e=>(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,r.jsx)("path",{fill:"currentColor",d:"m3.543 8.883 7.042-7.047a2 2 0 0 1 2.828 0l7.043 7.046a1 1 0 0 1 0 1.415l-.701.701a1 1 0 0 1-1.414 0L13.3 5.956v15.792a1 1 0 0 1-1 1h-.99a1 1 0 0 1-1-1V6.342l-4.654 4.656a1 1 0 0 1-1.414 0l-.7-.7a1 1 0 0 1 0-1.415"})}),{}))},573966:function(e,t,n){n.d(t,{useEstablished:function(){return r}});var i=n(713738);let r=e=>{let t=(0,i.useRef)(e);return t.current=t.current||e,t.current}},997022:function(e,t,n){n.d(t,{useOnce:function(){return r}});var i=n(713738);let r=e=>{let t=(0,i.useRef)(!1);t.current||(t.current=!0,e())}},162897:function(e,t,n){n.d(t,{toSorted:function(){return i}});let i=(e,t)=>(e.sort(t),e)},843174:function(e,t,n){n.d(t,{utf8:function(){return a}});var i=n(519428),r=n(436041);let a={length(e){let t=0,n=0;for(let i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:(64512&n)==55296&&(64512&e.charCodeAt(i+1))==56320?(++i,t+=4):t+=3;return t},read(e,t,n){if(n-t<1)return"";let i="";for(let r=t;r<n;){let t=e[r++];if(t<=127)i+=String.fromCharCode(t);else if(t>=192&&t<224)i+=String.fromCharCode((31&t)<<6|63&e[r++]);else if(t>=224&&t<240)i+=String.fromCharCode((15&t)<<12|(63&e[r++])<<6|63&e[r++]);else if(t>=240){let n=((7&t)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;i+=String.fromCharCode(55296+(n>>10)),i+=String.fromCharCode(56320+(1023&n))}}return i},write(e,t,n){let i,r;let a=n;for(let a=0;a<e.length;++a)(i=e.charCodeAt(a))<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&(64512&(r=e.charCodeAt(a+1)))==56320?(i=65536+((1023&i)<<10)+(1023&r),++a,t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128);return n-a},posCalcRange(e,t){let n=0,a={},o=(0,i.default)(t);o=(0,r.default)(o.sort((e,t)=>e-t));for(let t=0;t<e.length&&(n===o[0]&&(a[o[0]]=t,o.shift()),(64512&e[t].charCodeAt(0))==55296&&(64512&e[t+1].charCodeAt(0))==56320?(n+=this.length(`${e[t]}${e[t+1]}`),t++):n+=this.length(e[t]),o.length);t++);return a},posCalc(e,t){let n="",i=0;for(let r=0;r<e.length;r++)if(n+=e[r],this.length(n)===t){i=r+1;break}return i}}},154615:function(e,t,n){n.d(t,{ResetErrorFallback:function(){return u}});var i=n(713738),r=n(915299),a=n(178230),o=n(970946),l=n(345660);let u=e=>{let{error:t}=e;return(0,i.useEffect)(()=>{a.logger.persist.error({eventName:"boundary_reset_error_fallback",error:t,meta:{is_package:1}})},[]),(0,o.useAutoReload)("reset_error_fallback",r.getUnreactiveTranslate),(0,l.jsx)("div",{className:"retry-button-wrapper-SmFCqE",children:(0,l.jsx)("button",{onClick:()=>window.location.reload(),children:(0,r.getUnreactiveTranslate)("chat_list_load_failed")})})}},747854:function(e,t,n){n.d(t,{FullScreenOverlay:function(){return d}});var i=n(870539),r=n(385093),a=n(812650),o=n.n(a),l={container:"container-ESz2xm","animate-both":"animate-both-l3mtFW",animateBoth:"animate-both-l3mtFW","animate-in":"animate-in-MeIewZ",animateIn:"animate-in-MeIewZ",exiting:"exiting-wWn0v1",exited:"exited-lIr8cV",entering:"entering-GaArQb",entered:"entered-lCTMmX"},u=n(345660);let d=e=>{let{className:t,style:n,visible:a,keepDOM:d=!1,mountOnEnter:s=!d,animate:c="both",children:v}=e;return(0,u.jsx)(i.default,{in:a,timeout:200,mountOnEnter:s,unmountOnExit:!d,children:e=>(0,u.jsx)("div",{className:o()(l.container,t,l[e],l[`animate-${c}`]),style:n,"data-testid":"full_screen_overlay","data-visible":a,children:(0,r.default)(v)?null==v?void 0:v({animationFinished:"entered"===e}):v})})}},220197:function(e,t,n){n.d(t,{BizChatCommonErrorFallback:function(){return u}});var i=n(713738),r=n(698392),a=n(154615),o=n(337524),l=n(345660);let u=e=>{let{currentChatViewConfig:t}=(0,r.useChatSlice)("chatViewCoreStore"),n=(0,i.useRef)(!0);return(0,i.useEffect)(()=>{n.current?n.current=!1:null==e||e.resetErrorBoundary()},[null==t?void 0:t.chatId]),(0,l.jsx)(o.SamanthaLayout.MaxWidthLayout,{children:(0,l.jsx)(a.ResetErrorFallback,{...e})})}},589141:function(e,t,n){n.d(t,{chatKit:function(){return s}});var i=n(368107),r=n(83990),a=n(698392),o=n(230932),l=n(102249),u=n(7625),d=n(992847);let s={isInitialed:!1,init(e){if(this.isInitialed)return;this.isInitialed=!0;let{store:t,isEnableDebug:n}=e,i=(0,l.getFGValue)(u.FGLocalDebugKeys.reduxDevToolsSnapshot,{source:d.FGBuiltinNames.debugStorage});(0,r.initMessageStore)({...t,isEnableDebug:!!n,reduxDevToolsSnapshot:i}),(0,o.initFeedStore)({...t,isEnableDebug:!!n,reduxDevToolsSnapshot:i})},initData(e){let{launchData:t}=e;try{var n,r;(0,a.getChatStore)("launcherRawSettingStore").setState(e=>e.launchStatus!==i.LaunchStatus.Success?{launchData:t,launchStatus:i.LaunchStatus.Success}:{});let{upload_file_allowed_types:e,upload_file_max_size:o,upload_multi_entity_conf:l,feature_config:u,language_list:d}=t;(0,a.getChatStore)("launcherRawSettingStore").setState({deprecatedSystemConfig:{language_list:d||[]}}),(0,a.getChatStore)("attachmentUploadStore").setState({attachmentUploadConfig:{uploadFileMaxSize:Number(o)||0,uploadFileAllowedTypes:e||[],enabledSendMultiFileMessage:!!(null==u?void 0:null===(n=u.send_multi_file_message)||void 0===n?void 0:n.enabled),enableImageVlm:!!(null==u?void 0:null===(r=u.send_vlm_image_message)||void 0===r?void 0:r.enabled),uploadMultiEntityConf:{maxFileCount:Number(null==l?void 0:l.max_file_cnt)||0,maxFileSize:Number(null==l?void 0:l.max_file_size)||0,maxImageCount:Number(null==l?void 0:l.max_image_cnt)||0,maxImageSize:0x1400000}}})}catch(e){}}}},595495:function(e,t,n){n.d(t,{PluginLazyImmersivePage:function(){return p},temporaryImmersivePlugin:function(){return m}});var i=n(713738),r=n(865607),a=n(321647),o=n(214071),l=n(831370),u=n(666196),d=n(220197),s=n(747854),c=n(426156),v=n(460821),h=n(573966),f=n(178230);let _=(0,n(559891).withSuspense)((0,i.lazy)(()=>Promise.all([n.e("43361"),n.e("7414"),n.e("23426"),n.e("71331"),n.e("85781"),n.e("34210"),n.e("88883"),n.e("65823"),n.e("39079"),n.e("38354"),n.e("42546"),n.e("27024"),n.e("38754"),n.e("77970"),n.e("92322"),n.e("59346"),n.e("79948"),n.e("98222"),n.e("99543"),n.e("25438"),n.e("24817"),n.e("60437"),n.e("34812"),n.e("53756"),n.e("32179"),n.e("35235"),n.e("49690"),n.e("79630"),n.e("50182"),n.e("33247"),n.e("27678"),n.e("56076")]).then(n.bind(n,209212)).then(e=>({default:e.FlowChatSplitterLayoutCompose}))));var g=n(345660);let m=[],p=e=>{let{chatViewConfig:t}=e,n=(0,u.useChatService)("chatViewService"),{immersive:m,exactImmersiveMode:p}=(0,a.useStore)(n.immersiveStore,e=>e,r.shallow),{lastActiveValue:w,enterTime:S}=function(e){let{current:t}=(0,i.useRef)({lastActiveValue:e,lastValue:e,enterTime:Date.now()});return(0,o.default)(e)||(t.lastActiveValue=e,t.lastValue!==e&&(t.enterTime=Date.now())),t.lastValue=e,(0,v.useCompareMemo)(t,r.shallow)}(p),y=(0,h.useEstablished)(!!p),C=(0,i.useMemo)(()=>{var e;return null==n?void 0:null===(e=n.immersiveChatViews)||void 0===e?void 0:e.find(e=>e.name===w)},[w]);return(0,i.useEffect)(()=>{if(p){let e={chat_id:null==t?void 0:t.chatId,chat_type:null==t?void 0:t.chatType,immesive_type:p};return f.logger.persist.info({message:"chat_immersive_mode_enter",meta:e}),()=>f.logger.persist.info({message:"chat_immersive_mode_exit",meta:e})}},[p]),y&&C?(0,g.jsx)(s.FullScreenOverlay,{visible:!!(p&&(null==m?void 0:m[p])),keepDOM:!0,mountOnEnter:!0,animate:"in",children:e=>{var i;let{animationFinished:r}=e,a=p?null==m?void 0:m[p]:void 0;return(0,g.jsx)(c.ErrorBoundary,{errorBoundaryName:C.errorBoundaryName||`${C.name}_error`,logger:f.logger,FallbackComponent:d.BizChatCommonErrorFallback,errorBoundaryScope:c.ErrorBoundaryScopeEnum.Component,children:(0,g.jsx)(l.FlowChatSplitterLayoutSlotProvider,{value:_,children:p&&(null==m?void 0:m[p])?null==C?void 0:null===(i=C.render)||void 0===i?void 0:i.call(C,{chatViewConfig:t,showChatHeader:!1,onClose:()=>n.exitImmersiveMode(),...a,teaCtx:{enterTime:S,...null==a?void 0:a.teaCtx}}):null})})}},w):null}},256595:function(e,t,n){n.d(t,{getChatBizPlugins:function(){return m},getInitialChatServiceContextParams:function(){return p}});var i=n(996080),r=n(783477),a=n(777422),o=n(102249),l=n(7625),u=n(992847),d=n(595495),s=n(910214),c=n(302430),v=n(178230);async function h(){try{let{data:e}=await s.settingApiService.Launch({});return null==e?void 0:e.config}catch(e){v.logger.console.info("request failed to get launch config")}}async function f(){try{let e=await h();return e&&c.ttWidManager.setTtwidConfig({web_id:null==e?void 0:e.web_id,tt_wid:null==e?void 0:e.ttwid}),e}catch(e){v.logger.console.info("request failed to get launch config")}}var _=n(499075),g=n(253800);let m=()=>[{chatView:{immersiveView:d.temporaryImmersivePlugin}}],p=e=>{let{teaCommonParams:t,overrideFeatureGating:n,launchConfig:d,reportEvent:s}=e;return{teaServiceInitParams:{tracker:a.trackEvent,tea:"undefined"!=typeof window?window.Tea:void 0,preRequestAbTest:"undefined"!=typeof window?window[i.PromiseName.GuestLayoutMode]:void 0,teaCommonParams:t},configServiceInitParams:()=>{let e=(0,_.getChatConfig)();return{...e,featureGating:{...e.featureGating,...n}}},asrServiceInitParams:{useAudioWorklet:!0},botServiceInitParams:{actions:r.useBotStore.getState(),useBotInfoHook:r.useBotInfo},chatBizPlugins:m(),messageProtocolServiceInitOptions:{config:d,reportEvent:s,getCommonSocketParams:g.getCommonSocketParams,featureConfig:{binaryType:(0,o.getFGValue)(l.FGLocalDebugKeys.chunkWithJSON,{source:u.FGBuiltinNames.debugStorage})?"json":"pb",consoleSocketPacket:(0,o.getFGValue)(l.FGLocalDebugKeys.consoleSocketPacket,{source:u.FGBuiltinNames.debugStorage})},refreshSocketConfig:f}}}},499075:function(e,t,n){n.d(t,{getChatConfig:function(){return y}});var i=n(993897),r=n(530088),a=n(996080),o=n(510534),l=n(156272),u=n(102249),d=n(382938),s=n(7625),c=n(992847),v=n(888130),h=n(643404),f=n(672978),_=n(204454),g=n(173464);let m={enableNewWritingSkill:!!_.isBetaEnv&&!(0,g.isE2eEnv)()||void 0,canEditImageWithoutAB:!0};var p=n(340002);let w="object"==typeof window&&"object"==typeof window[a.PromiseName.SkillList]?(0,f.wrapPrefetchGetter)(window[a.PromiseName.SkillList]):void 0,S="object"==typeof window&&"object"==typeof window[a.PromiseName.GuestLayoutMode]?(0,f.wrapPrefetchGetter)(window[a.PromiseName.GuestLayoutMode].then(e=>{var t,n,i;return!!(null!==(i=null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(t=n.ai_reader)||void 0===t?void 0:t.enable_ult)&&void 0!==i&&i)})):void 0,y=e=>{var t;let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,u.getFGValue)(e,{source:r.FG_FEATURE_CONFIG_KEY});return(0,i.getFeatureConfigValue)(n,t)};return{appId:(0,o.getAid)(),userId:(0,v.getUserId)()||"",isSeoUser:"undefined"!=typeof window&&"1"===p.default.get("flow_is_seo_user"),chatReportParams:{loginSource:(0,l.getLoginSourceQuery)(e)},isEnableDebug:(0,d.isEnableDebug)(),featureGating:{answerWithSuggest:a("answer_with_suggest").value,namedEntityHighlight:a("named_entity_highlight").value,answerWithVideo:a("answer_with_video").value,enableChatInputNewLayout:!0,showBotHeat:a("bot_heat").enabled,enableBotProfileOpenJump:a("profile_jump").enabled,showBotHandleName:a("profile").enabled,enableSendFileMessage:a("send_file_message").enabled,enableSendWithAttachmentArea:a("attachment_area").enabled,enableGenerateDocByOutline:!0,...m,enableSamanthaProtocolStage:null!==(t=(0,u.getFGValue)(s.FGLocalDebugKeys.enableSamanthaProtocolStage,{source:c.FGBuiltinNames.debugStorage}))&&void 0!==t?t:void 0,enableGuestSendSkill:(0,u.getFGValue)(s.FGLocalDebugKeys.newGuestGuidanceType,{source:c.FGBuiltinNames.debugStorage})},overrideLocalFeatureConfig:{enableMessageDebug:(0,d.isEnableDebug)()},createUploader:async e=>{let{UploaderService:t}=await (0,h.retryLoad)(()=>Promise.all([n.e("14905"),n.e("4857")]).then(n.bind(n,105989)));return new t(e)},getSkillListPrefetch:w,enableUltPrefetch:S}}},831370:function(e,t,n){n.d(t,{FlowChatSplitterLayoutSlotProvider:function(){return o},useFlowChatSplitterLayoutSlot:function(){return a}});var i=n(713738);let r=(0,i.createContext)(void 0),a=()=>{let e=(0,i.useContext)(r);if(!e)throw Error("useFlowChatSplitterLayoutSlot must be used within a FlowChatSplitterLayoutSlotProvider");return e},o=r.Provider},993897:function(e,t,n){n.d(t,{getFeatureConfigValue:function(){return u},intersectFeatureConfigFromLaunch:function(){return o},intersectFeatureConfigFromUserConfig:function(){return l}});var i=n(317494),r=n(214071),a=n(789271);let o=(e,t)=>Object.fromEntries((0,i.default)([...Object.keys(e),...Object.keys(t||{})]).map(n=>{var i,a;let o=e[n],l=null==t?void 0:t[n];return!l||(0,r.default)(l)?[]:[n,{enabled:!!(null==l?void 0:l.enabled),default_value:!!(null==l?void 0:l.default_value),value:null!==(i=null==l?void 0:l.value)&&void 0!==i?i:null==o?void 0:o.value,version:null!==(a=null==l?void 0:l.version)&&void 0!==a?a:null==o?void 0:o.version}]}).filter(e=>!!(null==e?void 0:e.length))),l=(e,t)=>{var n;if(!t)return e;let i=Object.keys(a.FEATURE_CONFIG_KEY_MAPS);return Object.fromEntries([...Object.keys(e),...(null===(n=t.configs)||void 0===n?void 0:n.map(e=>i.find(t=>e.object===a.FEATURE_CONFIG_KEY_MAPS[t])).filter(e=>e))||[]].map(n=>{var i;let r=e[n],o=null==t?void 0:null===(i=t.configs)||void 0===i?void 0:i.find(e=>e.object===a.FEATURE_CONFIG_KEY_MAPS[n]);return o?[n,{...r,...Number(o.version)<Number(null==r?void 0:r.version)?{}:{version:o.version,value:!!Number(o.value)}}]:[n,r]}))},u=function(e){var t,n;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{enabled:null==e?void 0:e.enabled,value:null!==(n=null!==(t=(null==e?void 0:e.enabled)?null==e?void 0:e.value:void 0)&&void 0!==t?t:null==e?void 0:e.default_value)&&void 0!==n?n:i}}},789271:function(e,t,n){n.d(t,{FEATURE_CONFIG_KEY_MAPS:function(){return r}});var i=n(946576);let r={answer_with_suggest:i.UserConfigObject.AnswerWithSuggest,answer_with_video:i.UserConfigObject.AnswerWithVideo,named_entity_highlight:i.UserConfigObject.HighlightKeyword,personalized_recommend:i.UserConfigObject.PersonalizedRecommend,save_chat_history:i.UserConfigObject.SaveChatHistory,allow_model_training:i.UserConfigObject.AllowTraining}},466204:function(e,t,n){n.d(t,{withBotInit:function(){return l}}),n(713738);var i=n(783477),r=n(382938),a=n(345660);let o=e=>{let{children:t}=e;return(0,i.initBotStore)((0,r.isEnableDebug)()),(0,a.jsx)(a.Fragment,{children:t})};function l(e){return t=>(0,a.jsx)(o,{children:(0,a.jsx)(e,{...t})})}},739044:function(e,t,n){n.d(t,{canInitChatAppConversationReport:function(){return i.canInitChatAppConversationReport},getChatIdFromURL:function(){return i.getChatIdFromURL},getIsChatPage:function(){return i.getIsChatPage},useIsChatPage:function(){return i.useIsChatPage},useIsChatPageOther:function(){return i.useIsChatPageOther},useIsShareOrChatNewPage:function(){return i.useIsShareOrChatNewPage}});var i=n(391723)},674414:function(e,t,n){n.d(t,{withRequireAuthWithFallback:function(){return u}});var i=n(500978),r=n(604662),a=n(206805),o=n(739044),l=n(345660);let u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=n=>{let u=(0,o.useIsChatPage)(),d=(0,o.useIsChatPageOther)(),s=(0,i.useIsSkillGuidancePage)(),c=(0,o.useIsShareOrChatNewPage)();return(u||d||s||c)&&(t.chatSkeletonFallback=(0,l.jsx)(a.ChatSkeletonFull,{showInput:!d})),(0,l.jsx)(r.RequireAuth,{requireAuthConfig:t,children:(0,l.jsx)(e,{...n})})},u=e.displayName||e.name||"Component";return n.displayName=`withRequireAuthWithFallback(${u})`,n}},321050:function(e,t,n){n.d(t,{useIsOverallList:function(){return v}});var i=n(713738),r=n(229079),a=n(467851),o=n(996080),l=n(198660),u=n(672978),d=n(178230);let s="object"==typeof window&&"object"==typeof window[o.PromiseName.GuestLayoutMode]?(0,u.wrapPrefetchGetter)(window[o.PromiseName.GuestLayoutMode]):void 0,c=()=>{var e;let{promise:t,syncValue:n}=null!==(e=null==s?void 0:s())&&void 0!==e?e:{},[a,o]=(0,i.useState)((0,r.default)(n,"data.is_login"));return(0,i.useEffect)(()=>{var e;null==t||null===(e=t.then(e=>{if(!e||0!==e.code)throw Error(JSON.stringify(e));o((0,r.default)(e,"data.is_login"))}))||void 0===e||e.catch(e=>{d.logger.console.error(e)})},[]),a},v=()=>{let e=(0,l.useIsLoggedIn)(),t=(0,l.useIsLoginLoading)(),n=c();return(0,a.default)(n)&&!(!t&&e!==n)?{value:n,loading:!1,isLoggedIn:n}:{value:e,loading:t,isLoggedIn:e}}},924666:function(e,t,n){n.d(t,{useInitChatAppLegacy:function(){return J}});var i=n(713738),r=n(530088),a=n(63321),o=n(589141),l=n(382938),u=n(4137),d=n(762707),s=n(251913),c=n(459735),v=n(39199),h=n(500825),f=n(746904),_=n(717529),g=n(956801),m=n(777422),p=n(903520),w=n(274088),S=n(201272),y=n(712980),C=n(162897),b=n(910321),E=n(165482),L=n(580622),P=n(997022),F=n(38848),T=n(227587),k=n(178230);let I=(e,t)=>Object.keys(t).reduce((n,i)=>(n[`${e}_${i}`]=t[i],n),{});var N=n(344417),A=n(123306);let O=(e,t,n)=>{if("undefined"!=typeof window)try{let r=Math.round((0,N.default)(t)?t:(0,b.safelyGetNow)()),a=Math.round((0,N.default)(n)?n:1e4),o=e.split("_").map(A.default).join("");if(performance.mark(o,{startTime:r}),performance.measure(o,{start:r,end:a===r?a+1e3:a,detail:{devtools:{dataType:"track-entry",track:"Chat Page Timings",trackGroup:"Flow Perf Tracing",color:a===r?"secondary":"tertiary-dark",properties:[[o,t]],tooltipText:`${o} ${r}ms`}}}),e.includes("finish")||e.includes("end")){var i;let t=e.replace(/_(start|finish|end)/,""),n=`${t}_start`.split("_").map(A.default).join(""),a=t.split("_").map(A.default).join(""),o=null===(i=performance.getEntriesByName(n,"mark"))||void 0===i?void 0:i[0];o&&performance.measure(a,{start:o.startTime,end:r,detail:{devtools:{dataType:"track-entry",track:"Chat Page Measures",trackGroup:"Flow Perf Tracing",color:"tertiary-dark",properties:[[`${a}Start`,`${o.startTime}ms`],[`${a}End`,`${r}ms`]],tooltipText:`${a} ${r-o.startTime}ms`}}})}}catch(e){}},G=(e,t,n)=>{if("undefined"!=typeof window)try{let i=Object.entries(t).sort((e,t)=>e[1]-t[1]);performance.mark(e,{detail:{devtools:{dataType:"marker",color:"secondary",properties:i,tooltipText:null!=n?n:`${e} ${Math.round(i[i.length-1][1])}ms`}}})}catch(e){}},x=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4;Object.entries(e).sort((e,t)=>e[1]-t[1]).forEach(e=>{let[n,i]=e;return O(n,i,t)})};var D=n(615188);let j=()=>{var e,t;return{is_main_ssr:"0",render_level:null!==(t=null===(e=window._SSR_DATA)||void 0===e?void 0:e.renderLevel)&&void 0!==t?t:"0",is_samantha_client:"0",is_from_ug:(0,D.getSemChannel)()?"1":"0"}};var M=n(739044),R=n(946537);let B=(e,t)=>{},V=e=>{let{chat_input_mount:t,guidance_group_mount:n,message_list_mount:i,guidance_skeleton_mount:r}=e,a=(0,u.default)(n)&&(0,u.default)(r)?void 0:(0,u.default)(n)?r:(0,u.default)(r)?n:Math.min(r,n),o=(0,u.default)(a)?i:(0,u.default)(i)?a:Math.min(a,i);if(!((0,u.default)(t)||(0,u.default)(o)))return Math.max(t,o)},W=e=>{let t=V(e),{chat_list_mount:n}=e;if(!((0,u.default)(t)||(0,u.default)(n)))return Math.max(t,n)},U=e=>{if("undefined"==typeof window)return;let{guidance_group_html_loaded:t,message_list_html_loaded:n,chat_input_html_loaded:i}=window;if(!((0,u.default)(t)&&(0,u.default)(n)||(0,u.default)(i)))return(null!=t?t:1/0)>(null!=n?n:1/0)?{message_list_html_loaded:n,chat_page_lcp:Math.max(n,i),chat_input_html_loaded:i}:{guidance_group_html_loaded:t,chat_page_lcp:Math.max(t,i),chat_input_html_loaded:i}},z=e=>({...e,duration:(0,d.default)(e.duration,["chat_view_show","chat_view_interactive","chat_view_interactive_v2","chat_page_finish","chat_input_mount","chat_list_mount","redirect_start","chat_store_hydrate_finish","launch_finish","chat_page_first_render","dcl_event_end","dom_interactive","full_launch_start","root_layout_first_render","init_chat_app_start","response_end","login_state_finish","message_list_mount","chatkit_init_start","guidance_skeleton_mount"])}),K=function(e,t){let{durationMetric:n=e,reportDurationJson:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{duration:r,...a}=t,o=Object.fromEntries((0,C.toSorted)(Object.entries(r).filter(e=>{let[,t]=e;return!(0,u.default)(t)}).map(e=>{let[t,n]=e;return[t,Math.round(10*n)/10]}),(e,t)=>e[1]-t[1]));(0,m.trackEvent)(e,{app_type:"web",duration:Math.round(10*r[n])/10,...i?{duration_json:(0,E.stringifyJSON)(o)}:{},...o,...a,...j()})},H=[R.CHAT_PAGE_ROUTE,"/",R.CHAT_PAGE_WITHOUT_END_SLASH,"/chat/*"].concat(Object.keys(h.SkillGuidancePageRoute)),$=(0,s.default)(()=>{S.DeprecatedFlowEvent.emit("app.init"),(0,v.setAppInitEventEmitted)(!0)}),q=()=>{var e,t;let n=(0,T.useLocation)(),[r]=(0,i.useState)(null!==(t=null===(e=performance)||void 0===e?void 0:e.now())&&void 0!==t?t:Date.now()),[a]=(0,i.useState)(n.key),[o]=(0,i.useState)("1"===(0,y.parseHashOrQuery)(n.search).measure),{value:l}=(0,_.useNewGuidanceAb)(),d=(0,L.default)(l),v=(0,i.useMemo)(()=>{let e="undefined"!=typeof window&&F.FlowLocalStorage.getItem("hasEnterGuest");return e&&1===Number(e)&&F.FlowLocalStorage.setItem("hasEnterGuest","0"),e},[]),h=(0,i.useCallback)((0,s.default)(()=>{g.useTracingStore.setState({hasInteracted:!0,firstInteractionTime:Math.round((0,b.safelyGetNow)())})}),[]),m=(0,i.useRef)({}),S=(0,i.useRef)(""),C=(e,t)=>{var n,i,r,a,l;let{chatCached:u,enterPid:s,reason:c,innerError:h,enterPathname:_,hasInteracted:m,firstInteractionTime:w,newGuidanceType:S}=g.useTracingStore.getState(),y=V(e),C=V(e),b=W(e),E=U(e);return{success:c?"0":"1",reason:c,error:h,duration:{...e,chat_view_show:y,chat_view_interactive:C,chat_page_finish:b,...E},chat_cached:u?"1":"0",page:"chat",is_from_login:v||"0",enter_pid:s,current_pid:(0,p.extractPid)(t),has_redirect:_===t?"0":"1",measure_query:o?"1":"0",is_sidebar_expand:(0,f.getIsExpand)()?"1":"0",new_guidance_type:null!==(l=d.current)&&void 0!==l?l:S,...function(){if("undefined"==typeof window)return{};try{let e=performance.getEntriesByType("resource").filter(e=>["audio","css","script","link","img","image","other","video"].includes(e.initiatorType)).map(e=>({name:e.name,initiatorType:e.initiatorType,decodedBodySize:e.decodedBodySize,encodedBodySize:e.encodedBodySize,transferSize:e.transferSize,cached:!!e.encodedBodySize&&!e.transferSize,duration:e.duration}));return{...I("statics",function(e){let t=0,n=0,i=0,r=0,a=0,o=0,l=0;e.forEach(e=>{let{cached:u,decodedBodySize:d,duration:s,encodedBodySize:c,transferSize:v}=e;u&&(t+=1,n+=d,i+=c),r+=d,a+=c,l+=v,o+=s});let u=Number((t/e.length).toFixed(4));return{cached_count:t,total_count:e.length,cached_decoded_size:n,cached_encoded_size:i,total_decoded_size:r,total_encoded_size:a,total_duration:Math.round(o),total_transfer_size:l,cache_hit_rate:u,cached_decoded_size_rate:r?Number((n/r).toFixed(4)):0,cached_encoded_size_rate:a?Number((i/a).toFixed(4)):0}}(e))}}catch(e){return{}}}(),has_interacted:m?"1":"0",first_interaction_time:w,hardware_concurrency:null===(i=window)||void 0===i?void 0:null===(n=i.navigator)||void 0===n?void 0:n.hardwareConcurrency,device_memory:null===(a=window)||void 0===a?void 0:null===(r=a.navigator)||void 0===r?void 0:r.deviceMemory}},E=(0,i.useCallback)((0,s.default)(()=>{let{enterPid:e,reason:t,innerError:n}=g.useTracingStore.getState();if(!e||!H.includes(e))return;let i=C(m.current,S.current);t?k.logger.persist.error({eventName:"init_chat",error:null!=n?n:Error("unknown_error"),meta:z(i)}):k.logger.persist.success({eventName:"init_chat",meta:z(i)}),K("chat_page_finish",i,{reportDurationJson:!0,durationMetric:"chat_view_interactive"})}),[]),N=(0,i.useMemo)(()=>{let e=(0,s.default)((e,t)=>{var n,i,r,a,o;let l=C(e,t);k.logger.persist.info({eventName:"init_chat_view_show",meta:z(l)}),null===(i=(0,w.getSlardar)())||void 0===i||null===(n=i.sendCustomPerfMetric)||void 0===n||n.call(i,{name:"perf_chat_view_show",value:null!==(a=l.duration.chat_view_show)&&void 0!==a?a:0}),"undefined"!=typeof window&&window.serverPerfMetrics&&(k.logger.persist.info({eventName:"init_chat_view_show_server_timing",meta:{...l,duration:{...window.serverPerfMetrics.mark,chat_view_show:l.duration.chat_view_show}}}),k.logger.persist.info({eventName:"init_chat_view_show_server_duration",meta:{...l,duration:{...window.serverPerfMetrics.measure,chat_view_show:l.duration.chat_view_show}}})),K("chat_view_show",l),B("web_chat_view_show",performance.timeOrigin+(null!==(o=null===(r=l.duration)||void 0===r?void 0:r.chat_view_show)&&void 0!==o?o:0))}),t=(0,s.default)((e,t)=>{var n,i,r,a,o;let l=C(e,t);k.logger.persist.info({eventName:"init_chat_view_interactive",meta:z(l)}),null===(i=(0,w.getSlardar)())||void 0===i||null===(n=i.sendCustomPerfMetric)||void 0===n||n.call(i,{name:"perf_chat_view_interactive",value:null!==(a=l.duration.chat_view_interactive)&&void 0!==a?a:0}),K("chat_view_interactive",l),B("web_chat_view_interactive",performance.timeOrigin+(null!==(o=null===(r=l.duration)||void 0===r?void 0:r.chat_view_interactive)&&void 0!==o?o:0))}),n=(0,s.default)((e,t)=>{var n,i,r,a,o;let l=C(e,t);k.logger.persist.info({eventName:"init_chat_page_finish",meta:z(l)}),B("web_chat_page_finish",performance.timeOrigin+(null!==(a=null===(n=l.duration)||void 0===n?void 0:n.chat_page_finish)&&void 0!==a?a:0)),null===(r=(0,w.getSlardar)())||void 0===r||null===(i=r.sendCustomPerfMetric)||void 0===i||i.call(r,{name:"perf_chat_page_finish",value:null!==(o=l.duration.chat_page_finish)&&void 0!==o?o:0})});return(i,r)=>{let{enterPid:a}=g.useTracingStore.getState();if(!a||!H.includes(a))return;let o=V(i),l=V(i),d=W(i);(0,u.default)(o)||e(i,r),(0,u.default)(l)||t(i,r),(0,u.default)(d)||n(i,r)}},[]),A=(0,i.useMemo)(()=>{let e=!1,t=!1;return(n,i)=>{n.url_action_chat_page_mount&&(null==i?void 0:i.urlActionNavEndTime)&&(null==i?void 0:i.urlActionChatRenderEventName)&&!e&&(e=!0,k.logger.persist.info({eventName:null==i?void 0:i.urlActionChatRenderEventName,meta:{duration:n.url_action_chat_page_mount-(null==i?void 0:i.urlActionNavEndTime)}})),(null==i?void 0:i.urlActionCanvasEndTime)&&(null==i?void 0:i.urlActionNavEndTime)&&(null==i?void 0:i.urlActionCanvasEventName)&&!t&&(t=!0,k.logger.persist.info({eventName:null==i?void 0:i.urlActionCanvasEventName,meta:{duration:i.urlActionCanvasEndTime-(null==i?void 0:i.urlActionNavEndTime)}}))}},[]);(0,P.useOnce)(()=>{var e,t,n,i,o,l,d,s,v,h,f,_,m,w,S,y,C,b,E,L,P;if("undefined"==typeof window)return;let F=(0,M.canInitChatAppConversationReport)(),T=null===(e=performance.getEntriesByType("navigation"))||void 0===e?void 0:e[0];g.useTracingStore.setState({chatLayoutCreateTime:r,chatLayoutEnterPageKey:a,flowWebScriptJsFinish:window.docLoadPerformanceTs,enterPathname:window.enter_pathname,enterPid:(0,p.extractPid)(window.enter_pathname),canReport:F,pageNavigationType:null==T?void 0:T.type}),g.useTracingStore.getState().addDurationPoints((0,c.default)({redirect_start:null==T?void 0:T.redirectStart,fetch_start:null==T?void 0:T.fetchStart,response_start:null==T?void 0:T.responseStart,response_end:null==T?void 0:T.responseEnd,dom_interactive:null==T?void 0:T.domInteractive,dom_complete:null==T?void 0:T.domComplete,dcl_event_start:null==T?void 0:T.domContentLoadedEventStart,dcl_event_end:null==T?void 0:T.domContentLoadedEventEnd,load_event_start:null==T?void 0:T.loadEventStart,load_event_end:null==T?void 0:T.loadEventEnd,root_layout_script_loaded:null===(n=window)||void 0===n?void 0:null===(t=n.perfTiming)||void 0===t?void 0:t.root_layout_script_loaded,load_root_layout_config:null===(o=window)||void 0===o?void 0:null===(i=o.perfTiming)||void 0===i?void 0:i.load_root_layout_config,init_root_layout_start:null===(d=window)||void 0===d?void 0:null===(l=d.perfTiming)||void 0===l?void 0:l.init_root_layout_start,init_root_layout_end:null===(v=window)||void 0===v?void 0:null===(s=v.perfTiming)||void 0===s?void 0:s.init_root_layout_end,root_layout_first_render:null===(f=window)||void 0===f?void 0:null===(h=f.perfTiming)||void 0===h?void 0:h.root_layout_first_render,chat_layout_script_loaded:null===(m=window)||void 0===m?void 0:null===(_=m.perfTiming)||void 0===_?void 0:_.chat_layout_script_loaded,chatkit_init_start:null===(S=window)||void 0===S?void 0:null===(w=S.perfTiming)||void 0===w?void 0:w.chatkit_init_start,chatkit_init_finish:null===(C=window)||void 0===C?void 0:null===(y=C.perfTiming)||void 0===y?void 0:y.chatkit_init_finish,guidance_skeleton_mount:null===(E=window)||void 0===E?void 0:null===(b=E.perfTiming)||void 0===b?void 0:b.guidance_skeleton_mount,chat_layout_wrapper_first_render:null===(P=window)||void 0===P?void 0:null===(L=P.perfTiming)||void 0===L?void 0:L.chat_layout_wrapper_first_render},u.default))});let O=(0,s.default)(()=>{var e;if("1"!==F.FlowLocalStorage.getItem("__flow_show_load_perf")&&!o)return;let t=g.useTracingStore.getState().duration,n=V(t);U(t),G("ChatViewShow",t,`ChatViewShow ${Math.round(null!=n?n:0)}ms`),G("ChatViewInteractive",t),x({...t,...null===(e=window.serverPerfMetrics)||void 0===e?void 0:e.mark},V(t))});(0,i.useEffect)(()=>{window.addEventListener("keydown",h,{once:!0,capture:!0}),window.addEventListener("click",h,{once:!0,capture:!0});let e=g.useTracingStore.subscribe(e=>({duration:e.duration,hasInteracted:e.hasInteracted,reason:e.reason,urlActionDuration:e.urlActionDuration}),t=>{let{duration:i,hasInteracted:r,reason:a,urlActionDuration:l}=t;if(N(i,n.pathname),A(i,l),a){m.current=i,S.current=n.pathname,E(),e();return}let d=V(i),s=V(i),c=W(i);(0,u.default)(s)||O(),(0,u.default)(d)||(0,u.default)(s)||(0,u.default)(c)||(Object.keys(m.current).length||(S.current=n.pathname),m.current=i,$(),(r||o)&&(E(),e()))});return()=>{window.removeEventListener("keydown",h),window.removeEventListener("click",h),e()}},[])},J=()=>{(0,a.logPerfTiming)("chatkit_init_start"),o.chatKit.init({isEnableDebug:(0,l.isEnableDebug)(),store:{prefix:"samantha-web"}}),(0,a.logPerfTiming)("chatkit_init_finish"),q(),(0,i.useMemo)(()=>{(0,r.initFeatureConfig)()},[])}},962195:function(e,t,n){n.d(t,{useInitChatApp:function(){return L}});var i,r=n(713738),a=n(816295),o=n(368107),l=n(956801),u=n(589141),d=n(698392),s=n(831566),c=n(387978),v=n(910214),h=n(177048),f=n(198660),_=n(715056),g=n(888130),m=n(910321),p=n(178230),w=n(856392);let S=((i={}).Config="config",i.Other="other",i),y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"init_chat_app";return(0,w.createReportEvent)({eventName:n,meta:{is_retry:e,page_create_time:t,enter_pid:l.useTracingStore.getState().enterPid,"page_time.origin":-t,"page_time.start":(0,m.safelyGetNow)()-t}})},C=function(e,t){let{isGuest:n,eventName:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=y(e,t,i),a=r.success.bind(r);r.success=function(){let{meta:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return a({meta:{...e,"page_time.success":(0,m.safelyGetNow)()-t}})};let o=-1,u=-1,d=-1,s=-1;return{beforeFetchStart:e=>{if(e===S.Config){var t,n,i,r,a,d,s,c,v,h,f,_,g;o=(0,m.safelyGetNow)(),l.useTracingStore.getState().addDurationPoints({mssdk_finish:null===(t=window)||void 0===t?void 0:t.mssdkEnd,ttwid_start:null===(n=window)||void 0===n?void 0:n.ttWidStart,ttwid_finish:null===(i=window)||void 0===i?void 0:i.ttWidEnd,launch_start:null===(r=window)||void 0===r?void 0:r.launchStart,launch_finish:null===(a=window)||void 0===a?void 0:a.launchEnd,skill_guidance_finish:null===(d=window)||void 0===d?void 0:d.skillGuidanceEnd,skill_guidance_consume_start:null===(s=window)||void 0===s?void 0:s.skillGuidanceConsumeStart,skill_list_finish:null===(c=window)||void 0===c?void 0:c.skillListEnd,skill_list_consume_start:null===(v=window)||void 0===v?void 0:v.skillListConsumeStart,user_info_finish:null===(h=window)||void 0===h?void 0:h.userInfoEnd,profile_finish:null===(f=window)||void 0===f?void 0:f.profileEnd,server_libra_start:null===(_=window)||void 0===_?void 0:_.serverLibraStart,server_libra_finish:null===(g=window)||void 0===g?void 0:g.serverLibraEnd})}else u=performance.now()},afterFetchDone:e=>{e===S.Config?d=performance.now():s=performance.now()},afterFetchSuccessCheck:e=>{l.useTracingStore.setState({chatLaunchStartTime:o,chatLaunchSuccessTime:(0,m.safelyGetNow)()}),l.useTracingStore.getState().addDurationPoints({part_launch_finish:d,full_launch_start:u,full_launch_finish:s})},getLaunchOptions:()=>n?{fetchGuestDataOnly:!0}:{},event:r}};var b=n(321050),E=n(924666);let L=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];(0,E.useInitChatAppLegacy)();let[t]=(0,r.useState)((0,m.safelyGetNow)()),{showBoundary:i}=(0,c.useErrorBoundary)(),w=(0,f.useIsLoginLoading)(),{value:y}=(0,b.useIsOverallList)(),L=(0,f.useIsGuest)(),[P,F]=(0,r.useState)(),[T,k]=(0,r.useState)(),I=async function(){var e,t,n,i,r,a;let u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{autoRetry:s,isGuest:c}=u,{setLaunchData:g,pageCreateTime:m=0,setReportEvent:w,showBoundary:y}=u,b=e=>p.logger.persist.log({message:e,meta:{time:Date.now(),loginState:(0,f.getLoginState)(),autoRetry:s,isGuest:!!c}});l.useTracingStore.getState().addDurationPoint("init_chat_app_start"),"undefined"!=typeof window&&window.login_state_finish&&l.useTracingStore.getState().addDurationPoint("login_state_finish",window.login_state_finish);let E=C(!s,m,{isGuest:c,eventName:"init_chat_app_web"});null==w||w(E.event);try{let a;let u=null==E?void 0:E.event;(0,d.getChatStore)("launcherRawSettingStore").setState({launchStatus:o.LaunchStatus.Loading,settingStatus:o.LaunchStatus.Loading}),null==E||null===(e=E.beforeFetchStart)||void 0===e||e.call(E,S.Config),u.addDurationPoint("firstLaunchStart");let{data:s}=await v.samanthaApiService.GetSettingWithPrefetch({fetchGuestDataOnly:c});(0,d.getChatStore)("launcherRawSettingStore").setState({settingData:s,settingStatus:o.LaunchStatus.Success}),u.addDurationPoint("firstLaunchEnd"),null==E||null===(t=E.afterFetchDone)||void 0===t||t.call(E,S.Config);try{let{data:e}=await v.settingApiService.Launch();a=e}catch(e){throw null==E||E.event.error({reason:"full_launch_failed",error:e instanceof Error?e:Error(String(e))}),l.useTracingStore.getState().error("full_launch_failed",e instanceof Error?e:Error(String(e))),e}if(!a)throw Error("Service return empty launch data");let h=null==a?void 0:a.config;if(!h||(null==E||E.event.addDurationPoint("secondLaunchStart"),null==E||null===(n=E.beforeFetchStart)||void 0===n||n.call(E,S.Other),null==E||E.event.addDurationPoint("secondLaunchEnd"),null==E||null===(i=E.afterFetchDone)||void 0===i||i.call(E,S.Other),null==E||null===(r=E.afterFetchSuccessCheck)||void 0===r||r.call(E,a),!h))return;null==g||g(a),(0,d.getChatStore)("launcherRawSettingStore").setState({launchData:a}),l.useTracingStore.getState().addDurationPoint("init_chat_app_finish")}catch(e){if(null==E||E.event.error({error:e,reason:"part_launch_failed"}),(0,d.getChatStore)("launcherRawSettingStore").setState(e=>{let{launchStatus:t,settingStatus:n}=e;return{settingStatus:n===o.LaunchStatus.Loading?o.LaunchStatus.Failed:n,launchStatus:t===o.LaunchStatus.Loading?o.LaunchStatus.Failed:t}}),s){let t=(0,f.getLoginState)();if(b("Init error and autoRetry"),t===_.LoginState.Success)b("Init error and retry immediately"),I({...u,autoRetry:!1});else if(t===_.LoginState.Loading){b("Init error and wait to retry");let e=null,t=()=>{e&&(clearTimeout(e),e=null),n()},n=(0,f.subscribeLoginState)(e=>{e===_.LoginState.Success?(b("Init error and retry in subscribe"),I({...u,autoRetry:!1}),t()):e===_.LoginState.Failed&&t()});e=setTimeout(()=>{b("Init error and retry in timeout"),I({...u,autoRetry:!1}),t()},5e3)}else t===_.LoginState.Failed?b("Init error and skip retry because of LoginState.Failed"):null==y||y(e)}else b("Init error and not autoRetry"),l.useTracingStore.getState().error("init_chat_app_error",e),String(null===(a=e.errorOption)||void 0===a?void 0:a.code)!==String(h.ErrorCodes.USER_BANNED)&&(null==y||y(e))}};return(0,r.useEffect)(()=>{if(!w){var e;I({autoRetry:!0,isGuest:L,isOverallList:y,showBoundary:i,setLaunchData:F,pageCreateTime:t,setReportEvent:k}),L&&(null===(e=(0,g.getUserInfo)())||void 0===e?void 0:e.user_id_str)&&s.DeprecatedChatEvent.emit("chat.service.resetAll")}},[w,L,y]),(0,r.useEffect)(()=>{P&&(P&&(0,a.afterAppInitLazyLoad)(()=>n.e("64845").then(n.bind(n,371083)).then(e=>({default:e.handleLaunchData}))).then(e=>{let{default:t}=e;return t(P)}),e&&u.chatKit.initData({launchData:P}))},[P]),(0,r.useMemo)(()=>({launchData:P,reportEvent:T}),[P])}}}]);
"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["66812"],{526459:function(e,n,t){t.d(n,{CanvasPanelContainer:function(){return v}});var a=t(713738),r=t(812650),i=t.n(r),o=t(57392),l=t(666196),s=t(698392),d=t(883393),u={container:"container-lYUJLU","container-inner":"container-inner-__4VjI","container-footer":"container-footer-rlbyFI","container-outer":"container-outer-PoCILM","container-mask":"container-mask-NKqMK8","container-outer--narrow":"container-outer--narrow-sZv2dn"},c=t(345660);let v=e=>{let{children:n,disableInput:t,isExpand:r,canvasLayoutState:v,className:g,innerClassName:p}=e,h=(0,l.useChatService)("chatViewService"),f=(0,a.useRef)(null),C=(0,a.useRef)(null),x=r&&v===o.CanvasLayoutState.NARROW_SIDE_PANEL,m="sm"===(0,d.useAppSizeType)({sm:800,md:1200});return(0,a.useEffect)(()=>{if(r&&!t){let e=[o.CanvasLayoutState.SIDE_PANEL,void 0].includes(v);(0,s.getChatStore)("chatViewCanvasStore").setState({inputPortalTarget:m&&e||v===o.CanvasLayoutState.FULL_PANEL?f.current:void 0})}},[m,r,v]),(0,a.useEffect)(()=>{var e;let n=e=>e.stopPropagation();return null===(e=C.current)||void 0===e||e.addEventListener("copy",n),()=>{var e;null===(e=C.current)||void 0===e||e.removeEventListener("copy",n),(0,s.getChatStore)("chatViewCanvasStore").setState({inputPortalTarget:void 0})}},[]),(0,c.jsxs)("div",{"data-testid":"canvas_panel_container","data-visible":r,"data-state":v,className:i()(u["container-outer"],{[u["container-outer--narrow"]]:x},g),children:[m&&x&&(0,c.jsx)("div",{className:u["container-mask"],onClick:()=>h.closeCanvasPanel()}),(0,c.jsxs)("div",{className:u.container,children:[(0,c.jsx)("div",{className:i()(u["container-inner"],p),ref:C,children:n}),(0,c.jsx)("div",{className:u["container-footer"],ref:f})]})]})}},687897:function(e,n,t){t.d(n,{CanvasPluginRender:function(){return x},PluginCanvasPanel:function(){return m}});var a=t(713738),r=t(865607),i=t(666196),o=t(698392),l=t(689368),s=t(831566),d=t(426156),u=t(643404),c=t(794267),v=t(559891),g=t(526459),p=t(345660);let h=()=>(0,u.retryAsync)(()=>t.e("6447").then(t.bind(t,568007)),3,e=>1e3*e),f=(0,v.withSuspense)((0,a.lazy)(()=>h().then(e=>({default:e.NoMatchCanvasPanel})))),C=(0,v.withSuspense)((0,a.lazy)(()=>h().then(e=>({default:e.CommonLoadingCanvasPanel})))),x=(0,a.memo)(function(e){let n=(0,a.useMemo)(()=>({...e.payload,transitionStatus:e.state}),[e.payload,e.state]);return(0,a.useEffect)(()=>{"entered"===e.state&&s.DeprecatedChatEvent.emit("chat.canvas.entered")},[e.state]),(0,p.jsx)(e.plugin.Content,{...n})}),m=e=>{var n;let{containerClassName:t,adaptCanvasLayoutState:a}=e,s=(0,i.useChatService)("chatViewService"),{isExpand:u,pluginIdentifier:v,artifactLoading:h,artifactError:m,canvasLayoutState:S,preRenderNodeId:w,...E}=(0,o.useChatSlice)("chatViewCanvasStore",e=>{var n,t;let r={messageId:e.messageId||"",conversationId:e.conversationId||"",...e.canvasContent},i=null===(n=e.canvasContent)||void 0===n?void 0:n.artifactLoading,o=null===(t=e.canvasContent)||void 0===t?void 0:t.artifactError;return{isExpand:e.isExpand,pluginIdentifier:i?void 0:e.matchedCanvasPluginIdentifier,canvasLayoutState:a?a(e.canvasLayoutState):e.canvasLayoutState,artifactLoading:i,artifactError:o,preRenderNodeId:e.preRenderNodeId,...r}},r.shallow),{plugin:P,loading:_}=(0,l.useChatCanvasPlugin)(v),y=(0,c.default)(u,{wait:500});if(w)return null;if(h||!v||v&&_)return u?(0,p.jsx)(C,{}):null;if(m||!(v&&!_&&P))return(0,p.jsx)(f,{error:m||Error("no match plugin"),resetErrorBoundary:()=>s.closeCanvasPanel()});let N=u?y?"entered":"entering":y?"exiting":"exited";return(0,p.jsx)(d.ErrorBoundary,{FallbackComponent:f,errorBoundaryName:null!==(n=null==P?void 0:P.errorBoundaryName)&&void 0!==n?n:`canvas_error_${String(v)}`,children:P?(0,p.jsx)(g.CanvasPanelContainer,{isExpand:u,className:t,canvasLayoutState:S,children:(0,p.jsx)(x,{plugin:P,payload:E,state:N})}):void 0})}},284033:function(e,n,t){t.d(n,{CanvasWrapper:function(){return j}});var a=t(870539),r=t(713738),i=t(865607),o=t(678669),l=t(812650),s=t.n(l),d=t(845647),u=t(666196),c=t(698392),v=t(689368),g=t(883393),p=t(460821),h=t(794267),f=t(270061),C=t(366119),x=t(239686),m=t(178230),S=t(526459),w=t(687897),E=t(901034),P=t(928921),_=t(214492),y=t(574885),N={canvas_wrapper:"canvas_wrapper-IbhP3H",canvasWrapper:"canvas_wrapper-IbhP3H",entering:"entering-WuCxMB",entered:"entered-oOr915",exiting:"exiting-t87KU8",exited:"exited-lytMPl",unmounted:"unmounted-mqN56u",canvas_wrapper_inner:"canvas_wrapper_inner-xCm3Bf",canvasWrapperInner:"canvas_wrapper_inner-xCm3Bf"},L=t(345660);let I=Math.round(1e3/60*2),b={enter:I,exit:500},R=e=>{let{children:n,meta:t}=e;return(0,r.useEffect)(()=>{m.logger.persist.error({eventName:"canvas_mismatch_prerender_plugin",error:Error("canvas mismatch prerender plugin"),meta:t})},[]),(0,L.jsx)(L.Fragment,{children:n})},j=(0,r.forwardRef)(function(e,n){let{children:t,className:l,style:m,pluginIdentifier:j,messageId:D="",conversationId:A="",canvasContent:$,canvasLayoutState:T,disablePreRender:M}=e,O=(0,r.useId)(),B=(0,u.useChatService)("chatViewService"),z=(0,p.useCompareMemo)($,i.shallow),F="sm"===(0,g.useAppSizeType)({sm:800,md:1200}),V=`${String(j)}_${O}`,{isSelfExpand:U,isOtherExpand:W,canvasLayoutState:k,openingRect:H}=(0,c.useChatSlice)("chatViewCanvasStore",e=>{let n=e.isExpand?e.preRenderNodeId===V&&j===e.matchedCanvasPluginIdentifier?{isSelfExpand:!0,isOtherExpand:!1}:{isSelfExpand:!1,isOtherExpand:!0}:{isSelfExpand:!1,isOtherExpand:!1};return{openingRect:e.openingRect,canvasLayoutState:e.canvasLayoutState,...n}},i.shallow),[K,Y]=(0,r.useState)(),[q,X]=(0,r.useState)(),J=(0,h.default)(U,{wait:500+I}),Z=(0,h.default)(W,{wait:500+I}),G=(0,r.useMemo)(()=>({messageId:D,conversationId:A,preRenderNodeId:V,canvasLayoutState:T,exactPluginIdentifier:j,...z}),[z,D,A,T,j]),Q=(0,r.useRef)(null),[ee]=(0,f.default)(Q,{threshold:0,rootMargin:"100px 0px"}),{plugin:en,loading:et}=(0,v.useChatCanvasPlugin)(j),{run:ea}=(0,C.default)(async e=>{var n,t,a,r,i,l,s,u;let g=null===(t=Q.current)||void 0===t?void 0:null===(n=t.getBoundingClientRect)||void 0===n?void 0:n.call(t),p=en||await (0,v.getChatCanvasPlugin)(j),h=M||!p||F||d.ChatType.ThreadLocalConversation===(null===(a=(0,c.getChatSlice)("chatViewCoreStore").currentChatViewConfig)||void 0===a?void 0:a.chatType);p?null==B||null===(r=B.openCanvasPanel)||void 0===r||r.call(B,(0,o.default)(G,h?["preRenderNodeId"]:[]),g,null!==(i=null==e?void 0:e.isAutoOpen)&&void 0!==i?i:void 0):null==B||null===(l=B.openCanvasPanel)||void 0===l||l.call(B,(0,o.default)(G,h?["preRenderNodeId"]:[]),null!==(s=null==e?void 0:e.targetRect)&&void 0!==s?s:g,null!==(u=null==e?void 0:e.isAutoOpen)&&void 0!==u?u:void 0)},{leading:!0,trailing:!1});(0,r.useImperativeHandle)(n,()=>({open:ea,getRootElement:()=>Q.current}),[]);let{run:er}=(0,C.default)(()=>{var e;return U&&(null==B?void 0:null===(e=B.closeCanvasPanel)||void 0===e?void 0:e.call(B))},{wait:300,leading:!0,trailing:!1});(0,x.default)(er);let ei=(0,c.useChatSlice)("sidebarStore",e=>e.isExpand),{sashPct:eo,matchedPluginName:el}=(0,E.useFlowWebSashPct)(),{dragging:es,sashRef:ed,onDrag:eu,onDragEnd:ec}=(0,P.useSashDragging)(el);return t?M||j&&et?(0,L.jsx)(L.Fragment,{children:t}):j&&!et&&en?(0,L.jsxs)("div",{className:s()("relative w-fit",l),style:m,ref:Q,children:[t,void 0!==ee&&(0,L.jsx)(a.default,{in:U,enter:!(Z||J),mountOnEnter:!ee,unmountOnExit:!ee,timeout:b,onEnter:e=>(0,r.startTransition)(()=>{var n;X(void 0),Y(null==e?void 0:null===(n=e.getBoundingClientRect)||void 0===n?void 0:n.call(e))}),onEntered:()=>Y(void 0),onExit:e=>X(null==e?void 0:e.getBoundingClientRect()),onExited:()=>X(void 0),children:e=>{var n,t,a,r,i;let o=U&&Z||W&&J||!!(null===(n=ed.current)||void 0===n?void 0:n.dragging),l=o?e:"entered"===e?J?"entered":"entering":"exited"===e?J?"exiting":"exited":e;return(0,L.jsxs)("div",{className:s()(N.canvas_wrapper,N[e]),"data-testid":"canvas-wrapper",style:{...H?{"--right-rect-left":`${null==H?void 0:H.left}px`,"--right-rect-top":`${null==H?void 0:H.top}px`,"--right-rect-width":`${null==H?void 0:H.width}px`,"--right-rect-height":`${null==H?void 0:H.height}px`}:{},...q?{"--leaving-rect-width":`${null==q?void 0:q.width}px`,"--leaving-rect-right":`${null==q?void 0:q.right}px`}:{},"--offset-width":`${null!==(r=null==H?void 0:H.width)&&void 0!==r?r:null==Q?void 0:null===(t=Q.current)||void 0===t?void 0:t.offsetWidth}px`,"--offset-height":`${null!==(i=null==H?void 0:H.height)&&void 0!==i?i:null==Q?void 0:null===(a=Q.current)||void 0===a?void 0:a.offsetHeight}px`,transition:o?"none":void 0,"--left-side-width":ei?`${_.LEFT_SIDE_WIDTH}px`:"0px","--sash-pct":void 0===eo?`calc(${_.CENTER_DEFAULT_PCT}vw + var(--left-side-width))`:`${eo}vw`},children:["entered"===l&&(0,L.jsx)(y.Sash,{ref:ed,className:"absolute w-6 -left-3 h-full",style:{zIndex:1002},onDrag:eu,onDragEnd:ec}),(0,L.jsx)(S.CanvasPanelContainer,{isExpand:U,canvasLayoutState:k,innerClassName:N.canvas_wrapper_inner,className:es?"pointer-events-none":void 0,children:en?(0,L.jsx)(w.CanvasPluginRender,{plugin:en,payload:G,state:l}):void 0})]})}},ee||U||J?`open_${O}`:`close_${O}`)]}):(0,L.jsx)(R,{meta:{plugin_identifier:j?String(j):void 0},children:t}):null})},574885:function(e,n,t){t.d(n,{Sash:function(){return u}});var a=t(713738),r=t(812650),i=t.n(r),o=t(273637),l=t(626803),s=t(751825),d=t(345660);let u=(0,a.forwardRef)(function(e,n){let{orientation:t="horizontal",onDrag:r,onDragEnd:u,className:c,style:v}=e,g=(0,o.default)(r),p=(0,o.default)(u),{current:h}=(0,a.useRef)({dragging:!1,startPos:0,curPos:0}),f=(0,a.useRef)(null),[,C]=(0,l.useForceUpdate)(),{run:x}=(0,s.default)(e=>{if(!h.dragging)return;let n={delta:e-h.curPos,curPos:e,prevPos:h.curPos,startPos:h.startPos};h.curPos=e,g(n)},{leading:!0,trailing:!0,wait:15}),m=(0,a.useCallback)(e=>{x("horizontal"===t?e.clientX:e.clientY)},[t]),S=(0,a.useCallback)(e=>{var n;h.dragging&&(h.dragging=!1,null===(n=f.current)||void 0===n||n.releasePointerCapture(e.pointerId),null==p||p(),C())},[]);return(0,a.useImperativeHandle)(n,()=>({get dragging(){return h.dragging}}),[]),(0,d.jsxs)("div",{className:i()("sash flex flex-col items-center","opacity-0 hover:opacity-60 active:opacity-100 transition-opacity",c),style:{cursor:"horizontal"===t?"col-resize":"row-resize",...(null==h?void 0:h.dragging)?{opacity:1}:{},...v},"data-testid":"chat_route_layout_sash",onPointerDown:e=>{var n;e.preventDefault(),h.dragging=!0,h.curPos=h.startPos="horizontal"===t?e.clientX:e.clientY,null===(n=f.current)||void 0===n||n.setPointerCapture(e.pointerId)},onPointerUp:S,onPointerMove:m,ref:f,children:[(0,d.jsx)("div",{className:"bg-s-color-border-primary w-1 flex-1 min-h-0"}),(0,d.jsx)("div",{className:"w-6 h-20 flex-shrink-0 border-[1px] border-solid border-s-color-border-primary bg-s-color-bg-body rounded-3"}),(0,d.jsx)("div",{className:"bg-s-color-border-primary w-1 flex-1 min-h-0"})]})})},928921:function(e,n,t){t.d(n,{useSashDragging:function(){return s}});var a=t(713738),r=t(698392),i=t(626803),o=t(214492);let l=(e,n)=>Number((100*e/n).toFixed(2)),s=(e,n)=>{var t;let s=(0,a.useRef)(null),d=(0,a.useCallback)(n=>{let{curPos:t}=n;e&&((0,r.getChatStore)("chatViewCanvasStore").setState(n=>{let{sashPctMap:a}=n;return{sashPctMap:{...a,[e]:l(t,document.body.clientWidth)}}}),t<=o.CENTER_MIN_WIDTH&&(0,r.getChatStore)("sidebarStore").setState(()=>({isExpand:!1})))},[e]),[,u]=(0,i.useForceUpdate)();return{sashRef:s,onDrag:d,onDragEnd:n?()=>{n(),u()}:u,dragging:null===(t=s.current)||void 0===t?void 0:t.dragging}}}}]);
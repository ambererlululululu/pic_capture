"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["94914"],{414459:function(e,n,t){t.d(n,{DotFlashing:function(){return l}});var o=t(812650),a=t.n(o),r="circle-INrrw2",i=t(345660);let l=e=>{let{disabled:n=!1,...t}=e;return(0,i.jsxs)("div",{...t,className:a()("dot-flashing-GPOXhx",{"disabled-r1DH5f":n}),children:[(0,i.jsx)("div",{className:r}),(0,i.jsx)("div",{className:r})]})}},255804:function(e,n,t){t.d(n,{ExternalLink:function(){return i}});var o=t(166952);function a(e,n,t){var o;return(n="symbol"==typeof(o=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(n,"string"))?o:o+"")in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}let r=[["d","o","u","b","a","o",".","c","o","m"],["c","i","c","i","a","i",".","c","o","m"],["t","i","k","t","o","k",".","c","o","m"],["d","o","u","y","i","n",".","c","o","m"],["b","y","t","e","d","a","n","c","e",".","c","o","m"]].map(e=>e.join(""));class i{static isExternalLink(e){let{hostname:n}=window.location;if(!(0,o.isAbsoluteUrl)(e))return!1;let t=!1;try{let o=new URL(e).hostname.toLocaleLowerCase();t=!(o===n||i.whitelist.some(e=>o.endsWith(`.${e}`)||o===e))}catch(e){}return t}static updateConfig(e){void 0!==e.needInterceptExternalLink&&(i.needInterceptExternalLink=e.needInterceptExternalLink),void 0!==e.whitelist&&(i.whitelist=[...r,...e.whitelist||[]])}static transformExternalLink(e){return i.needInterceptExternalLink&&e&&i.isExternalLink(e)?`https://www.doubao.com/to?target=${encodeURIComponent(e)}`:e}getWhitelist(){return i.whitelist}constructor(){}}a(i,"needInterceptExternalLink",!1),a(i,"whitelist",[...r])},379575:function(e,n,t){t.d(n,{useFirstScreenInView:function(){return l}});var o=t(713738),a=t(385093);let r=(e,n,t)=>e>=n&&e<=t,i=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{top:t,left:o,bottom:a,right:i}=e.getBoundingClientRect(),{topOffset:l=0,bottomOffset:s=0,leftOffset:d=0,rightOffset:c=0}=n,u=window.innerWidth||document.documentElement.clientWidth,_=window.innerHeight||document.documentElement.clientHeight;return(r(t,-l,_+s)||r(a,-l,_+s)||t<-l&&a>_+s)&&(r(o,-d,u+c)||r(i,-d,u+c)||o<-d&&i>u+c)},l=e=>{let{ref:n,...t}=e,[r,l]=(0,o.useState)(!1);return(0,o.useLayoutEffect)(()=>{let e=(0,a.default)(n)?n():n.current;e&&i(e,t)&&l(!0)},[]),{ref:n,inView:r}}},848504:function(e,n,t){t.d(n,{useFPSPassive:function(){return r}});var o=t(713738),a=t(297547);let r=e=>{let{interval:n=1e3,onChange:t}=e,r=(0,o.useRef)(-1),i=(0,o.useRef)(0),l=(0,o.useRef)(0),s=(0,o.useRef)(0),d=(0,a.default)(function(e){0===s.current&&(s.current=e),l.current++,e-s.current>=n&&(i.current=Math.round(1e3*l.current/(e-s.current)),null==t||t(i.current),l.current=0,s.current=e),r.current=window.requestAnimationFrame(d)}),c=(0,a.default)(()=>{l.current=0,s.current=0,r.current=window.requestAnimationFrame(d)}),u=(0,a.default)(()=>{r.current&&window.cancelAnimationFrame(r.current)});return{fps:i.current,start:c,stop:u}}},555853:function(e,n,t){t.d(n,{DiagramBlock:function(){return y}});var o=t(456602),a=t(650543),r=t(55845),i=t(874487),l=t(143475),s=t(959601),d=t(983785),c=t(476698),u=t(713738),_=t(812650),m=t.n(_),g=t(441259),v=t(250953),p=t(421298),h=t(275259),f=t(214902),w=t(774890),x={panel:"panel-Ec5ovo",container:"container-ms5nN3",copyDropdownWrapper:"copyDropdownWrapper-nc9XIl",divider:"divider-htXWZv",actionBtn:"actionBtn-qRmasm",disabled:"disabled-P5nDJG"},b=t(345660);let y=(0,u.forwardRef)(function(e,n){let{className:t,diagram:_,code:y,i18nConfig:C,hideDownload:k,onDownloadImage:T,onCopyImage:S,onCopyHtml:E,onZoomOut:I,onZoomIn:j,onZoomFit:M,onFullScreenEnter:D,onCopyText:R,onTabChange:F,getPopupContainer:N,enableCopyImage:z=!0,enableCopyRichText:B=!0,enableZoom:P=!0,disabled:L=!1,defaultActiveKey:O=w.TabKey.Diagram,customRenderTabTools:H,disableDiagram:K=!1,panelStyle:Z}=e,[V,A]=(0,u.useState)(O);(0,u.useImperativeHandle)(n,()=>({switchTab:A}));let[U,G]=(0,u.useState)(!1),W=(0,g.getIsIPad)();return(0,b.jsx)("div",{className:m()("h-380 bg-s-color-bg-content-base rounded-s-radius-xxss overflow-hidden border border-solid border-s-color-border-tertiary",x.container,t),children:(0,b.jsxs)(v.default,{type:"button",className:x.panel,renderTabBar:(e,n)=>{let{activeKey:t}=e,u=!1,_=null;"function"==typeof H&&(u=!0,_=H(t));let g=[{node:"item",name:C.downloadImage,onClick:T,disabled:L},z?{node:"item",name:C.copyImage,onClick:S,disabled:L}:void 0,B?{node:"item",name:C.copyRichText,onClick:E,disabled:L}:void 0].filter(Boolean);return(0,b.jsxs)("div",{className:"relative flex items-center h-42 bg-s-color-bg-quaternary rounded-t-s-radius-xxss p-6 pr-12",children:[(0,b.jsx)(n,{...e}),u?_:null,t!==w.TabKey.Diagram||u?null:(0,b.jsxs)("div",{className:"flex grow justify-end items-center",children:[k?null:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.SamanthaDropdown,{trigger:"hover",menu:g,spacing:8,className:x.copyDropdownWrapper,getPopupContainer:N,clickToHide:!0,children:(0,b.jsxs)("div",{className:m()(x.actionBtn,L&&x.disabled,"!mr-0 !py-0 !px-2"),"data-testid":"diagram-download-btn",children:[(0,b.jsx)(c.default,{className:"p-4"}),(0,b.jsx)(d.default,{className:"text-8"})]})}),(0,b.jsx)("div",{className:x.divider})]}),P?(0,b.jsx)(f.SamanthaTooltip,{content:W?void 0:C.zoomOut,getPopupContainer:N,spacing:{y:12,x:0},children:(0,b.jsx)("div",{className:m()(x.actionBtn,L&&x.disabled),"data-testid":"diagram-zoom-out-btn",onClick:()=>{L||null==I||I()},children:(0,b.jsx)(s.default,{})})}):null,P?(0,b.jsx)(f.SamanthaTooltip,{content:W?void 0:C.zoomIn,getPopupContainer:N,spacing:{y:12,x:0},children:(0,b.jsx)("div",{className:m()(x.actionBtn,L&&x.disabled),"data-testid":"diagram-zoom-in-btn",onClick:()=>{L||null==j||j()},children:(0,b.jsx)(l.default,{})})}):null,P?(0,b.jsx)(f.SamanthaTooltip,{content:W?void 0:C.fitPage,getPopupContainer:N,spacing:{y:12,x:0},children:(0,b.jsx)("div",{className:m()(x.actionBtn,L&&x.disabled),"data-testid":"diagram-zoom-fit-btn",onClick:()=>{L||null==M||M()},children:(0,b.jsx)(i.default,{})})}):null,(0,b.jsx)(f.SamanthaTooltip,{content:W?void 0:C.fullscreenView,getPopupContainer:N,spacing:{y:12,x:0},children:(0,b.jsx)("div",{className:m()(x.actionBtn,L&&x.disabled,"!mr-0"),onClick:()=>{L||null==D||D(t)},"data-testid":"diagram-fullscreen-btn",children:(0,b.jsx)(r.default,{})})})]}),t!==w.TabKey.Code||u?null:(0,b.jsx)("div",{className:"flex grow justify-end items-center",children:(0,b.jsx)(f.SamanthaTooltip,{content:U?C.copyDoneText:C.copyText,getPopupContainer:N,spacing:{y:12,x:0},children:(0,b.jsx)("div",{"data-testid":"diagram-copy-btn",className:m()(x.actionBtn,"!mr-0"),onClick:()=>{null==R||R(),G(!0),setTimeout(()=>{G(!1)},3e3)},children:U?(0,b.jsx)(o.default,{}):(0,b.jsx)(a.default,{})})})})]})},onChange:e=>{A(e),null==F||F(e)},activeKey:V,defaultActiveKey:O,children:[_?(0,b.jsx)(p.default,{tab:C.diagramTitle,itemKey:w.TabKey.Diagram,className:"h-full relative",disabled:K,style:Z,children:_}):null,y?(0,b.jsx)(p.default,{tab:C.codeTitle,itemKey:w.TabKey.Code,className:"h-full relative",style:Z,children:y}):null]})})})},774890:function(e,n,t){var o;t.d(n,{TabKey:function(){return a}});let a=((o={}).Diagram="1",o.Code="2",o)},220:function(e,n,t){t.d(n,{useFPSReport:function(){return l},useScrollFPSReport:function(){return s},useStreamFPSReport:function(){return d}});var o=t(713738),a=t(297547),r=t(848504),i=t(178230);let l=e=>{let{eventName:n,interval:t}=e,l=(0,o.useRef)([]),s=(0,a.default)(e=>{l.current.length>=120&&l.current.shift(),l.current.push(e)}),{start:d,stop:c}=(0,r.useFPSPassive)({interval:t,onChange:s});return{startRecord:(0,a.default)(()=>{l.current=[],d()}),reportFPS:(0,a.default)(e=>{c();let t=l.current;if(t.length<1)return;let o=Math.round(t.reduce((e,n)=>e+n,0)/t.length),a=t.reduce((e,n)=>(n<20&&e++,e),0)>=3,r=t.reduce((e,n)=>(n<10&&e++,e),0)>=3,s=t.reduce((e,n)=>(n<3&&e++,e),0)>=3;i.logger.persist.info({eventName:n,meta:{fps_list:t,avg_fps:o,is_minor_stuck:a,is_major_stuck:r,is_critical_stuck:s,...e}})})}},s=e=>{let{eventName:n}=e,t=(0,o.useRef)(!1),a=(0,o.useRef)(),{startRecord:r,reportFPS:s}=l({eventName:n}),d=e=>{a.current=setTimeout(()=>{s(e),t.current=!1},5e3)};return{onScrollForFPS:e=>{t.current?clearTimeout(a.current):(i.logger.persist.info({eventName:n,meta:{...e,type:"start"}}),t.current=!0,r()),d(e)}}},d=e=>{let{eventName:n}=e,{startRecord:t,reportFPS:a}=l({eventName:n}),r=(0,o.useRef)(!1);return{startFPSRecord:()=>{r.current||(r.current=!0,t())},stopFPSRecord:e=>{r.current=!1,a(e)}}}},951678:function(e,n,t){t.r(n),t.d(n,{CodeBlockSplitter:function(){return U}});var o=t(713738),a=t(436114),r=t(678669),i=t(579163),l=t.n(i),s=t(777422),d=t(774890),c=t(555853),u=t(915299),_=t(221062),m=t(48766),g=t(352498),v=t(913821),p=t(83990),h=t(637319),f=t(334312);let w=e=>{var n;let{trackEvent:t,messageLink:a,message:r,conversationId:i,reportParams:l={},codeBlockPosition:s}=e,d=null!==(n=(0,p.useMessageStore)(e=>{var n,t,o;if(!r){if(!a)return{};r=(0,h.getMessageSelector)(e,i||"",a)}return{message_id:null==r?void 0:r.message_id,conversation_id:i,skill_id:String(null==r?void 0:null===(n=r.skill)||void 0===n?void 0:n.skill_type)||"",skill_name:(null==r?void 0:null===(t=r.skill)||void 0===t?void 0:t.skill_type)?(0,f.getSkillTeaNameByType)(null==r?void 0:null===(o=r.skill)||void 0===o?void 0:o.skill_type):""}},v.default))&&void 0!==n?n:{},c=e=>{let{isFullscreen:n}=e;return{...d,whether_full_screen:n?"1":"0",position:s}},u=e=>n=>t("mind_map_click",{...c({isFullscreen:n}),...l,button_name:e}),_=(e,n)=>{t("mind_map_show",{...c({isFullscreen:e}),...l,if_success:"boolean"==typeof n?n?"1":"0":void 0})},m=e=>{t("copy",{...c({isFullscreen:e}),click_from:"read_graph"})},g=e=>{t("download",{...c({isFullscreen:e}),click_from:"read_graph"})};return(0,o.useMemo)(()=>({onDownload:e=>{u("download")(e),g(e)},onCopyCode:e=>{u("copy_code")(e),m(e)},onCopyImg:e=>{u("copy_mind_map_image")(e),m(e)},onCopyHtml:e=>{u("copy_mind_map_text")(e),m(e)},onZoomIn:u("zoom_in"),onZoomOut:u("zoom_out"),onZoomFit:u("zoom_fit"),onEnterFullscreen:()=>{u("fullscreen")(),_(!0,!0)},onMindMapShow:_,onTabChange:e=>{let{buttonName:n}=e;return u(n)()}}),[])};var x=t(584265);let b=(0,o.createContext)({});var y=()=>(0,o.useContext)(b),C=t(335575),k=t(345660);let T=e=>{var n,t,i,v,p,h;let{code:f,loading:b,onPreview:T,viewOnly:S,messageLink:E,message:I,conversationId:j,customHandleEnterFullscreen:M,hideDownload:D,className:R}=e,F=(0,u.useTranslateFn)(),N=y(),z=M||N.customHandleEnterFullscreen,[B,P]=(0,o.useState)(d.TabKey.Diagram),[L,O]=(0,o.useState)(f),H=(0,o.useRef)(null),K=(0,x.useCodeBlockPosition)(f,I),Z=w({trackEvent:s.trackEvent,messageLink:E,message:I,conversationId:j,reportParams:{graph_type:"mind_map"},codeBlockPosition:K}),V={onDownloadImage:null===(n=H.current)||void 0===n?void 0:n.downloadImage,onCopyImage:null===(t=H.current)||void 0===t?void 0:t.copyImage,onCopyHtml:null===(i=H.current)||void 0===i?void 0:i.copyHtml,onZoomOut:null===(v=H.current)||void 0===v?void 0:v.zoomOut,onZoomIn:null===(p=H.current)||void 0===p?void 0:p.zoomIn,onZoomFit:null===(h=H.current)||void 0===h?void 0:h.zoomFit,onFullScreenEnter:e=>{if(z){z({key:e,diagramCode:L,diagramType:"mindmap"});return}if(e===d.TabKey.Diagram){var n,t;null===(t=H.current)||void 0===t||null===(n=t.enterFullscreen)||void 0===n||n.call(t);return}null==T||T(f)},onCopyText:()=>{var e;l()(f),null===(e=Z.onCopyCode)||void 0===e||e.call(Z)},onTabChange:e=>{P(e),Z.onTabChange({buttonName:e===d.TabKey.Diagram?"graph":"code"})}},A=(0,o.useRef)({initialExpandLevel:4});(0,o.useEffect)(()=>{B===d.TabKey.Diagram&&f!==L&&O(f)},[B,f]),(0,o.useEffect)(()=>{Z.onMindMapShow(!1,!0)},[]);let U=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-Kka3Vn",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:F("deepResearch_tool_gencode_generating")})]}),[F]);return(0,k.jsx)(c.DiagramBlock,{...V,hideDownload:D,disabled:b,className:R,i18nConfig:{diagramTitle:F("web_ai_coding_canvas_preview"),codeTitle:F("mindmap_previewer_tab_code"),downloadImage:F("flow_web_ext_search_mindmap_download"),copyImage:F("flow_web_ext_search_mindmap_copy"),copyRichText:F("flow_web_ext_mindmap_copy_rich_text"),zoomIn:F("flow_web_ext_search_mindmap_zoom_in"),zoomOut:F("flow_web_ext_search_mindmap_zoom_out"),fitPage:F("flow_web_ext_search_mindmap_fit"),fullscreenView:F("flow_web_ext_search_mindmap_full"),copyText:F("skill_search_copytext"),copyDoneText:F("text_copied_tip")},diagram:(0,k.jsx)(_.default,{actionButtonRef:H,t:F,value:L,handleRetry:a.default,extName:F("brandName_doubao"),iconUrl:g,isDone:!b,className:"mindmap-container-eBS3ZQ",actionButtonClassName:"action-button-container-gs6UX5",maxHeight:336,minHeight:336,markmapOptions:A.current,hideAction:!0,inMessage:!0,customHandleEnterFullscreen:z?()=>z({key:d.TabKey.Diagram,diagramCode:L,diagramType:"mindmap"}):void 0,...(0,r.default)(Z,["onCopyCode","onTabChange"])}),code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:f,className:"!m-0 !rounded-none !border-none",contentClassName:"!max-h-336 !border-none",codeAreaClassName:"!rounded-none",viewOnly:S,language:"mindmap"}),customRenderTabTools:b?U:void 0})};var S=t(60113);let E=()=>{let[e,n]=(0,o.useState)(!1);return{fullscreenVisible:e,handleEnterFullscreen:()=>{n(!0)},handleExitFullscreen:()=>{n(!1)}}};var I=t(346348),j=t(651089),M=t(254943),D=t(178230);let R=e=>{let{code:n,onPreview:t,loading:a,viewOnly:r,messageLink:i,message:_,conversationId:g,customHandleEnterFullscreen:v,className:p}=e,h=y(),f=v||h.customHandleEnterFullscreen,b=(0,x.useCodeBlockPosition)(n,_),T=w({trackEvent:s.trackEvent,messageLink:i,message:_,conversationId:g,reportParams:{graph_type:"mermaid"},codeBlockPosition:b}),R=(0,u.useTranslateFn)(),{fullscreenVisible:F,handleEnterFullscreen:N,handleExitFullscreen:z}=E(),B=(0,o.useRef)(null),P=(0,o.useRef)(null),{svgContainerRef:L,downloadImage:O,copyImage:H}=(0,j.useDiagramExporter)(),[K,Z]=(0,o.useState)(!1),V=e=>({onZoomIn:()=>{var n;null===(n=e.current)||void 0===n||n.zoomIn(),T.onZoomIn(F)},onZoomOut:()=>{var n;null===(n=e.current)||void 0===n||n.zoomOut(),T.onZoomOut(F)},onZoomFit:()=>{var n;null===(n=e.current)||void 0===n||n.fit(),T.onZoomFit(F)},onCopyText:()=>{l()(n),T.onCopyCode(F)},onTabChange:e=>{T.onTabChange({buttonName:e===d.TabKey.Diagram?"graph":"code"})},onFullScreenEnter:e=>{if(f){f({key:e,diagramCode:n,diagramType:"mermaid"});return}if(T.onEnterFullscreen(),e===d.TabKey.Diagram){N();return}null==t||t(n)},onDownloadImage:()=>{O(),T.onDownload(F)},onCopyImage:()=>{H(),T.onCopyImg(F)}}),A=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D.logger.persist.error({eventName:"mermaid_render_error",error:e,meta:n}),T.onMindMapShow(!1,!1)},U=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Z(!0),A(e,n)},G=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.logger.persist.success({eventName:"mermaid_render_success",meta:e}),T.onMindMapShow(!1,!0)},W=(0,o.useMemo)(()=>({errorText:R("reading_mindmap_toast_reAsk")}),[R]),q=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-nFDopF",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:R("deepResearch_tool_gencode_generating")})]}),[R]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c.DiagramBlock,{...V(B),disabled:K,className:p,enableCopyRichText:!1,i18nConfig:{diagramTitle:R("web_ai_coding_canvas_preview"),codeTitle:R("mindmap_previewer_tab_code"),downloadImage:R("flow_web_ext_search_mindmap_download"),copyImage:R("flow_web_ext_search_mindmap_copy"),copyRichText:R("flow_web_ext_mindmap_copy_rich_text"),zoomIn:R("flow_web_ext_search_mindmap_zoom_in"),zoomOut:R("flow_web_ext_search_mindmap_zoom_out"),fitPage:R("flow_web_ext_search_mindmap_fit"),fullscreenView:R("flow_web_ext_search_mindmap_full"),copyText:R("skill_search_copytext"),copyDoneText:R("text_copied_tip")},diagram:(0,k.jsx)(S.MermaidDiagram,{chart:n,ref:B,loading:a,onError:U,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G({...e,from:"message"})},i18nConfig:W}),code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:n,className:"!m-0 !rounded-none !border-none",contentClassName:"!max-h-336 !border-none",codeAreaClassName:"!rounded-none",viewOnly:r,language:"mermaid"}),customRenderTabTools:a?q:void 0}),F?(0,k.jsx)(I.FullscreenDiagram,{...V(P),disabled:K,i18nConfig:{downloadImage:R("flow_web_ext_search_mindmap_download"),copyImage:R("flow_web_ext_search_mindmap_copy"),copyHtml:R("flow_web_ext_mindmap_copy_rich_text"),zoomIn:R("flow_web_ext_search_mindmap_zoom_in"),zoomOut:R("flow_web_ext_search_mindmap_zoom_out"),zoomFit:R("flow_web_ext_search_mindmap_fit"),close:R("flow_web_ext_close_upper_case")},onCloseClick:z,enableCopyRichText:!1,children:(0,k.jsx)(S.MermaidDiagram,{chart:n,loading:a,ref:P,onError:U,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G({...e,from:"fullscreen"})},i18nConfig:W})}):null,(0,k.jsx)(M.DiagramExporter,{i18nConfig:{brandName:R("brandName_doubao"),brandDesc:R("flow_web_ext_search_share_pic_doubao")},svgContainerRef:L,children:(0,k.jsx)(S.MermaidDiagram,{chart:n,loading:a,onError:U,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return G({...e,from:"exporter"})},i18nConfig:W})})]})};var F=t(628833),N=t(18089);let z=e=>{let{code:n,onPreview:t,loading:a,viewOnly:r,messageLink:i,message:_,conversationId:g,customHandleEnterFullscreen:v}=e,p=(0,x.useCodeBlockPosition)(n,_),h=w({trackEvent:s.trackEvent,messageLink:i,message:_,conversationId:g,reportParams:{graph_type:"svg"},codeBlockPosition:p}),f=(0,u.useTranslateFn)(),{fullscreenVisible:b,handleEnterFullscreen:y,handleExitFullscreen:T}=E(),S=(0,o.useRef)(null),R=(0,o.useRef)(null),{svgContainerRef:z,copyImage:B}=(0,j.useDiagramExporter)({exportSvgSelf:!0}),[P,L]=(0,o.useState)(!1),O=e=>({onZoomIn:()=>{var n;null===(n=e.current)||void 0===n||n.zoomIn(),h.onZoomIn(b)},onZoomOut:()=>{var n;null===(n=e.current)||void 0===n||n.zoomOut(),h.onZoomOut(b)},onZoomFit:()=>{var n;null===(n=e.current)||void 0===n||n.fit(),h.onZoomFit(b)},onCopyText:()=>{l()(n),h.onCopyCode(b)},onTabChange:n=>{if(n===d.TabKey.Diagram){var t;null===(t=e.current)||void 0===t||t.fit()}h.onTabChange({buttonName:n===d.TabKey.Diagram?"graph":"code"})},onFullScreenEnter:e=>{if(v){v(e);return}if(h.onEnterFullscreen(),e===d.TabKey.Diagram){y();return}null==t||t(n)},onDownloadImage:()=>{!function(e){let n=new Blob([e],{type:"image/svg+xml"}),t=URL.createObjectURL(n);(0,N.downloadImg)(t,"svg"),URL.revokeObjectURL(t)}(n),h.onDownload(b)},onCopyImage:()=>{B(),h.onCopyImg(b)}}),H=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D.logger.persist.error({eventName:"svg_render_error",error:e,meta:n}),h.onMindMapShow(!1,!1)},K=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};L(!0),H(e,n)},Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.logger.persist.success({eventName:"svg_render_success",meta:e}),h.onMindMapShow(!1,!0)},V=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-MDl1Dn",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:f("deepResearch_tool_gencode_generating")})]}),[f]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c.DiagramBlock,{...O(S),disabled:P,enableCopyRichText:!1,i18nConfig:{diagramTitle:f("web_ai_coding_canvas_preview"),codeTitle:f("mindmap_previewer_tab_code"),downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyRichText:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),fitPage:f("flow_web_ext_search_mindmap_fit"),fullscreenView:f("flow_web_ext_search_mindmap_full"),copyText:f("skill_search_copytext"),copyDoneText:f("text_copied_tip")},diagram:(0,k.jsx)(F.SVGRenderer,{code:n,ref:S,loading:a,onError:K,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z({...e,from:"message"})}}),code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:n,className:"!m-0 !h-full overflow-auto !rounded-none !border-none",codeAreaClassName:"!rounded-none !h-full",viewOnly:r,contentClassName:"!border-none !rounded-none min-h-full",language:"svg"}),customRenderTabTools:a?V:void 0}),b?(0,k.jsx)(I.FullscreenDiagram,{...O(R),disabled:P,i18nConfig:{downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyHtml:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),zoomFit:f("flow_web_ext_search_mindmap_fit"),close:f("flow_web_ext_close_upper_case")},onCloseClick:T,enableCopyRichText:!1,children:(0,k.jsx)(F.SVGRenderer,{code:n,loading:a,ref:R,onError:K,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z({...e,from:"fullscreen"})}})}):null,(0,k.jsx)(M.DiagramExporter,{i18nConfig:{brandName:f("brandName_doubao"),brandDesc:f("flow_web_ext_search_share_pic_doubao")},svgContainerRef:z,children:(0,k.jsx)(F.SVGRenderer,{code:n,loading:a,onError:K,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Z({...e,from:"exporter"})}})})]})},B=(0,o.lazy)(()=>Promise.all([t.e("67885"),t.e("42967"),t.e("98093"),t.e("19906")]).then(t.bind(t,977513)).then(e=>({default:e.HTMLRenderer}))),P=e=>{var n,t;let{code:a,onPreview:r,loading:i,viewOnly:_,conversationId:g,messageLink:v,message:p,customHandleEnterFullscreen:h}=e,f=(0,x.useCodeBlockPosition)(a,p),b=w({trackEvent:s.trackEvent,messageLink:v,message:p,conversationId:g,reportParams:{graph_type:"html"},codeBlockPosition:f}),y=(0,u.useTranslateFn)(),{fullscreenVisible:T,handleEnterFullscreen:S,handleExitFullscreen:j}=E(),M=(0,o.useRef)(null),[R,F]=(0,o.useState)(!1),z=e=>({onCopyText:()=>{l()(a),b.onCopyCode(T)},onTabChange:e=>{b.onTabChange({buttonName:e===d.TabKey.Diagram?"graph":"code"})},onFullScreenEnter:e=>{if(h){h(e);return}if(b.onEnterFullscreen(),e===d.TabKey.Diagram){S();return}null==r||r(a)},onDownloadImage:()=>{var n;let t=null===(n=e.current)||void 0===n?void 0:n.exportImage();t&&t.then(e=>{(0,N.downloadImg)(e)}),b.onDownload(T)},onCopyImage:()=>{var n;let t=null===(n=e.current)||void 0===n?void 0:n.exportImage();t&&t.then(e=>{(0,N.copyBase64)(e)}),b.onCopyImg(T)}}),P=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D.logger.persist.error({eventName:"html_render_error",error:e,meta:n}),b.onMindMapShow(!1,!1)},L=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(!0),P(e,n)},O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.logger.persist.success({eventName:"html_render_success",meta:e}),b.onMindMapShow(!1,!0)},[H,K]=(0,o.useState)(void 0),Z=(0,o.useCallback)(e=>{(null==e?void 0:e.height)&&K(e.height)},[]),V=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-fjx4sN",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:y("deepResearch_tool_gencode_generating")})]}),[y]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c.DiagramBlock,{...z(M),className:"container-GgE4A3",disabled:R,enableCopyRichText:!1,enableZoom:!1,i18nConfig:{diagramTitle:y("web_ai_coding_canvas_preview"),codeTitle:y("mindmap_previewer_tab_code"),downloadImage:y("flow_web_ext_search_mindmap_download"),copyImage:y("flow_web_ext_search_mindmap_copy"),copyRichText:y("flow_web_ext_mindmap_copy_rich_text"),zoomIn:y("flow_web_ext_search_mindmap_zoom_in"),zoomOut:y("flow_web_ext_search_mindmap_zoom_out"),fitPage:y("flow_web_ext_search_mindmap_fit"),fullscreenView:y("flow_web_ext_search_mindmap_full"),copyText:y("skill_search_copytext"),copyDoneText:y("text_copied_tip")},diagram:(0,k.jsx)(B,{uniqueId:null!==(n=null==p?void 0:p.message_id)&&void 0!==n?n:"",code:a,ref:M,loading:i,onError:L,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return O({...e,from:"message"})},onPreviewSizeChanged:Z}),panelStyle:{height:H},code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:a,className:"!m-0 !h-full overflow-auto !rounded-none !border-none",codeAreaClassName:"!rounded-none !h-full",viewOnly:_,contentClassName:"!border-none !rounded-none min-h-full",language:"html"}),customRenderTabTools:i?V:void 0}),T?(0,k.jsx)(I.FullscreenDiagram,{...z(M),disabled:R,i18nConfig:{downloadImage:y("flow_web_ext_search_mindmap_download"),copyImage:y("flow_web_ext_search_mindmap_copy"),copyHtml:y("flow_web_ext_mindmap_copy_rich_text"),zoomIn:y("flow_web_ext_search_mindmap_zoom_in"),zoomOut:y("flow_web_ext_search_mindmap_zoom_out"),zoomFit:y("flow_web_ext_search_mindmap_fit"),close:y("flow_web_ext_close_upper_case")},onCloseClick:j,enableCopyRichText:!1,enableZoom:!1,children:(0,k.jsx)(B,{code:a,uniqueId:null!==(t=null==p?void 0:p.message_id)&&void 0!==t?t:"",loading:i,ref:M,fullscreen:!0,onError:L,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return O({...e,from:"fullscreen"})}})}):null]})};var L=t(924811);let O=e=>{let{code:n,onPreview:t,loading:a,viewOnly:r,messageLink:i,message:_,conversationId:g,customHandleEnterFullscreen:v}=e,p=(0,x.useCodeBlockPosition)(n,_),h=w({trackEvent:s.trackEvent,messageLink:i,message:_,conversationId:g,reportParams:{graph_type:"vega-lite"},codeBlockPosition:p}),f=(0,u.useTranslateFn)(),{fullscreenVisible:b,handleEnterFullscreen:y,handleExitFullscreen:T}=E(),S=(0,o.useRef)(null),R=(0,o.useRef)(null),{svgContainerRef:F,downloadImage:N,copyImage:z}=(0,j.useDiagramExporter)({exportSvgSelf:!0}),B=(0,o.useRef)(null),P=(0,o.useRef)(!1),O=function(e,n){let t=(0,o.useRef)();return(0,o.useMemo)(()=>{if(n)return!1;if(void 0===t.current)try{JSON.parse(e),t.current=!1}catch(e){t.current=!0}return!t.current},[n,e])}(n,a);(0,o.useEffect)(()=>{if(!P.current&&O){var e;null===(e=B.current)||void 0===e||e.switchTab(d.TabKey.Diagram)}},[O]);let[H,K]=(0,o.useState)(!1),Z=e=>({onZoomIn:()=>{var n;null===(n=e.current)||void 0===n||n.zoomIn(),h.onZoomIn(b)},onZoomOut:()=>{var n;null===(n=e.current)||void 0===n||n.zoomOut(),h.onZoomOut(b)},onZoomFit:()=>{var n;null===(n=e.current)||void 0===n||n.fit(),h.onZoomFit(b)},onCopyText:()=>{l()(n),h.onCopyCode(b)},onTabChange:n=>{if(P.current=!0,n===d.TabKey.Diagram){var t;null===(t=e.current)||void 0===t||t.fit()}h.onTabChange({buttonName:n===d.TabKey.Diagram?"graph":"code"})},onFullScreenEnter:e=>{if(v){v(e);return}if(h.onEnterFullscreen(),e===d.TabKey.Diagram){y();return}null==t||t(n)},onDownloadImage:()=>{N(),h.onDownload(b)},onCopyImage:()=>{z(),h.onCopyImg(b)}}),V=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D.logger.persist.error({eventName:"vega_lite_render_error",error:e,meta:n}),h.onMindMapShow(!1,!1)},A=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};K(!0),V(e,n)},U=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.logger.persist.success({eventName:"vega_lite_render_success",meta:e}),h.onMindMapShow(!1,!0)},G=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-mpomfh",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:f("deepResearch_tool_gencode_generating")})]}),[f]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c.DiagramBlock,{ref:B,defaultActiveKey:O?d.TabKey.Diagram:d.TabKey.Code,...Z(S),disabled:H,disableDiagram:a,enableCopyRichText:!1,i18nConfig:{diagramTitle:f("web_ai_coding_canvas_preview"),codeTitle:f("mindmap_previewer_tab_code"),downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyRichText:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),fitPage:f("flow_web_ext_search_mindmap_fit"),fullscreenView:f("flow_web_ext_search_mindmap_full"),copyText:f("skill_search_copytext"),copyDoneText:f("text_copied_tip")},diagram:(0,k.jsx)(L.LazyVegaLiteRenderer,{code:n,ref:S,loading:a,onError:A,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U({...e,from:"message"})}}),code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:n,className:"!m-0 !h-full overflow-auto !rounded-none !border-none",codeAreaClassName:"!rounded-none !h-full",viewOnly:r,contentClassName:"!border-none !rounded-none min-h-full",language:"json"}),customRenderTabTools:a?G:void 0}),b?(0,k.jsx)(I.FullscreenDiagram,{...Z(R),disabled:H,i18nConfig:{downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyHtml:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),zoomFit:f("flow_web_ext_search_mindmap_fit"),close:f("flow_web_ext_close_upper_case")},onCloseClick:T,enableCopyRichText:!1,children:(0,k.jsx)(L.LazyVegaLiteRenderer,{code:n,loading:a,ref:R,onError:A,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U({...e,from:"fullscreen"})}})}):null,(0,k.jsx)(M.DiagramExporter,{i18nConfig:{brandName:f("brandName_doubao"),brandDesc:f("flow_web_ext_search_share_pic_doubao")},svgContainerRef:F,children:(0,k.jsx)(L.LazyVegaLiteRenderer,{code:n,loading:a,onError:A,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return U({...e,from:"exporter"})}})})]})},H=(0,o.lazy)(()=>t.e("29872").then(t.bind(t,749494)).then(e=>({default:e.GeogebraRenderer}))),K=e=>{let{code:n,onPreview:t,loading:a,viewOnly:r,messageLink:i,message:_,conversationId:g,customHandleEnterFullscreen:v}=e,p=(0,x.useCodeBlockPosition)(n,_),h=w({trackEvent:s.trackEvent,messageLink:i,message:_,conversationId:g,reportParams:{graph_type:"geogebra"},codeBlockPosition:p}),f=(0,u.useTranslateFn)(),{fullscreenVisible:b,handleEnterFullscreen:y,handleExitFullscreen:T}=E(),S=(0,o.useRef)(null),R=(0,o.useRef)(null),{svgContainerRef:F,downloadImage:N,copyImage:z}=(0,j.useDiagramExporter)({exportSvgSelf:!0,exportCanvasSelf:!0}),B=(0,o.useRef)(null),P=(0,o.useRef)(!1),[L,O]=(0,o.useState)(!1),K=e=>({onZoomIn:()=>{var n;null===(n=e.current)||void 0===n||n.zoomIn(),h.onZoomIn(b)},onZoomOut:()=>{var n;null===(n=e.current)||void 0===n||n.zoomOut(),h.onZoomOut(b)},onZoomFit:()=>{var n;null===(n=e.current)||void 0===n||n.fit(),h.onZoomFit(b)},onCopyText:()=>{l()(n),h.onCopyCode(b)},onTabChange:n=>{if(P.current=!0,n===d.TabKey.Diagram){var t;null===(t=e.current)||void 0===t||t.fit()}h.onTabChange({buttonName:n===d.TabKey.Diagram?"graph":"code"})},onFullScreenEnter:e=>{if(v){v(e);return}if(h.onEnterFullscreen(),e===d.TabKey.Diagram){y();return}null==t||t(n)},onDownloadImage:()=>{N(),h.onDownload(b)},onCopyImage:()=>{z(),h.onCopyImg(b)}}),Z=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};D.logger.persist.error({eventName:"geogebra_render_error",error:e,meta:n}),h.onMindMapShow(!1,!1)},V=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};O(!0),Z(e,n)},A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};D.logger.persist.success({eventName:"geogebra_render_success",meta:e}),h.onMindMapShow(!1,!0)},U=(0,o.useCallback)(()=>(0,k.jsxs)("div",{className:"loading-MogDd6",children:[(0,k.jsx)(m.default,{size:"small"}),(0,k.jsx)("span",{children:f("deepResearch_tool_gencode_generating")})]}),[f]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(c.DiagramBlock,{ref:B,defaultActiveKey:d.TabKey.Diagram,...K(S),disabled:L,disableDiagram:a,enableCopyRichText:!1,i18nConfig:{diagramTitle:f("web_ai_coding_canvas_preview"),codeTitle:f("mindmap_previewer_tab_code"),downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyRichText:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),fitPage:f("flow_web_ext_search_mindmap_fit"),fullscreenView:f("flow_web_ext_search_mindmap_full"),copyText:f("skill_search_copytext"),copyDoneText:f("text_copied_tip")},diagram:(0,k.jsx)(H,{code:n,ref:S,loading:a,onError:V,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A({...e,from:"message"})}}),code:(0,k.jsx)(C.MdboxCodeBlock,{showHeader:!1,code:n,className:"!m-0 !h-full overflow-auto !rounded-none !border-none",codeAreaClassName:"!rounded-none !h-full",viewOnly:r,contentClassName:"!border-none !rounded-none min-h-full",language:"json"}),customRenderTabTools:a?U:void 0}),b?(0,k.jsx)(I.FullscreenDiagram,{...K(R),disabled:L,i18nConfig:{downloadImage:f("flow_web_ext_search_mindmap_download"),copyImage:f("flow_web_ext_search_mindmap_copy"),copyHtml:f("flow_web_ext_mindmap_copy_rich_text"),zoomIn:f("flow_web_ext_search_mindmap_zoom_in"),zoomOut:f("flow_web_ext_search_mindmap_zoom_out"),zoomFit:f("flow_web_ext_search_mindmap_fit"),close:f("flow_web_ext_close_upper_case")},onCloseClick:T,enableCopyRichText:!1,children:(0,k.jsx)(H,{code:n,loading:a,ref:R,onError:V,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A({...e,from:"fullscreen"})}})}):null,(0,k.jsx)(M.DiagramExporter,{i18nConfig:{brandName:f("brandName_doubao"),brandDesc:f("flow_web_ext_search_share_pic_doubao")},svgContainerRef:F,children:(0,k.jsx)(H,{code:n,loading:a,onError:V,onSuccess:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A({...e,from:"exporter"})}})})]})};var Z=t(102249),V=t(992847);let A=()=>({enableGeogebraCode:"1"===(0,Z.useFGValue)("enable_geogebra_code",{source:V.FGBuiltinNames.serverAB})}),U=e=>{let{language:n,showMindMapOrMermaid:t=!0,meta:o=""}=e,{enableGeogebraCode:a}=A();return"mindmap"===n&&t?(0,k.jsx)(T,{...e}):"mermaid"===n&&t?(0,k.jsx)(R,{...e}):"svg"===n?(0,k.jsx)(z,{...e}):"html"===n&&o.includes('type="renderer"')?(0,k.jsx)(P,{...e}):"vega-lite"===n?(0,k.jsx)(O,{...e}):"geogebra"===n&&a?(0,k.jsx)(K,{...e}):(0,k.jsx)(C.MdboxCodeBlock,{...e})}},540498:function(e,n,t){t.d(n,{useMessageTextContentData:function(){return Q},indexParams:function(){return X},MessageTextContent:function(){return Y}});var o=t(713738),a=t(217957),r=t(101874),i=t(746167),l=t(220),s=t(666196),d=t(629006),c=t(674157),u=t(456712),_=t(847857),m=t(461141),g=t(698392),v=t(212183),p=t(588426),h=t(128614),f=t(777422),w=t(915299),x=t(102249),b=t(7625),y=t(992847),C=t(255804),k=t(573966),T=t(379575),S=t(602530),E=t(712980),I=t(414459),j=t(178230),M=t(241107),D=t(481923),R=t(4137),F=t(334312),N=t(725172),z=t(439027);let B=e=>{let{inView:n,message:t}=e,a=(0,o.useRef)({end_method:"",start_method:"",is_stream:0,show_end_timestamp:0,show_start_timestamp:0,stream_end_timestamp:0,stream_start_timestamp:0}),{ref:{current:r}}=(0,N.useScrollView)(),i=e=>{(0,R.default)(e)||z.readMessageTriggerManager.setCurrentMethod(e)},l=()=>{a.current.show_start_timestamp=Date.now(),a.current.start_method=z.readMessageTriggerManager.getStartMethod()},s=()=>{0!==a.current.stream_start_timestamp&&(a.current.stream_end_timestamp=Date.now())},d=()=>{a.current.show_end_timestamp=Date.now(),a.current.end_method=z.readMessageTriggerManager.getEndMethod()},u=()=>{a.current={end_method:"",start_method:"",is_stream:0,show_end_timestamp:0,show_start_timestamp:0,stream_end_timestamp:0,stream_start_timestamp:0}},_=()=>{d(),s();let e={read_duration:a.current.stream_end_timestamp-a.current.stream_start_timestamp,show_duration:a.current.show_end_timestamp-a.current.show_start_timestamp};return n=>{i(n),m(e),u()}},m=(0,o.useCallback)(e=>{var n,o;(0,f.trackEvent)("read_message",{bot_id:t.bot_id,message_id:null==t?void 0:t.message_id,conversation_id:null==t?void 0:t.conversation_id,skill_id:null==t?void 0:null===(n=t.skill)||void 0===n?void 0:n.skill_id_no_default,skill_name:(0,F.getSkillTeaNameByType)(null==t?void 0:null===(o=t.skill)||void 0===o?void 0:o.skill_type_no_default),reply_id:null==t?void 0:t.reply_id,section_id:null==t?void 0:t.section_id,is_finish:+!!(0,c.isMessageFinished)(t),is_stream:a.current.is_stream,is_regenerate:+(null!=t&&!!t.is_regen),read_duration:e.read_duration>0?e.read_duration:0,show_duration:e.show_duration<1e3?0:e.show_duration,start_method:a.current.start_method,end_method:a.current.end_method})},[t]),v=e=>{(0,R.default)(e)||i(e),l()};return(0,o.useEffect)(()=>z.readMessageTriggerManager.addScrollContainerListener(r),[r]),(0,o.useEffect)(()=>{if(n){let e=()=>{v()},n=()=>{_()()};return v(),z.readMessageTriggerManager.addVisibleChangeListener({show:e,hide:n}),()=>{z.readMessageTriggerManager.removeVisibleChangeListener({show:e,hide:n});let o=_();setTimeout(()=>{var e;t.conversation_id!==(null===(e=(0,g.getChatSlice)("chatViewCoreStore").currentChatViewConfig)||void 0===e?void 0:e.chatId)?o(z.TriggerMethod.ChatChange):o()},50)}}},[n]),{updateStreamMessageTimer:()=>{0===a.current.stream_start_timestamp&&(a.current.is_stream=1,a.current.stream_start_timestamp=Date.now())},stopStreamMessageTimer:s}};var P=t(119721),L=t(744374),O=t(847546),H=t(959354),K=t(147899);let Z=e=>{let{conversationId:n,extraEventParams:t={},eventName:a="message_smooth_text_stuck",getNow:r=performance.now.bind(performance)}=e,i=(0,o.useRef)([]),l=(0,o.useRef)(),s=(0,o.useRef)(),d=(0,o.useRef)(r()),c=(0,o.useRef)(),u=(0,o.useRef)(H.MessageTracer.getInstance(n));(0,o.useEffect)(()=>{u.current.addWaiter(a)},[]),(0,K.default)("visibilitychange",()=>{if(!s.current)return;if(document.hidden){c.current=r();return}if(!c.current)return;let e=r()-c.current;s.current+=e});let _=()=>{i.current=[],l.current=void 0,s.current=void 0,d.current=r()};return{onTextUpdate:e=>{l.current=e;let n=s.current,t=r();s.current=t,n&&i.current.push({duration:t-n})},onFinish:()=>{var e;if(!s.current||!l.current)return;let n=i.current,o=n.filter(e=>e.duration>600&&e.duration<=1e3),c=(0,L.default)(o,e=>e.duration),m=n.filter(e=>e.duration>1e3&&e.duration<=3e3),g=(0,L.default)(m,e=>e.duration),v=n.filter(e=>e.duration>3e3),p=(0,L.default)(v,e=>e.duration),h={...t,stuck_duration:(0,L.default)(n,e=>e.duration),full_duration:r()-d.current,stuck_count:n.length,content_length:l.current.length,stuck_duration_600ms:c,stuck_duration_600ms_count:o.length,stuck_duration_1000ms:g,stuck_duration_1000ms_count:m.length,stuck_duration_3000ms:p,stuck_duration_3000ms_count:v.length,stuck_max_duration:null===(e=(0,O.default)(n,e=>e.duration))||void 0===e?void 0:e.duration};(0,f.trackEvent)(a,h);let{rootSpan:w}=u.current;null==w||w.setTags({client_slight_stuck_duration:g,client_slight_stuck_count:m.length,client_severe_stuck_duration:p,client_severe_stuck_count:v.length,client_render_answer_duration:w.elapse()}),u.current.resolveWaiter(a),j.logger.persist.log({eventName:a,meta:h}),_()}}};var V=t(951678),A=t(812650),U=t.n(A),G=t(2132),W=t(345660);let q=(0,o.forwardRef)(function(e,n){let{classname:t,message:a}=e,[r,i]=(0,o.useState)(!1),[l,s]=(0,o.useState)(),u=(0,o.useMemo)(()=>(0,c.isStreamAsyncMessage)(a)?"skill_copliotreading_2M_continue_loading":(0,d.isDeepSearchMessage)(a)?"search_Continuously_loading":"academic_Continuously_loading",[a]),_=(0,w.useTranslateFn)(),m=()=>{s(setTimeout(()=>{i(!0)},5e3))},g=()=>{l&&clearTimeout(l),i(!1)};return(0,o.useImperativeHandle)(n,()=>({startDeepSearchClock:()=>m(),updateDeepSearchClock:()=>g()})),(0,W.jsxs)("span",{className:"search-custom-indicator",children:[(0,W.jsx)(G.Indicator,{}),(0,W.jsx)("span",{className:U()("text-t1mHH5",{"opacity-0":!r},t),children:_(u)})]})}),J=t(981483).MdBoxLazy,X="f_link_type=f_footnote",$=()=>[],Q=e=>{var n,t,a;let{message:r,messageBlockText:i,messageBlockMeta:l}=e,c=(0,w.useTranslateFn)(),{enableMessageDebug:u}=(0,s.useChatService)("chatConfigService").localFeatureConfig,m=null!==(a=(0,_.getSearchReplyTypeFromTextMessage)(r))&&void 0!==a?a:"",g=(null==r?void 0:null===(n=r.ext)||void 0===n?void 0:n.ref_info_data)?JSON.parse(r.ext.ref_info_data):[],v=i||(0,_.getMessageText)(r,u,(0,d.isEmptyMessage)(r)?"":(null==r?void 0:null===(t=r.ext)||void 0===t?void 0:t.default_display_content)||c("chat_unsupported_message_type")),{content_type:p}=r||{},h=l||r.meta_infos,{insertingMetaInfos:f}=(0,o.useMemo)(()=>(0,d.isSimpleSearchMessage)({content_type:p})||(0,d.isWiderTextMessage)({content_type:p,is_delta:!1})||l?{insertingMetaInfos:h?(0,M.batchConvertMetaInfoToUnionMetaInfo)(h):[]}:{},[h,v]);return{content:v,insertingMetaInfos:f,searchType:m,refInfoData:g}},Y=(0,o.forwardRef)(function(e,n){var t,a;let{customRenderOptions:r,message:i,...l}=e,s=(0,m.getChatConfig)("chatMessageBoxConfig"),d=null==s?void 0:null===(a=s.textContent)||void 0===a?void 0:null===(t=a.getCustomRenderOptions)||void 0===t?void 0:t.call(a,{conversationId:i.conversation_id||""}),c=(0,o.useMemo)(()=>({...r,...d}),[r,d]);return(0,W.jsx)(ee,{ref:n,...l,message:i,customRenderOptions:c})}),ee=(0,o.forwardRef)(function(e,n){var t,_,m,M,R,F,N,z,L,O,H,K,A;let{inView:U,message:G,messageBlockMeta:Y,messageBlockText:ee,messageBlockTextFinish:en,messageBlockTextBroken:et,imageOptions:eo,customRenderOptions:ea}=e,er=(0,w.useTranslateFn)(),{sendMessage:ei}=(0,s.useChatService)("chatMessageService"),{startFPSRecord:el,stopFPSRecord:es}=(0,l.useStreamFPSReport)({eventName:"message_stream_fps"}),ed=(0,d.isMessageFailed)(G),ec=null!=et?et:(0,d.isBrokenMessage)(G),eu=null!=en?en:(0,c.isMessageFinished)(G),e_=(0,d.isMessageCached)(G),em=(0,c.isStreamAsyncMessage)(G),eg=(0,o.useRef)(null),ev=null===(t=eg.current)||void 0===t?void 0:t.getRootElement(),ep=(0,x.useFGValue)(b.FGLocalDebugKeys.forceDarkMode,{source:y.FGBuiltinNames.debugStorage,defaultValue:!1});(0,o.useImperativeHandle)(n,()=>{var e,n;return{flushSmoothCursor:null===(e=eg.current)||void 0===e?void 0:e.flushSmoothCursor,getRootElement:null===(n=eg.current)||void 0===n?void 0:n.getRootElement}});let eh=(null==ea?void 0:ea.enableCustomIndicator)||em,{imageEventCallbacks:ef,renderImagePreview:ew}=(0,h.useImagePreview)({conversationId:G.conversation_id,messageId:G.message_id||"",chatType:(0,v.getChatTypeForTea)("",G.conversation_id),conversationType:(0,p.getConversationTypeById)(G.conversation_id)||"",botId:(0,v.getBotIdByConversationId)(G.conversation_id)||"",skillId:null==G?void 0:null===(_=G.skill)||void 0===_?void 0:_.skill_id},[],r.ContentSource.Original),{stopStreamMessageTimer:ex,updateStreamMessageTimer:eb}=B({inView:U,message:G}),{content:ey,insertingMetaInfos:eC,searchType:ek,refInfoData:eT}=Q({message:G,messageBlockText:ee,messageBlockMeta:Y}),eS=null!==(O=null==ea?void 0:ea.overrideTextContent)&&void 0!==O?O:ey,eE=(0,P.useEventTrackTrigger)({message:G,messageTextContent:eS||""}),eI=(e,n)=>{var t;let{skillMap:o}=(0,g.getChatStore)("chatInputStore").getState(),a=Object.values(o).find(e=>{var n;return(null==e?void 0:e.skill_type)===(null==G?void 0:null===(n=G.skill)||void 0===n?void 0:n.skill_type)});(0,f.trackEvent)(e,{bot_id:G.bot_id,message_id:G.message_id,reply_id:G.reply_id,chat_type:(0,v.getChatTypeForTea)(G.conversation_id),conversation_id:G.conversation_id,conversation_type:(0,p.getConversationTypeById)(G.conversation_id),skill_id:null==G?void 0:null===(t=G.skill)||void 0===t?void 0:t.skill_id_no_default,search_type:ek,skill_name:null==a?void 0:a.show_name,...n})},ej=(e,n)=>{let{url:t,exts:o,openLink:a}=n;e.preventDefault(),e.stopPropagation(),"wiki"===o.type?((0,f.trackEvent)("click_special_soft_link"),a(C.ExternalLink.transformExternalLink(o.wiki_link||""))):"normal"===o.type&&((null==t?void 0:t.includes(X))&&ez("footnote_link_click"),a(C.ExternalLink.transformExternalLink(t)))},eM=e=>{let n=(0,u.getSkillParamsNoDefault)(G),t=n?{input_skill:JSON.stringify(n)}:{};null==ei||ei([{text:e,reportParams:{scene:i.ChatTeaScene.SCENE_SUGGESTED_PROMPTS},extraExt:t}])},eD=null!==(H=null==ea?void 0:null===(m=ea.useCustomEventCallbacks)||void 0===m?void 0:m.call(ea,{message:G}))&&void 0!==H?H:{},eR=(0,o.useMemo)(()=>({message:G,metaInfos:null!=eC?eC:[],messageText:null!=eS?eS:"",options:{isFinishedMessage:eu,enableHightLight:!0},onLinkClick:eD.onLinkClick||ej,onSendMessage:eM,onTrackEvent:eI,refInfoData:eT,mdBoxRef:eg}),[eC,eS,eu,eT]),eF=(0,o.useMemo)(()=>{var e;return(0,a.default)(eS)||""===eS&&(null==eC?void 0:eC.length)===0?[]:(null!==(e=null==ea?void 0:ea.getInitialReplacementElements)&&void 0!==e?e:D.getInsertElements)(eR)},[eR,null==ea?void 0:ea.getInitialReplacementElements]),eN=((null==ea?void 0:ea.useCustomReplacementElements)||$)(eR),ez=e=>{(0,f.trackEvent)(e,{message_id:G.message_id,bot_id:G.bot_id,conversation_id:G.conversation_id})},eB=(0,o.useRef)(null),eP=(0,k.useEstablished)(null!=U&&U),{inView:eL}=(0,T.useFirstScreenInView)({ref:()=>{var e,n;return null!==(n=null===(e=eg.current)||void 0===e?void 0:e.getRootElement())&&void 0!==n?n:null}}),eO=()=>{var e,n,t,o,a,r;let i=null===(e=eg.current)||void 0===e?void 0:e.getRootElement(),l=null===(t=document)||void 0===t?void 0:null===(n=t.getSelection())||void 0===n?void 0:n.toString().trim();if(l){let e=(null==i?void 0:null===(a=i.innerText)||void 0===a?void 0:null===(o=a.replace(/\r?\n/g,""))||void 0===o?void 0:o.indexOf(l.replace(/\r?\n/g,"")))||0,n=(null==i?void 0:i.querySelector('[data-testid="code_block"]'))!==null,t=e+l.length;eS&&-1!==e&&t>0&&(0,f.trackEvent)("right_click_copy",{message_id:G.message_id,bot_id:G.bot_id,conversation_id:G.conversation_id,start_index:String(e),end_index:String(t),is_image:"0",skill_id:null==G?void 0:null===(r=G.skill)||void 0===r?void 0:r.skill_id_no_default,content_type:"text",click_from:n?"code":"answer",...null==ea?void 0:ea.rightClickCopyReportParams})}};(0,o.useEffect)(()=>(ev&&ev.addEventListener("copy",eO),()=>{null==ev||ev.removeEventListener("copy",eO)}),[ev]);let{onTextUpdate:eH,onFinish:eK}=Z({conversationId:G.conversation_id,extraEventParams:{message_id:G.message_id,bot_id:G.bot_id,conversation_id:G.conversation_id,skill_id:null==G?void 0:null===(M=G.skill)||void 0===M?void 0:M.skill_id,llm_intention:null==G?void 0:null===(F=G.verbose)||void 0===F?void 0:null===(R=F.seed_intention)||void 0===R?void 0:R.intention,llm_intention_detail:null==G?void 0:null===(z=G.verbose)||void 0===z?void 0:null===(N=z.seed_intention)||void 0===N?void 0:N.detail,total_length:null==eS?void 0:eS.length,is_nova:(null==G?void 0:null===(L=G.local_info)||void 0===L?void 0:L.from)===r.MessageFrom.SamanthaChat}}),eZ=null!==(K=null==ea?void 0:ea.getCodebarConfig)&&void 0!==K?K:(e,n)=>{var t,o;let{codeBlocks:a}=e,{isFinished:r,isFailed:i,isBroken:l}=n,s=null===(t=a.at(0))||void 0===t?void 0:t.language,d=null===(o=a.at(0))||void 0===o?void 0:o.code.trim();return(!s&&!d||s)&&!d&&"compute".startsWith(null!=s?s:"")||d&&"compute"===s?{finished:r||i||l,defaultExpand:!1,showCodeBar:!0,expandedFinishedText:er("deepResearch_tool_genCode_done"),unExpandFinishedText:er("deepResearch_tool_genCode_done"),codeBarLoadingText:er("deepResearch_tool_genCode"),compact:!0}:{finished:r||i||l,showCodeBar:!1}},eV={Indicator:eh?()=>(0,W.jsx)(q,{ref:eB,message:G}):void 0,CodeBlock:(0,o.useCallback)(e=>{var n,t;return(0,W.jsx)(V.CodeBlockSplitter,{...e,...null!==(t=null==ea?void 0:null===(n=ea.customSlotsProps)||void 0===n?void 0:n.CodeBlock)&&void 0!==t?t:{},message:G,hideDownload:null==ea?void 0:ea.hideDownload,customHandleEnterFullscreen:null==ea?void 0:ea.customHandleEnterFullscreen,viewOnly:null==ea?void 0:ea.viewOnly})},[null==G?void 0:G.message_id]),...null!==(A=null==ea?void 0:ea.customSlots)&&void 0!==A?A:{}};return((0,o.useEffect)(()=>{if(em&&eB.current){var e;null===(e=eB.current)||void 0===e||e.startDeepSearchClock()}return()=>{var e;null===(e=eB.current)||void 0===e||e.updateDeepSearchClock()}},[em,eV.Indicator]),G&&(!ed||eS))?(0,a.default)(eS)||""===eS&&0===eF.length&&(null==eN?void 0:eN.length)===0?ec?null:em?(0,W.jsx)(q,{ref:eB,message:G}):(0,W.jsx)(I.DotFlashing,{}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(J,{ref:eg,theme:"samantha",mode:ep?"dark":"light",imageOptions:{forceHttps:!0,...null!=eo?eo:{responsiveNaturalSize:{maxWidth:1/0,maxHeight:600}}},markDown:eS,translate:{copyTitle:er("message_long_press_copy"),codeBarLoadingText:er("code_block_compute_switch_button_generating"),codeBarExpandedFinishedText:er("code_block_switch_button_hide_details"),codeBarUnExpandFinishedText:er("code_block_switch_button_show_details")},eventCallbacks:{onImageRender:e=>{let{src:n}=e;n&&ef.onImageRender(n)},onImageClick:(e,n)=>{let{src:t}=n;t&&ef.onImageClick(e,t)},onLinkClick:ej,onLinkRender:e=>{var n;(null===(n=e.url)||void 0===n?void 0:n.includes(X))&&ez("footnote_link_show")},onSendMessage:eM,onCopyCodeBlock:eE.clickCodeBarCopyEvent,onCodeBarExpandChange:eE.clickCodeDetailButtonEvent,onCodeBlockShowEvent:eE.codeBlockShowEvent,onCodeBarMounted:eE.codeBarShowEvent,...eD},showEllipsis:ec||ed,showIndicator:!(eu||ed),autoFixSyntax:(eP||eL)&&{autoFixEnding:!eu||ec,imageEmphasisTitle:!0},smooth:{enable:!eu,maxFirstTextSmoothSize:e_?9999:10,onUpdate:e=>{var n,t;let{text:o}=e;null===(n=eB.current)||void 0===n||n.updateDeepSearchClock(),eH(o),null===(t=eB.current)||void 0===t||t.startDeepSearchClock(),eu||eb(),el()},onSmoothFinished:()=>{eK(),es({message_length:eS.length,version:"0"}),ex()},onTextBreak:e=>{var n,t;let{prevText:o,currentText:a}=e;j.logger.persist.warning({eventName:"message_text_break_change",meta:{prevText:o,currentText:a,is_immersive_mode:(null===(t=(0,g.getChatSlice)("chatViewCoreStore"))||void 0===t?void 0:null===(n=t.currentChatViewConfig)||void 0===n?void 0:n.isImmersiveMode)?"1":"0"}})}},slots:eV,insertedElements:[...eN,...eF],autoFitRTL:(0,S.isRTL)(),onHop:e=>{let{prevRenderedText:n,renderedText:t,prevEndNodeType:o,endNodeType:a}=e;(0,f.trackEvent)("rd_flow_message_hop",{message_id:G.message_id,end_syntax_type:a,prev_end_syntax_type:o,platform:"web",reduce_char_count:n.length-t.length})},forceBrInterSpacing:!0,enhancedCopy:!0,customLink:e=>!(0,E.isMobileNativeLink)(e),codeBarConfig:e=>eZ(e,{isFinished:eu,isBroken:ec,isFailed:ed}),footnote:!1,enabledHtmlTags:["doubaocanvas"],renderHtml:e=>{let{tagName:n,children:t}=e;if("doubaocanvas"===n)return(0,W.jsx)(W.Fragment,{children:t})},"data-testid":"message_text_content"}),ew()]}):null})},439027:function(e,n,t){t.r(n),t.d(n,{TriggerMethod:function(){return r},readMessageTriggerManager:function(){return l}});var o=t(154922);function a(e,n,t){var o;return(n="symbol"==typeof(o=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,n||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(n,"string"))?o:o+"")in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var r={ChatChange:0,PageChange:1,ScrollChange:2};class i extends o.default{setCurrentMethod(e){this.current_method=e}getEndMethod(){switch(this.current_method){case r.ChatChange:return"leave_chat";case r.ScrollChange:return"scroll";case r.PageChange:return"switch_tab";default:return"leave_chat"}}getStartMethod(){switch(this.current_method){case r.ChatChange:return"enter_chat_or_new_message";case r.ScrollChange:return"scroll";case r.PageChange:return"switch_tab";default:return"enter_chat_or_new_message"}}addVisibleChangeListener(e){let{show:n,hide:t}=e;this.listenerCount("page_visible_show")||window.addEventListener("visibilitychange",this.visiblityChangedHandler),this.on("page_visible_show",n),this.on("page_visible_hide",t)}visiblityChangedHandler(){"hidden"===document.visibilityState?(this.current_method=r.PageChange,this.emit("page_visible_hide")):"visible"===document.visibilityState&&(this.current_method=r.PageChange,this.emit("page_visible_show"))}removeVisibleChangeListener(e){let{show:n,hide:t}=e;this.off("page_visible_show",n),this.off("page_visible_hide",t),this.listenerCount("page_visible_show")||window.removeEventListener("visibilitychange",this.visiblityChangedHandler)}handleUpdateTriggerMethodToScroll(){this.current_method=r.ScrollChange,this.clearTriggerMethodTimer&&clearTimeout(this.clearTriggerMethodTimer),this.clearTriggerMethodTimer=setTimeout(()=>{this.current_method=r.ChatChange},500)}addScrollContainerListener(e){return null==e||e.addEventListener("scroll",this.handleUpdateTriggerMethodToScroll),()=>{null==e||e.removeEventListener("scroll",this.handleUpdateTriggerMethodToScroll)}}constructor(){super(),a(this,"current_method",r.ChatChange),a(this,"clearTriggerMethodTimer",void 0),this.visiblityChangedHandler=this.visiblityChangedHandler.bind(this),this.handleUpdateTriggerMethodToScroll=this.handleUpdateTriggerMethodToScroll.bind(this)}}let l=new i},119721:function(e,n,t){t.d(n,{useEventTrackTrigger:function(){return w}});var o=t(637319),a=t(83990),r=t(971857),i=t(212183),l=t(334312),s=t(777422),d=t(828617);let c=async e=>{let n=await e.read();return await Promise.all(n.map(e=>Promise.all(e.types.map(n=>e.getType(n).then(async e=>({type:n,content:await e.text()}))))))},u=async e=>(await c(e)).flat().find(e=>{if("text/plain"===e.type)return!0}),_=async(e,n)=>(await c(e)).flat().find(e=>{if("text/plain"===e.type)return!1;let t=new DOMParser().parseFromString(e.content,"text/html");return n.find(e=>t.querySelector(e))}),m=async e=>_(e,["img","picture"]),g=async e=>_(e,["code"]);var v=t(843174),p=t(949932),h=t(178230);let f=e=>{var n;let t;let o=null!==(n=null==e?void 0:e.length)&&void 0!==n?n:0;return 1===o?t=String(null==e?void 0:e[0]):o>1&&(t=JSON.stringify(e)),t},w=e=>{let{message:n,messageTextContent:t}=e,c=(0,r.useConversation)(n.conversation_id||""),_=e=>{var t,r;if(!(null==n?void 0:n.reply_id))return;let i=f(null===(r=(0,o.getMessageByIdSelector)(a.useMessageStore.getState(),n.conversation_id||"",null==n?void 0:n.reply_id))||void 0===r?void 0:null===(t=r.attachments)||void 0===t?void 0:t.map(e=>e.key).filter(Boolean));(0,s.trackEvent)("code_block_show",{code_type:e,message_id:n.message_id,section_id:n.section_id,conversation_id:n.conversation_id,bot_id:null==c?void 0:c.bot_id,collection_id:i})},w=(0,d.useLatestFunction)(async()=>{try{let[e,o,a]=await Promise.all([u(navigator.clipboard),m(navigator.clipboard),g(navigator.clipboard)]),r=(e,o)=>{var a,r;(0,s.trackEvent)("right_click_copy",{message_id:null==n?void 0:n.message_id,bot_id:null==c?void 0:c.bot_id,conversation_id:n.conversation_id||"",...o?{start_index:String(v.utf8.length(String(null==t?void 0:t.slice(0,o.start)))),end_index:String(v.utf8.length(String(null==t?void 0:t.slice(0,Number(o.start)+o.end))))}:{start_index:"",end_index:""},skill_id:null==n?void 0:null===(a=n.skill)||void 0===a?void 0:a.skill_id_no_default,is_image:e.includes("image")?"1":"0",content_type:null!==(r=f(e))&&void 0!==r?r:""})};if(e&&!o&&!a){navigator.clipboard.readText().then(e=>{let n=null==t?void 0:t.indexOf(e),o=e.length;t&&-1!==n&&o>0&&r(["text"],{start:n,end:o})}).catch(e=>{if((null==e?void 0:e.name)==="NotAllowedError"){h.logger.console.warning({eventName:"copy_text_error",meta:{error:e}});return}throw e});return}let i=[!!e&&"text",!!a&&"code",!!o&&"image"].filter(Boolean);r(i)}catch(e){return}}),x=(0,d.useLatestFunction)(function(){var e;let{name:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.trackEvent)("download",{conversation_id:n.conversation_id||"",bot_id:null==c?void 0:c.bot_id,skill_id:null==n?void 0:null===(e=n.skill)||void 0===e?void 0:e.skill_id_no_default,message_id:n.message_id,content_type:(0,p.getFileExt)(t),click_from:"response_attachment"})});return{onClickAttachmentEvent:x,onClickDownloadAttachmentEvent:(0,d.useLatestFunction)(function(){var e;let{name:t=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,s.trackEvent)("click_response_attachment",{conversation_id:n.conversation_id||"",bot_id:null==c?void 0:c.bot_id,skill_id:null==n?void 0:null===(e=n.skill)||void 0===e?void 0:e.skill_id_no_default,message_id:n.message_id,content_type:(0,p.getFileExt)(t)})}),clickCodeDetailButtonEvent:(e,t,r)=>{var i,d,u,m;if(!(null==n?void 0:n.reply_id))return;let g=f(null===(d=(0,o.getMessageByIdSelector)(a.useMessageStore.getState(),n.conversation_id||"",null==n?void 0:n.reply_id))||void 0===d?void 0:null===(i=d.attachments)||void 0===i?void 0:i.map(e=>e.key).filter(Boolean));e&&_(t),(0,s.trackEvent)("click_detail_button",{button_name:e?"expand":"hide",skill_id:null===(u=n.skill)||void 0===u?void 0:u.skill_id_no_default,skill_name:(0,l.getSkillTeaNameByType)(null===(m=n.skill)||void 0===m?void 0:m.skill_type_no_default),message_id:n.message_id,section_id:n.section_id,conversation_id:n.conversation_id,bot_id:null==c?void 0:c.bot_id,collection_id:g,position:(null!=r?r:0)+1})},codeBlockShowEvent:_,clickCodeBarCopyEvent:()=>{(0,s.trackEvent)("copy",{if_regenerated:+(null!=n&&!!n.is_regen),chat_type:(0,i.getChatTypeForTea)("",n.conversation_id||""),message_id:null==n?void 0:n.message_id,section_id:null==n?void 0:n.section_id,conversation_id:n.conversation_id||"",bot_id:null==c?void 0:c.bot_id,click_from:"code_block"})},clickRightCopyEvent:w,codeBarShowEvent:(0,d.useLatestFunction)(e=>{var t,r,i,d;if(!(null==n?void 0:n.reply_id))return;let u=f(null===(r=(0,o.getMessageByIdSelector)(a.useMessageStore.getState(),n.conversation_id||"",null==n?void 0:n.reply_id))||void 0===r?void 0:null===(t=r.attachments)||void 0===t?void 0:t.map(e=>e.key).filter(Boolean));(0,s.trackEvent)("show_pill_button",{skill_id:null===(i=n.skill)||void 0===i?void 0:i.skill_id_no_default,skill_name:(0,l.getSkillTeaNameByType)(null===(d=n.skill)||void 0===d?void 0:d.skill_type_no_default),message_id:n.message_id,section_id:n.section_id,conversation_id:n.conversation_id,bot_id:null==c?void 0:c.bot_id,collection_id:u,position:(null!=e?e:0)+1})})}}}}]);
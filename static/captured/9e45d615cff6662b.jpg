"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["87959"],{769110:function(e,t,n){n.d(t,{Link:function(){return o}});var i=n(186995),l=n(532430),a=n(345660);let o=e=>{let t=(0,l.getFromInstance)("Link",i.Link);return(0,a.jsx)(t,{...e})}},167838:function(e,t,n){n.d(t,{default:function(){return a}}),n(713738);var i=n(430261),l=n(345660),a=(0,i.IconFactory)((0,l.jsx)(e=>(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,l.jsx)("path",{fill:"currentColor",d:"M7.707 21.707a1 1 0 0 1 0-1.414L16 12 7.707 3.707a1 1 0 0 1 1.414-1.414l8.293 8.293a2 2 0 0 1 0 2.828l-8.293 8.293a1 1 0 0 1-1.414 0"})}),{}))},403649:function(e,t,n){n.d(t,{RiskTips:function(){return d}});var i=n(812650),l=n.n(i),a=n(165482),o=n(769110),s=n(345660),r={TEXT:1,URL:2};let d=e=>{let{jsonString:t,tips:n,isBlock:i}=e,d=null!=n?n:[];return(null==n?void 0:n.length)||!t||(d=(0,a.parseJSON)(t,[])),(0,s.jsx)(s.Fragment,{children:d.map(e=>{let{type:t,text:n,url:a}=e;return t===r.URL?(0,s.jsx)(o.Link,{to:null!=a?a:"",target:"_blank",rel:"noopener noreferrer",className:l()("block text-sm/[24px] text-s-color-brand-primary-default",{"mt-12":!i}),children:n}):t===r.TEXT?(0,s.jsx)("div",{className:l()("text-sm/[24px] text-s-color-text-quaternary",{"mt-12":!i}),children:n}):null})})}},47405:function(e,t,n){n.d(t,{messageShareThemeCss:function(){return i}});let i={coco:{cssVar:{"--send-text-content-link-color":"var(--s-color-text-invert-secondary, rgba(255, 255, 255, 0.85))","--send-text-content-link-decoration-color":"var(--s-color-text-invert-intact-quaternary,rgba(255, 255, 255, 0.35))"},sendClassNames:["text-white","!bg-[#06f]","rounded-2xl","py-16","px-12"],receiveClassNames:["py-16","px-12","rounded-2xl","bg-[#f5f5f5]","!w-fit","max-w-full","min-w-0"]},"coco-immerse":{cssVar:{"--send-text-content-link-color":"var(--Text-color_text_invert_secondary, rgba(255, 255, 255, 0.85))","--send-text-content-link-decoration-color":"var(--s-color-text-invert-intact-quaternary,rgba(255, 255, 255, 0.35))"},sendClassNames:["text-white","!bg-black","rounded-2xl","py-16","px-12"],receiveClassNames:["py-16","px-12","rounded-2xl","bg-[#f5f5f5]","!w-fit","max-w-full","min-w-0"]},samantha:{cssVar:{},sendClassNames:["!text-[length:var(--message-send-text-content-font-size,16px)]"],receiveClassNames:[],receivePluginContainerClassNames:[]}}},921013:function(e,t,n){n.d(t,{useReplacementArtifactElements:function(){return _}});var i=n(713738),l=n(458524),a=n(559891),o=n(643404),s=n(637319),r=n(83990);let d=e=>{let{replyId:t,conversationId:n}=e,l=(0,i.useMemo)(()=>t&&n?(0,s.getMessageByIdSelector)(r.useMessageStore.getState(),n,t):null,[t,n]),a=(0,i.useMemo)(()=>{var e,t,n;return!!l&&!!((null===(e=l.content_obj)||void 0===e?void 0:e.link_model)||(null===(t=l.attachments)||void 0===t?void 0:t.length)||(null===(n=l.references)||void 0===n?void 0:n.filter(e=>!!(e.key||e.identifier)).length))},[l]);return{replyMessage:l,messageHasAttachments:a}};var u=n(884962),c=n(777210),v=n(722038),m=n(345660);let f=e=>{let{meta:t,conversationId:n,message:l,replyMessage:a}=e,{openFileByKey:o,openRepo:s}=(0,u.useOpenCodeCanvas)(),r=c.messageServiceContainer.get("chatTeaService"),d=(0,i.useMemo)(()=>{var e,t,n,i,l,o,s;if(null==a?void 0:null===(e=a.content_obj)||void 0===e?void 0:e.link_model){let e=null===(i=a.content_obj)||void 0===i?void 0:i.link_model;return[{type:"link",name:(null===(l=e.extra)||void 0===l?void 0:l.repo_name)||e.url,url:e.url,key:(null===(o=e.extra)||void 0===o?void 0:o.repo_id)||"",repo_id:(null===(s=e.extra)||void 0===s?void 0:s.repo_id)||"",file_parse_state:v.ParseState.ParseState_Success}]}return(null==a?void 0:null===(t=a.attachments)||void 0===t?void 0:t.length)?null==a?void 0:a.attachments:(null==a?void 0:null===(n=a.references)||void 0===n?void 0:n.length)?(null==a?void 0:a.references.filter(e=>!!(e.key||e.url))).map(e=>"link"===e.type?{type:e.type,key:e.identifier,url:e.url,name:e.url,repo_id:e.identifier,file_parse_state:v.ParseState.ParseState_Success}:e):[]},[a]),f=(0,i.useCallback)((e,t)=>{var i;if(!a||!t||!l||!d||0===d.length)return;let s=d.find(t=>t.name===e.name);s&&o(s.key,{messageId:l.message_id,conversationId:n,attachments:d.map(e=>({key:e.key,name:e.name,type:"file"})),activePath:e.path},{messageId:null==l?void 0:l.message_id,skillType:null==a?void 0:null===(i=a.skill)||void 0===i?void 0:i.skill_type_no_default},t)},[l,a,d]),p=(0,i.useCallback)((e,t)=>{var i,r;if(a&&t&&l){if(1===d.length&&"link"===d[0].type){s({id:d[0].repo_id,name:d[0].name,url:d[0].url,activePath:e.path},{messageId:null==l?void 0:l.message_id,skillType:null==a?void 0:null===(r=a.skill)||void 0===r?void 0:r.skill_type_no_default},t);return}o(d[0].key,{messageId:l.message_id,conversationId:n,attachments:d.map(e=>({key:e.key,name:e.name,type:"directory"})),activePath:e.path},{messageId:null==l?void 0:l.message_id,skillType:null==a?void 0:null===(i=a.skill)||void 0===i?void 0:i.skill_type_no_default},t)}},[a,n,l,d]),g=(0,i.useCallback)((e,t)=>{var i,a;let o=!1;2===e.type?(o=!0,f(e,null==t?void 0:null===(i=t.getBoundingClientRect)||void 0===i?void 0:i.call(t))):(1===e.type||3===e.type)&&(o=!0,p(e,null==t?void 0:null===(a=t.getBoundingClientRect)||void 0===a?void 0:a.call(t))),o&&(null==r||r.trackEvent("code_file_click",{current_page:"chat",conversation_id:n,bot_id:null==l?void 0:l.bot_id,message_id:null==l?void 0:l.message_id,link_detail:e.path}))},[p,f,n,l]);return(0,m.jsx)("span",{className:"code-file-path-iIAQg1",onClick:e=>g(t,e.currentTarget),children:t.name})};var p=n(648121),g=n(375881);let h=(0,a.withSuspense)(i.lazy(()=>(0,o.retryLoadWithFallBack)({fn:async()=>{let{CodeArtifactCard:e}=await Promise.all([n.e("75996"),n.e("260"),n.e("48776")]).then(n.bind(n,989725));return{default:e}}}))),_=e=>{var t;let{message:n,isShareOrCollectionMessage:i,onClick:a,enableOpenCanvas:o=!0,loadingIconClassName:s,metaInfos:r,enableCodePathElements:u=!0}=e,c=(0,g.getCodeArtifactListDataByMessage)(n),v=null==n?void 0:n.conversation_id,{messageHasAttachments:_,replyMessage:y}=d({replyId:null!==(t=null==n?void 0:n.reply_id)&&void 0!==t?t:"",conversationId:v});if(!n)return[];if(!i&&v&&_&&(null==r?void 0:r.length)&&u&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.some(e=>e.type===l.MetaType.CodeAssistantFilePath)}(r)){let e=new Map;return r.forEach(t=>{let{start_position:n,end_position:i,path:l,name:a}=t.data,o=`${n}-${i}-${l}-${a}`;e.has(o)||e.set(o,t)}),Array.from(e.values()).map(e=>{let t=e.data;return{range:[t.start_position,t.end_position+1],render:()=>(0,m.jsx)(f,{meta:t,conversationId:v,message:n,replyMessage:y})}})}return(null==c?void 0:c.length)?(0,p.groupByArtifactKey)(c).map((e,t)=>{var l,r;let{offset:d={start:0},identifier:u,artifactId:c,artifactKey:v}=null!==(l=null==e?void 0:e[0])&&void 0!==l?l:{},{start:f=0}=d,p=null!==(r=null!=c?c:u)&&void 0!==r?r:"";return{range:f,render:()=>(0,m.jsx)(h,{message:n,artifactId:p,artifactKey:v,artifactMeta:e,autoOpen:0===t,isShareOrCollectionMessage:i,enableOpenCanvas:o,onClick:a,loadingIconClassName:s},null!=v?v:t)}}):[]}},648121:function(e,t,n){n.d(t,{groupByArtifactKey:function(){return i}});function i(e){let t=new Map;return e.forEach(e=>{let{artifactKey:n=""}=e;if(t.has(n)){var i;null===(i=t.get(n))||void 0===i||i.push(e)}else t.set(n,[e])}),Array.from(t.values())}},911411:function(e,t,n){n.r(t),n.d(t,{ShareReceiveCodeArtifactContentPlugin:function(){return _}}),n(713738);var i=n(973893),l=n(812650),a=n.n(l),o=n(744322),s=n(629006),r=n(674157),d=n(456712),u=n(274372),c=n(47405),v=n(403649),m=n(921013),f=n(345660);let p=e=>{var t,n,i,l,p,g,h,_,y;let{inView:k,message:C,theme:x="samantha"}=e,S=(0,s.isTextMessageWithDeepThiking)(C),b=(0,r.isMessageFinished)(C),T=(0,d.getDeepThinkStatusFromExt)(null==C?void 0:C.ext),L=!!(null==C?void 0:null===(t=C.content_obj)||void 0===t?void 0:t.think)&&!!(null==C?void 0:null===(n=C.content_obj)||void 0===n?void 0:n.text)&&!T||b;return(0,f.jsxs)("div",{className:a()(null===(i=c.messageShareThemeCss[x])||void 0===i?void 0:i.receiveClassNames),style:c.messageShareThemeCss[x].cssVar,children:[S&&!(null==C?void 0:C.think_reason_is_hide)&&(0,f.jsx)(o.DeepThinkingContent,{isThinkingFinished:L,isThinkingBroken:T,thinkExpandStatus:!0,content:(null==C?void 0:null===(l=C.content_obj)||void 0===l?void 0:l.think)||"",messageId:null==C?void 0:C.message_id,botId:null==C?void 0:C.bot_id,skillType:null==C?void 0:null===(p=C.skill)||void 0===p?void 0:p.skill_type_no_default,skillId:null==C?void 0:null===(g=C.skill)||void 0===g?void 0:g.skill_id_no_default,conversationId:null==C?void 0:C.conversation_id,messageText:(null==C?void 0:null===(h=C.content_obj)||void 0===h?void 0:h.text)||""}),(0,f.jsx)(u.MessageTextContentLitePure,{inView:k,message:C,theme:x,messageBlockText:void 0,messageBlockTextFinish:void 0,messageBlockTextBroken:void 0,customRenderOptions:{useCustomReplacementElements:()=>(0,m.useReplacementArtifactElements)({message:C,isShareOrCollectionMessage:!0})}}),((0,r.isMessageFinished)(C)||(0,s.isBrokenMessage)(C))&&(0,f.jsx)(v.RiskTips,{jsonString:null===(y=C.verbose)||void 0===y?void 0:null===(_=y.extra)||void 0===_?void 0:_.risk_tips})]})};function g(e,t,n){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:i+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let h=e=>{let{inView:t,message:n,theme:i}=e;return n?(0,f.jsx)(p,{inView:t,message:n,theme:i}):null};class _{constructor(){g(this,"pluginIdentifier",i.receiveCodeArtifactContentIdentifier),g(this,"Content",h)}}},884962:function(e,t,n){n.d(t,{useOpenCodeCanvas:function(){return s}});var i=n(713738),l=n(57392),a=n(666196),o=n(698392);let s=()=>{let e=(0,o.useChatSlice)("chatViewCoreStore",e=>{var t;return(null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId)||""}),t=(0,a.useChatService)("chatViewService"),n=(0,i.useRef)(0);return{openFileByKey:(i,a,o,s)=>{let{attachments:r=[],messageId:d="",conversationId:u="",activePath:c}=a||{};t.openCanvasPanel({messageId:d,conversationId:u,canvasLayoutState:l.CanvasLayoutState.CANVAS_ONLY,fileKey:i,attachments:r,isCodeFile:!0,activePath:c,canvasVersion:n.current,chatId:e,teaCtx:o},s),n.current+=1},openCodeContent:(n,i,a,o,s)=>{let{messageId:r="",conversationId:d="",autoRun:u,autoQuote:c=!0}=a||{};t.openCanvasPanel({messageId:r,conversationId:d,canvasLayoutState:l.CanvasLayoutState.CANVAS_ONLY,fileKey:"",attachments:[],modelGenContent:{code:n,language:i},isCodeFile:!0,chatId:e,autoQuote:c,teaCtx:o,autoRun:u},s)},openRepo:(i,a,o)=>{let{id:s,name:r,url:d,activePath:u}=i||{};t.openCanvasPanel({messageId:"",conversationId:"",canvasLayoutState:l.CanvasLayoutState.CANVAS_ONLY,fileKey:s,canvasVersion:n.current,activePath:u,attachments:[{key:s,type:"link",identifier:s,local_key:s,name:r,url:d,repo_id:s}],isCodeFile:!0,chatId:e,teaCtx:a},o),n.current+=1},openArtifact:(e,n,i,a,o,s)=>{let{messageId:r="",conversationId:d="",isAutoOpen:u}=a||{},{version:c}=i||{};t.openCanvasPanel({conversationId:d,messageId:r,artifactId:e,artifactKey:n,defaultArtifacts:void 0,isCodeFile:!0,canvasLayoutState:l.CanvasLayoutState.CANVAS_ONLY,chatId:d,version:c,isAutoOpen:u,artifactMeta:i,teaCtx:o},s,u)}}}}}]);
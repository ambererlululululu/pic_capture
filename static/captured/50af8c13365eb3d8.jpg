"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["80602"],{981483:function(e,t,n){n.r(t),n.d(t,{stringifyDomNode:function(){return x.stringifyDomNode},isRoot:function(){return x.isRoot},stringifyChildren:function(){return x.stringifyChildren},useProcessMarkdown:function(){return x.useProcessMarkdown},parseMarkdown:function(){return x.parseMarkdown},isEndTagOfHtml:function(){return x.isEndTagOfHtml},useCopy:function(){return x.useCopy},LinkType:function(){return x.LinkType},isImage:function(){return x.isImage},stringifyMarkdown:function(){return x.stringifyMarkdown},useHop:function(){return x.useHop},isLiteralOfContent:function(){return x.isLiteralOfContent},useIsRTL:function(){return x.useIsRTL},isHeading:function(){return x.isHeading},autoDisableHtmlTag:function(){return x.autoDisableHtmlTag},getTagNameOfHtml:function(){return x.getTagNameOfHtml},BaseSourcePlugin:function(){return x.BaseSourcePlugin},BaseAstPlugin:function(){return x.BaseAstPlugin},isTypeOfContent:function(){return x.isTypeOfContent},useSmoothText:function(){return x.useSmoothText},isParentOfContent:function(){return x.isParentOfContent},parseMarkdownAndProcess:function(){return x.parseMarkdownAndProcess},isParent:function(){return x.isParent},MdBoxLazy:function(){return w},getTextOfAst:function(){return x.getTextOfAst},MdBoxLight:function(){return x.MdBoxLight},retryLoad:function(){return x.retryLoad},ImageStatus:function(){return x.ImageStatus}});var l=n(713738),o=n(40680),i=n(467851),r=n(274240),a=n(211997),c=n(506302);class s extends Error{constructor(e,t,n){super(),this.message=e,this.lexer=t,this.position=n}}let d=()=>{let[e,t]=(0,l.useState)(),o=(0,l.useCallback)(async()=>{if(e)return;let{default:l}=await (0,c.retryLoad)(()=>n.e("79817").then(n.bind(n,642593)));t(l)},[e]),i=(0,l.useMemo)(()=>{var e,t,n,l;return t=e=class{static render(){throw o(),new s("DefaultKatex.render has called",{},0)}static renderToString(){throw o(),new s("DefaultKatex.renderToString has called",{},0)}},(n="symbol"==typeof(l=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!=typeof l)return l;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n="ParseError","string"))?l:l+"")in t?Object.defineProperty(t,n,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[n]=s,e},[o]);return null!=e?e:i};var u=n(345660);let h=(e,t)=>{var n;let o=n=>(0,u.jsx)(l.Suspense,{fallback:t&&(0,u.jsx)(t,{...n}),children:(0,u.jsx)(e,{...n})});return o.displayName=null!==(n=e.displayName)&&void 0!==n?n:null==t?void 0:t.displayName,o};var f=n(217957),v=n(723112);let g=async(e,t)=>{let{tryTimes:n=5,interval:l=100,fallback:o,onRetryError:i}=t;for(let t=0;t<n;t++){let r=t+1;try{return await e()}catch(e){if(r>=n){if(!(0,f.default)(o))return o;throw e}null==i||i(e,t)}let a="number"==typeof l?l:l(r);await (0,v.timeoutPromise)(a)}throw Error("retry times out of limit")},m=(e,t)=>function(){for(var n=arguments.length,l=Array(n),o=0;o<n;o++)l[o]=arguments[o];return g(()=>e(...l),t)},p=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{retryTimes:o=5,retryInterval:i=100}=n;return(0,l.useMemo)(()=>h(l.lazy(m(e,{tryTimes:o,interval:i,fallback:{default:t}})),t),[o,i])};var x=n(184494);let w=(0,l.forwardRef)(function(e,t){let{slots:l={},autoFixSyntax:c=!0,retryTimes:s=5,retryInterval:h=100,...f}=e,v=d(),g=p(()=>Promise.all([n.e("79817"),n.e("22213"),n.e("40635")]).then(n.bind(n,982176)),r.default,{retryTimes:s,retryInterval:h}),m=p(()=>Promise.all([n.e("79817"),n.e("22213"),n.e("9097"),n.e("64407"),n.e("14668")]).then(n.bind(n,323186)),g,{retryTimes:s,retryInterval:h}),w=p(()=>Promise.all([n.e("84154"),n.e("50601")]).then(n.bind(n,915613)),a.default,{retryTimes:s,retryInterval:h});return(0,u.jsx)(x.MdBoxLight,{ref:t,slots:(0,o.default)(l,{Tex:m,CodeBlockHighlighter:w}),autoFixSyntax:c&&{katex:v,...(0,i.default)(c)?{}:c},...f})})},915613:function(e,t,n){n.r(t),n.d(t,{PrismCodeBlockHighlighter:function(){return f},default:function(){return v}});var l=n(713738),o=n(812650),i=n.n(o),r=n(534091);let a=null,c=async()=>{if(!a){let{default:{languages:e=null}={}}=await n.e("47739").then(n.t.bind(n,373275,23));a=e}return a},s=e=>{let[t,n]=(0,l.useState)(a||r.languages),o=async()=>{let e=await c();e&&e!==t&&n(e)};return(0,l.useEffect)(()=>{t[e]||o()},[t,e]),t[e]||t.plaintext},d=(e,t)=>{let n=t.toLowerCase(),o=s(n);return(0,l.useMemo)(()=>{try{return(0,r.highlight)(e,o,n)}catch(t){return e}},[n,e,o])};var u=n(812264),h=n(345660);let f=e=>{let{code:t,language:n="",className:l,style:o,dark:r=!1}=e,a=d(t,n);return(0,h.jsx)("pre",{className:i()("container-_HmLba",l,n&&`language-${n}`,{"dark-NA_5Bj":r}),style:o,children:(0,h.jsx)("code",{className:n&&`language-${n}`,dangerouslySetInnerHTML:{__html:(0,u.purifyHtml)(a)}})})};var v=f},783593:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,o.jsx)("path",{fill:"currentColor",d:"M12 .5a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1"}),(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 19a7 7 0 1 0 0-14 7 7 0 0 0 0 14m0-2a5 5 0 1 0 0-10 5 5 0 0 0 0 10",clipRule:"evenodd"}),(0,o.jsx)("path",{fill:"currentColor",d:"M13 21.5a1 1 0 1 0-2 0v1a1 1 0 1 0 2 0zM23.5 12a1 1 0 0 1-1 1h-1a1 1 0 1 1 0-2h1a1 1 0 0 1 1 1M2.5 13a1 1 0 1 0 0-2h-1a1 1 0 1 0 0 2zM20.132 5.282l-.707.707a1 1 0 0 1-1.415-1.414l.707-.707a1 1 0 1 1 1.415 1.414M5.282 20.132l.708-.708a1 1 0 1 0-1.415-1.414l-.707.707a1 1 0 1 0 1.414 1.415M18.718 20.132l-.708-.707a1 1 0 0 1 1.415-1.414l.707.707a1 1 0 0 1-1.415 1.414M4.575 5.99A1 1 0 1 0 5.99 4.576l-.708-.707a1 1 0 0 0-1.414 1.414z"})]}),{}))},945396:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",d:"M18 18.25v-1.955l3.02 2.028c1.333.75 2.98-.213 2.98-1.743V7.42c0-1.53-1.647-2.493-2.98-1.743L18 7.705V5.75c0-1.243-.895-2.25-2-2.25H2c-1.105 0-2 1.007-2 2.25v12.5c0 1.243.895 2.25 2 2.25h14c1.105 0 2-1.007 2-2.25M16 5.5v13H2v-13zm6 11.08L18 14v-4l4-2.58z"})}),{}))},586303:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.797 16.856a8.28 8.28 0 0 0 6.27 2.87h.008A8.28 8.28 0 0 0 14.372 3.84a11.6 11.6 0 0 1-1.658 7.714 11.62 11.62 0 0 1-7.917 5.303M13.415 1.43a10.28 10.28 0 0 1-2.348 20.296 10.28 10.28 0 0 1-8.883-5.103c-.397-.74.155-1.605.912-1.609a9.617 9.617 0 0 0 9.011-12.258 1.093 1.093 0 0 1 1.308-1.326",clipRule:"evenodd"})}),{}))},811465:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11m0-20a9 9 0 1 1 0 18 9 9 0 0 1 0-18m-.909 4.667a1 1 0 0 0-1.591.806v7.054a1 1 0 0 0 1.591.806l4.81-3.527a1 1 0 0 0 0-1.612z",clipRule:"evenodd"})}),{}))},52963:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M4 4a1 1 0 0 1 1 1v3a3 3 0 0 0 3 3h11.086l-5.293-5.293a1 1 0 0 1 1.414-1.414l7 7a1 1 0 0 1 0 1.414l-7 7a1 1 0 0 1-1.414-1.414L19.086 13H8a5 5 0 0 1-5-5V5a1 1 0 0 1 1-1",clipRule:"evenodd"})}),{}))},71848:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18m0 2c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11M10.756 7.299a1.245 1.245 0 1 1 2.488 0l-.227 5.227a1.018 1.018 0 0 1-2.034 0zM12 16.9a1.2 1.2 0 1 0 0-2.4 1.2 1.2 0 0 0 0 2.4",clipRule:"evenodd"})}),{}))},143475:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M17 10.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0m-1.237 6.675a8.5 8.5 0 1 1 1.413-1.413l.031.03 5 5a1 1 0 0 1-1.414 1.415l-5-5zM7 10.5a1 1 0 0 1 1-1h1.5V8a1 1 0 0 1 2 0v1.5H13a1 1 0 1 1 0 2h-1.5V13a1 1 0 1 1-2 0v-1.5H8a1 1 0 0 1-1-1",clipRule:"evenodd"})}),{}))},959601:function(e,t,n){n.d(t,{default:function(){return i}}),n(713738);var l=n(430261),o=n(345660),i=(0,l.IconFactory)((0,o.jsx)(e=>(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,o.jsx)("path",{fill:"currentColor",fillRule:"evenodd",d:"M10.5 17a6.5 6.5 0 1 0 0-13 6.5 6.5 0 0 0 0 13m0 2a8.46 8.46 0 0 0 5.263-1.825l.03.032 5 5a1 1 0 0 0 1.414-1.414l-5-5-.032-.03A8.5 8.5 0 1 0 10.5 19M8 9.5a1 1 0 0 0 0 2h5a1 1 0 1 0 0-2z",clipRule:"evenodd"})}),{}))},901034:function(e,t,n){n.d(t,{useFlowWebSashPct:function(){return i}});var l=n(865607),o=n(698392);let i=()=>(0,o.useChatSlice)("chatViewCanvasStore",e=>{let t=e.isExpand?e.matchedCanvasPluginIdentifier:void 0;return t?{sashPct:e.sashPctMap[String(t)],canvasExpandWithPreRender:e.isExpand&&!!e.preRenderNodeId,matchedPluginName:String(t)}:{}},l.shallow)},667006:function(e,t,n){n.d(t,{toggleCodeBlockThemeMode:function(){return r},useCodeBlockThemeMode:function(){return i}});var l=n(544901);let o=()=>l.useCodeBlockStore.getState().codeBlockMode,i=()=>(0,l.useCodeBlockStore)(e=>e.codeBlockMode),r=()=>{l.useCodeBlockStore.setState({codeBlockMode:o()===l.CodeBlockMode.LIGHT?l.CodeBlockMode.DARK:l.CodeBlockMode.LIGHT})}},335575:function(e,t,n){n.d(t,{MdboxCodeBlock:function(){return Y}});var l=n(713738),o=n(430261),i=n(345660),r=(0,o.IconFactory)((0,i.jsx)(e=>(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:[(0,i.jsx)("path",{fill:"#000",fillOpacity:.8,d:"M4.974 14q-.545 0-1.004-.277a2.2 2.2 0 0 1-.727-.727A1.94 1.94 0 0 1 2.974 12q0-.555.269-1.004.277-.46.727-.728Q4.428 10 4.974 10q.865 0 1.437.58.58.571.58 1.42 0 .537-.277.996-.277.45-.736.727-.45.277-1.004.277"}),(0,i.jsx)("path",{fill:"#000",fillOpacity:.3,d:"M11.991 14q-.545 0-1.004-.277a2.2 2.2 0 0 1-.727-.727A1.94 1.94 0 0 1 9.99 12q0-.555.269-1.004.276-.46.727-.728Q11.445 10 11.99 10q.866 0 1.437.58.58.571.58 1.42 0 .537-.276.996-.277.45-.736.727-.45.277-1.005.277"}),(0,i.jsx)("path",{fill:"#000",fillOpacity:.15,d:"M19.009 14q-.546 0-1.005-.277a2.2 2.2 0 0 1-.727-.727A1.94 1.94 0 0 1 17.01 12q0-.555.268-1.004.277-.46.727-.728Q18.464 10 19.01 10q.865 0 1.437.58.58.571.58 1.42 0 .537-.277.996-.277.45-.736.727-.45.277-1.004.277"})]}),{})),a=n(579163),c=n.n(a),s=n(812650),d=n.n(s),u=n(915613),h=n(284033),f=n(695422),v=n(57392),g=n(698392),m=n(922851),p=n(915299),x=n(524129),w=n(198660),k=n(297547),_=n(584265),y=n(544901),C=n(629006),b=n(674157);let j=e=>{let{message:t}=e;return{isCIReply:(0,C.isCIReplyMessage)(t),isFinished:(0,b.isMessageFinished)(t)}};var S=n(637319),M=n(83990),B=n(212183),T=n(777422);let N=e=>{var t;let n;let l=null!==(t=null==e?void 0:e.length)&&void 0!==t?t:0;return 1===l?n=String(null==e?void 0:e[0]):l>1&&(n=JSON.stringify(e)),n},I=e=>{let{message:t,conversationId:n,codeBlockPosition:o}=e;return{codeBlockShowEvent:(0,l.useCallback)((e,l)=>{let i,r;if(null==t?void 0:t.reply_id){try{var a,c;i=N(null===(c=(0,S.getMessageByIdSelector)(M.useMessageStore.getState(),n,null==t?void 0:t.reply_id))||void 0===c?void 0:null===(a=c.attachments)||void 0===a?void 0:a.map(e=>e.key).filter(Boolean)),r=(0,B.getBotIdByConversationId)(n,!0)}catch(e){}(0,T.trackEvent)("code_block_show",{code_type:e,message_id:t.message_id,section_id:t.section_id,conversation_id:t.conversation_id,bot_id:r,collection_id:i,whether_dark_mode:+(l===y.CodeBlockMode.DARK),position:o})}},[null==t?void 0:t.message_id,null==t?void 0:t.reply_id,n]),codeBlockActionBtnClickEvent:(e,l)=>{let i,r;if(null==t?void 0:t.reply_id){try{var a,c;i=N(null===(c=(0,S.getMessageByIdSelector)(M.useMessageStore.getState(),n,null==t?void 0:t.reply_id))||void 0===c?void 0:null===(a=c.attachments)||void 0===a?void 0:a.map(e=>e.key).filter(Boolean)),r=(0,B.getBotIdByConversationId)(n,!0)}catch(e){}(0,T.trackEvent)("code_block_click",{code_type:e,message_id:t.message_id,section_id:t.section_id,conversation_id:t.conversation_id,bot_id:r,collection_id:i,button_name:l,position:o})}}}};var A=n(667006),E=n(214902),R={"code-block-element":"code-block-element-YDlfvc",codeBlockElement:"code-block-element-YDlfvc",dark:"dark-xmPie6","code-area":"code-area-tZtDgG",codeArea:"code-area-tZtDgG",header:"header-cGu84a",title:"title-XQhI4x",clickable:"clickable-eGISjP",icon:"icon-FIfuuc",rotate:"rotate-NPRMak",text:"text-jgT4jF",action:"action-tEcs3i",hoverable:"hoverable-sPLxOT",content:"content-EGRozu","content--stderr":"content--stderr-rA5UWN",contentStderr:"content--stderr-rA5UWN","content--stdout":"content--stdout-RiVm4m",contentStdout:"content--stdout-RiVm4m","generating-wrapper":"generating-wrapper-W3y9m4",generatingWrapper:"generating-wrapper-W3y9m4",generating:"generating-vQaQl2",generatingText:"generatingText-cIA37O",mask:"mask-ZLHDuN","thumbnail-content":"thumbnail-content-qprLHf",thumbnailContent:"thumbnail-content-qprLHf","header-wrapper":"header-wrapper-UnnlXS",headerWrapper:"header-wrapper-UnnlXS","mask-wrapper":"mask-wrapper-VgpgeU",maskWrapper:"mask-wrapper-VgpgeU","light-scrollbar":"light-scrollbar-TbsSwi",lightScrollbar:"light-scrollbar-TbsSwi"},L=n(554479);let P=l.memo(e=>{let{isExpand:t=!1}=e;return(0,i.jsx)("div",{className:d()(R.icon,t?void 0:R.rotate),children:(0,i.jsx)(L.default,{className:"text-12"})})}),H=e=>{let{language:t,disabled:n,tips:l,isExpand:o,onExpand:r}=e,a=(0,k.default)(()=>{r()}),c=(0,i.jsxs)("div",{className:d()(R.title,n?null:R.clickable),onClick:n?void 0:a,children:[(0,i.jsx)("div",{className:R.text,children:t}),n?null:(0,i.jsx)(P,{isExpand:o})]});return n?c:(0,i.jsx)(E.SamanthaTooltip,{content:l,style:{fontSize:"12px"},spacing:{y:10,x:0},clickToHide:!0,children:c})};var O=n(55845);let D=l.memo(e=>{let{showTooltip:t,handlePreview:n}=e,l=(0,p.useTranslateFn)(),o=(0,i.jsx)("div",{className:R.hoverable,onClick:n,children:(0,i.jsx)(O.default,{className:"text-14"})});return t?(0,i.jsx)(E.SamanthaTooltip,{content:l("cici_web_ai_coding_code_block_expand"),style:{fontSize:"12px"},spacing:{y:10,x:0},clickToHide:!0,children:o}):o}),F=e=>{let{language:t,mode:n,isExpand:l,className:o,onExpand:r,onPreview:a,showTooltip:c,codeShowPreview:s}=e,u=(0,p.useTranslateFn)(),h=(0,k.default)(()=>{a()}),f=(0,k.default)(()=>{r()});return(0,i.jsx)("div",{className:d()(R["code-block-element"],R[n],n,"hide-indicator","disable-theme-style"),children:(0,i.jsx)("div",{className:d()(R["code-area"],R["thumbnail-content"],"code-area",o),dir:"ltr",children:(0,i.jsxs)("div",{className:R.header,children:[(0,i.jsx)(H,{tips:u("code_block_switch_button_show_details"),language:t,isExpand:l,onExpand:f}),s&&(0,i.jsx)("div",{className:R.action,children:(0,i.jsx)(D,{handlePreview:h,showTooltip:c})})]})})})};var z=n(586303),V=n(783593);let K=l.memo(e=>{let{mode:t,showTooltip:n,changeTheme:l}=e,o=(0,p.useTranslateFn)(),r=(0,i.jsx)("div",{className:R.hoverable,onClick:l,children:t===y.CodeBlockMode.DARK?(0,i.jsx)(V.default,{className:"text-14"}):(0,i.jsx)(z.default,{className:"text-14"})});return n?(0,i.jsx)(E.SamanthaTooltip,{content:o(t===y.CodeBlockMode.DARK?"web_ai_coding_codeblock_light_mode":"web_ai_coding_codeblock_dark_mode"),spacing:{y:10,x:0},style:{fontSize:"12px"},children:r}):r});var q=n(811465);let W=l.memo(e=>{let{type:t,handleRun:n}=e,l=(0,p.useTranslateFn)();return(0,i.jsxs)("div",{className:R.hoverable,onClick:n,style:{width:"fit-content",paddingInline:"3px"},children:[(0,i.jsx)(q.default,{className:"text-14 mr-4"}),l("preview"===t?"web_ai_coding_code_block_preview":"web_ai_coding_code_block_run")]})});var G=n(52963);let Q=l.memo(e=>{let{showTooltip:t,handleQuote:n}=e,l=(0,p.useTranslateFn)(),o=(0,i.jsx)("div",{className:R.hoverable,onClick:n,children:(0,i.jsx)(G.default,{className:"text-14"})});return t?(0,i.jsx)(E.SamanthaTooltip,{content:l("cici_web_ai_coding_code_block_cite"),spacing:{y:10,x:0},style:{fontSize:"12px"},children:o}):o});var U=n(650543),$=n(456602);let X=l.memo(e=>{let{isCopied:t,showTooltip:n,handleCopy:l}=e,o=(0,p.useTranslateFn)(),r=(0,i.jsx)("div",{className:R.hoverable,onClick:l,"data-testid":"code-block-copy",children:t?(0,i.jsx)($.default,{className:"text-14"}):(0,i.jsx)(U.default,{className:"text-14"})});return n?(0,i.jsx)(E.SamanthaTooltip,{content:o(t?"cici_web_ai_coding_code_block_copied":"cici_web_ai_coding_code_block_copy"),style:{fontSize:"12px"},spacing:{y:10,x:0},children:r}):r}),Y=e=>{var t;let{className:n,contentClassName:o,codeAreaClassName:a,style:s,code:C,language:b,onCopyCode:S,viewOnly:M=!1,showHeader:B=!0,showTooltip:T=!0,showRun:N,codeShowPreview:E=!0,loading:L=!1,message:P,meta:O=""}=e,z=(0,g.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatId}),V=(0,p.useTranslateFn)(),[q,G]=(0,l.useState)(!1),[U,$]=(0,l.useState)(!1),[Y,Z]=(0,l.useState)(!1),[J,ee]=(0,l.useState)(!0),[et,en]=(0,l.useState)(!1),[el,eo]=(0,l.useState)(0),ei=(0,w.useIsLoggedIn)(),er=b||"",ea=(0,l.useRef)(null),ec=(0,_.useCodeBlockPosition)(C,P),es=I({message:P,conversationId:z||"",codeBlockPosition:ec}),ed=(0,A.useCodeBlockThemeMode)(),{isCIReply:eu,isFinished:eh}=j({message:P}),ef=eu||O.includes('type="interpreter"'),ev=L&&!eh;(0,l.useEffect)(()=>{var e;null==es||null===(e=es.codeBlockShowEvent)||void 0===e||e.call(es,er,ed)},[er,null==es?void 0:es.codeBlockShowEvent]);let eg=(0,l.useRef)(null),em=(0,g.useChatSlice)("chatViewCanvasStore",e=>e.isExpand),ep=(0,l.useMemo)(()=>"function"==typeof N&&N(er)||null,[er,N]);(0,l.useEffect)(()=>{let e=eg.current;if(!e)return;let t=()=>{let{scrollTop:t,scrollHeight:n,clientHeight:l}=e;en(t+l>=n-1)},n=new ResizeObserver(()=>{t()});return e.addEventListener("scroll",t),n.observe(e),()=>{e.removeEventListener("scroll",t),n.unobserve(e)}},[]),(0,l.useEffect)(()=>{$(!et)},[et]),(0,l.useEffect)(()=>{em&&ev?Z(!0):Z(!1)},[em,ev]),(0,l.useEffect)(()=>{if(el>0){var e;null===(e=ea.current)||void 0===e||e.open()}},[el]);let ex=(0,k.default)(()=>{!q&&(null==es||es.codeBlockActionBtnClickEvent(er,"copy"),c()(C),null==S||S(C),G(!0),setTimeout(()=>{G(!1)},3e3))}),ew=(0,k.default)(()=>{var e;null==es||null===(e=es.codeBlockActionBtnClickEvent)||void 0===e||e.call(es,er,ed===y.CodeBlockMode.DARK?"to_bright_mode":"to_dark_mode"),(0,A.toggleCodeBlockThemeMode)()}),ek=(0,g.getChatSlice)("chatInputStore").checkSupportSkill(x.SkillType.CodeAssistant),e_=(0,k.default)(()=>{let e=x.SkillType.CodeAssistant;z&&(null==es||es.codeBlockActionBtnClickEvent(er,"cite"),(0,g.getChatSlice)("chatInputStore").activeSkillTypeMap[z]!==e&&(0,g.getChatSlice)("chatInputStore").updateActiveSkillTypeMap(z,e,f.SkillFrom.Quote),(0,m.getChatService)("refContentStoreService").then(t=>{null==t||t.setRefContents({refContents:[{type:"text",text:C,extra:{language:er}}],channel:`skill_${e}`},z)}))}),ey=(0,l.useCallback)(()=>{var e,t;if(!ei){eo(0),null===(e=ea.current)||void 0===e||e.open();return}N&&"preview"===ep?eo(e=>e+1):null===(t=ea.current)||void 0===t||t.open(),null==es||es.codeBlockActionBtnClickEvent(er,"fullscreen")},[ep,ei]),eC=(0,k.default)(()=>{ee(!J)}),eb=(0,l.useCallback)(()=>{if(ep){var e;eo(e=>e+1),null==es||null===(e=es.codeBlockActionBtnClickEvent)||void 0===e||e.call(es,er,ep)}},[ep]),ej=(0,l.useMemo)(()=>!ev&&!J&&B&&!ef,[ev,J,B,ef]),eS=ej?(0,i.jsx)(F,{mode:ed,language:er,isExpand:J,onPreview:ey,onExpand:eC,showTooltip:T,codeShowPreview:E}):(0,i.jsx)("div",{className:d()(R["code-block-element"],R[ed],ed,`custom-code-block-container--${er.toLowerCase()}`,"hide-indicator","disable-theme-style","custom-code-block-container",n),style:s,children:(0,i.jsxs)("div",{className:d()(R["code-area"],"code-area",a),dir:"ltr",children:[B&&(0,i.jsx)("div",{className:R["header-wrapper"],children:(0,i.jsxs)("div",{className:R.header,children:[(0,i.jsx)(H,{language:er,isExpand:J,disabled:ev||M||ef,tips:V("code_block_switch_button_hide_details"),onExpand:eC}),!ev&&(0,i.jsxs)("div",{className:d()(R.action),children:[!M&&ek&&ep&&(0,i.jsx)(W,{type:ep,handleRun:eb}),(0,i.jsx)(X,{showTooltip:T,isCopied:q,handleCopy:ex}),!M&&ek&&(0,i.jsx)(Q,{showTooltip:T,handleQuote:e_}),(0,i.jsx)(K,{showTooltip:T,mode:ed,changeTheme:ew}),!M&&ek&&(0,i.jsx)(D,{showTooltip:T,handlePreview:ey})]})]})}),(0,i.jsx)("div",{ref:eg,className:d()(R.content,"code-content",R["light-scrollbar"],R[`content--${er.toLowerCase()}`],o,em?"max-h-325":null),children:u.PrismCodeBlockHighlighter&&(0,i.jsx)(u.PrismCodeBlockHighlighter,{code:C,language:er,dark:ed===y.CodeBlockMode.DARK})}),Y?(0,i.jsx)("div",{className:R["generating-wrapper"],children:(0,i.jsxs)("div",{className:R.generating,children:[(0,i.jsx)("span",{className:R.generatingText,children:V("web_ai_coding_generating_tips")}),(0,i.jsx)(r,{className:"!text-12"})]})}):null,(0,i.jsx)("div",{className:R["mask-wrapper"],style:{opacity:U&&!Y?1:0},children:(0,i.jsx)("div",{className:R.mask})})]})});return B&&!ev&&!M&&ek?(0,i.jsx)(h.CanvasWrapper,{ref:ea,className:d()("custom-code-block-canvas-wrapper",ej?"w-fit":"w-full"),pluginIdentifier:"coding-canvas-preview",canvasContent:{messageId:null!==(t=null==P?void 0:P.message_id)&&void 0!==t?t:"",conversationId:z||"",canvasLayoutState:v.CanvasLayoutState.CANVAS_ONLY,fileKey:"",attachments:[],modelGenContent:{code:C,language:er},isCodeFile:!0,chatId:z||"",autoQuote:!0,autoRun:el},disablePreRender:!0,children:eS}):eS}},544901:function(e,t,n){n.d(t,{CodeBlockMode:function(){return d},useCodeBlockStore:function(){return f}});var l,o,i,r,a=n(642220),c=n(580296),s=n(38848);let d=((l={}).DARK="dark",l.LIGHT="light",l),u={codeBlockMode:"undefined"!=typeof window&&(null===(r=window)||void 0===r?void 0:null===(i=r.matchMedia)||void 0===i?void 0:null===(o=i.call(r,"(prefers-color-scheme: dark)"))||void 0===o?void 0:o.matches)?d.DARK:d.LIGHT},h=()=>({...u}),f=(()=>{let e=(0,a.persist)((0,a.subscribeWithSelector)(h),{name:"flow-web-code-block-theme-store",getStorage:()=>s.FlowLocalStorage});return(0,c.create)()(e)})()},584265:function(e,t,n){n.d(t,{CodeBlockPositionContext:function(){return i},useCodeBlockPosition:function(){return a}});var l=n(713738),o=n(629006);let i=(0,l.createContext)({position:0}),r=(e,t)=>{let n=0;for(let l=0;l<t;l++)"```"===e.slice(l,l+3)&&(n++,l+=3);return n},a=(e,t)=>{let n=(0,l.useRef)(0),{position:a}=(0,l.useContext)(i);if(a>0)return a;if(n.current<1)try{var c,s,d,u,h,f;if((0,o.isBlockMessage)(t)){let l=null!==(s=null==t?void 0:null===(c=t.content_blocks)||void 0===c?void 0:c.filter(e=>{var t,n;return("0"===e.parent_id||!e.parent_id)&&(null!==(n=null===(t=e.content_obj)||void 0===t?void 0:t.text)&&void 0!==n?n:"").includes("```")}))&&void 0!==s?s:[];if(0===l.length)return 0;let o=0;for(let t of l){let n=null!==(u=null===(d=t.content_obj)||void 0===d?void 0:d.text)&&void 0!==u?u:"",l=n.indexOf(e);if(l>-1){let e=r(n,l);o+=Math.floor(e/2);break}{let e=r(n,l);o+=Math.floor(e/2)}}n.current=o+1}else{let l=null!==(f=null==t?void 0:null===(h=t.content_obj)||void 0===h?void 0:h.text)&&void 0!==f?f:"";if(!l||"string"!=typeof l)return 0;let o=l.indexOf(e);if(o>-1){let e=r(l,o);n.current=Math.floor(e/2)+1}}}catch(e){return 0}return n.current}}}]);
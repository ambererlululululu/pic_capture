"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["49690"],{769110:function(e,t,s){s.d(t,{Link:function(){return o}});var r=s(186995),a=s(532430),n=s(345660);let o=e=>{let t=(0,a.getFromInstance)("Link",r.Link);return(0,n.jsx)(t,{...e})}},680887:function(e,t,s){s.d(t,{default:function(){return n}}),s(713738);var r=s(430261),a=s(345660),n=(0,r.IconFactory)((0,a.jsx)(e=>(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 24",...e,children:(0,a.jsx)("path",{fill:"currentColor",d:"M21.707 7.293a1 1 0 0 0-1.414 0L12 15.586 3.707 7.293a1 1 0 0 0-1.414 1.414L10.586 17a2 2 0 0 0 2.828 0l8.293-8.293a1 1 0 0 0 0-1.414"})}),{}))},848504:function(e,t,s){s.d(t,{useFPSPassive:function(){return n}});var r=s(713738),a=s(297547);let n=e=>{let{interval:t=1e3,onChange:s}=e,n=(0,r.useRef)(-1),o=(0,r.useRef)(0),i=(0,r.useRef)(0),l=(0,r.useRef)(0),u=(0,a.default)(function(e){0===l.current&&(l.current=e),i.current++,e-l.current>=t&&(o.current=Math.round(1e3*i.current/(e-l.current)),null==s||s(o.current),i.current=0,l.current=e),n.current=window.requestAnimationFrame(u)}),d=(0,a.default)(()=>{i.current=0,l.current=0,n.current=window.requestAnimationFrame(u)}),c=(0,a.default)(()=>{n.current&&window.cancelAnimationFrame(n.current)});return{fps:o.current,start:d,stop:c}}},403649:function(e,t,s){s.d(t,{RiskTips:function(){return u}});var r=s(812650),a=s.n(r),n=s(165482),o=s(769110),i=s(345660),l={TEXT:1,URL:2};let u=e=>{let{jsonString:t,tips:s,isBlock:r}=e,u=null!=s?s:[];return(null==s?void 0:s.length)||!t||(u=(0,n.parseJSON)(t,[])),(0,i.jsx)(i.Fragment,{children:u.map(e=>{let{type:t,text:s,url:n}=e;return t===l.URL?(0,i.jsx)(o.Link,{to:null!=n?n:"",target:"_blank",rel:"noopener noreferrer",className:a()("block text-sm/[24px] text-s-color-brand-primary-default",{"mt-12":!r}),children:s}):t===l.TEXT?(0,i.jsx)("div",{className:a()("text-sm/[24px] text-s-color-text-quaternary",{"mt-12":!r}),children:s}):null})})}},511720:function(e,t,s){s.d(t,{CollectionDetailTrackEventProvider:function(){return l},CollectionTrackEventProvider:function(){return o},useCollectionTrackEventContext:function(){return u}});var r=s(713738),a=s(436114);let n=(0,r.createContext)({viewId:0,reportCollectContentCard:a.default,reportFilteringOptionsShow:a.default,reportFilteringOptionsClick:a.default}),o=n.Provider,i=(0,r.createContext)({}),l=i.Provider,u=()=>{let e=(0,r.useContext)(n),t=(0,r.useContext)(i);return{...e,...t}}},220:function(e,t,s){s.d(t,{useFPSReport:function(){return i},useScrollFPSReport:function(){return l},useStreamFPSReport:function(){return u}});var r=s(713738),a=s(297547),n=s(848504),o=s(178230);let i=e=>{let{eventName:t,interval:s}=e,i=(0,r.useRef)([]),l=(0,a.default)(e=>{i.current.length>=120&&i.current.shift(),i.current.push(e)}),{start:u,stop:d}=(0,n.useFPSPassive)({interval:s,onChange:l});return{startRecord:(0,a.default)(()=>{i.current=[],u()}),reportFPS:(0,a.default)(e=>{d();let s=i.current;if(s.length<1)return;let r=Math.round(s.reduce((e,t)=>e+t,0)/s.length),a=s.reduce((e,t)=>(t<20&&e++,e),0)>=3,n=s.reduce((e,t)=>(t<10&&e++,e),0)>=3,l=s.reduce((e,t)=>(t<3&&e++,e),0)>=3;o.logger.persist.info({eventName:t,meta:{fps_list:s,avg_fps:r,is_minor_stuck:a,is_major_stuck:n,is_critical_stuck:l,...e}})})}},l=e=>{let{eventName:t}=e,s=(0,r.useRef)(!1),a=(0,r.useRef)(),{startRecord:n,reportFPS:l}=i({eventName:t}),u=e=>{a.current=setTimeout(()=>{l(e),s.current=!1},5e3)};return{onScrollForFPS:e=>{s.current?clearTimeout(a.current):(o.logger.persist.info({eventName:t,meta:{...e,type:"start"}}),s.current=!0,n()),u(e)}}},u=e=>{let{eventName:t}=e,{startRecord:s,reportFPS:a}=i({eventName:t}),n=(0,r.useRef)(!1);return{startFPSRecord:()=>{n.current||(n.current=!0,s())},stopFPSRecord:e=>{n.current=!1,a(e)}}}},839783:function(e,t,s){s.d(t,{updateReceiveMessagePerformance:function(){return n},updateSendMessagePerformance:function(){return a}});var r=s(379424);let a=(e,t)=>{r.useMessagePerformanceStore.setState(s=>{var r;let a=null!==(r=s.sendMessagePerformance[e])&&void 0!==r?r:{};return{sendMessagePerformance:{...s.sendMessagePerformance,[e]:{...a,...t}}}})},n=(e,t)=>{r.useMessagePerformanceStore.setState(s=>{var r;let a=null!==(r=s.receiveMessagePerformance[e])&&void 0!==r?r:{};return{receiveMessagePerformance:{...s.receiveMessagePerformance,[e]:{...a,...t}}}})}},379424:function(e,t,s){s.d(t,{useMessagePerformanceStore:function(){return o}});var r=s(642220),a=s(580296);let n=()=>({sendMessagePerformance:{},receiveMessagePerformance:{}}),o=(()=>{let e=(0,r.subscribeWithSelector)(n);return(0,a.create)()(e)})()},390322:function(e,t,s){s.d(t,{updateReadMessageIndexAndReport:function(){return u},updateReadMessageIndexAndReportIfInCurrentConversation:function(){return d}});var r=s(756817),a=s(178230),n=s(230932),o=s(389174),i=s(266035);let l={};async function u(e,t,s){n.useFeedStore.getState().updateConversationMessageIndex({conversationId:e,messageIndex:s,readMessageIndex:t,badgeCount:s,readBadgeCount:t}),await c(e)(t)}function d(e,t,s){if(s===e){u(e,t,t);return}let r=n.useFeedStore.getState().conversationMap[e];if(!s&&(0,o.isCocoConversation)(r)){u(e,t,t);return}n.useFeedStore.getState().updateConversationMessageIndex({conversationId:e,messageIndex:t,badgeCount:t})}let c=e=>(l[e]||(l[e]=(0,r.default)(async t=>{try{return(await (0,i.getConversationApiClient)()).markConversationRead({conversation_id:e,latest_read_idx:t})}catch(e){a.logger.persist.error({message:"report conversation read index failed",error:e})}},500)),l[e])},959610:function(e,t,s){s.d(t,{useRetryReceiveMessage:function(){return u},useRetrySendMessage:function(){return l}});var r=s(725705),a=s(178230),n=s(856392),o=s(637319),i=s(83990);let l=e=>{let{sendMessage:t,message:s,customPayload:n}=e;return()=>{if(!s)return;let e={conversation_id:s.conversation_id||s.local_conversation_id,message_id:(null==s?void 0:s.message_id)||s.local_message_id,is_local_message:(0,r.isLocalMessage)(s)};a.logger.persist.info({eventName:"retry_send_message_start",meta:e});try{t([{conversationId:s.conversation_id||s.local_conversation_id,reportParams:{scene:"resend"},operation:{resend:{messageLink:{messageId:s.message_id||s.local_message_id||"",isLocalMessage:(0,r.isLocalMessage)(s)}}},...n}])}catch(t){a.logger.persist.error({eventName:"retry_send_message_failed",meta:e,error:t})}}},u=e=>{let{sendMessage:t,message:s}=e;return()=>{if(!s)return;let e=(0,n.createReportEvent)({eventName:"retry_receive_message",meta:{conversation_id:s.conversation_id,reply_id:null==s?void 0:s.reply_id,message_id:null==s?void 0:s.message_id}}),{reply_id:r}=s||{};if(!r){e.error({reason:"reply_id is null, retry failed"});return}let a={isLocalMessage:!1,messageId:r},l=(0,o.getMessageSelector)(i.useMessageStore.getState(),s.conversation_id||"",a);try{t([{conversationId:s.conversation_id,operation:{replace:{messageLink:a}},reportParams:{scene:"resend"}}]),e.successIfIdle(3e3)}catch(t){e.error({reason:"send message happen error, retry failed",error:t,meta:{content_type:null==l?void 0:l.content_type,is_local_message:null==a?void 0:a.isLocalMessage}})}}}},459046:function(e,t,s){s.d(t,{checkImagesShowError:function(){return o},reportMessageShowError:function(){return n}});var r=s(178230),a=s(83990);let n=e=>{var t,s,n,o,i,l;let{message:u,reason:d,error:c,from:g,meta:m}=e,v=null!=c?c:Error(d),f={success:"0",reason:d,content_type:String(null!==(n=null==u?void 0:u.content_type)&&void 0!==n?n:"unknown"),skill_id:String(null!==(o=null==u?void 0:null===(t=u.skill)||void 0===t?void 0:t.skill_id)&&void 0!==o?o:"generic"),message_from:null!==(i=null==u?void 0:null===(s=u.local_info)||void 0===s?void 0:s.from)&&void 0!==i?i:"unknown",user_type:String(null!==(l=null==u?void 0:u.user_type)&&void 0!==l?l:"unknown"),conversation_id:null==u?void 0:u.conversation_id,message_id:null==u?void 0:u.message_id,conversation_type:String(null==u?void 0:u.conversation_type),from:g||"unknown",...m},h=null==u?void 0:u.message_id;if(a.useMessageStore.getState().checkMessageShowErrorHasReported({messageId:h})){r.logger.console.error({eventName:"message_show_error_duplicate",error:v,meta:f});return}a.useMessageStore.getState().updateMessageShowErrorHasReported({messageId:h}),r.logger.persist.error({eventName:"message_show_error",error:v,meta:f})},o=e=>{let{element:t,hasImage:s=!1,defaultNaturalWidth:r=256,defaultNaturalHeight:a=192,onError:n}=e;if(s){let e=t.querySelectorAll("[data-testid=mdbox_image] picture");if(0===e.length)null==n||n({reason:"images_render_error"});else{let t=!1;e.forEach(e=>{let s=e.querySelector("img");(null==s?void 0:s.complete)&&s.naturalWidth&&s.naturalHeight&&(s.naturalWidth!==r||s.naturalHeight!==a)&&(t=!0)}),t||null==n||n({reason:"all_images_load_error"})}}}},496910:function(e,t,s){s.d(t,{MessageListLoadMore:function(){return c}});var r=s(828438),a=s(713738),n=s(453157),o=s(83990),i=s(604889),l=s(48766),u=s(345660);let d=(0,a.forwardRef)(function(e,t){return(0,u.jsx)("div",{className:"load-more-wrapper-UMMBMG",ref:t,children:(0,u.jsx)(l.default,{size:"middle"})})});function c(e){let{className:t,style:s}=e,{hasMore:r,inLoadingMore:a}=m(e);return(0,u.jsx)(g,{hasMore:r,inLoadingMore:a,className:t,style:s})}let g=e=>{let{hasMore:t,inLoadingMore:s}=e,{inView:n,ref:o}=(0,r.useInView)(),{chatViewRef:l}=(0,i.useChatRef)();return((0,a.useEffect)(()=>{if(n&&t){var e,s;null===(s=l.current)||void 0===s||null===(e=s.onLoadMore)||void 0===e||e.call(s)}},[n]),s)?(0,u.jsx)(d,{ref:o}):null},m=e=>{let{conversationId:t}=e;return(0,o.useMessageStore)(e=>{var s,r;return{hasMore:(null===(s=e.messageListStatusMap[t])||void 0===s?void 0:s.hasMore)||!1,inLoadingMore:(null===(r=e.messageListStatusMap[t])||void 0===r?void 0:r.inLoadingMore)||!1}},n.shallow)}},273737:function(e,t,s){s.d(t,{MessageList:function(){return t7}});var r,a=s(713738),n=s(453157),o=s(385093),i=s(812650),l=s.n(i),u=s(956801),d=s(802370),c=s(321647);let g={inViewMessageList:[],messageBoxElementsMap:{}},m=(0,c.create)(()=>({...g})),v=e=>{m.setState({inViewMessageList:e})},f=()=>{m.setState(g)},h=(e,t)=>{m.setState(s=>({messageBoxElementsMap:{...s.messageBoxElementsMap,[e]:t}}))};var p=s(752673),_=s(637319),x=s(83990),M=s(689368),S=s(214071),C=s(266655),w=s(698392),b=s(178230);let y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=(0,a.useRef)({}),[r,n]=function(e,t){let[s,r]=(0,a.useState)(e),n=(0,a.useRef)(null);return(0,a.useEffect)(()=>()=>{n.current&&clearTimeout(n.current)},[]),[s,e=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{r(e)},200)}]}(!t,0),o=(0,a.useCallback)((e,t)=>{s.current[e]=+!t},[e]);return(0,a.useEffect)(()=>{if(t){n(!1),b.logger.persist.info({eventName:"message_list_skeleton_hide_by_disabled"});return}let r=setInterval(()=>{1===((0,S.default)(s.current)?0:(0,C.default)(s.current).reduce((e,t)=>e*t,1))&&(b.logger.persist.info({eventName:"message_list_skeleton_hide_by_plugins_loaded"}),clearTimeout(a),clearInterval(r),n(!1))},100),a=setTimeout(()=>{b.logger.persist.info({eventName:"message_list_skeleton_hide_by_plugins_load_timeout"}),clearInterval(r),n(!1)},4e3);return()=>{s.current={};let{currentChatViewConfig:t}=(0,w.getChatSlice)("chatViewCoreStore");(null==t?void 0:t.chatKey)!==e&&n(!0),clearInterval(r),clearTimeout(a)}},[e,t]),{skeletonShow:r,pluginLoadCounter:o}};var j=s(971857),L=s(389174),I=s(721118),B=s(230932),P=s(212183),k=s(604889),E=s(155853),R=s(337524),T=s(790521),F=s(516655),N=s(948673);let A=e=>{let{matcher:t,loading:s}=(0,F.useChatMessageListBottomBtnPluginMatcher)();if(s||!t)return null;let r=t.map(t=>t(e)).filter(e=>void 0!==e),a=r.find(e=>void 0!==e),n=(0,N.getDuplicatePluginIdentifier)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_message_list_bottom_btn_plugin",error:e})}return a};var V=s(345660);let O=e=>{let{pluginIdentifier:t,...s}=e,{plugin:r,loading:a}=(0,M.useChatMessageListBottomBtnPlugin)(t);if(a||!r)return null;let{Content:n}=r;return(0,V.jsx)(n,{...s})},W=e=>{let{conversationId:t,unionMessageList:s}=e,{isSelectMode:r}=(0,p.useThreadShareStore)(e=>({isSelectMode:e.isSelectMode}),n.shallow),{inViewMessageList:a}=m(e=>({inViewMessageList:e.inViewMessageList}),n.shallow),o=A({isSelectMode:r,inViewMessageList:a,conversationId:t,unionMessageList:s});return o?(0,V.jsx)(O,{pluginIdentifier:o,conversationId:t,inViewMessageList:a,unionMessageList:s}):null};var D=s(220),G=s(674157),H=s(992528),$=s(550837),q=s(828617),U=s(420177),z=s(339902),K=s(629006);let X=(e,t)=>{var s,r,a;let n=null===(r=window)||void 0===r?void 0:null===(s=r.navigator)||void 0===s?void 0:s.mimeTypes;for(let s in n)if((null==n?void 0:null===(a=n[s])||void 0===a?void 0:a[e])===t)return n[s];return null},J=()=>!!(X("type","application/cenroll.cenroll.version.1")||X("type","application/hwepass2001.installepass2001")),Q=()=>"undefined"!=typeof navigator&&"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36"===navigator.userAgent&&J(),Y=e=>{if("divider"!==e.type)return"block"===e.type?(0,U.default)(e.data):e.data},Z=e=>{if("divider"===e.type)return!1;let t=Y(e);if(!t)return!1;let{conversationId:s}=e,r=(0,_.getMessageSelector)(x.useMessageStore.getState(),s,t);return!(!r||(0,K.isProfessionalWritingOutlineMessage)(r))&&!(0,G.isMessageFinished)(r)&&!(0,K.isMessageFailed)(r)},ee=(e,t)=>{if("divider"===t.type)return 0;let{conversationId:s}=t,r=e.indexOf(t),a=(0,z.default)(e.slice(0,r),e=>{let t=Y(e);if(!t)return!1;let r=(0,_.getMessageSelector)(x.useMessageStore.getState(),s,t);return(0,K.isSendMessage)(r)});return r-a},et=e=>{if("divider"===e.type)return!0;let{conversationId:t}=e,s=Y(e);if(!s)return!0;let r=(0,_.getMessageSelector)(x.useMessageStore.getState(),t,s);return!((0,K.isProfessionalWritingOutlineMessage)(r)||(0,K.isAIPPTOutlineMessage)(r))},es=(0,a.forwardRef)(function(e,t){let{dataList:s,children:r,top:n,bottom:o,keepedBottom:i,onInViewItemsChange:l,className:u,style:d,onReachTop:c,onReachBottom:g,conversationId:m,...v}=e,{onScroll:f}=(0,H.useChat)({optionalProvider:!0}),{chatViewRef:h,scrollRef:p}=(0,k.useChatRef)(),{onScrollForFPS:M}=(0,D.useScrollFPSReport)({eventName:"message-list-fps-report"}),S=(0,a.useCallback)(()=>{var e,t;null==f||f();let r=(0,G.isMessageFinished)((0,_.getLastStreamingMessageSelector)(x.useMessageStore.getState(),m||""));M({version:"0",message_count:s.length,last_message_is_finish:r?"1":"0",open_canvas:(null===(t=(0,w.getChatStore)("chatViewCanvasStore"))||void 0===t?void 0:null===(e=t.getState())||void 0===e?void 0:e.isExpand)?"1":"0"})},[f,M]),C=(0,a.useRef)(!0);(0,a.useImperativeHandle)(t,()=>({setEnableInterAnchor:b}),[]);let b=(0,q.useLatestFunction)(e=>{C.current=e}),y=(0,q.useLatestFunction)(()=>C.current);return(0,V.jsx)($.ClassicScrollView,{...v,className:u,style:d,reverse:!Q(),dataList:s,getId:e=>{var t;return null!==(t=null==e?void 0:e.id)&&void 0!==t?t:""},top:n,bottom:o,keepedBottom:i,memorizeItem:!0,onReachTop:()=>{var e,t;null===(t=h.current)||void 0===t||null===(e=t.onLoadMore)||void 0===e||e.call(t),null==c||c()},onReachBottom:g,ref:p,onScroll:S,onInViewItemsChange:l,enableInterAnchor:y,anchorWhenOverflow:Z,overflowAnchorOffset:e=>ee(s,e),anchorWhenScrolling:et,children:r})});var er=s(828438);let ea=e=>{let{bottomThreshold:t=0,onShow:s,onHide:r}=e,{inView:n,ref:o}=(0,er.useInView)({initialInView:!0});return(0,a.useEffect)(()=>{n?null==s||s():null==r||r()},[n]),(0,V.jsx)("div",{className:"container-gTazL1",ref:o,style:{height:t}})};var en=s(680887);let eo=e=>(0,V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:46,height:46,fill:"none",viewBox:"0 0 46 46",...e,children:[(0,V.jsx)("path",{fill:"currentColor",d:"M1 23C1 10.85 10.85 1 23 1s22 9.85 22 22-9.85 22-22 22S1 35.15 1 23"}),(0,V.jsx)("circle",{cx:23,cy:23,r:22.3,stroke:"#0057FF",strokeOpacity:.1,strokeWidth:1.5}),(0,V.jsx)("path",{stroke:"url(#partial_border_svg__a)",strokeWidth:1.5,d:"M45 23c0-12.15-9.85-22-22-22"}),(0,V.jsx)("defs",{children:(0,V.jsxs)("linearGradient",{id:"partial_border_svg__a",x1:23,x2:49.163,y1:1,y2:8.171,gradientUnits:"userSpaceOnUse",children:[(0,V.jsx)("stop",{stopColor:"#0057FF",stopOpacity:0}),(0,V.jsx)("stop",{offset:.502,stopColor:"#0057FF",stopOpacity:.6}),(0,V.jsx)("stop",{offset:1,stopColor:"#0057FF",stopOpacity:0})]})})]}),ei=e=>{let{conversationId:t}=e;return(0,x.useMessageStore)(e=>{if(!t)return!1;let s=(0,_.getLastAvailableReplyMessageSelector)(e,t);return!!s&&(0,_.getLastStreamingMessageSelector)(e,t)===s})};var el={container:"container-HRpMdH",loading:"loading-B101Vu",hidden:"hidden-MyOhBw","loading-border":"loading-border-ggv3VB",icon:"icon-W5bbS1"};let eu=(0,a.forwardRef)(function(e,t){let{className:s,style:r,initialVisible:n=!1,conversationId:o,onClick:i}=e,[u,d]=(0,a.useState)(n),c=ei({conversationId:o});return(0,a.useImperativeHandle)(t,()=>({setVisible:d}),[]),(0,V.jsxs)("div",{id:"to-bottom-button","data-testid":"to-bottom-button","data-visible":u,className:l()(el.container,s,{[el.hidden]:!u,[el.loading]:c}),style:r,onClick:i,children:[c&&(0,V.jsx)(eo,{className:el["loading-border"]}),(0,V.jsx)(en.default,{className:el.icon})]})});var ed=s(93178);let ec=()=>(0,V.jsx)("div",{className:"float top w-full px-16",children:(0,V.jsx)(R.SamanthaLayout.MaxWidthLayout,{children:(0,V.jsx)(ed.ChatContentSkeletonUI,{})})});var eg=s(979168);let em=e=>{let{className:t,MessageGroupBottomFoundation:s,MessageGroupCenterFoundation:r}=e;return(0,V.jsxs)("div",{className:l()("flex flex-col w-full",t),children:[r&&(0,V.jsx)(r,{}),s&&(0,V.jsx)(s,{})]})},ev=(0,a.createContext)({messages:null,conversationId:"",pluginLoadCounter:()=>null}),ef=()=>{let{messages:e,...t}=(0,a.useContext)(ev);return e?{...t,messages:e}:{...t,messages:[{is_delta:!1}]}};var eh=s(611833);let ep=(e,t)=>{let{matcher:s=[]}=(0,F.useChatReceiveMessageGroupBottomPluginMatcher)(),r=(null!=s?s:[]).map(s=>s.matchPlugin(e,t)?s.pluginIdentifier:void 0).filter(e=>void 0!==e),a=r[0],n=(0,N.getDuplicatePluginIdentifier)(r),{plugin:o,loading:i}=(0,M.useChatReceiveMessageGroupBottomPlugin)(a);return{plugin:o,pluginIdentifier:a,loading:i,duplicateIdentifierList:n}},e_=(e,t)=>{let{matcher:s=[]}=(0,F.useChatReceiveMessageGroupPluginMatcher)(),r=(null!=s?s:[]).map(s=>s.matchPlugin(e,t)?s.pluginIdentifier:void 0).filter(e=>void 0!==e),n=r[0],o=(0,a.useMemo)(()=>(0,eh.default)(),[n]),i=(0,N.getDuplicatePluginIdentifier)(r),{plugin:l,loading:u}=(0,M.useChatReceiveMessageGroupPlugin)(n);return{pluginLoadId:o,plugin:l,pluginIdentifier:n,loading:u,duplicateIdentifierList:i}};var ex=s(588710);let eM=(0,a.createContext)({message:null}),eS=()=>{let{message:e,...t}=(0,a.useContext)(eM);return e?{...t,message:e}:{...t,message:{is_delta:!1}}};var eC=s(191174),ew=s(556946),eb=s(403649);let ey=()=>null,ej=e=>{var t;let{message:s,inView:r}=e,a=(null===(t=s.content_blocks_tree)||void 0===t?void 0:t.children)||[],{contentBlockRenderConfigs:n}=(0,ew.useChatReceiveMessageCenterContentBlockPluginWithContentBlocks)(a);return(null==n?void 0:n.length)?(0,V.jsx)("div",{className:l()("flex w-full flex-col","gap-20"),children:n.map(e=>{let{pluginIdentifier:t,PluginContentRender:a,block:n,duplicateIdentifierList:o}=e;return(0,V.jsx)(a,{pluginIdentifier:t,duplicateIdentifierList:o,contentBlock:n,message:s,inView:r})})}):null},eL=e=>{var t,s;let{message:r,inView:a,mouseOver:n}=e,{plugin:o,pluginIdentifier:i,loading:l,duplicateIdentifierList:u}=(0,ew.useChatReceiveMessageBoxPluginWithMessage)(r);if(u.length>1){let e=Error(`${u.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_box",error:e})}if(l)return(0,V.jsx)(eC.Loading,{});if(!o)return null;let{Content:d=ey}=o;return(0,V.jsxs)("div",{"data-plugin-identifier":String(i),className:"w-full",children:[(0,V.jsx)(d,{message:r,inView:a,mouseOver:n}),(0,G.isMessageFinished)(r)&&(0,V.jsx)(eb.RiskTips,{jsonString:null===(s=r.verbose)||void 0===s?void 0:null===(t=s.extra)||void 0===t?void 0:t.risk_tips})]})};var eI=(0,s(430261).IconFactory)((0,V.jsx)(e=>(0,V.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:18,height:18,fill:"none",viewBox:"0 0 18 18",...e,children:[(0,V.jsx)("rect",{width:16.5,height:16.5,x:.75,y:.75,stroke:"currentColor",strokeWidth:1.5,rx:8.25}),(0,V.jsx)("path",{fill:"currentColor",d:"M8.214 9.588q.026.753.779.753.735 0 .761-.762l.132-3.87a.77.77 0 0 0-.245-.63.93.93 0 0 0-.657-.246.9.9 0 0 0-.648.245.76.76 0 0 0-.236.622zM8.284 12.845q.297.263.709.263.42 0 .709-.254a.86.86 0 0 0 .297-.674q0-.403-.297-.666a1.01 1.01 0 0 0-.71-.262q-.42 0-.708.262a.86.86 0 0 0-.289.666q0 .402.289.665"})]}),{})),eB=s(666196),eP=s(959610);let ek=e=>{let{message:t}=e,{sendMessage:s}=(0,eB.useChatService)("chatMessageService"),r=(0,K.isMessageFailed)(t),a=(0,K.isImageSafetyError)(t)||(0,K.isFileSafetyError)(t),n=(0,eP.useRetryReceiveMessage)({sendMessage:s,message:t});return r&&!a?(0,V.jsx)(eI,{"data-testid":"message_box_failed_icon",className:"m-8 text-s-color-alert flex-shrink-0",onClick:n}):null},eE=e=>{let{inView:t,mouseOver:s}=e,{message:r}=eS(),a=r.content_blocks_tree;return(0,V.jsxs)("div",{"data-testid":"receive_message","data-message-id":r.message_id,className:"flex flex-row w-full",children:[a?(0,V.jsx)(ej,{inView:t,mouseOver:s,message:r}):(0,V.jsx)(eL,{inView:t,mouseOver:s,message:r}),(0,V.jsx)(ek,{message:r})]})};var eR=s(567134),eT=s(907929),eF=s(349456),eN=s(198660),eA=s(356064),eV=s(816651),eO=s(915299),eW=s(525029),eD=s(275259),eG=s(748202);let eH=e=>{let{children:t,unmountPopover:s}=e,r=(0,eO.useTranslateFn)(),a=(0,V.jsx)("div",{children:(0,V.jsx)(eG.ActionButton,{tooltipContent:r("message_action_button_more_tooltip"),prefix:(0,V.jsx)(eV.default,{}),"data-testid":"message_action_more"})});return s?a:(0,V.jsx)(eW.SamanthaPopover,{position:"bottomLeft",clickToHide:!0,trigger:"click",className:"rounded-12",content:(0,V.jsx)(eD.SamanthaDropdown.Menu,{className:"!p-8 !min-w-150",children:t}),children:a})},e$=((r={})[r.insert=0]="insert",r[r["re-translate"]=1]="re-translate",r[r["deep-search"]=2]="deep-search",r[r["canvas-read"]=3]="canvas-read",r[r["outline-gen"]=4]="outline-gen",r[r["outline-gen-doc"]=5]="outline-gen-doc",r[r.tts=6]="tts",r[r.edit=7]="edit",r[r.copy=8]="copy",r[r.regenerate=9]="regenerate",r[r["creation-download"]=10]="creation-download",r[r["create-doc-by-message"]=11]="create-doc-by-message",r[r.ref=12]="ref",r[r.aispace=13]="aispace",r[r["thread-share"]=14]="thread-share",r[r["thread-collection"]=15]="thread-collection",r[r.report=16]="report",r[r.delete=17]="delete",r[r.debug=18]="debug",r[r.feedback=19]="feedback",r),eq=e=>{var t;return null!==(t=e$[e])&&void 0!==t?t:Number.MAX_SAFE_INTEGER},eU=e=>null==e?void 0:e.sort((e,t)=>eq(e.actionType)-eq(t.actionType));var ez={"message-action-bar":"message-action-bar-ghR0JC"};let eK=()=>null,eX="expanded_more_item",eJ=(e,t,s,r,a)=>{if(e===eX)return eQ(s,t,r,a);let{ButtonContentGroupLoader:n=eK,onEnterEditMode:o,onEnterActionMode:i}=e;return(0,V.jsx)(n,{pluginIdentifier:e.pluginIdentifier,message:t,onEnterEditMode:o,onEnterActionMode:i,reportParams:a,actionVisible:r},String(e.pluginIdentifier))},eQ=(e,t,s,r)=>{let a=e.filter(e=>e!==eX).map(e=>{let{DropdownItemContentGroupLoader:a=eK,onEnterEditMode:n,onEnterActionMode:o}=e;return(0,V.jsx)(a,{pluginIdentifier:e.pluginIdentifier,message:t,onEnterEditMode:n,onEnterActionMode:o,reportParams:r,actionVisible:s},String(e.pluginIdentifier))});return(0,V.jsx)(eH,{unmountPopover:!s,children:a},eX)},eY=e=>{let t=(0,K.isSearchErrorMessage)(e),s=(0,K.isSearchMessage)(e)||(0,K.isComplexSearchMessage)(e),r=(0,K.isSimpleSearchOnlyImageMessage)(e),a=(0,K.isSimpleSearchOnlyVideoMessage)(e),n=(0,K.isSimpleSearchTextMessage)(e),o=(0,K.isMessageActionInvisibleInMessage)(e),i=(0,eN.getIsLoggedIn)(),l=(0,_.isLastAvailableMessage)(x.useMessageStore.getState(),e.conversation_id||"",e.message_id||"");return!i&&l||t||s&&!r&&!a||n||o},eZ=e=>!(0,eN.getIsLoggedIn)(),e0=e=>{let t=(0,K.isSimpleSearchOnlyImageMessage)(e),s=(0,K.isSimpleSearchOnlyVideoMessage)(e),r=(0,K.isWiderTextMessage)(e),a=(0,K.isSimpleSearchMessage)(e),n=(0,K.isRemoteMessageStable)(e),o=(0,K.isPluginAuthMessage)(e),i=(0,K.isBrokenMessage)(e),l=(0,K.isMusicGenReceiveMessage)(e),u=(0,eN.getIsLoggedIn)(),d=(0,eF.isAtLastSection)(e),c=(0,_.isLastAvailableMessage)(x.useMessageStore.getState(),e.conversation_id||"",e.message_id||""),g=(0,K.isResearchProcessBlockMessage)(e),m=!(0,K.isDisableActionViewMessage)(e)&&u&&!(0,K.isTemplateMessage)(e)&&d&&c&&n&&!o&&!i;return(r||t||s||a||l||g)&&m},e1=e=>{let{message:t,pluginConfigs:s,mouseOver:r,inView:a,className:n,observeParents:o,reportParams:i}=e,u=eU(s),d=(0,eR.default)((0,eT.default)(u,e=>"main"===e.area),(e,t)=>!!e.actionType&&!!t.actionType&&e.actionType===t.actionType),c=(0,eR.default)((0,eT.default)(u,e=>"fold"===e.area),(e,t)=>!!e.actionType&&!!t.actionType&&e.actionType===t.actionType),g=(0,eR.default)((0,eT.default)(u,e=>"expand"===e.area),(e,t)=>!!e.actionType&&!!t.actionType&&e.actionType===t.actionType),m=(0,eR.default)((0,eT.default)(u,e=>"third"===e.area),(e,t)=>!!e.actionType&&!!t.actionType&&e.actionType===t.actionType),v=eY(t),f=e0(t),h=eZ(t);if(v)return null;if(h)return(0,V.jsx)("div",{className:l()("flex flex-col justify-end h-40 w-full select-none"),"data-testid":"message_action_bar"});let p=[...d,...c.length>0?[eX]:[]],_=f||r;return(0,V.jsx)("div",{className:l()("flex flex-col justify-end h-40 w-full select-none",_?"opacity-100":"opacity-0 pointer-events-none"),"data-testid":"message_action_bar",children:f||a?(0,V.jsxs)("div",{className:l()(ez["message-action-bar"],"flex flex-row w-full group",n),children:[(null==d?void 0:d.length)?(0,V.jsx)(eA.OverflowList,{className:l()("message-action-button-main","flex w-fit min-w-0 items-center gap-10 self-center"),items:p,minVisibleItems:0,visibleItemRenderer:e=>eJ(e,t,c,_,i),collapseFrom:"end",overflowRenderer:e=>eQ([...e,...c],t,_,i),observeParents:o}):null,(0,V.jsx)("div",{className:`
              mr-12 hidden h-12 w-0 items-center self-center rounded-[0.5px] border-[0.5px]
              border-solid border-[var(--s-color-border-secondary)]
              first:hidden
              last:hidden
              [&:has(+.message-action-button-expand)]:block
            `}),(null==g?void 0:g.length)?(0,V.jsx)("div",{className:l()("message-action-button-expand","flex w-fit min-w-0 items-center gap-10 self-center"),children:g.map(e=>eJ(e,t,[],_,i))}):null,(0,V.jsx)("div",{className:`
              mx-12 hidden h-12 w-0 items-center self-center rounded-[0.5px] border-[0.5px]
              border-solid border-[var(--s-color-border-secondary)]
              first:hidden
              last:hidden
              [&:has(+.message-action-button-third)]:block
            `}),(null==m?void 0:m.length)?(0,V.jsx)("div",{className:l()("message-action-button-third","flex w-fit min-w-0 items-center gap-12 self-center"),children:m.map(e=>eJ(e,t,[],_))}):null]}):null})},e2=e=>{let{message:t,pluginConfigs:s,inView:r,mouseOver:a,observeParents:n,reportParams:o}=e;return(0,V.jsx)(e1,{className:"justify-end relative -right-10",message:t,pluginConfigs:s,inView:r,mouseOver:a,observeParents:n,reportParams:o})},e3=e=>{let{message:t,pluginConfigs:s,inView:r,mouseOver:a,observeParents:n,reportParams:o}=e;return(0,V.jsx)(e1,{message:t,pluginConfigs:s,inView:r,mouseOver:a,observeParents:n,reportParams:o})},e6=e=>{let{pluginIdentifier:t,...s}=e,{plugin:r,loading:a}=(0,M.useChatReceiveMessageActionButtonPlugin)(t);if(a)return null;let n=null==r?void 0:r.ButtonContentGroups;return(0,V.jsx)(V.Fragment,{children:n?n.map((e,t)=>(0,V.jsx)(e,{...s},t)):null})},e8=e=>{let{pluginIdentifier:t,...s}=e,{plugin:r,loading:a}=(0,M.useChatReceiveMessageActionButtonPlugin)(t);if(a)return null;let n=null==r?void 0:r.DropdownItemContentGroups;return(0,V.jsx)(V.Fragment,{children:n?n.map((e,r)=>(0,V.jsx)(e,{...s},String(t)+r)):null})},e7=(e,t)=>{let{matcher:s=[]}=(0,F.useChatReceiveMessageActionButtonPluginMatcher)();return{messageActionPluginConfig:(null!=s?s:[]).map(t=>t.matchPlugin(e)?t:void 0).filter(e=>(null==e?void 0:e.pluginIdentifier)!==void 0).map(e=>({pluginIdentifier:e.pluginIdentifier,area:e.area,actionType:e.actionType,onEnterActionMode:t,ButtonContentGroupLoader:e6,DropdownItemContentGroupLoader:e8}))}},e9=(e,t)=>{let{matcher:s=[]}=(0,F.useChatReceiveMessageActionBottomPluginMatcher)(),r=(null!=s?s:[]).map(s=>s.matchPlugin(e,t)?s.pluginIdentifier:void 0).filter(e=>void 0!==e),a=r[0],n=(0,N.getDuplicatePluginIdentifier)(r),{plugin:o,loading:i}=(0,M.useChatReceiveMessageActionBottomPlugin)(a);return{plugin:o,pluginIdentifier:a,loading:i,duplicateIdentifierList:n}},e5=e=>{let{matcher:t=[]}=(0,F.useChatReceiveMessageActionRightPluginMatcher)(),s=(null!=t?t:[]).map(t=>t.matchPlugin(e)?t.pluginIdentifier:void 0).filter(e=>void 0!==e),r=s[0],a=(0,N.getDuplicatePluginIdentifier)(s),{plugin:n,loading:o}=(0,M.useChatReceiveMessageActionRightPlugin)(r);return{plugin:n,pluginIdentifier:r,loading:o,duplicateIdentifierList:a}},e4=()=>null,te=e=>{let{message:t}=e,{plugin:s}=e5(t),{Content:r=e4}=s||{};return(0,V.jsx)(r,{message:t})},tt=()=>null,ts=e=>{let{message:t,actionMode:s,updateActionMode:r}=e,{plugin:a}=e9(t,s),{Content:n=tt}=a||{};return(0,V.jsx)(n,{message:t,onExitActionMode:()=>r("")})},tr=e=>{let{message:t}=e,[s,r]=(0,a.useState)(""),{messageActionPluginConfig:n}=e7(t,r),o=n.filter(e=>["copy","debug","report","tts"].includes(e.actionType));return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{className:"flex flex-row flex-grow max-w-full min-w-0",children:[(0,V.jsx)(e3,{inView:!0,mouseOver:!0,message:t,pluginConfigs:o}),(0,V.jsx)(te,{message:t})]}),(0,V.jsx)(ts,{message:t,actionMode:s,updateActionMode:()=>r("")})]})},ta=e=>{let{mouseOver:t,inView:s}=e,{message:r}=eS(),{plugin:a,duplicateIdentifierList:n}=(0,ew.useChatReceiveMessageBoxBottomPluginWithMessage)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_bottom",error:e})}if(!a)return null;let{Content:o}=a;return(0,V.jsx)(o,{message:r,mouseOver:t,inView:s,actionBarComponentNode:(0,V.jsx)(tr,{message:r}),suggestList:null})},tn=e=>{let{message:t}=e,s=(0,w.useChatSlice)("chatMessageBoxLayoutStore",e=>e.receiveMessageBoxConfig.containerDataAttr,n.shallow),r=(0,_.isLastAvailableMessage)(x.useMessageStore.getState(),t.conversation_id||"",t.message_id||"");r&&u.useTracingStore.getState().markMessageListPerformance("lastMessageBoxRenderStartTimestamp");let o=r?document.querySelector(`[data-message-id="${t.message_id}"]`):null;return(0,a.useEffect)(()=>{(null==o?void 0:o.clientHeight)&&u.useTracingStore.getState().markMessageListPerformance("lastMessageBoxRenderFinishTimestamp")},[o]),(0,V.jsx)(eM.Provider,{value:{message:t},children:(0,V.jsx)(ex.MessageBoxLayout,{dataAttributes:{"data-attr":s},className:l()("w-full max-w-full s-font-base text-s-color-text-secondary p-0 rounded-s-radius-s bg-transparent"),MessageBoxTopFoundation:null,MessageBoxLeftFoundation:null,MessageBoxBottomFoundation:ta,MessageBoxRightFoundation:null,MessageBoxCenterFoundation:eE})})},to=()=>{let{messages:e,conversationId:t,pluginLoadCounter:s}=ef(),{plugin:r,duplicateIdentifierList:n,loading:o,pluginLoadId:i}=e_("",e);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_group_center",error:e})}if((0,a.useEffect)(()=>{s(i,o)},[o]),(0,a.useEffect)(()=>(s(i,o),()=>{null==s||s(i,!1)}),[i]),!r)return null;let{Content:l}=r;return(0,V.jsx)(l,{ReceiveMessageBox:tn,messages:e,conversationId:t})},ti=()=>{let{messages:e,conversationId:t}=ef(),{plugin:s,duplicateIdentifierList:r}=ep("",e);if(r.length>1){let e=Error(`${r.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_group_bottom",error:e})}if(!s)return null;let{Content:a}=s;return(0,V.jsx)(a,{messages:e,conversationId:t})},tl=e=>{let{messages:t,conversationId:s,pluginLoadCounter:r}=e,{bottom:a}=(0,w.useChatSlice)("chatMessageGroupLayoutStore",e=>e.getMessageGroupArea(),n.shallow);return(0,V.jsx)(ev.Provider,{value:{messages:t,conversationId:s,pluginLoadCounter:r},children:(0,V.jsx)(em,{MessageGroupBottomFoundation:a.visible?ti:null,MessageGroupCenterFoundation:to})})},tu=e=>{let{conversationId:t,messageLinks:s,pluginLoadCounter:r}=e,a=(0,x.useMessageStore)(e=>s.map(s=>(0,_.getMessageSelector)(e,t,s)).filter(e=>!!e),n.shallow);return a.length?(0,V.jsx)(tl,{messages:a,conversationId:t,pluginLoadCounter:r}):null};var td=s(459046),tc=s(426156),tg=s(825264);let tm=(0,a.createContext)({onEnterEditMode:()=>null,editMode:!1,message:null,onExitEditMode:()=>null,pluginLoadCounter:()=>null}),tv=()=>{let{message:e,...t}=(0,a.useContext)(tm);return e?{...t,message:e}:{...t,message:{is_delta:!1}}},tf=e=>{let{mouseOver:t,inView:s}=e,{message:r,editMode:a}=tv(),{plugin:n,duplicateIdentifierList:o}=(0,tg.useChatSendMessageBoxTopPluginWithMessage)(r);if(o.length>1){let e=Error(`${o.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_top",error:e})}if(!n||a)return null;let{Content:i}=n;return(0,V.jsx)(i,{message:r,mouseOver:t,inView:s})},th=e=>{let{mouseOver:t,inView:s}=e,{message:r,editMode:a}=tv(),{plugin:n,duplicateIdentifierList:o}=(0,tg.useChatSendMessageBoxRightPluginWithMessage)(r);if(o.length>1){let e=Error(`${o.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_right",error:e})}if(!n||a)return null;let{Content:i}=n;return(0,V.jsx)(i,{message:r,mouseOver:t,inView:s})},tp=e=>{let{mouseOver:t,inView:s}=e,{message:r,editMode:a}=tv(),{plugin:n,duplicateIdentifierList:o}=(0,tg.useChatSendMessageBoxLeftPluginWithMessage)(r);if(o.length>1){let e=Error(`${o.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_left",error:e})}if(!n||a)return null;let{Content:i}=n;return(0,V.jsx)(i,{message:r,mouseOver:t,inView:s})};var t_=s(379424),tx=s(839783),tM=s(910321);let tS=e=>{let{message:t}=e,s=(0,K.isMessageFailed)(t),{sendMessage:r}=(0,eB.useChatService)("chatMessageService"),a=(0,eP.useRetrySendMessage)({sendMessage:r,message:t});return s?(0,V.jsx)(eI,{"data-testid":"message_box_failed_icon",className:"m-8 text-s-color-alert flex-shrink-0",onClick:a}):null},tC=()=>null,tw=e=>{let{plugin:t,message:s}=e;(0,a.useEffect)(()=>{var e,r;let{sendMessagePerformance:a}=t_.useMessagePerformanceStore.getState(),{local_message_id:n}=null!=s?s:{},{start:o,duration:i}=null!==(r=a[null!==(e=null==s?void 0:s.local_message_id)&&void 0!==e?e:""])&&void 0!==r?r:{};if(!t||!n||!o||void 0!==i)return;let l=(0,tM.safelyGetNow)();(0,tx.updateSendMessagePerformance)(n,{end:l,duration:l-o});let u=t_.useMessagePerformanceStore.getState().sendMessagePerformance[n];u&&b.logger.persist.info({eventName:"send_message_performance",meta:{...u}})},[t,s])},tb=e=>{let{inView:t,mouseOver:s}=e,{message:r,editMode:n,onExitEditMode:o,pluginLoadCounter:i}=tv(),{pluginIdentifier:l,plugin:u,loading:d,duplicateIdentifierList:c,pluginLoadId:g}=(0,tg.useChatSendMessageBoxPluginWithMessage)(r);if(c.length>1){let e=Error(`${c.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box",error:e})}if(tw({plugin:u,message:r}),(0,a.useEffect)(()=>{i(g,d)},[g,d]),(0,a.useEffect)(()=>(i(g,d),()=>{i(g,!1)}),[g]),d)return(0,V.jsx)(eC.Loading,{inlineEnd:!0});if(!u)return null;let{EditableContent:m=tC,Content:v=tC}=u;return(0,V.jsx)("div",{ref:e=>{e&&r.message_id&&h(r.message_id,e)},"data-testid":"message_content","data-plugin-identifier":String(l),"data-message-id":r.message_id,className:"flex flex-row w-full justify-end",children:n?(0,V.jsx)(m,{message:r,onExit:o,inView:t,mouseOver:s}):(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(tS,{message:r}),(0,V.jsx)(v,{message:r,inView:t,mouseOver:s})]})})},ty=e=>{let{pluginIdentifier:t,...s}=e,{plugin:r,loading:a}=(0,M.useChatSendMessageActionButtonPlugin)(t);if(a)return null;let n=null==r?void 0:r.ButtonContentGroups;return(0,V.jsx)(V.Fragment,{children:n?n.map((e,r)=>(0,V.jsx)(e,{...s},String(t)+r)):null})},tj=e=>{let{pluginIdentifier:t,...s}=e,{plugin:r,loading:a}=(0,M.useChatSendMessageActionButtonPlugin)(t);if(a)return null;let n=null==r?void 0:r.DropdownItemContentGroups;return(0,V.jsx)(V.Fragment,{children:n?n.map((e,r)=>(0,V.jsx)(e,{...s},String(t)+r)):null})},tL=(e,t)=>{let{matcher:s=[]}=(0,F.useChatSendMessageActionButtonPluginMatcher)();return{messageActionPluginConfig:(null!=s?s:[]).map(t=>t.matchPlugin(e)?t:void 0).filter(e=>(null==e?void 0:e.pluginIdentifier)!==void 0).map(e=>({pluginIdentifier:e.pluginIdentifier,area:e.area,actionType:e.actionType,onEnterEditMode:t,ButtonContentGroupLoader:ty,DropdownItemContentGroupLoader:tj}))}},tI=e=>{let{message:t,inView:s,mouseOver:r,onEnterEditMode:a}=e,{messageActionPluginConfig:n}=tL(t,a);return(0,V.jsx)(e2,{message:t,inView:s,mouseOver:r,pluginConfigs:n})},tB=e=>{let{mouseOver:t,inView:s}=e,{message:r,editMode:a,onEnterEditMode:n}=tv(),{plugin:o,duplicateIdentifierList:i}=(0,tg.useChatSendMessageBoxBottomPluginWithMessage)(r);if(i.length>1){let e=Error(`${i.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_bottom",error:e})}if(!o||a)return null;let{Content:l}=o;return(0,V.jsx)(l,{message:r,mouseOver:t,inView:s,actionBarComponentNode:(0,V.jsx)(tI,{message:r,mouseOver:t,inView:s,onEnterEditMode:n})})},tP=e=>{let{message:t,pluginLoadCounter:s}=e,[r,o]=(0,a.useState)(!1),i=(0,a.useCallback)(()=>{o(!0)},[o]),u=(0,a.useCallback)(()=>{o(!1)},[o]),d=(0,_.isLastSendMessage)(x.useMessageStore.getState(),t.conversation_id||"",t.message_id||"")&&r,c=(0,w.useChatSlice)("chatMessageBoxLayoutStore",e=>e.sendMessageBoxConfig.containerDataAttr,n.shallow),g=(0,w.useChatSlice)("chatMessageBoxLayoutStore",e=>e.getMessageBoxArea(),n.shallow),m=(0,a.useMemo)(()=>({message:t,editMode:d,onEnterEditMode:i,onExitEditMode:u,pluginLoadCounter:s}),[t,d,i,u,s]);return(0,V.jsx)(tm.Provider,{value:m,children:(0,V.jsx)(ex.MessageBoxLayout,{dataAttributes:{"data-attr":c,"data-testid":"send_message"},className:l()("w-full max-w-full s-font-base text-s-color-text-secondary p-0 rounded-s-radius-s bg-transparent","data-[attr=select-mode]:-mt-10 data-[attr=select-mode]:py-10 data-[attr=select-mode]:px-16 data-[attr=select-mode]:sm:p-10 data-[attr=select-mode]:hover:bg-s-color-bg-base data-[attr=select-mode]:hover:rounded-s-radius-xs","data-[attr=select-mode]:has-[:checked]:bg-s-color-bg-trans data-[attr=select-mode]:has-[:checked]:rounded-s-radius-xs","data-[attr=select-mode]:pointer-events-none"),inlineEnd:!0,MessageBoxTopFoundation:g.top.visible?tf:null,MessageBoxLeftFoundation:g.left.visible?tp:null,MessageBoxBottomFoundation:g.bottom.visible?tB:null,MessageBoxRightFoundation:g.right.visible?th:null,MessageBoxCenterFoundation:tb})})},tk=(0,a.createContext)({message:null,pluginLoadCounter:()=>null,isLastMessage:void 0}),tE=()=>{let{message:e,...t}=(0,a.useContext)(tk);return e?{...t,message:e}:{...t,message:{is_delta:!1}}},tR=e=>{let{mouseOver:t,inView:s}=e,{message:r}=tE(),{plugin:a,duplicateIdentifierList:n}=(0,ew.useChatReceiveMessageBoxTopPluginWithMessage)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_box_top",error:e})}if(!a)return null;let{Content:o}=a;return(0,V.jsx)(o,{message:r,mouseOver:t,inView:s})},tT=e=>{let{mouseOver:t,inView:s}=e,{message:r}=tE(),{plugin:a,duplicateIdentifierList:n}=(0,ew.useChatReceiveMessageBoxRightPluginWithMessage)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_box_right",error:e})}if(!a)return null;let{Content:o}=a;return(0,V.jsx)(o,{message:r,mouseOver:t,inView:s})},tF=e=>{let{mouseOver:t,inView:s}=e,{message:r}=tE(),{plugin:a,duplicateIdentifierList:n}=(0,ew.useChatReceiveMessageBoxLeftPluginWithMessage)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_send_message_box_left",error:e})}if(!a)return null;let{Content:o}=a;return(0,V.jsx)(o,{message:r,mouseOver:t,inView:s})},tN=()=>null,tA=e=>{let{message:t,blockCount:s}=e;(0,a.useEffect)(()=>{var e;let{receiveMessagePerformance:r}=t_.useMessagePerformanceStore.getState(),{message_id:a}=null!=t?t:{},{start:n,duration:o}=null!==(e=r[null!=a?a:""])&&void 0!==e?e:{};if(0===s||!a||!n||void 0!==o)return;let i=(0,tM.safelyGetNow)();(0,tx.updateReceiveMessagePerformance)(a,{end:i,duration:i-n,type:"content_block",blockCount:s});let l=t_.useMessagePerformanceStore.getState().receiveMessagePerformance[a];l&&b.logger.persist.info({eventName:"receive_message_performance",meta:{...l}})},[t,s])},tV=e=>{var t;let{message:s,inView:r}=e,a=(null===(t=s.content_blocks_tree)||void 0===t?void 0:t.children)||[],{contentBlockRenderConfigs:n}=(0,ew.useChatReceiveMessageCenterContentBlockPluginWithContentBlocks)(a);return(tA({message:s,blockCount:n.length}),null==n?void 0:n.length)?(0,V.jsx)("div",{className:l()("flex w-full flex-col","gap-20"),children:n.map(e=>{let{pluginIdentifier:t,PluginContentRender:a,block:n,duplicateIdentifierList:o}=e;return(0,V.jsx)(a,{pluginIdentifier:t,duplicateIdentifierList:o,contentBlock:n,message:s,inView:r},n.id)})}):null},tO=e=>{let{plugin:t,message:s,pluginIdentifier:r}=e;(0,a.useEffect)(()=>{var e;let{receiveMessagePerformance:a}=t_.useMessagePerformanceStore.getState(),{message_id:n}=null!=s?s:{},{start:o,duration:i}=null!==(e=a[null!=n?n:""])&&void 0!==e?e:{};if(!r||!t||!n||!o||void 0!==i)return;let l=(0,tM.safelyGetNow)();(0,tx.updateReceiveMessagePerformance)(n,{end:l,duration:l-o,pluginId:r.toString(),type:"content"});let u=t_.useMessagePerformanceStore.getState().receiveMessagePerformance[n];u&&b.logger.persist.info({eventName:"receive_message_performance",meta:{...u}})},[t,s,r])},tW=e=>{var t,s;let{message:r,inView:n,mouseOver:o,pluginLoadCounter:i}=e,{plugin:l,pluginIdentifier:u,loading:d,duplicateIdentifierList:c,pluginLoadId:g}=(0,ew.useChatReceiveMessageBoxPluginWithMessage)(r),m=(0,K.isMessageFailed)(r);if(c.length>1){let e=Error(`${c.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_box",error:e})}if(tO({pluginIdentifier:u,plugin:l,message:r}),(0,a.useEffect)(()=>{i(g,d)},[d]),(0,a.useEffect)(()=>(i(g,d),()=>{null==i||i(g,!1)}),[g]),d)return(0,V.jsx)(eC.Loading,{});if(!l)return null;let{Content:v=tN}=l;return(0,V.jsxs)("div",{"data-plugin-identifier":String(u),className:m?"":"w-full",children:[(0,V.jsx)(v,{message:r,inView:n,mouseOver:o}),((0,G.isMessageFinished)(r)||(0,K.isBrokenMessage)(r))&&(0,V.jsx)(eb.RiskTips,{jsonString:null===(s=r.verbose)||void 0===s?void 0:null===(t=s.extra)||void 0===t?void 0:t.risk_tips})]})},tD=e=>{let{message:t}=e,{sendMessage:s}=(0,eB.useChatService)("chatMessageService"),r=(0,K.isMessageFailed)(t),a=(0,K.isImageSafetyError)(t)||(0,K.isFileSafetyError)(t),n=(0,eP.useRetryReceiveMessage)({sendMessage:s,message:t});return r&&!a?(0,V.jsx)(eI,{"data-testid":"message_box_failed_icon",className:"m-8 text-s-color-alert flex-shrink-0",onClick:n}):null},tG=e=>{let{inView:t,mouseOver:s}=e,{message:r,pluginLoadCounter:a}=tE(),n=r.content_blocks_tree;return(0,V.jsxs)("div",{"data-testid":"message_content","data-message-id":r.message_id,className:"flex flex-row w-full",children:[n?(0,V.jsx)(tV,{inView:t,mouseOver:s,message:r,pluginLoadCounter:a}):(0,V.jsx)(tW,{inView:t,mouseOver:s,message:r,pluginLoadCounter:a}),(0,V.jsx)(tD,{message:r})]})};var tH=s(23923);let t$=()=>null,tq=e=>{let{message:t}=e,{plugin:s}=e5(t),{Content:r=t$}=s||{};return(0,V.jsx)(r,{message:t})},tU=()=>null,tz=e=>{let{message:t,actionMode:s,updateActionMode:r}=e,{plugin:a}=e9(t,s),{Content:n=tU}=a||{};return(0,V.jsx)(n,{message:t,onExitActionMode:()=>r("")})},tK=e=>{let{message:t,inView:s,mouseOver:r}=e,[n,o]=(0,a.useState)(""),{messageActionPluginConfig:i}=e7(t,o);return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsxs)("div",{className:"flex-row flex max-w-full min-w-0 flex-grow",children:[(0,V.jsx)(e3,{inView:s,mouseOver:r,message:t,pluginConfigs:i}),(0,V.jsx)(tq,{message:t})]}),(0,V.jsx)(tz,{message:t,actionMode:n,updateActionMode:()=>o("")})]})},tX=e=>{let{mouseOver:t,inView:s}=e,{message:r}=tE(),{plugin:a,duplicateIdentifierList:n}=(0,ew.useChatReceiveMessageBoxBottomPluginWithMessage)(r);if(n.length>1){let e=Error(`${n.join(", ")}`);b.logger.persist.warning({eventName:"duplicate_matcher_of_receive_message_box_bottom",error:e})}let o=(0,tH.useSuggestMessageListComponentHook)({message:r});if(!a)return null;let{Content:i}=a;return(0,V.jsx)(i,{message:r,mouseOver:t,inView:s,actionBarComponentNode:(0,V.jsx)(tK,{message:r,mouseOver:t,inView:s}),suggestList:o})},tJ=e=>{let{message:t,pluginLoadCounter:s,lastAvaliableMessageId:r}=e,o=(0,w.useChatSlice)("chatMessageBoxLayoutStore",e=>e.receiveMessageBoxConfig.containerDataAttr,n.shallow),i=(0,w.useChatSlice)("chatMessageBoxLayoutStore",e=>e.getMessageBoxArea(),n.shallow),d=r===t.message_id;d&&u.useTracingStore.getState().markMessageListPerformance("lastMessageBoxRenderStartTimestamp");let c=d?document.querySelector(`[data-message-id="${t.message_id}"]`):null;(0,a.useEffect)(()=>{(null==c?void 0:c.clientHeight)&&u.useTracingStore.getState().markMessageListPerformance("lastMessageBoxRenderFinishTimestamp")},[c]);let g=(0,a.useMemo)(()=>({pluginLoadCounter:s,message:t,isLastMessage:d}),[s,t,d]),{top:m,left:v,bottom:f,right:h}=i;return(0,V.jsx)(tk.Provider,{value:g,children:(0,V.jsx)(ex.MessageBoxLayout,{dataAttributes:{"data-attr":o,"data-testid":"receive_message"},className:l()("w-full max-w-full s-font-base text-s-color-text-secondary p-0 rounded-s-radius-s bg-transparent","group data-[attr=select-mode]:-mt-10 data-[attr=select-mode]:py-10 data-[attr=select-mode]:px-16 data-[attr=select-mode]:sm:p-10 data-[attr=select-mode]:hover:bg-s-color-bg-base data-[attr=select-mode]:hover:rounded-s-radius-xs","data-[attr=select-mode]:has-[:checked]:bg-s-color-bg-trans data-[attr=select-mode]:has-[:checked]:rounded-s-radius-xs","data-[attr=select-mode]:pointer-events-none"),MessageBoxTopFoundation:m.visible?tR:null,MessageBoxLeftFoundation:v.visible?tF:null,MessageBoxBottomFoundation:f.visible?tX:null,MessageBoxRightFoundation:h.visible?tT:null,MessageBoxCenterFoundation:tG})})},tQ=e=>{let{conversationId:t,messageLink:s,pluginLoadCounter:r,lastAvaliableMessageId:a}=e,o=(0,x.useMessageStore)(e=>(0,_.getMessageSelector)(e,t,s),n.shallow),i=(0,B.useFeedStore)(e=>{var s;return Number(null===(s=e.conversationMap[t])||void 0===s?void 0:s.message_cursor)||0},n.shallow),l=(0,K.isSendMessage)(o);return(0,K.isMessageVisible)(o,i)&&o?(0,V.jsx)(tc.ErrorBoundary,{errorBoundaryName:"message_box_error",FallbackComponent:eg.BizMessageBlockErrorFallback,onError:(e,s)=>{var r;(0,td.reportMessageShowError)({message:o,reason:"base_message_box_error",error:e,from:"base_message_box_error",meta:{info:s}}),b.logger.persist.error({eventName:"message_box_error",error:e,meta:{info:s,conversation_id:t,message_id:o.message_id,content_type:String(null!==(r=null==o?void 0:o.content_type)&&void 0!==r?r:"unknown"),is_send:+!!l}})},children:l?(0,V.jsx)(tP,{message:o,pluginLoadCounter:r}):(0,V.jsx)(tJ,{message:o,pluginLoadCounter:r,lastAvaliableMessageId:a})}):null};var tY=s(161284),tZ=s(414459);let t0=()=>{let e=(0,a.useRef)(null),t=(0,a.useCallback)(()=>{var t,s;let r=null===(t=e.current)||void 0===t?void 0:t.getBoundingClientRect().width;r&&(null===(s=e.current)||void 0===s||s.style.setProperty("--message-block-container-inline-width",`${r}px`))},[]);return(0,tY.useResizeObserver)({ref:e,onResize:t}),(0,a.useLayoutEffect)(()=>{t()},[t]),{ref:e}},t1=e=>{let{conversationId:t,messageLinks:s,pluginLoadCounter:r,isBatch:n=!1,lastAvaliableMessageId:o,...i}=e,{ref:u}=(0,er.useInView)(),{ref:d}=t0(),c=(0,a.useCallback)(e=>{u(e),d.current=e},[]);return(0,V.jsx)("div",{"data-testid":"message-block-container","data-ui-version":"samantha",className:l()("message-block-container-aFugD6"),ref:c,...i,children:s.length>1||n?(0,V.jsx)(tu,{conversationId:t,messageLinks:s,pluginLoadCounter:r}):1===s.length?(0,V.jsx)(tQ,{messageLink:s[0],conversationId:t,pluginLoadCounter:r,lastAvaliableMessageId:o}):null})},t2=e=>{let{messageLinks:t,conversationId:s,children:r}=e;return(0,V.jsx)(a.Suspense,{fallback:(0,V.jsx)("span",{className:"flex items-baseline",children:(0,V.jsx)(tZ.DotFlashing,{})}),children:(0,V.jsx)(tc.ErrorBoundary,{errorBoundaryName:"message_block_error",FallbackComponent:eg.BizMessageBlockErrorFallback,onError:(e,r)=>{t.forEach(t=>{var a;b.logger.persist.error({eventName:"message_block_error",error:e,meta:{info:r,conversation_id:s,message_id:t.messageId,content_type:null===(a=(0,_.getMessageSelector)(x.useMessageStore.getState(),s,t))||void 0===a?void 0:a.content_type}})})},children:r})})};function t3(e){let{conversationId:t,messageLinks:s,pluginLoadCounter:r,isBatch:a,lastAvaliableMessageId:n}=e;return(0,V.jsx)(t2,{messageLinks:s,conversationId:t,children:(0,V.jsx)(t1,{conversationId:t,messageLinks:s,pluginLoadCounter:r,isBatch:a,lastAvaliableMessageId:n})})}let t6=(0,a.forwardRef)((e,t)=>{let{conversationId:s,isSelectMode:r,dataList:n,children:i,top:u,bottom:d,className:c,bottomCenterButton:g,onInViewItemsChange:m,style:v,Container:f=R.SamanthaLayout.MaxWidthLayout}=e,h=(0,a.useRef)(null),{scrollRef:p}=(0,k.useChatRef)(),_=(0,a.useRef)(null);return(0,a.useEffect)(()=>{var e;null===(e=_.current)||void 0===e||e.setEnableInterAnchor(!0)},[n.length]),(0,V.jsxs)("div",{ref:t,"data-table-spillover":"true",className:l()("message-list-_25AQ9","table-spillover-vRPGcI",c),style:v,children:[(0,V.jsx)(es,{"data-testid":"message-list",ref:_,dataList:n,top:(0,V.jsx)(f,{className:"top-item-NuXT_0",children:(0,o.default)(u)?u():u}),bottom:(0,V.jsx)(f,{className:"bottom-item-GcV25k",children:(0,o.default)(d)?d():d}),keepedBottom:(0,V.jsx)(ea,{onShow:()=>{var e;null===(e=h.current)||void 0===e||e.setVisible(!1)},onHide:()=>{var e,t;null===(e=h.current)||void 0===e||e.setVisible(!0),null===(t=_.current)||void 0===t||t.setEnableInterAnchor(!0)},bottomThreshold:"min(100%, 50px)"}),onInViewItemsChange:m,onReachBottom:()=>{var e;null===(e=_.current)||void 0===e||e.setEnableInterAnchor(!1)},children:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,V.jsx)(f,{"data-target-id":"message-box-target-id",className:"inner-item-f8P6nx",containerClassName:l()({"select-mode-xCTy4E":r}),ref:t.anchorTopRef,"data-testid":"union_message",centerContentMaxWidthDelta:32*!!r,children:i(e)})}}),(0,V.jsx)(f,{children:(0,V.jsxs)("div",{className:l()("bottom-center-button-H23oje","max-dbx-xs:!bottom-0"),children:[g,(0,V.jsx)(eu,{ref:h,className:l()("to-bottom-button-FZyt0L"),conversationId:s,onClick:()=>{var e,t,s;null===(e=h.current)||void 0===e||e.setVisible(!1),null===(t=_.current)||void 0===t||t.setEnableInterAnchor(!1),null===(s=p.current)||void 0===s||s.scrollToBottom({smooth:!0})}})]})}),(0,V.jsx)(E.ChatPerfHtmlLoaded,{name:"message_list_html_loaded"})]})}),t8=e=>{let{conversationId:t,segmented:s}=e,{status:{inIniting:r=!1},messageLinks:n,resolveConversationId:o}=(0,d.useMessageLinksWithStatus)(t),i=(0,j.useConversation)(t),l=(0,L.isConversationReviewStatusRejected)(i),{messageList:c}=(0,T.useUnionMessageList)({conversationId:t,segmented:s,shareReviewStatusRejected:l});return(0,a.useEffect)(()=>{r||u.useTracingStore.getState().addDurationPoint("message_list_mount")},[r]),{unionMessageList:c,inIniting:r,resolveConversationId:o,rawMessageLinks:n}},t7=(0,a.memo)(function(e){var t;let{section:s=!0,LoadMoreSlot:r,InnerAfterMessageListSlot:o,SectionDividerSlot:i,MessageBeforeSlot:d,LargeAvatarSlot:c,enableLoadMore:g=!1,className:m,conversationId:h,disableSkeleton:S=!1,Container:C=R.SamanthaLayout.MaxWidthLayout}=e,w=(0,a.useRef)(null),j=(0,M.getPluginIdetifierListByType)("chatMessageListLifeCyclePlugin"),{pluginList:L,loading:k}=(0,M.useMessageListLifeCyclePluginList)(j),{unionMessageList:E,resolveConversationId:F}=t8({conversationId:h,segmented:s}),{skeletonShow:N,pluginLoadCounter:A}=y(F,S);(0,a.useEffect)(()=>(f(),()=>{f()}),[]),(0,a.useEffect)(()=>{if(!k)return L.forEach(e=>{var t;null==e||null===(t=e.mounted)||void 0===t||t.call(e,{conversationId:h})}),()=>{L.forEach(e=>{var t;null==e||null===(t=e.unmounted)||void 0===t||t.call(e,{conversationId:h})})}},[k,h]);let{isSelectMode:O}=(0,p.useThreadShareStore)(e=>({isSelectMode:e.isSelectMode}),n.shallow),D=(0,_.findLastAvailableMessageLinkSelector)(x.useMessageStore.getState(),h,null!==(t=x.useMessageStore.getState().messageLinkMap[h])&&void 0!==t?t:[]);return(0,a.useEffect)(()=>{if(F){let e=0,t=setInterval(()=>{var s,r;e++;let a=t9(w.current);if(a){let{pageNavigationType:e,enterPid:t}=u.useTracingStore.getState();b.logger.persist.success({eventName:"message_list_render",meta:{conversation_type:null===(s=(0,I.conversationSelector)(B.useFeedStore.getState(),F))||void 0===s?void 0:s.conversation_type,bot_type:(0,P.getChatTypeForTea)("",F),success:1,page_navigate_type:e,page_entry_pid:t}})}if(a||e>=10){if(e>=10){let{pageNavigationType:e,enterPid:t}=u.useTracingStore.getState();b.logger.persist.info({eventName:"message_list_render",meta:{conversation_type:null===(r=(0,I.conversationSelector)(B.useFeedStore.getState(),F))||void 0===r?void 0:r.conversation_type,bot_type:(0,P.getChatTypeForTea)("",F),success:0,page_navigate_type:e,page_entry_pid:t}})}clearInterval(t)}},1e3);return()=>clearInterval(t)}},[F]),(0,V.jsxs)(V.Fragment,{children:[N?(0,V.jsx)(ec,{}):null,(0,V.jsx)(t6,{className:l()(m,"opacity-0 transition-opacity duration-400",N?"":"opacity-100"),Container:C,ref:w,conversationId:F,isSelectMode:O,enableLoadMore:g,dataList:E,bottom:(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)("div",{className:"bottom-placeholder-QBvtGv"}),(0,V.jsx)("div",{className:l()("bottom-placeholder-intersect-input-VUAYTL","max-dbx-xs:hidden")}),o&&(0,V.jsx)(o,{})]}),top:(0,V.jsxs)(V.Fragment,{children:[d&&(0,V.jsx)(d,{}),g&&r&&(0,V.jsx)(r,{conversationId:F}),c&&(0,V.jsx)(c,{})]}),bottomCenterButton:(0,V.jsx)(W,{conversationId:F,unionMessageList:E}),onInViewItemsChange:e=>v(e),children:e=>{if((0,T.isBlockMessageItem)(e)){let{id:t,data:s,showActionsAndSuggests:r,isBatch:a}=e;return(0,V.jsx)(t3,{messageLinks:s,conversationId:F,isShowActionsAndSuggests:r,isBatch:a,pluginLoadCounter:A,lastAvaliableMessageId:null==D?void 0:D.messageId},t)}if((0,T.isSingleMessageItem)(e)){let{id:t,data:s,showActionsAndSuggests:r}=e;return(0,V.jsx)(t3,{messageLinks:[s],conversationId:F,isShowActionsAndSuggests:r,pluginLoadCounter:A,lastAvaliableMessageId:null==D?void 0:D.messageId},t)}if((0,T.isDividerMessageItem)(e)){let{id:t}=e;return i&&(0,V.jsx)(i,{dividerItem:e},t&&`section-divider-${t}`)}return null}})]})}),t9=e=>{var t;return!!(null===(t=e||document)||void 0===t?void 0:t.querySelector('[data-target-id="message-box-target-id"]'))}},462310:function(e,t,s){s.d(t,{useBotSupportLanguages:function(){return m},useLoadConversationMessage:function(){return g}});var r=s(713738),a=s(956801),n=s(83990),o=s(628338),i=s(230932),l=s(910214),u=s(198660),d=s(910321),c=s(856392);let g=()=>{let{canReport:e}=a.useTracingStore.getState(),t=(0,r.useRef)(null!=e&&e);return{initLoadMessageInChatPage:async(e,s)=>{let{reportFirstView:r=!1}=s||{};if(!e)return;i.useFeedStore.getState().updateChatCreateInFirstTime({conversationId:e,status:!1});let l=(0,u.getIsLoggedIn)(),g=n.useMessageStore.getState().initMessageList({conversationId:e,messageIndex:Number.MAX_SAFE_INTEGER,isGuest:!l,hasPreprocessTask:o.hasPreprocessTask});if(r&&t.current){var m,v;t.current=!1;let{chatLayoutCreateTime:s=0,chatLaunchSuccessTime:r=0,flowWebScriptJsFinish:o=0,enterPid:i}=a.useTracingStore.getState(),l=null===(v=n.useMessageStore.getState().messageLinkMap)||void 0===v?void 0:null===(m=v[e])||void 0===m?void 0:m.length,u=(0,c.createReportEvent)({eventName:"init_chat_app_first_conversation",meta:{chat_cached:l?"1":"0",enter_pid:i,"page_time.origin":-s,"page_time.dom_interactive":o-s,"page_time.launch_success":r-s,"page_time.start":(0,d.safelyGetNow)()-s}});a.useTracingStore.setState({chatCached:!!l}),await g.then(e=>{(null==e?void 0:e.length)?(u.addDurationPoint("success"),u.success({meta:{"page_time.success":(0,d.safelyGetNow)()-s}}),a.useTracingStore.getState().addDurationPoint("load_chat_finish")):(u.error({reason:"init_msg_list_empty"}),a.useTracingStore.getState().error("init_msg_list_empty"))},e=>{throw u.error({error:e,reason:"init_msg_inner_error"}),a.useTracingStore.getState().error("init_msg_inner_empty",e),e})}else r?await g.then(e=>{(null==e?void 0:e.length)?a.useTracingStore.getState().addDurationPoint("load_chat_finish"):a.useTracingStore.getState().error("init_msg_list_empty")},e=>{throw a.useTracingStore.getState().error("init_msg_inner_empty",e),e}):await g}}},m=e=>{let[t,s]=(0,r.useState)(null),[a,n]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{n(!0),void 0!==e&&l.botApiService.LanguageList({bot_id:e}).then(e=>{let{data:t}=e;(null==t?void 0:t.support_language_list)!==void 0&&s(t.support_language_list),n(!1)}).catch(()=>{n(!1)})},[]),{languages:t,loading:a}}},619352:function(e,t,s){s.d(t,{useChatView:function(){return T}});var r=s(713738),a=s(865607),n=s(214071),o=s(229079),i=s(4137),l=s(845647),u=s(956801),d=s(83990),c=s(637319),g=s(462310),m=s(698392),v=s(628338),f=s(230932),h=s(971857);let p=async e=>{if(!f.useFeedStore.getState().conversationMap[e]){let t=new Promise(t=>{let s=f.useFeedStore.subscribe(t=>({conversation:t.conversationMap[e]}),e=>{let{conversation:r}=e;r&&(s(),t())},{fireImmediately:!0,equalityFn:a.shallow})});await t}};var _=s(212183),x=s(389174),M=s(721118),S=s(781313),C=s(390322),w=s(992528),b=s(604889),y=s(511720),j=s(631122),L=s(777422),I=s(915299),B=s(387978),P=s(198660),k=s(366119),E=s(441259),R=s(845362);let T=(e,t)=>{let{conversationId:s,extraExtRef:T}=t,{showBoundary:F}=(0,B.useErrorBoundary)(),N=(0,r.useRef)(!0),A=(0,I.useTranslateFn)(),{toChatPage:V,onChatPageLoaded:O,onChatPageDestroy:W,idInParams:D,locationKey:G,locationState:H}=(0,w.useChat)(),{scrollRef:$,chatInputRef:q,chatViewRef:U,chatPageTargetRef:z,chatDropTargetRef:K}=(0,b.useChatRef)(),X=(0,m.useChatSlice)("chatViewCoreStore",e=>{var t;return null===(t=e.currentChatViewConfig)||void 0===t?void 0:t.chatKey}),{run:J}=(0,k.default)(()=>null==V?void 0:V(),{wait:100,leading:!0,trailing:!1}),Q=(0,f.useFeedStore)(e=>{let{latestArchivedConversationId:t}=e;return t});(0,r.useEffect)(()=>{s&&Q===s&&J()},[s,Q]);let{collectionId:Y,collectionType:Z}=(0,y.useCollectionTrackEventContext)(),ee={scrollRef:$,chatInputRef:q,chatViewRef:U,chatPageTargetRef:z,chatDropTargetRef:K},{initLoadMessageInChatPage:et}=(0,g.useLoadConversationMessage)();(0,h.useConversationRecorder)(s);let es=(0,r.useRef)(!1),er=(0,j.useToast)(),[ea,en,eo,ei]=(0,f.useFeedStore)(e=>[e.fetchUpdateConversationInfo,e.insertConversationToLinks,e.removeConversationFromLinks,e.removeConversationFromMap],a.shallow),[el,eu]=(0,d.useMessageStore)(e=>[e.loadMoreMessageList,e.clearConversationMessages],a.shallow);(0,r.useImperativeHandle)(e,()=>({onLoadMore:async()=>{if(!es.current){es.current=!0;try{var e;let t=(null===(e=d.useMessageStore.getState().messageListStatusMap[s])||void 0===e?void 0:e.hasMore)||!1,r=(0,P.getIsLoggedIn)();if(t)return await el(s,!r,v.hasPreprocessTask)}finally{es.current=!1}}},syncData:()=>{ed({toastWhenFailed:!1,navigateWhenFailed:!1,showErrorWhenFailed:!1})}}),[s]),(0,r.useEffect)(()=>{let e=async(e,t)=>{var r;if(!t.length||t[0].conversationId&&t[0].conversationId!==s)return t;await (null===(r=$.current)||void 0===r?void 0:r.scrollToBottom());let a=Y?{collect_id:Y,collect_type:Z}:{},o=t.map(e=>({...e.extraExt,...null==T?void 0:T.current}));await p(s);let i=t.map((e,t)=>{let{reportParams:r,...i}=e;return{...i,...(0,n.default)(o[t])?{}:{extraExt:o[t]},reportParams:{...r,...a,from:r.from?String(r.from):"",enter_from:null==H?void 0:H.enter_from},conversationId:s,botId:(0,_.getBotIdByConversationId)(s),chatType:l.ChatType.Conversation,botType:(0,x.isBotConversation)((0,M.conversationSelector)(f.useFeedStore.getState(),s))?"UGC":"Main"}});return en({conversationId:s,index:1}),i};return R.chatViewMessageEventBus.on("processMessageBefore",e),()=>{R.chatViewMessageEventBus.off("processMessageBefore",e)}},[s]);let ed=async e=>{let{init:t,toastWhenFailed:r,navigateWhenFailed:a,showErrorWhenFailed:n,reportFirstView:l=!1,skipWhenIdEmpty:g=!1}=e;if((void 0===s||0===s.length||(0,S.isLocalConversation)(s))&&g){(0,L.trackEvent)("enter_page",{current_page:"chat",is_from_ug:"0"});return}let{error:m}=u.useTracingStore.getState();async function v(){let e=await ea(s,t?"initChatView":"refreshChatView");return(null==e?void 0:e.deleted)&&(eo({conversationId:s}),ei({conversationId:s}),eu(s),null==J||J()),null==O||O({conversationId:s,botId:null==e?void 0:e.bot_id,...ee}),e}try{let e=await v();await et(s,{reportFirstView:l}),e&&function(e){let{conversation_id:t,read_message_index:s,message_index:r,read_badge_count:a=s,badge_count:n=r}=e,o=(0,c.getLastMessageIndexFromMessageLinksSelector)(d.useMessageStore.getState(),t||"");if(Number(a)!==o){let e=Math.max(o,Number(n));Number(a)<e&&(0,C.updateReadMessageIndexAndReport)(t||"",e)}}(e)}catch(t){let e="712013001"===(0,o.default)(t,"errorOption.code");if(r&&!e&&("boolean"!=typeof r?er[r.type](r.text):er.error(A("system_error_toast"))),a){let e=(0,P.getIsLoggedIn)();(0,i.default)(D)&&e?F(t):null==J||J()}n&&F(t),l&&m("load_chat_failed",t instanceof Error?t:Error(String(t)))}};(0,r.useEffect)(()=>{var e,t,r,a;if(N.current){if(N.current=!1,u.useTracingStore.getState().addDurationPoint("load_cache_end"),X&&(0,m.getChatSlice)("chatViewCoreStore").needSkipChatKey===X){(0,m.getChatStore)("chatViewCoreStore").setState({needSkipChatKey:void 0}),null==O||O({conversationId:s,botId:null===(e=(0,M.conversationSelector)(f.useFeedStore.getState(),s))||void 0===e?void 0:e.bot_id,...ee});return}ed({toastWhenFailed:{text:A("web_toast_chat_noAccess_homepage"),type:"info"},navigateWhenFailed:!0,showErrorWhenFailed:!1,init:!0,reportFirstView:G===u.useTracingStore.getState().chatLayoutEnterPageKey,skipWhenIdEmpty:!0})}else null===(t=$.current)||void 0===t||t.scrollToBottom(),null===(r=q.current)||void 0===r||r.clear(),null===(a=$.current)||void 0===a||a.enableScroll(),ed({toastWhenFailed:!1,navigateWhenFailed:!1,showErrorWhenFailed:!1});return()=>{null==W||W({conversationId:s,...ee})}},[s]),(0,r.useEffect)(()=>{if(!(0,E.isAppleWebkit)())return;let e=d.useMessageStore.subscribe(e=>[e.messageLinkMap[s],e.messageMap[s],e.localMessageMap[s]],e=>{var t,s;e&&(null===(s=$.current)||void 0===s||null===(t=s.refreshAnchor)||void 0===t||t.call(s))});return()=>{e()}},[])}},551886:function(e,t,s){s.d(t,{NewThreadLocalChatView:function(){return x},NewThreadLocalChatViewPeerComp:function(){return _}});var r=s(713738),a=s(845647),n=s(698392),o=s(971857),i=s(604889),l=s(426156),u=s(728319),d=s(198660),c=s(239686),g=s(178230),m=s(651159),v=s(845362),f=s(32212),h=s(345660);let p=e=>e,_=e=>{let{chatId:t,chatType:s}=e,l=(0,d.useIsLoggedIn)();(0,c.default)(()=>(0,n.getChatStore)("chatViewCoreStore").setState({currentLocalConversationId:""}));let{scrollRef:u}=(0,i.useChatRef)(),g=(0,m.useLocalThreadSendMessage)({chatType:s});return((0,r.useEffect)(()=>{let e=async(e,r)=>{var n;return await (null===(n=u.current)||void 0===n?void 0:n.scrollToBottom()),t&&s!==a.ChatType.Conversation?await g(t,r):r};return v.chatViewMessageEventBus.on("processMessageBefore",e),()=>{v.chatViewMessageEventBus.off("processMessageBefore",e)}},[g,t]),(0,m.useSubscribeLocalConversationCreation)(t),!(0,o.useLocalConversation)(t)&&l)?(0,h.jsx)(f.NavigateToFirstChat,{}):null},x=(0,r.forwardRef)((e,t)=>{let{chatId:s,chatType:r,MessageListSlot:n,renderContent:o=p}=e;return(0,h.jsxs)(l.ErrorBoundary,{logger:g.logger,FallbackComponent:u.DefaultErrorFallback,errorBoundaryName:"new_thread_error",errorBoundaryScope:l.ErrorBoundaryScopeEnum.Component,children:[o((0,h.jsx)(n,{conversationId:s,enableLoadMore:!1})),r!==a.ChatType.Conversation&&(0,h.jsx)(_,{chatId:s,chatType:r})]})})},32212:function(e,t,s){s.d(t,{NavigateToFirstChat:function(){return n}});var r=s(713738),a=s(992528);let n=()=>{let{toChatPage:e}=(0,a.useChat)();return(0,r.useEffect)(()=>null==e?void 0:e({replace:!0,relative:"route"}),[]),null}}}]);
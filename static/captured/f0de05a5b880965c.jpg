"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["91600"],{289469:function(e,t,n){n.d(t,{checkLastMessageIsSearchReply:function(){return h},checkMessageIsSingleReply:function(){return M},createRegenHelper:function(){return p},createReportEventIfNotExist:function(){return _},getReplyToMessageByReplyMessage:function(){return f}});var r=n(519428),s=n(131696),l=n(746479),a=n(629006),o=n(674157),i=n(458524),u=n(856392),d=n(83990),g=n(752544),c=n(630768),v=n(637319);let _=(e,t)=>{var n;let r=d.useMessageStore.getState().regenerateMessageMap[e];if(!r){let n=(0,u.createReportEvent)({eventName:t});return d.useMessageStore.setState((0,l.produce)(r=>(r.regenerateMessageMap[e]={messageMap:{},reportEvents:{[t]:n}},r))),n}if(!(null==r?void 0:null===(n=r.reportEvents)||void 0===n?void 0:n[t])){let n=(0,u.createReportEvent)({eventName:t});return d.useMessageStore.setState((0,l.produce)(s=>(s.regenerateMessageMap[e].reportEvents={...r.reportEvents,[t]:n},s))),n}return r.reportEvents[t]},p=e=>({setRegenMessageInActive:t=>{let{messageId:n}=t,{draftMessageMap:{[n]:s},draftRegenerateMessageMap:{messageMap:{[n]:l}={}}={},draftRegenerateMessageMap:o}=e;{let e=null!=l?l:(0,r.default)(s);e.regen_active=!1,e.is_regen=!0,o.messageMap={...o.messageMap,[n]:e}}s.is_regen=!0,!((0,a.isImageMessage)(s)||(0,a.isCreationBlockMessage)(s))&&(s.status=i.PushMessageStatus.InVisible)},setRegenMessageActive:t=>{let{messageId:n}=t,{draftMessageMap:s,draftRegenerateMessageMap:{messageMap:{[n]:l}={}}}=e;l&&(s[n]={...s[n],...(0,r.default)(l)},l.regen_active=!0)}}),M=(e,t)=>{if(!e||!t.reply_id)return!1;let n=t.reply_id,r=d.useMessageStore.getState(),l=r.messageLinkMap[e],a=(0,g.createGetMessage)({messageMap:r.messageMap[e],localMessageMap:r.localMessageMap[e]}),i=(0,c.findAllMessageLinkByMatchEqualId)({messageLinks:l,replyId:n,getMessage:a});return(null==i?void 0:i.length)===1||(0,s.default)(i,e=>{let t=a(e);return t&&(0,o.isRegenerateMessage)(t)})},h=(e,t)=>{var n;if(!e||!t)return!1;let r=null===(n=d.useMessageStore.getState().messageMap[e])||void 0===n?void 0:n[t];return(0,a.isSearchTextMessage)(r)},f=e=>{let{reply_id:t}=null!=e?e:{},n=d.useMessageStore.getState();return t?(0,v.getMessageSelector)(n,(null==e?void 0:e.conversation_id)||"",{isLocalMessage:!1,messageId:t}):null}},119570:function(e,t,n){n.d(t,{useReportOnMessageShowError:function(){return l}});var r=n(713738),s=n(580622);let l=e=>{let{inView:t,reportOnInView:n,getElement:l,enable:a=!0,checkMessageShowError:o,onError:i}=e,u=(0,s.default)(a),d=(0,s.default)(o),g=(0,s.default)(i),c=(0,r.useRef)(t);c.current=c.current||t,(0,r.useLayoutEffect)(()=>()=>{var e,t;if(!u.current)return;let r=l();if(!r){null===(e=g.current)||void 0===e||e.call(g,{reason:"element_mount_error"});return}(c.current||!n)&&(null===(t=d.current)||void 0===t||t.call(d,{element:r,onError:g.current}))},[])}},459046:function(e,t,n){n.d(t,{checkImagesShowError:function(){return a},reportMessageShowError:function(){return l}});var r=n(178230),s=n(83990);let l=e=>{var t,n,l,a,o,i;let{message:u,reason:d,error:g,from:c,meta:v}=e,_=null!=g?g:Error(d),p={success:"0",reason:d,content_type:String(null!==(l=null==u?void 0:u.content_type)&&void 0!==l?l:"unknown"),skill_id:String(null!==(a=null==u?void 0:null===(t=u.skill)||void 0===t?void 0:t.skill_id)&&void 0!==a?a:"generic"),message_from:null!==(o=null==u?void 0:null===(n=u.local_info)||void 0===n?void 0:n.from)&&void 0!==o?o:"unknown",user_type:String(null!==(i=null==u?void 0:u.user_type)&&void 0!==i?i:"unknown"),conversation_id:null==u?void 0:u.conversation_id,message_id:null==u?void 0:u.message_id,conversation_type:String(null==u?void 0:u.conversation_type),from:c||"unknown",...v},M=null==u?void 0:u.message_id;if(s.useMessageStore.getState().checkMessageShowErrorHasReported({messageId:M})){r.logger.console.error({eventName:"message_show_error_duplicate",error:_,meta:p});return}s.useMessageStore.getState().updateMessageShowErrorHasReported({messageId:M}),r.logger.persist.error({eventName:"message_show_error",error:_,meta:p})},a=e=>{let{element:t,hasImage:n=!1,defaultNaturalWidth:r=256,defaultNaturalHeight:s=192,onError:l}=e;if(n){let e=t.querySelectorAll("[data-testid=mdbox_image] picture");if(0===e.length)null==l||l({reason:"images_render_error"});else{let t=!1;e.forEach(e=>{let n=e.querySelector("img");(null==n?void 0:n.complete)&&n.naturalWidth&&n.naturalHeight&&(n.naturalWidth!==r||n.naturalHeight!==s)&&(t=!0)}),t||null==l||l({reason:"all_images_load_error"})}}}},78158:function(e,t,n){n.d(t,{SearchDeepThinkContent:function(){return c}});var r=n(713738),s=n(750874),l=n(744322),a=n(629006),o=n(674157),i=n(456712),u=n(459046),d=n(119570),g=n(345660);let c=e=>{var t,n,c,v,_,p,M;let{message:h,searchType:f,searchReferenceData:m,hidden:S=!1,isShare:k=!1,onTrackEvent:E,customRenderSearchSideBarBtn:y}=e,x=(0,i.getDeepThinkStatusFromExt)(null==h?void 0:h.ext),R=(0,a.isTextMessageWithDeepThiking)(h)&&!(null==h?void 0:h.think_reason_is_hide),I=(0,o.isMessageFinished)(h),L=(0,a.isBrokenMessage)(h),T=(0,r.useRef)(null),w=!!(null==h?void 0:null===(t=h.content_obj)||void 0===t?void 0:t.think)&&!!(null==h?void 0:null===(n=h.content_obj)||void 0===n?void 0:n.text)&&!x||I,{isLoadingInThinking:b,loadingTitle:N}=(0,r.useMemo)(()=>{var e,t,n;let r=!1,s="",{text:l=""}=null!==(n=null==h?void 0:null===(e=h.loading_state)||void 0===e?void 0:e.current_state)&&void 0!==n?n:{};return{isLoadingInThinking:r=null!=h&&null!==(t=h.loading_state)&&void 0!==t&&!!t.in_loading&&!x&&!L,loadingTitle:l}},[null==h?void 0:null===(c=h.loading_state)||void 0===c?void 0:c.current_state,x]);return((0,d.useReportOnMessageShowError)({enable:!!R,getElement:()=>T.current,checkMessageShowError:e=>(0,s.checkDeepThinkingShowError)(e),onError:e=>(0,u.reportMessageShowError)({...e,message:h})}),S)?null:(0,g.jsx)(l.DeepThinkingContent,{ref:T,meta:null==h?void 0:h.meta_infos,searchType:f,messageReplyId:null==h?void 0:h.reply_id,conversationId:null==h?void 0:h.conversation_id,forceCloseCanvas:!0,isThinkingFinished:w,isThinkingBroken:x,thinkExpandStatus:!k,options:{isInSearchLoading:b,loadingTitle:N},isShare:k,onTrackEvent:E,references:null==m?void 0:m.search_result,messageId:null==h?void 0:h.message_id,botId:null==h?void 0:h.bot_id,skillType:null==h?void 0:null===(v=h.skill)||void 0===v?void 0:v.skill_type_no_default,skillId:null==h?void 0:null===(_=h.skill)||void 0===_?void 0:_.skill_id_no_default,content:(null==h?void 0:null===(p=h.content_obj)||void 0===p?void 0:p.think)||"",messageText:(null==h?void 0:null===(M=h.content_obj)||void 0===M?void 0:M.text)||"",customRenderSearchSideBarBtn:y})}},716919:function(e,t,n){n.d(t,{SearchErrorContentUI:function(){return M}});var r=n(28414),s=n(229079),l=n(812650),a=n.n(l),o=n(666196),i=n(725705),u=n(289469),d=n(637319),g=n(83990),c=n(915299),v=n(165482),_=n(424785),p=n(345660);let M=e=>{var t,n;let{className:l,message:M}=e,h=(0,c.useTranslateFn)(),{sendMessage:f}=(0,o.useChatService)("chatMessageService"),m=(0,s.default)(M,["ext","deep_search_error"]),S=null!==(n=null===(t=(0,v.parseJSON)(m,{}))||void 0===t?void 0:t.error_message)&&void 0!==n?n:"",k=(0,u.createReportEventIfNotExist)(M.conversation_id||"","retry_send_deep_search_message");return(0,p.jsxs)("div",{className:a()("contain-Ikag6M",l),children:[(0,p.jsxs)("div",{className:"error-siPu1k",children:[(0,p.jsx)(r.default,{className:"text-16"}),(0,p.jsx)("span",{className:"text-BRdwbO",children:S})]}),(0,p.jsx)("div",{className:"btnContent-b6H33V",children:(0,p.jsx)(_.default,{onClick:()=>{let e=(0,d.findLastMessageByReplyIdSelector)(g.useMessageStore.getState(),M.conversation_id||"",M.reply_id||"");if(e)try{var t,n,r;e&&f([{text:null!==(r=null==e?void 0:null===(t=e.content_obj)||void 0===t?void 0:t.text)&&void 0!==r?r:"",operation:{replace:{messageLink:{messageId:e.message_id||"",isLocalMessage:(0,i.isLocalMessage)(e)}}},reportParams:{scene:"edit"},extraExt:{...(null==e?void 0:null===(n=e.ext)||void 0===n?void 0:n.input_skill)?{input_skill:e.ext.input_skill}:{}}}]),k.success()}catch(e){k.error({reason:"send message failed, unexpected error",error:e})}},theme:"solid",className:"button-CNpy4a",children:h("search_tryagain")})})]})}}}]);
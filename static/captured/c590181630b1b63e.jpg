"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["25438"],{204454:function(e,t,a){a.d(t,{isBetaEnv:function(){return n}});let n=!1},130800:function(e,t,a){a.d(t,{ChatConfigService:function(){return o},DEFAULT_FEATURE_GATING:function(){return s},createChatConfigService:function(){return l}});var n=a(102249),i=a(992847);function r(e,t,a){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let s={showBotHeat:!1,enableBotProfileOpenJump:!1,showBotHandleName:!1,enableSendFileMessage:!1,enableSendWithAttachmentArea:!1,alwaysShowLargeAvatar:!1,enableNewWritingSkill:!1,enableGenerateDocByOutline:!1,enableDeepSearchButton:!1,enableAutoExitSkillAfterSendMsg:!1,enableSendOcrImage:!1,answerWithSuggest:!0,namedEntityHighlight:!1,answerWithVideo:!1,canEditImageWithoutAB:!1,enableSamanthaProtocolStage:-1,enableChatInputNewLayout:!1,enableNewAISearchGuidancePage:!1,enableAcademicSearchInGuidancePage:!1,enableSkillPin:!0,enableAutoEnterImmersiveReading:!1,enableGuestSendSkill:"normal"};class o{init(e){this._config=e}get userId(){return this._config().userId||""}get chatReportParams(){return this._config().chatReportParams||{}}get appId(){return this._config().appId}get featureGating(){var e;return null===(e=this._config().featureGating)||void 0===e||e}get localFeatureConfig(){return this._config().isEnableDebug?{...(0,n.getFGValueAll)(i.FGBuiltinNames.debugStorage),...this._config().overrideLocalFeatureConfig||{}}:{}}get isEnableDebug(){return this._config().isEnableDebug}get isSeoUser(){var e;return null!==(e=this._config().isSeoUser)&&void 0!==e&&e}createUploader(e){var t,a;return null===(t=(a=this._config()).createUploader)||void 0===t?void 0:t.call(a,e)}get getSkillListPrefetch(){return this._config().getSkillListPrefetch}get enableUltPrefetch(){return this._config().enableUltPrefetch}constructor(){r(this,"ctx",void 0),r(this,"_config",void 0)}}let l=e=>{let t=new o;return t.init(e),t}},235267:function(e,t,a){a.r(t),a.d(t,{ChatViewService:function(){return P},chatViewServiceContainer:function(){return b},SimpleChatViewService:function(){return I},createChatViewService:function(){return w}});var n=a(952259),i=a(321647),r=a(229079),s=a(385093),o=a(746479),l=a(430896),c=a(698392),u=a(516655),v=a(689368),d=a(831566),h=a(910321);let m=2e3/24,g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{maxCollectionDuation:5e3},t=0,a=null,n=0,i=[],r=s=>{if(s-n>=e.maxCollectionDuation){a&&cancelAnimationFrame(a);return}if(0!==t){let e=s-t;i.push(e)}t=s,a=requestAnimationFrame(r)};return{start:()=>{i=[],t=0,n=(0,h.safelyGetNow)(),a=requestAnimationFrame(r)},end:()=>new Promise(t=>{setTimeout(()=>{if(i.length<=3)return{normalJunkRate:0,seriousJunkRate:0};let e=0,a=0,n=0;for(let t=3;t<i.length;t++){let r=i[t];if(n+=r,r>2*((i[t-1]+i[t-2]+i[t-3])/3)){if(r>125){a+=r,e+=r;continue}if(r>m){e+=r;continue}}}t({normalJunkRate:e/n,seriousJunkRate:a/n})},e.maxCollectionDuation)})}};var _=a(178230),f=a(856392),p=a(139435);function C(e,t,a){var n;return(t="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?n:n+"")in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}let S=()=>{var e;return null===(e=Error("trace").stack)||void 0===e?void 0:e.split("\n").slice(3,8).map(e=>{var t,a;return null==e?void 0:null===(a=e.trim())||void 0===a?void 0:null===(t=a.replace("at ","- "))||void 0===t?void 0:t.replace(/\(http.*\/static\/js\//,"(/static/js/")}).reduce((e,t,a)=>(e[`call_chain${a?`_${a}`:""}`]=t,e),{})},y=(e,t)=>{_.logger.persist.info({eventName:"chat_perf_canvas_action",meta:{type:e,...t}})};class P{get immersiveChatViews(){return this._immersiveChatViews}get canvasPluginInstances(){return this._canvasPluginInstances}get exactImmersiveMode(){return this.immersiveStore.getState().exactImmersiveMode}get immersive(){return this.immersiveStore.getState().immersive}resetStore(){this.exitImmersiveMode(),this._temporaryCanvasTeaParams={},this.closeCanvasPanel()}createOpenCanvasOpenEvent(e,t,a){try{var n;let{messageId:i,conversationId:s,canvasLayoutState:o,ignoreReopenLogger:l,artifactId:u,artifactKey:v,localArtifactType:d,preRenderNodeId:h,exactMatchedPlugin:m,...g}=e;return l&&(null===(n=(0,c.getChatSlice)("chatViewCanvasStore"))||void 0===n?void 0:n.isExpand)?void 0:(0,f.createReportEvent)({eventName:"flow_chat_view_open_canvas",meta:{...S(),message_id:i,conversation_id:s,canvas_content_keys:Object.keys(g).join(","),layout_type:(0,p.getCanvasLayoutStateForTea)(e),artifact_id:u,artifact_key:v,pre_render:h?m?"1":"-1":"0",pre_render_plugin_name:(0,r.default)(m,"name"),local_artifact_type:d,canvas_enabled:this.canvasEnabled?"1":"0",open_by_rect:t?"1":"0",is_auto_open:a?"1":"0",auto_open_enabled:this.canvasAutoOpenEnaled?"1":"0"}})}catch(e){return}}async openCanvasPanel(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:!t,{messageId:n,conversationId:i,canvasLayoutState:r,ignoreReopenLogger:s,exactPluginIdentifier:l,preRenderNodeId:v,...d}=e,h=this.createOpenCanvasOpenEvent(e,t,a);if(!this.canvasEnabled||!this.canvasAutoOpenEnaled&&a)return;l||await (0,u.getChatCanvasPluginMatcher)(),this._temporaryCanvasTeaParams={};let{start:m,end:_}=g();m(),(0,c.getChatStore)("chatViewCanvasStore").setState((0,o.produce)(e=>{e.conversationId=i,e.messageId=n,e.preRenderNodeId=v,e.canvasLayoutState=r,e.canvasContent=d,e.openingRect=t,e.matchedCanvasPluginIdentifier=l})),l||await this._refreshCanvasMatchedPlugin(h),await this._refreshCanvasTypeForPlugin(),(0,c.getChatStore)("chatViewCanvasStore").setState((0,o.produce)(e=>{e.isExpand=!0})),_().then(e=>{let{normalJunkRate:t,seriousJunkRate:a}=e,{matchedCanvasPluginIdentifier:n}=(0,c.getChatSlice)("chatViewCanvasStore");y("open",{normalJunkRate:t,seriousJunkRate:a,pluginIdentifier:String(null!=n?n:"")})})}async _refreshCanvasMatchedPlugin(e){let t=await (0,u.getChatCanvasPluginMatcher)();(0,c.getChatStore)("chatViewCanvasStore").setState((0,o.produce)(a=>{let n=t.map(e=>e({messageId:a.messageId||"",conversationId:a.conversationId||"",...a.canvasContent})).find(e=>!!e);n?(a.matchedCanvasPluginIdentifier=n,null==e||e.success({meta:{matchedPluginIdentifier:String(n)}})):null==e||e.errorIfIdle(3e3,{reason:"no match plugin"})}))}async _refreshCanvasTypeForPlugin(){let{matchedCanvasPluginIdentifier:e}=(0,c.getChatSlice)("chatViewCanvasStore");if(e){let t=await (0,v.getChatCanvasPlugin)(e);t&&(this._temporaryCanvasTeaParams={...this._temporaryCanvasTeaParams,canvas_type:t.teaCanvasType})}}createCloseCanvasPanelEvent(){try{let{messageId:e,conversationId:t,canvasLayoutState:a,canvasContent:n,matchedCanvasPluginIdentifier:i,isExpand:r}=(0,c.getChatSlice)("chatViewCanvasStore");return(0,f.createReportEvent)({eventName:"flow_chat_view_close_canvas",meta:{...S(),start_message_id:e,start_conversation_id:t,start_layout_type:(0,p.getCanvasLayoutStateForTea)({canvasLayoutState:a}),start_canvas_enabled:this.canvasEnabled?"1":"0",start_canvas_expanded:r?"1":"0",start_matched_plugin_identifier:i?String(i):void 0,canvas_content_keys:Object.keys(n||{}).join(",")}})}catch(e){return}}closeCanvasPanel(){let{start:e,end:t}=g();e();let a=this.createCloseCanvasPanelEvent();(0,c.getChatStore)("chatViewCanvasStore").setState({isExpand:!1}),this._temporaryCanvasTeaParams={},setTimeout(()=>{(0,c.getChatStore)("chatViewCanvasStore").setState((0,o.produce)(e=>{if(e.isExpand){null==a||a.errorIfIdle(500,{reason:"stoke by other",meta:{stoke_matched_plugin_identifier:e.matchedCanvasPluginIdentifier?String(e.matchedCanvasPluginIdentifier):void 0}});return}e.matchedCanvasPluginIdentifier=void 0,e.openingRect=void 0,e.conversationId=void 0,e.preRenderNodeId=void 0,e.messageId=void 0,e.canvasContent=void 0,null==a||a.success()}))},500),t().then(e=>{let{normalJunkRate:t,seriousJunkRate:a}=e;y("close",{normalJunkRate:t,seriousJunkRate:a,pluginIdentifier:""})})}setCanvasLayoutState(e){(0,c.getChatStore)("chatViewCanvasStore").setState({canvasLayoutState:e})}setTemporaryCanvasTeaParams(e){this._temporaryCanvasTeaParams=(0,s.default)(e)?e(this._temporaryCanvasTeaParams):e}getCanvasTeaParams(){let e=(0,c.getChatSlice)("chatViewCanvasStore"),{canvasContent:t,isExpand:a}=e;return a?{...this._temporaryCanvasTeaParams,layout_type:(0,p.getCanvasLayoutStateForTea)(e),canvas_type:this._temporaryCanvasTeaParams?this._temporaryCanvasTeaParams.canvas_type:void 0,canvas_id:null==t?void 0:t.artifactId,canvas_key:null==t?void 0:t.artifactKey}:{}}constructor({immersiveChatViews:e,canvasPlugins:t}){C(this,"ctx",void 0),C(this,"immersiveStore",(0,i.create)()((0,n.subscribeWithSelector)(()=>({immersive:{},exactImmersiveMode:void 0})))),C(this,"canvasEnabled",!0),C(this,"canvasAutoOpenEnaled",!0),C(this,"_chatViewConfig",void 0),C(this,"_immersiveChatViews",[]),C(this,"_canvasPluginInstances",[]),C(this,"enterImmersiveMode",(e,t)=>{this.immersiveStore.setState({exactImmersiveMode:e,immersive:{[e]:t}})}),C(this,"exitImmersiveMode",()=>{this.immersiveStore.setState({exactImmersiveMode:void 0,immersive:{}})}),C(this,"_temporaryCanvasTeaParams",{}),d.DeprecatedChatEvent.on("chat.service.resetAll",this.resetStore.bind(this)),e&&(this._immersiveChatViews=e.map(e=>new e)),t&&(this._canvasPluginInstances=t.map(e=>new e))}}let b=(0,l.createServiceContainer)(),w=e=>(b.service||(b.service=new P(e)),b.service);class I{get chatViewConfig(){return this._chatViewConfig}constructor(){C(this,"_chatViewConfig",void 0)}}},139435:function(e,t,a){a.d(t,{getCanvasLayoutStateForTea:function(){return r}});var n=a(57392),i=a(214492);let r=function(e){var t,a;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{var e;return"undefined"==typeof document?void 0:null===(e=document.getElementById("root"))||void 0===e?void 0:e.clientWidth},s=null!==(t=e.canvasLayoutState)&&void 0!==t?t:n.CanvasLayoutState.SIDE_PANEL,o=(null!==(a=r())&&void 0!==a?a:1/0)<i.BREAK_POINT_NO_LEFT;switch(s){case n.CanvasLayoutState.SIDE_PANEL:return o?"full_panel":"side_panel";case n.CanvasLayoutState.CANVAS_ONLY:return o?"canvas_only":"side_panel";case n.CanvasLayoutState.FULL_IMMERSIVE:return"full_immersive";case n.CanvasLayoutState.FULL_PANEL:return"full_panel";case n.CanvasLayoutState.NARROW_SIDE_PANEL:return o?"full_panel":"narrow_side_panel";default:return"side_panel"}}}}]);
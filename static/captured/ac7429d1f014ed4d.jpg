"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([["88729"],{773289:function(e,t,n){var o,i,a,r,s,l,d,c;n.d(t,{BotActionType:function(){return v},BotMode:function(){return u},BotRecommendType:function(){return _},BotType:function(){return C},CallMode:function(){return p},FileBizType:function(){return T},PluginAuthType:function(){return h},PrivateStatus:function(){return m}});let v=((o={})[o.CreateConversation=1]="CreateConversation",o[o.ArchiveConversation=2]="ArchiveConversation",o),u=((i={})[i.subject=1]="subject",i[i.guest=2]="guest",i),_=((a={})[a.Choiceness=1]="Choiceness",a[a.Discovery=2]="Discovery",a[a.NotLogin=3]="NotLogin",a[a.ConversationPage=4]="ConversationPage",a[a.ImmersiveMode=5]="ImmersiveMode",a[a.ParticipantPage=6]="ParticipantPage",a[a.ConversationChatMode=7]="ConversationChatMode",a[a.CocoWebNotLogin=8]="CocoWebNotLogin",a[a.ConvRcmdToOldUser=9]="ConvRcmdToOldUser",a[a.ConvRcmdToOldUserReGen=10]="ConvRcmdToOldUserReGen",a),C=((r={})[r.User=0]="User",r[r.Coco=1]="Coco",r[r.GuanFang=2]="GuanFang",r[r.CocoWeb=3]="CocoWeb",r),p=((s={})[s.None=0]="None",s[s.Real=1]="Real",s[s.RealNone=2]="RealNone",s),T=((l={})[l.BIZ_UNKNOWN=0]="BIZ_UNKNOWN",l[l.BIZ_BOT_ICON=1]="BIZ_BOT_ICON",l[l.BIZ_PROFILE_ICON=2]="BIZ_PROFILE_ICON",l[l.BIZ_AUDIO=3]="BIZ_AUDIO",l[l.BIZ_VOICE_ICON=4]="BIZ_VOICE_ICON",l[l.BIZ_BOT_REF_BG_IMAGE_ORIGIN=5]="BIZ_BOT_REF_BG_IMAGE_ORIGIN",l[l.BIZ_BOT_REF_BG_IMAGE_CROP=6]="BIZ_BOT_REF_BG_IMAGE_CROP",l[l.BIZ_BOT_BG_IMAGE=7]="BIZ_BOT_BG_IMAGE",l),h=((d={})[d.Ask=0]="Ask",d[d.Once=1]="Once",d[d.Always=2]="Always",d),m=((c={})[c.Public=1]="Public",c[c.Private=2]="Private",c[c.Unlisted=3]="Unlisted",c)},247722:function(e,t,n){var o;n.d(t,{ConversationType:function(){return i}});let i=((o={})[o.Coco=1]="Coco",o[o.Bot=2]="Bot",o[o.CocoSub=3]="CocoSub",o[o.CocoWeb=4]="CocoWeb",o[o.CocoWebSub=5]="CocoWebSub",o)},327587:function(e,t,n){var o,i;n.d(t,{ConversationIntentionType:function(){return a},CreateScene:function(){return r}});let a=((o={})[o.Default=0]="Default",o[o.Writing=1]="Writing",o[o.ImageGen=2]="ImageGen",o[o.MeetingRecord=3]="MeetingRecord",o[o.AICode=4]="AICode",o[o.Mobile=5]="Mobile",o[o.DeepResearch=6]="DeepResearch",o),r=((i={})[i.Default=0]="Default",i[i.Landing=1]="Landing",i)},458524:function(e,t,n){var o,i,a,r,s,l;n.r(t),n.d(t,{ConnectionType:function(){return d},ContentType:function(){return c},MessageType:function(){return v},MetaType:function(){return u},PushMessageStatus:function(){return _},UserType:function(){return C}});let d=((o={})[o.WebSocket=0]="WebSocket",o[o.HttpChunk=1]="HttpChunk",o[o.Http=2]="Http",o),c=((i={})[i.Text=1]="Text",i[i.Suggest=2]="Suggest",i[i.Music=3]="Music",i[i.WebView=4]="WebView",i[i.Video=5]="Video",i[i.Image=6]="Image",i[i.File=7]="File",i[i.PluginSearchResult=8]="PluginSearchResult",i[i.AwemeVideoList=9]="AwemeVideoList",i[i.Composite=10]="Composite",i[i.Biz=11]="Biz",i[i.Nested=20]="Nested",i[i.VLMData=21]="VLMData",i[i.Card=50]="Card",i[i.BotCard=51]="BotCard",i[i.FormMsg=53]="FormMsg",i[i.CopilotCard=60]="CopilotCard",i[i.DeepSearchCard=61]="DeepSearchCard",i[i.MultiContent=66]="MultiContent",i[i.AggregatedMsg=67]="AggregatedMsg",i[i.LyricsToSongMusic=70]="LyricsToSongMusic",i[i.LyricsToSongLyric=71]="LyricsToSongLyric",i[i.LyricsToSongsMusic=72]="LyricsToSongsMusic",i[i.PagesCard=80]="PagesCard",i[i.Outline=81]="Outline",i[i.PagesIntentionCard=82]="PagesIntentionCard",i[i.AiPPT=83]="AiPPT",i[i.CodeArtifact=84]="CodeArtifact",i[i.Widget=100]="Widget",i[i.DoraRecord=101]="DoraRecord",i[i.Other=800]="Other",i[i.Multi=900]="Multi",i[i.Unsupported=1e3]="Unsupported",i[i.ReadingLoading=2003]="ReadingLoading",i[i.VideoGeneration=2021]="VideoGeneration",i[i.CreationMulti=2022]="CreationMulti",i[i.Block=9999]="Block",i[i.Block_Text=1e4]="Block_Text",i[i.Block_RESEARCH_CARD=10001]="Block_RESEARCH_CARD",i[i.Block_Code_Assistant_Process=10022]="Block_Code_Assistant_Process",i[i.Block_Requirement_Clarify=10023]="Block_Requirement_Clarify",i),v=((a={})[a.Message=1]="Message",a[a.Ack=2]="Ack",a[a.Loading=3]="Loading",a),u=((r={})[r.DesktopSearchRelatedWebCard=-11]="DesktopSearchRelatedWebCard",r[r.DesktopGrammarCorrection=-10]="DesktopGrammarCorrection",r[r.DesktopTimeStampReference=-9]="DesktopTimeStampReference",r[r.DesktopResourceContentReference=-8]="DesktopResourceContentReference",r[r.DesktopPodcastTranscript=-7]="DesktopPodcastTranscript",r[r.WebTranslateCardContext=-6]="WebTranslateCardContext",r[r.WebVideoSummary=-5]="WebVideoSummary",r[r.WebDocReference=-4]="WebDocReference",r[r.WebAcademicPreview=-3]="WebAcademicPreview",r[r.WebAcademicReference=-2]="WebAcademicReference",r[r.WebPluginReference=-1]="WebPluginReference",r[r.Replaceable=1]="Replaceable",r[r.Insertable=2]="Insertable",r[r.DocumentRef=3]="DocumentRef",r[r.KnowledgeCard=4]="KnowledgeCard",r[r.MetaPlaceHolder=5]="MetaPlaceHolder",r[r.EmbeddedMultiMedia=100]="EmbeddedMultiMedia",r[r.MetaTypeAlaCard=101]="MetaTypeAlaCard",r[r.CommonCard=102]="CommonCard",r[r.Think=103]="Think",r[r.BrandSuperscript=104]="BrandSuperscript",r[r.CodeAssistantFilePath=200]="CodeAssistantFilePath",r),_=((s={})[s.Available=1]="Available",s[s.InVisible=2]="InVisible",s[s.Broken=3]="Broken",s[s.Streaming=4]="Streaming",s[s.Unselected=5]="Unselected",s[s.NotCompliant=6]="NotCompliant",s),C=((l={})[l.Human=1]="Human",l[l.Bot=2]="Bot",l)},815105:function(e,t,n){n.d(t,{isEnableIMPlatform:function(){return c}});var o=n(229079),i=n(368107),a=n(260443),r=n(698392),s=n(910214);let l=async()=>{let e=await new Promise(e=>(0,r.getChatStore)("launcherRawSettingStore").subscribe(e=>({status:e.settingStatus,data:e.settingData}),t=>{let{status:n,data:o}=t,a=setTimeout(()=>{e(void 0)},5e3);n===i.LaunchStatus.Success&&(clearTimeout(a),e(o))},{fireImmediately:!0}));return"true"===(0,o.default)(e,"ab_config.ab_results.enable_im_platform")},d=async()=>{try{var e,t,n;let o=await s.samanthaApiService.GetAB({ab_request:{enable_im_platform:{parmas:["enable_im_platform","value"],ignore_login_status:!0}}});return(null!==(n=null==o?void 0:null===(t=o.data)||void 0===t?void 0:null===(e=t.ab_results)||void 0===e?void 0:e.enable_im_platform)&&void 0!==n?n:"")==="true"}catch(e){return!1}},c=async()=>{if(function(){if("undefined"==typeof window)return null;let{pathname:e}=window.location;return e&&e.startsWith("/code")?a.IndependentSite.Code:null}()===a.IndependentSite.Code)return!0;try{return await l()}catch(e){return await d()}}},58096:function(e,t,n){n.d(t,{mapImMessageBodyToAlicePushMessage:function(){return l}});var o=n(82760),i=n(458524),a=n(165482);let r=e=>{if(e!==o.ContentType.UNSPECIFIED&&void 0!==e)return e},s=(e,t)=>{if(e===o.ContentStatus.NORMAL){if(t===o.MessageStatus.MessageStatus_AVAILABLE)return i.PushMessageStatus.Available;if(t===o.MessageStatus.MessageStatus_UNSELECTED)return i.PushMessageStatus.Unselected;if(t===o.MessageStatus.MessageStatus_NotCompliant)return i.PushMessageStatus.NotCompliant}return e===o.ContentStatus.INTERRUPT&&t===o.MessageStatus.MessageStatus_AVAILABLE?i.PushMessageStatus.Broken:e===o.ContentStatus.CONTENT_IN_STREAMING&&t===o.MessageStatus.MessageStatus_AVAILABLE?i.PushMessageStatus.Streaming:i.PushMessageStatus.InVisible},l=e=>{var t,n,l,d;return{bot_id:null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t.bot_id,conversation_id:null==e?void 0:e.conversation_id,local_conversation_id:null==e?void 0:e.local_conversation_id,section_id:null==e?void 0:e.section_id,message_id:null==e?void 0:e.message_id,local_message_id:null==e?void 0:e.local_message_id,index:null==e?void 0:e.index_in_conv,sender:null==e?void 0:e.sender_id,sec_sender:null==e?void 0:e.sec_sender,reply_id:null==e?void 0:e.bot_reply_message_id,create_time:null==e?void 0:e.create_time,message_type:void 0,content_type:r(null==e?void 0:e.content_type),content:null==e?void 0:e.content,display_content:null==e?void 0:e.content,reference_info:(null==e?void 0:e.reference_info)?{...null==e?void 0:e.reference_info,content_type:r(null==e?void 0:null===(n=e.reference_info)||void 0===n?void 0:n.content_type)}:void 0,ext:null==e?void 0:e.ext,feedback:null==e?void 0:e.feedback_type,tts_content:null==e?void 0:e.tts_content,next_connection_type:i.ConnectionType.WebSocket,chunk_seq:void 0,is_delta:void 0,update_time:null==e?void 0:e.update_time,biz_content_key:null==e?void 0:e.biz_content_type,user_type:(null==e?void 0:e.user_type)===o.UserType.USER_TYPE_UNKNOWN?void 0:null==e?void 0:e.user_type,token:null==e?void 0:e.token,content_block:null==e?void 0:e.content_block,status:s(null==e?void 0:e.content_status,null==e?void 0:e.status),meta_infos:(null==e?void 0:null===(l=e.ext)||void 0===l?void 0:l.meta_info)?(0,a.parseJSON)(null==e?void 0:null===(d=e.ext)||void 0===d?void 0:d.meta_info,[]):void 0}}},849049:function(e,t,n){n.d(t,{getUnlinkMessage:function(){return i}});var o=n(611833);let i=e=>({...e,sequence_id:(0,o.default)(),channel:2,version:"1"})},430896:function(e,t,n){n.d(t,{createServiceContainer:function(){return o}});function o(){let e={service:null};return{get(t,n){var o,i;let a=null===(i=e.service)||void 0===i?void 0:null===(o=i.ctx)||void 0===o?void 0:o[t];if(!a&&!n)throw Error(`target service [${t}] not found`);return a},get service(){return e.service},set service(service){e.service=service}}}},918952:function(e,t,n){var o,i;n.d(t,{CreateConversationFailReason:function(){return r},CreateConversationStatus:function(){return a}});let a=((o={}).Pending="Pending",o.Creating="Creating",o.Done="Done",o.Failed="Failed",o),r=((i={}).ReachLimit="reach_limit",i)},307481:function(e,t,n){n.d(t,{IMCMD:function(){return o}});var o={IMCMD_NOT_USED:0,IMCMD_COMMON:10,SEND_MESSAGE:100,SEND_MESSAGE_LIST:110,APP_ACTION:120,MATERIAL_UPLOAD:150,NEW_MSG_NOTIFY:200,FETCH_CHUNK_MESSAGE:300,CHUNK_UPDATE:310,SUMMON_BOT:400,PUll_CHAIN_MESSAGE:3e3,PULL_SINGLE_CHAIN:3100,BATCH_PULL_SINGLE_CHAIN:3101,PULL_RECENT_CONV_CHAIN:3200,PULL_CMD_CHAIN:3300,MARK_CONVERSATION_READ:2100,CLEAR_MSG_CONTEXT:2101,CLEAR_MSG_HISTORY:2202,BATCH_UPDATE_MSG_STATUS:2210,UPDATE_MSG_CONTENT:2211,FEEDBACK_MSG:2220,REGENERATE_MSG:2230,FIX_REGENERATE_MSG:2231,SWITCH_REGENERATE_MSG:2232,BREAK_MSG:2240,RETRY_BOT_REPLY_MSG:2250,CHECK_MESSAGE_SEND_RATE_LIMIT:2260,MULTI_PUT_MESSAGE_IN:2300,MULTI_PUT_MESSAGE_OUT:2310,LOCAL_MESSAGE_SYNC:2400,SYNC_UPDATE_MSG_INFO:2500,CREATE_CONVERSATION:1100,GET_CONVERSATION_INFO:1110,BATCH_GET_CONVERSATION_INFO:1111,OPERATE_CONVERSATION:1120,DELETE_USER_CONVERSATION:1121,DISSOLVE_CONVERSATION:1122,UPDATE_CONVERSATION:1123,CONVERSATION_AUTO_GEN:1130,ADD_CONVERSATION_PARTICIPANT:4100,DEL_CONVERSATION_PARTICIPANT:4110,DELETE_CONVERSATION_PARTICIPANT:4111,GET_CONVERSATION_PARTICIPANT:4120,UPDATE_CONVERSATION_NAME:4150,BATCH_GET_CONVERSATION_PARTICIPANTS:4160,UPDATE_CONVERSATION_PARTICIPANT:4170,BATCH_DELETE_USER_CONVERSATION:4171,UPDATE_CONVERSATION_CREATE_SCENE:4172,OPERATE_CELL:4173,REPORT_CONSISTENCY_DATA:4174,COUNT_CONVERSATION:4176,CONVERSATION_OUT:4200,CONVERSATION_IN:4210,AUTO_SPEAK:4230,BATCH_VERIFY_CONVERSATION_CONSISTENCY:4240,UPDATE_SECTION:4300,UPDATE_CONVERSATION_PARTICIPANT_NOTIFY:50001,UPDATE_CONVERSATION_INFO_NOTIFY:50002,OPERATE_CONVERSATION_NOTIFY:50003,REFRESH_PARTICIPANT_INFO_NOTIFY:50004,UPDATE_CONVERSATION_NAME_NOTIFY:50005,CLEAR_MSG_CONTEXT_NOTIFY:50010,CLEAR_MSG_HISTORY_NOTIFY:50020,MARK_READ_NOTIFY:50030,RED_DOT_NOTIFY:50031,UPDATE_MSG_STATUS_NOTIFY:50040,SUGGEST_QUESTION_UPDATE_NOTIFY:50050,DELETE_USER_CONVERSATION_NOTIFY:50060,DELETE_PARTICIPANTS_NOTIFY:50062,FEEDBACK_MSG_NOTIFY:50070,PULL_MSG_NOTIFY:50080,FIX_REGENERATE_MSG_NOTIFY:50090,BREAK_STREAM_MSG_NOTIFY:50100,DISSOLVE_CONVERSATION_NOTIFY:50110,BOT_REPLY_LOADING_UPDATE_NOTIFY:50200,CANCEL_FOLLOW_NOTIFY:50300,REPLY_END:50400,UPDATE_MESSAGE_ATTR:50041,UPDATE_MSG:50042,OPEN_FULL_DUPLEX_Call:50500,UPDATE_SECTION_NOTIFY:50600,CELL_INFO_UPDATE:50700,OAUTH_RESULT:50800,USER_BAN:60001,USER_BAN_RELEASE:60002,USER_LOGOUT:60003,USER_CONFIG_UPDATE:60010,NEED_LOCATION:60020,USER_PENALTY_CHANGE_NOTIFY:80001,CONVERSATION_PENALTY_CHANGE_NOTIFY:80002,IN_APP_BANNER_NOTIFY:80004,SSE_HEARTBEAT:100001,SSE_ACK:100010,STREAM_MSG_NOTIFY:100011,STREAM_CHUNK:100012,FULL_MSG_NOTIFY:100013,SSE_REPLY_END:100005,STREAM_ERROR:100006,STREAM_TIMEOUT_CONTROL:100007,FETCH_STREAM:100008}},260443:function(e,t,n){n.d(t,{ConversationScene:function(){return a},IndependentSite:function(){return o},SceneType:function(){return i}});var o={Code:0},i={Common:0,LoadingHistory:1},a={Default:0,CASE:1,Evaluate:2,BotToken:3,Samantha:4}},101874:function(e,t,n){n.d(t,{AttachmentEnum:function(){return v},ContentSource:function(){return a},ErrorCode:function(){return c},LocalMessageStatus:function(){return l},MessageFrom:function(){return d},MessageLoadingMachineAction:function(){return r},MessageLoadingMachineState:function(){return s},PcchatExprConversationType:function(){return u},RichMediaCardType:function(){return C},SearchMessageContentTags:function(){return _}});var o,i,a={Original:"original",UseTemplate:"use_template",ChangeTemplate:"change_template",Paste:"paste",Other:"other",NotMessage:"notMessage"};let r=((o={})[o.StartThink=0]="StartThink",o[o.StartText=1]="StartText",o[o.StartReference=2]="StartReference",o[o.EndThink=3]="EndThink",o),s=((i={})[i.Init=-1]="Init",i[i.ThinkStart=5]="ThinkStart",i[i.Text=1]="Text",i[i.Reference=3]="Reference",i[i.ThinkEnd=6]="ThinkEnd",i);var l={Preprocessing:"preprocessing",PreprocessFailed:"preprocessFailed",Sending:"sending",WaitingAck:"waitingAck",ReceivingFirstPackage:"receivingFirstPackage",ReceivingStream:"receivingStream",SendingRegenerate:"sendingRegenerate",Timeout:"timeout",StreamingTimeout:"streamingTimeout",SentInLocalConversation:"SentInLocalConversation",SentAndCreateConversationFailedInLocalConversation:"SentAndCreateConversationFailedInLocalConversation",SafetyError:"SafetyError",Broken:"Broken"},d={Unknown:"Unknown",Api:"Api",AliceChatSocket:"AliceChatSocket",AliceChatStream:"AliceChatStream",AliceChatFallback:"AliceChatFallback",SamanthaChat:"SamanthaChat",AsyncFetch:"AsyncFetch",AsyncTask:"AsyncTask",LocalLLM:"LocalLLM"},c={FetchFailed:1001,ResponseIsInvalid:1002,StreamParseFailed:1003,ServerError:1004,AbortFetch:1005},v={Unknown:"unknown",File:"file",Image:"image",Text:"text",Link:"link",Directory:"directory",VlmImage:"vlm_image",ResourceContent:"resource_content",Video:"video",Audio:"audio"},u={Coco:1,Bot:2,CocoSub:3,CocoWeb:4,CocoWebSub:5,LocalLLM:1e3},_={ThinkReasonR1:"11000201",ThinkExpand:"11000301"},C={OnlyImage:3,OnlyVideo:2}},368107:function(e,t,n){var o;n.d(t,{LaunchStatus:function(){return i}});let i=((o={})[o.NotStarted=0]="NotStarted",o[o.Loading=1]="Loading",o[o.Success=2]="Success",o[o.Failed=3]="Failed",o)},266035:function(e,t,n){n.d(t,{getConversationApiClient:function(){return K}});var o=n(815105),i=n(678669),a=n(82760),r=n(910214),s=n(178230),l=n(58096),d=n(247722),c=n(773289),v=n(165482);let u=e=>{switch(e){case a.BotConversationType.COCO:return d.ConversationType.Coco;case a.BotConversationType.BOT:return d.ConversationType.Bot;case a.BotConversationType.COCO_SUB:return d.ConversationType.CocoSub;default:return}},_=e=>{switch(e){case d.ConversationType.Coco:return a.BotConversationType.COCO;case d.ConversationType.Bot:return a.BotConversationType.BOT;case d.ConversationType.CocoSub:return a.BotConversationType.COCO_SUB;default:return a.BotConversationType.BOT_TYPE_UNKNOWN}},C=e=>{switch(e){case a.BotType.BotType_Unknown:return;case a.BotType.BotType_User:return c.BotType.User;case a.BotType.BotType_Coco:return c.BotType.Coco;case a.BotType.BotType_GuanFang:return c.BotType.GuanFang;case a.BotType.BotType_CocoWeb:return c.BotType.CocoWeb;default:return}},p=(e,t)=>{var n;if(e)return Object.assign({},e,{conversation_id:null==e?void 0:e.conversation_id,conversation_type:u(null==e?void 0:e.bot_type),message_cursor:null==e?void 0:e.msg_cursor,message_index:null==e?void 0:e.latest_index,cmd_index:void 0,last_section_id:null==e?void 0:e.last_section_id,icon_url:null==t?void 0:t.icon_url,name:null==e?void 0:e.name,bot_id:null==t?void 0:t.id,tags:"Doubao",local_conversation_id:null==e?void 0:e.local_conversation_id,update_time:null==e?void 0:e.update_time,deleted:null==e?void 0:e.is_deleted,pinned:null==e?void 0:e.pinned_time,icon_image:null==t?void 0:null===(n=t.icon_image)||void 0===n?void 0:n.raw_image,bot_creator_info:null==t?void 0:t.creator_info,read_message_index:null==e?void 0:e.last_read_index,conversation_page:void 0,retention_cursor:null==e?void 0:e.retention_cursor,bot_disable_tag:null==t?void 0:t.disabled_tag,bot_type:C(null==t?void 0:t.real_bot_type),bg_img_url:null==t?void 0:t.bg_img_url,bg_img_avg_hue:null==t?void 0:t.bg_img_avg_hue,bot_conversation_type:void 0,content_dist_type:void 0,default_onboarding:null==e?void 0:e.default_onboarding,extra:null==e?void 0:e.extra,badge_count:null==e?void 0:e.badge_count,read_badge_count:null==e?void 0:e.read_badge_count})},T=e=>e===a.PrivateStatus.Public?c.PrivateStatus.Public:e===a.PrivateStatus.Private?c.PrivateStatus.Private:e===a.PrivateStatus.Unlisted?c.PrivateStatus.Unlisted:void 0,h=e=>e===a.BotMode.BotMode_Subject?c.BotMode.subject:e===a.BotMode.BotMode_Guest?c.BotMode.guest:void 0,m=e=>e===a.BotActionType.ArchiveConversation?c.BotActionType.ArchiveConversation:e===a.BotActionType.CreateConversation?c.BotActionType.CreateConversation:void 0,g=e=>{var t,n,o,i,a,r,s,d,c,v,u,_,p,g,S;if(e)return{...e,bot_type:C(null==e?void 0:e.real_bot_type),icon_image:{uri:null==e?void 0:null===(t=e.icon_image)||void 0===t?void 0:t.key,tiny_url:null==e?void 0:null===(o=e.icon_image)||void 0===o?void 0:null===(n=o.image_thumb)||void 0===n?void 0:n.url,origin_url:null==e?void 0:null===(a=e.icon_image)||void 0===a?void 0:null===(i=a.image_ori)||void 0===i?void 0:i.url},creator_info:{...null==e?void 0:e.creator_info,creator_avatar:{uri:null==e?void 0:null===(s=e.creator_info)||void 0===s?void 0:null===(r=s.creator_avatar)||void 0===r?void 0:r.key,tiny_url:null==e?void 0:null===(v=e.creator_info)||void 0===v?void 0:null===(c=v.creator_avatar)||void 0===c?void 0:null===(d=c.image_thumb)||void 0===d?void 0:d.url,origin_url:null==e?void 0:null===(p=e.creator_info)||void 0===p?void 0:null===(_=p.creator_avatar)||void 0===_?void 0:null===(u=_.image_ori)||void 0===u?void 0:u.url}},private_status:T(null==e?void 0:e.private_status),onboarding:{...null==e?void 0:e.onboarding,message_list:null==e?void 0:null===(S=e.onboarding)||void 0===S?void 0:null===(g=S.message_list)||void 0===g?void 0:g.map(l.mapImMessageBodyToAlicePushMessage)},bot_mode:h(null==e?void 0:e.bot_mode),action:(null==e?void 0:e.action)?{action_path:e.action.action_path,action_type:m(e.action.action_type)}:void 0,conversation_page:void 0}},S=e=>{var t,n;if(e)return{conversation_type:u(null==e?void 0:e.bot_type),conversation_id:null==e?void 0:e.conversation_id,message_cursor:null==e?void 0:e.user_msg_cursor,message_index:null==e?void 0:e.latest_index,cmd_index:void 0,last_section_id:null==e?void 0:e.last_section_id,icon_url:null==e?void 0:e.icon_url,name:null==e?void 0:e.name,bot_id:null==e?void 0:e.bot_id,tags:null==e?void 0:e.tags,update_time:null==e?void 0:e.update_time,pinned:!!(null==e?void 0:e.pinned_time),icon_image:(null==e?void 0:e.image)?{uri:e.image.key,tiny_url:null===(t=e.image.image_thumb)||void 0===t?void 0:t.url,origin_url:null===(n=e.image.image_ori)||void 0===n?void 0:n.url}:void 0,read_message_index:null==e?void 0:e.last_read_index,retention_cursor:void 0,bot_conversation_type:void 0,badge_count:null==e?void 0:e.badge_count,read_badge_count:null==e?void 0:e.read_badge_count}},f=e=>{var t,n,o,i;let a=null===(n=e.conversation)||void 0===n?void 0:null===(t=n.conv_extra)||void 0===t?void 0:t.flowpc_thread_source,r=(0,v.parseJSON)(a,void 0),s=S(e.conversation);return{thread_id:e.id,thread_source:r,conversation:{...s,bot_conversation_type:void 0,intention_type:null==e?void 0:null===(i=e.conversation)||void 0===i?void 0:null===(o=i.conv_extra)||void 0===o?void 0:o.samantha_intention_type,conversation_type:null==s?void 0:s.conversation_type}}},y=e=>{var t,n,o,i,a,r;if(!e)return;let s=null===(n=e.conversation)||void 0===n?void 0:null===(t=n.conv_extra)||void 0===t?void 0:t.flowpc_thread_source;return{thread_source:(0,v.parseJSON)(s,void 0),thread_id:e.id,can_chat:(null===(i=e.conversation)||void 0===i?void 0:null===(o=i.conv_extra)||void 0===o?void 0:o.can_chat)!==void 0?(null===(r=e.conversation)||void 0===r?void 0:null===(a=r.conv_extra)||void 0===a?void 0:a.can_chat)==="true":void 0,conversation:S(e.conversation)}};var I=n(307481),A=n(849049),E=n(39931);let L=async(e,t)=>{let n=(0,A.getUnlinkMessage)({cmd:I.IMCMD.UPDATE_CONVERSATION_NAME,uplink_body:{update_conversation_name_uplink_body:{conversation_id:e,name:t,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT}}});await (0,E.imGatewayClient)({url:"/im/conversation/update_name",method:"POST",data:n})};var b=n(260443);let O=async e=>{var t,n;let o=(0,A.getUnlinkMessage)({cmd:I.IMCMD.CREATE_CONVERSATION,uplink_body:{create_conv_uplink_body:{conversation_type:a.ConversationType.ONE_TO_BOT_CHAT,conversation_scene:b.ConversationScene.Samantha,participant_list:[{user_id:null!==(n=e.bot_id)&&void 0!==n?n:"",user_type:a.UserType.AIBOT}],onboarding_content:null===(t=e.samantha_onboarding)||void 0===t?void 0:t.value,ext:{},source_message_id:"",source_conversation_id:"",local_message_id_list:[],source_message_id_list:[]}}}),{status_code:i,status_desc:r,downlink_body:s}=await (0,E.imGatewayClient)({url:"/im/conversation/create",method:"POST",data:o}),{create_conv_downlink_body:l}=null!=s?s:{},{bot_info:d,conversation_info:c}=null!=l?l:{};return{code:i,msg:r,data:{thread_info:{conversation:p(c,d)},bot_info:g(d)}}},N=async(e,t)=>{let n=(0,A.getUnlinkMessage)({cmd:I.IMCMD.OPERATE_CONVERSATION,uplink_body:{operate_conv_uplink_body:{conversation_id:e,operate_type:t,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT}}}),{status_code:o,status_desc:i}=await (0,E.imGatewayClient)({url:"/im/conversation/operate",method:"POST",data:n});return{code:o,msg:i}},M=async(e,t)=>{let n=(0,A.getUnlinkMessage)({cmd:I.IMCMD.MARK_CONVERSATION_READ,uplink_body:{mark_conv_read_uplink_body:{conversation_id:e,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT,read_index:Number(t)}}}),{status_code:o,status_desc:i}=await (0,E.imGatewayClient)({url:"/im/message/mark_conv_read",method:"POST",data:n});return{code:o,msg:i}},R=async e=>{let{conversation_id:t="",bot_id:n="",ext:o={}}=e,i=(0,A.getUnlinkMessage)({cmd:I.IMCMD.GET_CONVERSATION_INFO,uplink_body:{get_conv_info_uplink_body:{conversation_id:t,ext:o,bot_id:n,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT,option:{need_bot_info:!0}}}}),{status_code:r,status_desc:s,downlink_body:l}=await (0,E.imGatewayClient)({url:"/im/conversation/info",method:"POST",data:i}),{get_conv_info_downlink_body:d}=null!=l?l:{},{conversation_info:c,bot_info:v}=null!=d?d:{};return{code:r,msg:s,data:{conversation:p(c,v),bot_info:g(v)}}},B=async e=>{let t=(0,A.getUnlinkMessage)({cmd:I.IMCMD.CREATE_CONVERSATION,uplink_body:{create_conv_uplink_body:{source_message_id:"",source_conversation_id:"",conversation_type:a.ConversationType.ONE_TO_BOT_CHAT,ext:{},participant_list:[],local_message_id_list:[],source_message_id_list:[],token:e.token,conversation_scene:b.ConversationScene.BotToken}}}),{status_code:n,status_desc:o,downlink_body:i}=await (0,E.imGatewayClient)({url:"/im/conversation/create",method:"POST",data:t}),{create_conv_downlink_body:r}=null!=i?i:{},{conversation_info:s}=null!=r?r:{};return{code:n,msg:o,data:{conversation:p(s,void 0)}}},P=async()=>{let e=(0,A.getUnlinkMessage)({cmd:I.IMCMD.COUNT_CONVERSATION,uplink_body:{conversation_count_uplink_body:{}}}),{status_code:t,status_desc:n,downlink_body:o}=await (0,E.imGatewayClient)({url:"/im/conversation/count",method:"POST",data:e});return{code:t,msg:n,data:null==o?void 0:o.conversation_count_downlink_body}},k=async e=>{let t=(0,A.getUnlinkMessage)({cmd:I.IMCMD.CLEAR_MSG_HISTORY,uplink_body:{clear_msg_history_uplink_body:{conversation_id:e,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT}}}),{status_code:n,status_desc:o}=await (0,E.imGatewayClient)({url:"/im/message/clear_history",method:"POST",data:t});return{code:n,msg:o}},x=async e=>{let t=(0,A.getUnlinkMessage)({cmd:I.IMCMD.CLEAR_MSG_CONTEXT,uplink_body:{clear_msg_context_uplink_body:{conversation_id:e,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT,scene_type:b.SceneType.Common}}}),{status_code:n,status_desc:o,downlink_body:i}=await (0,E.imGatewayClient)({url:"/im/message/clear_context",method:"POST",data:t}),{clear_msg_context_downlink_body:r}=null!=i?i:{},{new_section_id:s}=null!=r?r:{};return{code:n,msg:o,data:{section_id:s}}},F=async e=>{let{conv_version:t,option:n,...o}=e,i=Number(t),r=(0,A.getUnlinkMessage)({cmd:I.IMCMD.PULL_RECENT_CONV_CHAIN,uplink_body:{pull_recent_conv_chain_uplink_body:{...o,api_version:Number("1"),conv_version:i,direction:0===i?a.MessageDirection.FROM_LATEST:a.MessageDirection.OLDER,option:{not_need_message:!0,need_complete_conversation:!0,need_coco_conversation:0===i,need_coco_bot:0===i,...n}}}}),{status_code:s,status_desc:l,downlink_body:d}=await (0,E.imGatewayClient)({url:"/im/chain/recent_conv",method:"POST",data:r}),{pull_recent_conv_chain_downlink_body:c}=null!=d?d:{},{cells:v,has_more:u,next_conv_version:_,extra:C}=null!=c?c:{};return{code:s,msg:l,data:{has_more:u,next_cursor:_,cells:v,extra:C}}},w=async(e,t)=>{let n=(0,A.getUnlinkMessage)({cmd:I.IMCMD.BATCH_DELETE_USER_CONVERSATION,uplink_body:{batch_delete_user_conversation_uplink_body:{conversation_id:e,delete_all:t,conversation_type:a.ConversationType.ONE_TO_BOT_CHAT}}});await (0,E.imGatewayClient)({url:"/im/conversation/batch_del_user_conv",method:"POST",data:n})};function D(e,t,n){var o;return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:o+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class U{constructor(){D(this,"getConversationList",async e=>{var t,n,o,i,r,l,d,c,v,u;let C={conv_version:null!==(r=e.cursor)&&void 0!==r?r:"",limit:Number(null!==(l=e.batch_size)&&void 0!==l?l:50),filter:e.conversation_types?{conversation_type:e.conversation_types.map(e=>_(e))}:void 0,message_count_per_conv:10,option:{need_pc_pin_chain:!0,pc_pin_query_type:null!==(d=e.pc_pin_query_type)&&void 0!==d?d:a.PcPinQueryType.QueryPin}},{code:p,msg:T,data:h}=await F(C),{cells:m,has_more:g,next_cursor:S,extra:y}=null!=h?h:{},I=null==m?void 0:m.map(e=>f(e));return(null==I?void 0:I.length)||s.logger.persist.info({eventName:"IM_recent_conv_empty",meta:{conv_version:C.conv_version,limit:C.limit,filter:null===(v=C.filter)||void 0===v?void 0:null===(c=v.conversation_type)||void 0===c?void 0:c.join(","),message_count_per_conv:C.message_count_per_conv,pc_pin_query_type:null===(u=C.option)||void 0===u?void 0:u.pc_pin_query_type}}),{code:p,msg:T,data:{has_more:g,next_cursor:S,thread_list:I,pc_pin_query_type:null==y?void 0:y.pc_pin_query_type,samantha_bot:(null==y?void 0:null===(t=y.extra)||void 0===t?void 0:t.coco_bot_id)?{bot_id:null==y?void 0:null===(n=y.extra)||void 0===n?void 0:n.coco_bot_id,name:null==y?void 0:null===(o=y.extra)||void 0===o?void 0:o.coco_bot_name,icon_url:null==y?void 0:null===(i=y.extra)||void 0===i?void 0:i.coco_bot_icon_url}:void 0}}}),D(this,"getTouristConversationList",async()=>{var e,t,n,o,i,r,s,l,d,c,v,u;let{code:_,msg:C,data:p}=await F({conv_version:0,limit:10,message_count_per_conv:10}),{cells:T,has_more:h,next_cursor:m,extra:g}=null!=p?p:{},S=(null!==(u=null==T?void 0:T.filter(e=>{var t;return(null===(t=e.conversation)||void 0===t?void 0:t.bot_type)!==a.BotConversationType.COCO}))&&void 0!==u?u:[]).map(e=>y(e)).filter(e=>void 0!==e);return{code:_,msg:C,data:{main_thread:y(null==T?void 0:T.find(e=>{var t;return(null===(t=e.conversation)||void 0===t?void 0:t.bot_type)===a.BotConversationType.COCO})),threads:{has_more:h,next_cursor:m,thread_list:S},samantha_bot:(null==g?void 0:null===(e=g.extra)||void 0===e?void 0:e.coco_bot_id)?{bot_id:null==g?void 0:null===(t=g.extra)||void 0===t?void 0:t.coco_bot_id,name:null==g?void 0:null===(n=g.extra)||void 0===n?void 0:n.coco_bot_name,icon_url:null==g?void 0:null===(o=g.extra)||void 0===o?void 0:o.coco_bot_icon_url}:void 0,can_chat:(null==g?void 0:null===(i=g.extra)||void 0===i?void 0:i.can_chat)!==void 0?(null==g?void 0:null===(r=g.extra)||void 0===r?void 0:r.can_chat)==="true":void 0,can_create_thread:(null==g?void 0:null===(s=g.extra)||void 0===s?void 0:s.can_create_thread)!==void 0?(null==g?void 0:null===(l=g.extra)||void 0===l?void 0:l.can_create_thread)==="true":void 0,can_send_message:(null==g?void 0:null===(d=g.extra)||void 0===d?void 0:d.can_send_message)!==void 0?(null==g?void 0:null===(c=g.extra)||void 0===c?void 0:c.can_send_message)==="true":void 0,reply_limit:null==g?void 0:null===(v=g.extra)||void 0===v?void 0:v.reply_limit}}}),D(this,"getConversationInfo",async e=>R(e)),D(this,"getConversationBasicInfo",async e=>{let{conversation_id:t}=e;return await R({conversation_id:t})}),D(this,"updateConversationInfo",e=>{let{conversation_id:t,name:n}=e;return L(t,null!=n?n:"")}),D(this,"deleteConversation",e=>{let{conversation_ids:t,delete_all:n}=e;return w(null!=t?t:[],null!=n&&n)}),D(this,"conversationInfoAddBot",e=>B(e)),D(this,"getConversationCount",async()=>P()),D(this,"markConversationRead",e=>{var t,n;return M(null!==(t=e.conversation_id)&&void 0!==t?t:"",String(null!==(n=e.latest_read_idx)&&void 0!==n?n:""))}),D(this,"clearConversationHistory",e=>{var t;return k(null!==(t=e.conversation_id)&&void 0!==t?t:"")}),D(this,"clearConversationContext",e=>{var t;return x(null!==(t=e.conversation_id)&&void 0!==t?t:"")}),D(this,"pin",async e=>{let{conversation_id:t}=e;return N(t,a.ConvOperateType.TOP)}),D(this,"unpin",e=>{let{conversation_id:t}=e;return N(t,a.ConvOperateType.CANCEL_TOP)}),D(this,"getFeed",()=>this.getTouristConversationList()),D(this,"threadCreate",async e=>O(e)),D(this,"getThreadShareInfo",async e=>{let t=(0,i.default)(e,["thread_id"]);return await r.samanthaApiService.GetThreadShareInfo(t)}),D(this,"saveThreadShareInfo",async e=>{let t=(0,i.default)(e,["thread_id"]);return await r.samanthaApiService.SaveThreadShareInfo(t)}),D(this,"createCollection",async e=>{var t;return(null==e?void 0:null===(t=e.collection)||void 0===t?void 0:t.thread)&&(e.collection.thread.thread_id="0"),await r.samanthaApiService.CreateCollection(e)})}}var G=n(721118),V=n(230932),W=n(389174);function H(e,t,n){var o;return(t="symbol"==typeof(o=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?o:o+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Y{constructor(){H(this,"getConversationList",async e=>await r.samanthaImApiService.AGWConversationList(e)),H(this,"getTouristConversationList",async()=>await r.samanthaApiService.GetTouristFeed()),H(this,"getConversationInfo",async e=>await r.conversationApiService.ConversationInfo(e)),H(this,"getConversationBasicInfo",async e=>await r.samanthaImApiService.AGWConversationBasicInfo(e)),H(this,"updateConversationInfo",async e=>{let{conversation_id:t,name:n}=e,o=(0,G.conversationSelector)(V.useFeedStore.getState(),t);(0,W.isCocoSubConversation)(o)?await r.samanthaApiService.ThreadUpdate({conversation_id:t,name:n}):await r.conversationApiService.ConversationUpdate({conversation_id:t,name:n})}),H(this,"deleteConversation",async e=>{let{conversation_ids:t,delete_all:n}=e;if(n)await r.samanthaImApiService.AGWBatchDeleteConversation({delete_all:!0});else if((null==t?void 0:t.length)===1){let e=(0,G.conversationSelector)(V.useFeedStore.getState(),t[0]);(0,W.isCocoSubConversation)(e)?await r.samanthaApiService.ThreadDelete({conversation_id:t[0]}):await r.conversationApiService.ConversationArchive({conversation_id:t[0]})}else await r.samanthaImApiService.AGWBatchDeleteConversation({conversation_ids:t})}),H(this,"conversationInfoAddBot",async e=>await r.conversationApiService.ConversationInfoAddBot(e)),H(this,"getConversationCount",async()=>await r.samanthaImApiService.AGWGetConversationCount()),H(this,"markConversationRead",async e=>r.conversationApiService.MarkConversationRead(e)),H(this,"clearConversationHistory",async e=>r.conversationApiService.ConversationClear(e)),H(this,"clearConversationContext",async e=>r.conversationApiService.CreateSection(e)),H(this,"pin",async e=>{let{conversation_id:t}=e;return r.samanthaImApiService.AGWConversationPin({conversation_id:t})}),H(this,"unpin",async e=>{let{conversation_id:t}=e;return r.samanthaImApiService.AGWConversationUnpin({conversation_id:t})}),H(this,"getFeed",async()=>await r.samanthaApiService.GetFeed()),H(this,"threadCreate",async e=>await r.samanthaApiService.ThreadCreate(e)),H(this,"getThreadShareInfo",async e=>await r.samanthaApiService.GetThreadShareInfo(e)),H(this,"saveThreadShareInfo",async e=>await r.samanthaApiService.SaveThreadShareInfo(e)),H(this,"createCollection",async e=>await r.samanthaApiService.CreateCollection(e))}}let j=async()=>await (0,o.isEnableIMPlatform)()?new U:new Y,K=async()=>j()},884181:function(e,t,n){n.r(t),n.d(t,{ChatFeedService:function(){return s},createChatFeedService:function(){return d},feedServiceContainer:function(){return l}});var o=n(430896),i=n(831566),a=n(230932),r=n(209662);class s{resetStore(){a.useFeedStore.setState(r.defaultConversationState)}constructor(){var e,t,n;t=void 0,(e="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e="ctx","string"))?n:n+"")in this?Object.defineProperty(this,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):this[e]=t,i.DeprecatedChatEvent.on("chat.service.resetAll",this.resetStore.bind(this))}}let l=(0,o.createServiceContainer)(),d=()=>(l.service||(l.service=new s),l.service)},209662:function(e,t,n){n.d(t,{LoadConversationListType:function(){return g.LoadConversationListType},ConversationType:function(){return g.ConversationType},createConversationSlice:function(){return B},createLocalConversationId:function(){return m.createLocalConversationId},defaultConversationState:function(){return R}});var o=n(865607),i=n(788432),a=n(4137),r=n(743893),s=n(554450),l=n(304086),d=n(746479),c=n(101874),v=n(918952),u=n(910214),_=n(247722),C=n(327587),p=n(643404),T=n(393752),h=n(856392),m=n(73270),g=n(6940);let S=(e,t)=>({prevActiveConversationId:null,currentActiveConversationId:null,latestArchivedConversationId:null,setActiveConversation:n=>{let{currentActiveConversationId:o}=t();e({prevActiveConversationId:o,currentActiveConversationId:n})},markLatestArchivedConversationId(t){e({latestArchivedConversationId:t})}});var f=n(831566),y=n(769783),I=n(178230),A=n(389174),E=n(510665),L=n(884181),b=n(266035);let O={conversationMap:{},localConversationMap:{},lastSectionIdMap:{},lastMessageIndexMap:{},actionBarTemplateMap:{}},N=(e,t,n)=>({...O,fetchUpdateConversationInfo:async(e,n)=>{var o,i,a;let{prevActiveConversationId:r}=t(),s=(0,h.createReportEvent)({eventName:"load_conversation_info",meta:{cold_start:!r,conversation_id:e,main_conversation_id:null===(o=t().mainConversationLink)||void 0===o?void 0:o.conversationId,scene:n}});if(null===(i=t().localConversationMap[e])||void 0===i?void 0:i.local){s.error({reason:"local_conversation_id",error:Error("local_conversation_id")});return}try{let{data:n}=await (0,p.retryAsync)(async()=>(await (0,b.getConversationApiClient)()).getConversationInfo({conversation_id:e,ext:r?void 0:{cold_start:"true"}}).then(e=>{var t,n;if(!(null===(n=e.data)||void 0===n?void 0:null===(t=n.conversation)||void 0===t?void 0:t.conversation_id))throw Error("invalid conversationInfo");return e}),3,e=>500*e,e=>{var t;if((0,y.isApiError)(e)&&"710012002"===String(null==e?void 0:null===(t=e.errorOption)||void 0===t?void 0:t.code))throw f.DeprecatedChatEvent.emit("chat.user.logoutToSignIn"),e}),{conversation:o}=n||{};if(!n)throw Error("updateConversationInfo: invalid data from api");return s.addDurationPoint("success"),s.success(),t().updateConversationInfo(n),o}catch(n){throw s.error({reason:"load_conversation_info_failed",error:n,meta:{latest_main_conversation_id:null===(a=t().mainConversationLink)||void 0===a?void 0:a.conversationId,is_in_conversation_map:t().conversationMap[e]?"1":"0"}}),n}},updateConversationInfo:n=>{let o=L.feedServiceContainer.get("chatBotService"),{conversation:i,bot_info:a,msg_templates:r,trace_map:s}=n,{conversation_id:l}=i||{};if(!l||!i||!a){I.logger.persist.warning({message:"invalid conversationInfo to update",meta:{conversation_id:l,bot_id:null==a?void 0:a.bot_id}});return}e((0,d.produce)(e=>{var n,d,c,v,u;let _=e.conversationMap[l];e.conversationMap[l]={...i,name:(null==i?void 0:i.name)||(null==_?void 0:_.name),icon_image:t().isOverallList&&(0,A.isCocoSubConversationType)(i.conversation_type)?null!==(n=null==_?void 0:_.icon_image)&&void 0!==n?n:i.icon_image:null==i?void 0:i.icon_image,thread_source:null==_?void 0:_.thread_source,extra:null!==(d=i.extra)&&void 0!==d?d:null==_?void 0:_.extra,intention_type:null!==(c=null==i?void 0:i.intention_type)&&void 0!==c?c:null==_?void 0:_.intention_type},(null==a?void 0:a.id)&&(null==o||o.updateBot(a)),i.last_section_id&&(e.lastSectionIdMap[l]=i.last_section_id),r&&(e.actionBarTemplateMap[l]=r.map(e=>({...e,req_id:null==s?void 0:s.request_id}))),e.lastMessageIndexMap[l]={message_index:Number(i.message_index)||0,read_message_index:Number(i.read_message_index)||0,read_badge_count:Number(null!==(v=i.read_badge_count)&&void 0!==v?v:i.read_message_index)||0,badge_count:Number(null!==(u=i.badge_count)&&void 0!==u?u:i.message_index)||0}}))},updateThreadConversationToMap:n=>{let{conversation_id:o}=n||{};o&&e((0,d.produce)(e=>{var i,a,r,s;let l=e.conversationMap[o];e.conversationMap[o]={...n,name:(null==n?void 0:n.name)||(null==l?void 0:l.name),icon_image:t().isOverallList&&(0,A.isCocoSubConversationType)(n.conversation_type)?null!==(i=null==l?void 0:l.icon_image)&&void 0!==i?i:n.icon_image:null==n?void 0:n.icon_image,thread_source:null==l?void 0:l.thread_source,extra:null!==(a=n.extra)&&void 0!==a?a:null==l?void 0:l.extra},e.lastMessageIndexMap[o]={message_index:Number(n.message_index)||0,read_message_index:Number(n.read_message_index)||0,read_badge_count:Number(null!==(r=n.read_badge_count)&&void 0!==r?r:n.read_message_index)||0,badge_count:Number(null!==(s=n.badge_count)&&void 0!==s?s:n.message_index)||0}}))},updateLastSectionId:(t,n)=>{e((0,d.produce)(e=>{n&&(e.lastSectionIdMap[t]=n)}))},clearContext:async e=>{var n;let o=await (await (0,b.getConversationApiClient)()).clearConversationContext({conversation_id:e}),i=null==o?void 0:null===(n=o.data)||void 0===n?void 0:n.section_id;i&&t().updateLastSectionId(e,i)},updateConversationMessageIndex(t){let{conversationId:n,messageIndex:o,readMessageIndex:i,badgeCount:a=o,readBadgeCount:r=i}=t;e((0,d.produce)(e=>{let t=e.lastMessageIndexMap[n];t&&a&&Number(t.badge_count)<a&&(t.badge_count=a,t.message_index=o),t&&r&&Number(t.read_badge_count)<r&&(t.read_badge_count=r,t.read_message_index=i)}))},removeConversationFromMap:t=>{let{conversationId:n}=t;e((0,d.produce)(e=>{(0,E.deleteConversationInMap)(e,n)}))},removeConversationsFromMap:t=>{let{conversationIds:n}=t;e((0,d.produce)(e=>{n.forEach(t=>{(0,E.deleteConversationInMap)(e,t)})}))}});var M=n(651610);let R={conversationListStatus:{loading:!0,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1},overallListStatus:{loading:!0,failed:!1,count:0,hasMore:!1,isReload:!1,initiated:!1,nextIndex:""},conversationLinks:[],mainConversationLink:void 0,botConversationIndex:0,threadListStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},threadFeedStatus:{loading:!1,failed:!1,count:0,hasMore:!1,isReload:!1,nextIndex:"",initiated:!1},guestCanChat:!0,chatNotReachLimitMap:{},guestReachCreateThreadLimit:!0,guestReachSendMessageLimit:!1,guestSendMessageLimit:0,chatCreateInFirstTime:{},samanthaBot:{samanthaBotInfo:{},isLazyCreate:!1},isOverallList:!1},B=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let[f,y,I]=t,E=()=>{let{conversationLinks:e,botConversationIndex:t}=y();return e.slice(t)},O=e=>{let{conversationLinks:t,botConversationIndex:n}=y();f({conversationLinks:t.slice(0,n).concat(e)})},B=()=>{let{conversationLinks:e,botConversationIndex:t}=y();return e.slice(0,t)},P=e=>{let{conversationLinks:t,botConversationIndex:n}=y(),o=e.length;f({conversationLinks:e.concat(t.slice(n)),botConversationIndex:o})},k=()=>y().mainConversationLink,x=e=>{f({mainConversationLink:e})},F=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=L.feedServiceContainer.get("chatBotService");t&&e.forEach(e=>{if(e.bot_id&&e.bot_disable_tag){var t,o;let i={bot_id:null==e?void 0:e.bot_id,id:null==e?void 0:e.bot_id,bot_type:null==e?void 0:e.bot_type,disabled_tag:null!==(t=null==e?void 0:e.bot_disable_tag)&&void 0!==t?t:"normal",creator_info:null!==(o=null==e?void 0:e.bot_creator_info)&&void 0!==o?o:{}};(null==n?void 0:n.getBot(e.bot_id))||null==n||n.updateBot(i)}}),f(t=>({conversationMap:e.reduce((e,t)=>{if(t.conversation_id){var n;(null===(n=e[t.conversation_id])||void 0===n?void 0:n.extra)&&!t.extra&&(t.extra=e[t.conversation_id].extra),e[t.conversation_id]=(0,i.default)({},e[t.conversation_id],t)}return e},{...t.conversationMap}),lastMessageIndexMap:e.reduce((e,t)=>{if(t.conversation_id){var n,o;e[t.conversation_id]={message_index:Number(t.message_index)||0,read_message_index:Number(t.read_message_index)||0,badge_count:Number(null!==(n=t.badge_count)&&void 0!==n?n:t.message_index)||0,read_badge_count:Number(null!==(o=t.read_badge_count)&&void 0!==o?o:t.read_message_index)||0}}return e},{...t.lastMessageIndexMap})}))},w=(e,t)=>{let{append:n=!0,ignoreOld:o=!1}=t,i=B(),r=e.map(e=>{var t,n,o,i;return{threadId:null!==(i=null==e?void 0:e.thread_id_str)&&void 0!==i?i:null==e?void 0:null===(t=e.thread_id)||void 0===t?void 0:t.toString(),isLocalConversation:!1,conversationId:(null===(n=e.conversation)||void 0===n?void 0:n.conversation_id)||"",conversationType:null===(o=e.conversation)||void 0===o?void 0:o.conversation_type}}).filter(e=>!(0,a.default)(e.threadId)),s=o?[]:i,l=s.filter(e=>(0,M.isLocalThreadId)(e.threadId));return(0,m.uniqConversationList)(n?[...l,...s,...r]:[...l,...r,...s])},D=(e,t)=>{e.conversationLinks.splice(t,1),t<e.botConversationIndex&&(e.botConversationIndex-=1)},U=(e,t)=>{var n,o,i;let{conversationId:a,originConversationKey:r,index:s,threadId:l,pinOperation:d=!1,isLocalConversation:c=!1,isOverallChatItem:v}=t,u=v||y().isOverallList,_=!!l||!!(null===(n=e.conversationLinks.find(e=>e.conversationId===a))||void 0===n?void 0:n.threadId)||(0,A.isCocoSubConversation)(e.conversationMap[a])||(0,A.isCocoConversation)(e.conversationMap[a]),C=u?y().conversationLinks:_?B():E(),p=C.length,T=-1,h=!1,m=c?null===(o=e.localConversationMap[a])||void 0===o?void 0:o.conversation_type:null===(i=e.conversationMap[a])||void 0===i?void 0:i.conversation_type,S=l,f=p,I=g.ConversationType.Conversation;if(C.forEach((t,n)=>{var o,i;let r=t.isLocalConversation?null===(o=e.localConversationMap[t.conversationId])||void 0===o?void 0:o.pinned:null===(i=e.conversationMap[t.conversationId])||void 0===i?void 0:i.pinned;t.conversationId===a&&(T=n,h=null!=r&&r,m=t.conversationType,S=t.threadId,t.isLocalConversation&&(I=g.ConversationType.LocalConversation)),r||f!==p||(f=n)}),!s)return;if(~T){let t=_||u?T:T+e.botConversationIndex;e.conversationLinks.splice(t,1),f=f>T?f-1:f,_&&(e.botConversationIndex-=1)}let L=I===g.ConversationType.Conversation?e.conversationMap[a]:e.localConversationMap[a];d?(f=h?f:0,L&&(L.pinned=!L.pinned,L.pinned&&(L.update_time=Date.now()/1e3))):(f=h?0:f,L&&(L.update_time=Date.now()/1e3));let b=_||u?f:f+e.botConversationIndex;e.conversationLinks.splice(b,0,{isLocalConversation:c,conversationId:a,originConversationKey:r,conversationType:m,threadId:null==S?void 0:S.toString()}),_&&(e.botConversationIndex+=1)};return{...R,...N(...t),...S(...t),loadConversationList:async e=>{var t,n;let{type:o=[g.LoadConversationListType.Feed,g.LoadConversationListType.Thread,g.LoadConversationListType.Bot],...i}=e,a=(0,r.default)(o),d=(0,h.createReportEvent)({eventName:"load_conversation_list",meta:{type:a.join(","),isRefresh:i.isRefresh,isReload:i.isReload,isInit:!i.isRefresh&&0===i.index,size:i.size,index:i.index,has_cache:(null===(t=y().conversationLinks)||void 0===t?void 0:t.length)||(null===(n=y().mainConversationLink)||void 0===n?void 0:n.conversationId)?"1":"0"}}),c=a.map(e=>{switch(e){case g.LoadConversationListType.Bot:return y().loadBotConversationList(i);case g.LoadConversationListType.Feed:return y().loadThreadFeed(i);case g.LoadConversationListType.Thread:return y().loadThreadList({...i,index:void 0});case g.LoadConversationListType.Guest:return y().loadGuestThreadFeed(i);case g.LoadConversationListType.Overall:return y().loadOverallList({...i,index:void 0});default:return Promise.resolve([])}});try{let e=await Promise.all(c);return d.success(),(0,s.default)((0,l.default)(e),"conversation_id")}catch(e){throw e instanceof Error&&d.error({reason:`loadConversationList failed size:${i.size} index:${i.index} type:${a.join(",")}`,error:e}),e}},loadBotConversationList:async e=>{let{index:t,size:n,isReload:o,isRefresh:i}=e,{conversationListStatus:a}=y(),r=(0,h.createReportEvent)({eventName:"load_bot_conversation_list",meta:{isRefresh:i,isReload:o,size:n,index:t,isInit:!a.initiated}}),s=E(),l=!i&&0===t;f({conversationListStatus:{...a,loading:!0,isReload:!!o}});try{let{data:e}=await (0,p.retryAsync)(()=>u.conversationApiService.ConversationList({index:t,batch_size:n,conversation_types:[_.ConversationType.Bot]}),3,e=>1e3*e);r.addDurationPoint("fetch_success");let{conversation_list:o=[],has_more:a}=e||{};F(o);let d=o.map(e=>({isLocalConversation:!1,conversationId:e.conversation_id||"",conversationType:null==e?void 0:e.conversation_type})).filter(Boolean),c=(0,m.uniqConversationList)(i?[...d,...s]:[...l?[]:s,...d]);return O(c),f(e=>({conversationListStatus:{loading:!1,failed:!1,count:c.length,...i?{hasMore:e.conversationListStatus.hasMore}:{hasMore:a||!1},isReload:!1,initiated:!0}})),r.success(),o}catch(e){throw f(e=>({conversationListStatus:{...e.conversationListStatus,failed:!0,loading:!1}})),e instanceof Error&&r.error({reason:`loadBotConversationList failed size:${n} index:${t}`,error:e}),e}},loadThreadFeed:async function(){var e,t,n,o,i,r,s;let{isReload:l,isRefresh:d=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadFeedStatus:c}=y(),v=(0,h.createReportEvent)({eventName:"load_thread_feed",meta:{isRefresh:d,isReload:l,isInit:!c.initiated,call_chain:null===(e=Error("trace").stack)||void 0===e?void 0:e.split("\n").slice(1,8).map(e=>{var t,n;return null==e?void 0:null===(n=e.trim())||void 0===n?void 0:null===(t=n.replace(/^at /,"- "))||void 0===t?void 0:t.replace(/\(http.*\/static\/js\//,"(/static/js/")}).join("\n")}});f({threadFeedStatus:{...c,loading:!0,isReload:!!l}});try{let{data:e}=await (0,p.retryAsync)(async()=>(await (0,b.getConversationApiClient)()).getFeed(),3,e=>1e3*e);v.addDurationPoint("fetch_success");let{threads:l,main_thread:u}=e||{},{thread_list:_=[],has_more:C,next_index:T}=l||{};u&&x({conversationId:null!==(i=null===(t=u.conversation)||void 0===t?void 0:t.conversation_id)&&void 0!==i?i:"",conversationType:null===(n=u.conversation)||void 0===n?void 0:n.conversation_type,threadId:null!==(s=null!==(r=u.thread_id_str)&&void 0!==r?r:null===(o=u.thread_id)||void 0===o?void 0:o.toString())&&void 0!==s?s:"",isLocalConversation:!1});let h=[null==u?void 0:u.conversation].concat(_.map(e=>e.conversation?{...e.conversation,thread_source:e.thread_source,thread_id:e.thread_id_str||e.thread_id}:void 0)).filter(e=>!(0,a.default)(e));F(h);let m=w(_,{append:!1,ignoreOld:!c.initiated&&!y().threadListStatus.initiated});return P(m),f(e=>{var t;return{threadFeedStatus:{loading:!1,failed:!1,count:m.length,...d?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:C||!1},isReload:!1,nextIndex:null!==(t=null==T?void 0:T.toString())&&void 0!==t?t:"",initiated:!0}}}),v.success(),h}catch(e){throw f(e=>({threadFeedStatus:{...e.threadFeedStatus,failed:!0,loading:!1}})),e instanceof Error&&v.error({reason:"loadThreadFeed failed",error:e}),e}},loadOverallList:async function(){let{index:e,isReload:t,isRefresh:n,pcPinQueryType:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{overallListStatus:i,samanthaBot:r}=y(),s=(0,h.createReportEvent)({eventName:"load_overall_list",meta:{isRefresh:n,isReload:t,isInit:!i.initiated}});f({overallListStatus:{...i,loading:!0,isReload:!!t}});try{let{data:t}=await (0,p.retryAsync)(async()=>(await (0,b.getConversationApiClient)()).getConversationList({cursor:e,batch_size:20,pc_pin_query_type:o}),3,e=>1e3*e);s.addDurationPoint("fetch_success");let{thread_list:l=[],has_more:d,next_cursor:c,samantha_bot:v,pc_pin_query_type:u}=t||{},_=l.map(e=>{var t,n,o,i;return e.conversation?{...e.conversation,thread_source:e.thread_source,conversation_type:null===(t=e.conversation)||void 0===t?void 0:t.conversation_type,thread_id:null!==(i=null!==(o=e.thread_id_str)&&void 0!==o?o:null===(n=e.thread_id)||void 0===n?void 0:n.toString())&&void 0!==i?i:""}:void 0}).filter(e=>!(0,a.default)(e));F(_);let{conversationLinks:C}=y(),T=l.map(e=>{var t,n,o,i,a,r;return{isLocalConversation:!1,conversationId:String(null!==(i=null===(t=e.conversation)||void 0===t?void 0:t.conversation_id)&&void 0!==i?i:""),conversationType:null===(n=e.conversation)||void 0===n?void 0:n.conversation_type,threadId:null!==(r=null!==(a=e.thread_id_str)&&void 0!==a?a:null===(o=e.thread_id)||void 0===o?void 0:o.toString())&&void 0!==r?r:""}}),h=i.initiated||y().overallListStatus.initiated?C:[],g=(0,m.uniqConversationList)(n?[...T,...h]:[...h,...T]);return f(e=>{var t;return{conversationLinks:g,overallListStatus:{loading:!1,failed:!1,count:_.length,...n?{hasMore:e.overallListStatus.hasMore}:{hasMore:d||!1},isReload:!1,nextIndex:null!==(t=null==c?void 0:c.toString())&&void 0!==t?t:"",initiated:!0,pcPinQueryType:u},samanthaBot:{samanthaBotInfo:{...v,id:String(null==v?void 0:v.id)},isLazyCreate:r.isLazyCreate}}}),s.success(),_}catch(e){throw f(e=>({overallListStatus:{...e.overallListStatus,failed:!0,loading:!1}})),e instanceof Error&&s.error({reason:"loadOverallList failed",error:e}),e}},loadGuestThreadFeed:async function(){let{isReload:e,isRefresh:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadFeedStatus:n}=y(),o=L.feedServiceContainer.get("chatBotService"),i=(0,h.createReportEvent)({eventName:"load_guest_thread_feed",meta:{isRefresh:t,isReload:e,isInit:!n.initiated}});f({threadFeedStatus:{...n,loading:!0,isReload:!!e}});try{let{data:e}=await (0,p.retryAsync)(async()=>(await (0,b.getConversationApiClient)()).getTouristConversationList(),3,e=>1e3*e);i.addDurationPoint("fetch_success");let{samantha_bot:_,main_thread:C,threads:T,can_create_thread:m,can_send_message:g,reply_limit:S}=null!=e?e:{},{thread_list:I=[],has_more:A,next_index:E}=T||{};if(C){var r,s,l,d,v,u;x({conversationId:null!==(d=null===(r=C.conversation)||void 0===r?void 0:r.conversation_id)&&void 0!==d?d:"",conversationType:null===(s=C.conversation)||void 0===s?void 0:s.conversation_type,threadId:null!==(u=null!==(v=C.thread_id_str)&&void 0!==v?v:null===(l=C.thread_id)||void 0===l?void 0:l.toString())&&void 0!==u?u:"",isLocalConversation:!1})}else{let e=(0,h.createReportEvent)({eventName:"create_main_conversation",meta:{from:"header"}}),t=c.PcchatExprConversationType.CocoWeb,n=k(),i=y().addNewLocalConversation({reportEvent:e,conversation:{bot_id:null==_?void 0:_.bot_id,conversation_type:t},conversationId:(null==n?void 0:n.isLocalConversation)?null==n?void 0:n.conversationId:void 0});(null==_?void 0:_.bot_id)&&(null==o||o.setLocalConversationIdForBot({botId:_.bot_id,localConversationId:i})),x({conversationId:i,conversationType:t,threadId:(0,M.getLocalThreadId)(i,"FirstEnter","main"),isLocalConversation:!0})}let L=[null==C?void 0:C.conversation].concat(I.map(e=>{if(e.conversation){var t,n;return{...e.conversation,thread_id:null!==(n=null!==(t=e.thread_id_str)&&void 0!==t?t:e.thread_id)&&void 0!==n?n:""}}})).filter(e=>!(0,a.default)(e));F(L);let O=w(I,{append:!1,ignoreOld:!n.initiated});return P(O),f(e=>{var n,o;return{threadFeedStatus:{loading:!1,failed:!1,count:O.length,...t?{hasMore:e.threadFeedStatus.hasMore}:{hasMore:A||!1},isReload:!1,nextIndex:null!==(o=null==E?void 0:E.toString())&&void 0!==o?o:"",initiated:!0},chatNotReachLimitMap:{...e.chatNotReachLimitMap,...(null==C?void 0:null===(n=C.conversation)||void 0===n?void 0:n.conversation_id)?{[C.conversation.conversation_id]:!!C.can_chat}:{},...I.reduce((e,t)=>{var n;let{conversation_id:o}=null!==(n=t.conversation)&&void 0!==n?n:{};return o&&(e[o]=!!t.can_chat),e},{})},guestReachCreateThreadLimit:!m,guestReachSendMessageLimit:!1===g,guestSendMessageLimit:parseInt(String(null!=S?S:3*(!1!==g)),10),samanthaBot:{samanthaBotInfo:null!=_?_:{},isLazyCreate:null==C||!C.conversation}}}),i.success(),L}catch(e){throw f(e=>({threadFeedStatus:{...e.threadFeedStatus,failed:!0,loading:!1}})),e instanceof Error&&i.error({reason:"loadThreadFeed failed",error:e}),e}},loadThreadList:async function(){let{index:e,size:t,isReload:n,isRefresh:o=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{threadListStatus:i}=y(),r=(0,h.createReportEvent)({eventName:"load_thread_list",meta:{isRefresh:o,isReload:n,size:t,index:e,isInit:!i.initiated}});f({threadListStatus:{...i,loading:!0,isReload:!!n}});try{let{data:n}=await (0,p.retryAsync)(()=>u.samanthaApiService.ThreadList({index:e&&(0,T.isNumeric)(e)?Number(e):void 0,batch_size:t}),3,e=>1e3*e);r.addDurationPoint("fetch_success");let{thread_list:s=[],has_more:l,next_index:d}=n||{},c=s.map(e=>e.conversation?{...e.conversation,thread_source:e.thread_source,thread_id:e.thread_id_str||e.thread_id}:void 0).filter(e=>!(0,a.default)(e));F(c);let v=w(s,{append:!o,ignoreOld:!i.initiated&&!y().threadFeedStatus.initiated});return P(v),f(e=>{var t;return{threadListStatus:{loading:!1,failed:!1,count:v.length,...o?{hasMore:e.threadListStatus.hasMore}:{hasMore:l||!1},isReload:!1,nextIndex:null!==(t=null==d?void 0:d.toString())&&void 0!==t?t:"",initiated:!0}}}),r.success(),c}catch(n){throw f(e=>({threadListStatus:{...e.threadListStatus,failed:!0,loading:!1}})),n instanceof Error&&r.error({reason:`loadThreadList failed size:${t} index:${e}`,error:n}),n}},addNewLocalConversation:function(){let{reportEvent:e,conversation:t,conversationId:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=n||(0,m.createLocalConversationId)();return f((0,d.produce)(n=>{n.localConversationMap[o]={local:{createStatus:v.CreateConversationStatus.Pending,reportEvent:e},...t}})),o},updateLocalConversation:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];f((0,d.produce)(o=>{if(n&&(null==t?void 0:t.conversation_id)){o.localConversationMap[t.conversation_id]={...t},delete o.localConversationMap[e];return}Object.assign(o.localConversationMap[e]||{},t)}))},updateLocalConversationLocal(e,t){f((0,d.produce)(n=>{let{localConversationMap:{[e]:o}}=n;o&&(o.local=o.local?{...o.local,...t}:t)}))},updateConversationIdInLinks:(e,t)=>{f((0,d.produce)(n=>{let o=n.conversationLinks.findIndex(t=>t.conversationId===e),i={...n.conversationLinks[o],conversationId:t,isLocalConversation:!1};n.conversationLinks[o]=i}))},fetchConversationAndUpdateLocalStatusForBot:async e=>{let{token:t,botId:n,conversationId:i,localConversationId:a,messageId:r,scene:s=C.CreateScene.Default,createFrom:l}=e,d=y().localConversationMap[a];if(!(null==d?void 0:d.local))return;let{local:{reportEvent:c}}=d;try{var _,p,T,h;let e;y().updateLocalConversation(a,{local:{createStatus:v.CreateConversationStatus.Creating,createFrom:l}}),t?e=null===(p=await (await (0,b.getConversationApiClient)()).conversationInfoAddBot({token:t}))||void 0===p?void 0:p.data:n?e=null===(T=await (await (0,b.getConversationApiClient)()).getConversationInfo({bot_id:n}))||void 0===T?void 0:T.data:i&&(e=null===(h=await u.conversationApiService.CreateSubConversation({conversation_id:i,message_id:r,scene:s}))||void 0===h?void 0:h.data);let d=null==e?void 0:null===(_=e.conversation)||void 0===_?void 0:_.conversation_id;if(d&&e){if(y().updateConversationInfo(e),y().updateLocalConversation(a,{local:{createStatus:v.CreateConversationStatus.Done,newConversationId:d,createFrom:l}}),y().conversationListStatus.loading){let e=I.subscribe(e=>({conversationListStatus:e.conversationListStatus}),t=>{let{conversationListStatus:n}=t;n.loading||(null==e||e(),y().insertConversationToLinks({conversationId:d,index:1}))},{fireImmediately:!0,equalityFn:o.shallow})}else y().insertConversationToLinks({conversationId:d,index:1})}else throw Error("Expect newConversationId, but not found");return null==c||c.addDurationPoint("success"),null==c||c.success(),e.conversation}catch(e){throw y().updateLocalConversation(a,{local:{createStatus:v.CreateConversationStatus.Failed}}),e instanceof Error&&(null==c||c.error({error:e,reason:"create_conversation_error"})),e}},removeConversationFromLinks:e=>{let{conversationId:t}=e,n=y().conversationLinks.findIndex(e=>e.conversationId===t);~n&&f((0,d.produce)(e=>D(e,n)))},removeConversationsFromLinks:e=>{let{conversationIds:t=[]}=e;f((0,d.produce)(e=>{let n=!1,{botConversationIndex:o}=e,i=e.conversationLinks.filter((i,a)=>{let r=t.includes(i.conversationId);return r&&(n=!0,a<e.botConversationIndex&&(o-=1)),!r});n&&(e.conversationLinks=i,e.botConversationIndex=o)}))},insertConversationToLinks:e=>{f((0,d.produce)(t=>U(t,{...e})))},insertNewConversationAndRemoveOldConversationFromLinks:(e,t)=>{f((0,d.produce)(n=>{U(n,{...e});let o=n.conversationLinks.findIndex(e=>e.conversationId===t.conversationId);~o&&D(n,o)}))},setGuestCanChat:e=>{f({guestCanChat:e})},setNotReachLimitMap:e=>{f(t=>({chatNotReachLimitMap:{...t.chatNotReachLimitMap,...e}}))},setGuestReachCreateThreadLimit:e=>{f({guestReachCreateThreadLimit:e})},updateMainConvLink:e=>{let{conversation:t={},threadId:n="",isLocalConversation:o=!1}=e,i=(0,h.createReportEvent)({eventName:"update_main_convLink"});try{var r,s;if(!t||!n)throw Error("getMainConversationInfo: invalid data from api");if(x({conversationId:null!==(r=null==t?void 0:t.conversation_id)&&void 0!==r?r:"",conversationType:null==t?void 0:t.conversation_type,threadId:null!==(s=null==n?void 0:n.toString())&&void 0!==s?s:"",isLocalConversation:o}),!o){let e=[t].filter(e=>!(0,a.default)(e));F(e)}i.success()}catch(e){throw e instanceof Error&&i.error({reason:"getMainConversationInfo failed",error:e}),e}},updateChatCreateInFirstTime:e=>{let{conversationId:t="",status:n=!1}=e;f((0,d.produce)(e=>{e.chatCreateInFirstTime[t]=n}))}}}},6940:function(e,t,n){var o,i;n.d(t,{ConversationType:function(){return a},LoadConversationListType:function(){return r}});let a=((o={}).LocalConversation="LocalConversation",o.Conversation="Conversation",o),r=((i={}).Bot="bot",i.Feed="feed",i.Thread="thread",i.Guest="guest",i.Overall="overall",i)},73270:function(e,t,n){n.d(t,{createLocalConversationId:function(){return i},uniqConversationList:function(){return a}});var o=n(554450);let i=()=>{let e=(()=>{var e,t;let n=String(1e16*Math.random()).slice(0,16);if("undefined"==typeof window||null===(t=window)||void 0===t||null===(e=t.crypto)||void 0===e||!e.getRandomValues)return n;try{return window.crypto.getRandomValues(new Uint8Array(16)).toString().replaceAll(",","").slice(0,16)}catch(e){return n}})();return`local_${e}`},a=e=>(0,o.default)(e,"conversationId")},230932:function(e,t,n){n.r(t),n.d(t,{createStore:function(){return r},initFeedStore:function(){return l},useFeedStore:function(){return s}});var o=n(952259),i=n(321647),a=n(209662);let r=e=>{let{prefix:t,isEnableDebug:n,reduxDevToolsSnapshot:r}=e;return n&&r?(0,i.create)()((0,o.devtools)((0,o.subscribeWithSelector)(a.createConversationSlice),{name:`${t}-chat-feed-store`})):(0,i.create)()((0,o.subscribeWithSelector)(a.createConversationSlice))},s=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];let{_useFeedStore:o}=s.prototype;if(o)return o(...t);throw Error("useFeedStore is not initialized")};function l(e){let{_useFeedStore:t}=s.prototype||{};if(!t){let t=r({...e});Object.setPrototypeOf(s.prototype,t),Object.defineProperties(s,{...Object.getOwnPropertyDescriptors(t)}),s.prototype._useFeedStore=t}}},721118:function(e,t,n){n.d(t,{botConversationListDataSelector:function(){return a},conversationListSelector:function(){return v},conversationSelector:function(){return c},localConversationSelector:function(){return d},mainConvBotIdSelector:function(){return s},mainConversationLinkSelector:function(){return r},threadListDataSelector:function(){return l}});var o=n(785926),i=n(835789);let a=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,conversationListStatus:e.conversationListStatus,loadBotConversationList:e.loadBotConversationList}),r=e=>e.mainConversationLink,s=e=>{var t,n,a;return(0,o.getBotIdByConversationIdSelector)(e,null===(t=r(e))||void 0===t?void 0:t.conversationId,!0)||(null===(a=e.samanthaBot)||void 0===a?void 0:null===(n=a.samanthaBotInfo)||void 0===n?void 0:n.bot_id)||i.MAIN_BOT_ID},l=e=>({conversationLinks:e.conversationLinks,botConversationIndex:e.botConversationIndex,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadThreadList:e.loadThreadList,loadThreadFeed:e.loadThreadFeed}),d=(e,t)=>t?e.localConversationMap[t]:void 0,c=(e,t)=>t?e.conversationMap[t]:void 0,v=e=>({conversationLinks:e.conversationLinks,conversationListStatus:e.conversationListStatus,overallListStatus:e.overallListStatus,threadListStatus:e.threadListStatus,threadFeedStatus:e.threadFeedStatus,loadOverallList:e.loadOverallList,loadConversationList:e.loadConversationList})},785926:function(e,t,n){n.d(t,{conversationTypeByIdSelector:function(){return i},getBotIdByConversationIdSelector:function(){return l},getConversationInfoByConversationIdSelector:function(){return s},getInfoByConversationIdSelector:function(){return r},threadIdByConversationIdSelector:function(){return a}});var o=n(884181);let i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!t)return;let{conversation_type:o}=e.conversationMap[t]||{};if(o||!n)return o;let{conversation_type:i}=e.localConversationMap[t]||{};return t?i:void 0},a=(e,t)=>{if(!t)return;let n=[...e.conversationLinks,e.mainConversationLink].find(e=>(null==e?void 0:e.conversationId)===t);return null==n?void 0:n.threadId},r=(e,t,n)=>{if(!t)return{};let i=o.feedServiceContainer.get("chatBotService",!0),a=e.conversationMap[t],r=(null==a?void 0:a.bot_id)||n;return{conversation:a,botInfo:r?null==i?void 0:i.getBot(r):{}}},s=(e,t)=>t?e.conversationMap[t]:{},l=(e,t,n)=>{let{botInfo:i,conversation:a}=r(e,t),s=o.feedServiceContainer.get("chatBotService",!0),l=(null==i?void 0:i.id)||(null==i?void 0:i.bot_id)||(null==a?void 0:a.bot_id);return l||!n?l:t?null==s?void 0:s.getBotIdFromLocalConversation(t):void 0}},510665:function(e,t,n){n.d(t,{deleteConversationInMap:function(){return o}});function o(e,t){e.conversationMap[t]&&delete e.conversationMap[t],e.lastMessageIndexMap[t]&&delete e.lastMessageIndexMap[t]}},651610:function(e,t,n){n.d(t,{getBotConversationListFromConversationLinks:function(){return a},getLocalThreadId:function(){return r},getThreadLinksFromConversationLinks:function(){return i},getUnreadCount:function(){return o},isLocalThreadId:function(){return s}});let o=e=>{var t,n;let o=Number(null!==(t=null==e?void 0:e.badge_count)&&void 0!==t?t:null==e?void 0:e.message_index)||0,i=Number(null!==(n=null==e?void 0:e.read_badge_count)&&void 0!==n?n:null==e?void 0:e.read_message_index)||0;return o>i?o-i:0};function i(e){let{conversationLinks:t,botConversationIndex:n}=e;return t.slice(0,n)}function a(e){let{conversationLinks:t,botConversationIndex:n}=e;return t.slice(n)}let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub";return`${"sub"===n?"localThread_":"localMainThread_"}${t||""}_${e}`},s=function(e,t){var n,o;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sub",a="sub"===i?"localThread_":"localMainThread_";return t?null==e?void 0:null===(n=e.startsWith)||void 0===n?void 0:n.call(e,`${a}${t}_`):null==e?void 0:null===(o=e.startsWith)||void 0===o?void 0:o.call(e,a)}},389174:function(e,t,n){n.d(t,{isBotConversation:function(){return _},isBotConversationType:function(){return d},isCocoBotType:function(){return C},isCocoConversation:function(){return c},isCocoConversationType:function(){return s},isCocoSubConversation:function(){return v},isCocoSubConversationType:function(){return l},isConversationReviewStatusRejected:function(){return h},isGuanFangBotType:function(){return T},isSamantha:function(){return u},isUserBotType:function(){return p}});var o=n(101874),i=n(845647),a=n(773289),r=n(524129);let s=e=>e===o.PcchatExprConversationType.CocoWeb||e===o.PcchatExprConversationType.Coco,l=e=>e===o.PcchatExprConversationType.CocoWebSub||e===o.PcchatExprConversationType.CocoSub,d=e=>e===o.PcchatExprConversationType.Bot,c=e=>s(null==e?void 0:e.conversation_type),v=e=>l(null==e?void 0:e.conversation_type),u=(e,t)=>{let n=c(e),o=v(e);return n||o||t===i.ChatType.NewThread||t===i.ChatType.ThreadLocalConversation||t===i.ChatType.CollectionLocalConversation||t===i.ChatType.SharedThreadContinueChat||t===i.ChatType.NewDoc},_=e=>d(null==e?void 0:e.conversation_type),C=e=>e===a.BotType.Coco||e===a.BotType.CocoWeb,p=e=>e===a.BotType.User,T=e=>e===a.BotType.GuanFang,h=e=>{let t=!1;try{let n=JSON.parse((null==e?void 0:e.extra)||"");t=Number(n.share_from_review_status)===r.ReviewStatus.Reject}catch(e){}return t}}}]);